DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umozni stlacat tlacidla aj ked bezi delay
                       7    
                       8    ;Prerusenia pojdu, ale treba dat sakra pozor na zalohovanie veci!!!
                       9    
                      10    
                      11    $MOD51
                      12    $DEBUG
                      13    
                =1    14    $include (lift.inc)
                =1    15    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    16    i8255INA        equ     080h
  0081          =1    17    i8255INB        equ     081h
  0082          =1    18    i8255INC        equ     082h
  0083          =1    19    i8255INCW       equ     083h
  00C0          =1    20    i8255OUTA       equ     0c0h
  00C1          =1    21    i8255OUTB       equ     0c1h
  00C2          =1    22    i8255OUTC       equ     0c2h
  00C3          =1    23    i8255OUTCW      equ     0c3h
                =1    24    
  0028          =1    25    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    26    INPORTB         data    21h
  0022          =1    27    INPORTC         data    22h
  0023          =1    28    OUTPORTA        data    23h
  0024          =1    29    OUTPORTB        data    24h
  0025          =1    30    OUTPORTC        data    25h
  0026          =1    31    INPORTBold      data    26h
  0027          =1    32    CTRLREG         data    27h
                =1    33    
  0030          =1    34    POSITION        data    30h
  0031          =1    35    LOWEST          data    31h
  0032          =1    36    HIGHEST         data    32h
  0033          =1    37    STOPTIMER       data    33h
  0034          =1    38    OUTPORTBold     data    34h
                =1    39    
                =1    40    ;----------------
  0036          =1    41    FLOORREQ        data    36h
                =1    42    ;----------------
                =1    43    
  0040          =1    44    STOPNOT         bit     INPORTA.0
  0041          =1    45    PKI1            bit     INPORTA.1
  0042          =1    46    PKI2            bit     INPORTA.2
  0043          =1    47    PKI3            bit     INPORTA.3
  0044          =1    48    PKI4            bit     INPORTA.4
  0045          =1    49    DOORCLSD        bit     INPORTA.5 
                =1    50    
  0009          =1    51    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    52    MB2             bit     INPORTB.2
  000B          =1    53    SKRH            bit     INPORTB.3
  000C          =1    54    SKRD            bit     INPORTB.4
  000D          =1    55    DP              bit     INPORTB.5
  000E          =1    56    DPZK            bit     INPORTB.6
  000F          =1    57    DPK             bit     INPORTB.7
                =1    58    
DEBUG                                                                                                         PAGE 2

  0031          =1    59    MB1old          bit     INPORTBold.1
  0032          =1    60    MB2old          bit     INPORTBold.2
  0033          =1    61    SKRHold         bit     INPORTBold.3
  0034          =1    62    SKRDold         bit     INPORTBold.4
                =1    63    
                =1    64    
                =1    65    
                =1    66    
                =1    67    
  0010          =1    68    PI1             bit     INPORTC.0       
  0011          =1    69    PI2D            bit     INPORTC.1
  0012          =1    70    PI2U            bit     INPORTC.2
  0013          =1    71    PI3D            bit     INPORTC.3
  0014          =1    72    PI3U            bit     INPORTC.4
  0015          =1    73    PI4             bit     INPORTC.5
                =1    74    
                =1    75    
                =1    76    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    77    ; ****************************************************************************
                =1    78    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    79    ; ----------------------------------------------------------------------------
                =1    80    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    81    ; ----------------------------------------------------------------------------
                =1    82    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    83    ; ****************************************************************************
                =1    84    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    85    ; ----------------------------------------------------------------------------
                =1    86    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    87    ; ----------------------------------------------------------------------------
                =1    88    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    89    ; ----------------------------------------------------------------------------
                =1    90    
                =1    91    
  0018          =1    92    KS              bit     OUTPORTA.0
  0019          =1    93    PKO1            bit     OUTPORTA.1
  001A          =1    94    PKO2            bit     OUTPORTA.2
  001B          =1    95    PKO3            bit     OUTPORTA.3
  001C          =1    96    PKO4            bit     OUTPORTA.4
                =1    97    
  0020          =1    98    UP              bit     OUTPORTB.0
  0021          =1    99    DOWN            bit     OUTPORTB.1
  0022          =1   100    FAST            bit     OUTPORTB.2
  0023          =1   101    SLOW            bit     OUTPORTB.3
  0024          =1   102    FLED1           bit     OUTPORTB.4
  0025          =1   103    FLED2           bit     OUTPORTB.5
  0026          =1   104    FLED3           bit     OUTPORTB.6
  0027          =1   105    FLED4           bit     OUTPORTB.7
                =1   106    
  0028          =1   107    PO1             bit     OUTPORTC.0
  0029          =1   108    PO2D            bit     OUTPORTC.1
  002A          =1   109    PO2U            bit     OUTPORTC.2
  002B          =1   110    PO3D            bit     OUTPORTC.3
  002C          =1   111    PO3U            bit     OUTPORTC.4
  002D          =1   112    PO4             bit     OUTPORTC.5
  002E          =1   113    LEDD            bit     OUTPORTC.6
  002F          =1   114    LEDU            bit     OUTPORTC.7
                =1   115    
  0038          =1   116    STOPPED         bit     CTRLREG.0
DEBUG                                                                                                         PAGE 3

  0039          =1   117    DOORCLSDold     bit     CTRLREG.1
  003A          =1   118    UPold           bit     CTRLREG.2
  003B          =1   119    DOWNold         bit     CTRLREG.3
  003C          =1   120    FASTold         bit     CTRLREG.4
  003D          =1   121    SLOWold         bit     CTRLREG.5
                =1   122    
  00B6          =1   123    WRNOT           bit     0b6h        ; p3.6
  00B7          =1   124    RDNOT           bit     0b7h        ; p3.7
                =1   125    
                =1   126    ; bitove masky
                =1   127    ; 8255OUT 
                =1   128    ; port A
  0001          =1   129    bmKS              equ    00000001b
  0002          =1   130    bmPKO1            equ    00000010b
  0004          =1   131    bmPKO2            equ    00000100b
  0008          =1   132    bmPKO3            equ    00001000b
  0010          =1   133    bmPKO4            equ    00010000b
                =1   134    
                =1   135    ; port B
  0001          =1   136    bmUP              equ    00000001b
  0002          =1   137    bmDOWN            equ    00000010b
  0004          =1   138    bmFAST            equ    00000100b
  0008          =1   139    bmSLOW            equ    00001000b
  0010          =1   140    bmFLED1           equ    00010000b
  0020          =1   141    bmFLED2           equ    00100000b
  0040          =1   142    bmFLED3           equ    01000000b
  0080          =1   143    bmFLED4           equ    10000000b
                =1   144    
                =1   145    ; port C
  0001          =1   146    bmPO1             equ    00000001b
  0002          =1   147    bmPO2D            equ    00000010b
  0004          =1   148    bmPO2U            equ    00000100b
  0008          =1   149    bmPO3D            equ    00001000b
  0010          =1   150    bmPO3U            equ    00010000b
  0020          =1   151    bmPO4             equ    00100000b
  0040          =1   152    bmLEDD            equ    01000000b
  0080          =1   153    bmLEDU            equ    10000000b
                =1   154    
                =1   155    ; 8255IN
                =1   156    ; port A
  0001          =1   157    bmSTOP            equ    00000001b
  0002          =1   158    bmPKI1            equ    00000010b
  0004          =1   159    bmPKI2            equ    00000100b
  0008          =1   160    bmPKI3            equ    00001000b
  0010          =1   161    bmPKI4            equ    00010000b
  0020          =1   162    bmDOORCLSD        equ    00100000b
                =1   163    
                =1   164    ; port B
  0002          =1   165    bmMB1I            equ    00000010b
  0004          =1   166    bmMB2I            equ    00000100b
  0008          =1   167    bmSKRHI           equ    00001000b
  0010          =1   168    bmSKRHD           equ    00010000b
  0020          =1   169    bmDPI             equ    00100000b
  0040          =1   170    bmDPZKI           equ    01000000b
  0080          =1   171    bmDPKI            equ    10000000b
                =1   172    
                =1   173    ; port C
  0001          =1   174    bmPI1             equ    00000001b
DEBUG                                                                                                         PAGE 4

  0002          =1   175    bmPI2D            equ    00000010b
  0004          =1   176    bmPI2U            equ    00000100b
  0008          =1   177    bmPI3D            equ    00001000b
  0010          =1   178    bmPI3U            equ    00010000b
  0020          =1   179    bmPI4             equ    00100000b
                =1   180    
                =1   181    ; Sachta - masky
  003E          =1   182    bmSmerPI1U            equ    00111110b
  0001          =1   183    bmSmerPI2D            equ    00000001b
  0038          =1   184    bmSmerPI2U            equ    00111000b
  0007          =1   185    bmSmerPI3D            equ    00000111b
  0020          =1   186    bmSmerPI3U            equ    00100000b
  001F          =1   187    bmSmerPI4D            equ    00011111b
                =1   188    
                =1   189    ; Kabina - masky
  001C          =1   190    bmSmerPKI1U           equ    00011100b
  0002          =1   191    bmSmerPKI2D           equ    00000010b
  0018          =1   192    bmSmerPKI2U           equ    00011000b
  0006          =1   193    bmSmerPKI3D           equ    00000110b
  0010          =1   194    bmSmerPKI3U           equ    00010000b
  000E          =1   195    bmSmerPKI4D           equ    00001110b
                     196    
                     197    _BP_    MACRO 
                     198            clr     P3.3
                     199            setb    EX1
                     200            nop
                     201            nop
                     202    ENDM
                     203    
                     204    LJZ     MACRO   NAVESTIE
                     205            jnz     $+5
                     206            ljmp    NAVESTIE
                     207            nop
                     208    ENDM
                     209    
                     210    LJNZ    MACRO   NAVESTIE
                     211            jz      $+5
                     212            ljmp    NAVESTIE
                     213            nop
                     214    ENDM
                     215    
                     216    LJB     MACRO   TESTBIT, NAVESTIE
                     217            jnb     TESTBIT, $+6
                     218            ljmp    NAVESTIE
                     219            nop
                     220    ENDM
                     221    
                     222    LJNB    MACRO   TESTBIT, NAVESTIE
                     223            jb      TESTBIT, $+6
                     224            ljmp    NAVESTIE
                     225            nop
                     226    ENDM
                     227    
                     228    CJE     MACRO   OP1, OP2, NAVESTIE
                     229            cjne    OP1, OP2, $+7
                     230            jmp    NAVESTIE
                     231            nop
                     232    ENDM
DEBUG                                                                                                         PAGE 5

                     233    
                     234    LCJNE   MACRO   OP1, OP2, NAVESTIE
                     235            cjne    OP1, OP2, $+6
                     236            jmp     $+6
                     237            ljmp    NAVESTIE
                     238            nop
                     239    ENDM
                     240    
                     241    ZAKMITC MACRO   TYPCLONKY
                     242            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     243            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     244            jnb     TYPCLONKY, $-3  ; 
                     245            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     246    ENDM
                     247    
                     248    ZASTAV  MACRO  C_POSCH, SMER
                     249                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     250            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     251            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     252            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     253            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
                     254            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
                     255            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     256            orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
                     257            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     258    ENDM
                     259    
                     260    NAJNIZSIE  MACRO
                     261            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     262            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     263            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     264            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     265     ; LL1: 
                     266            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     267            clr     C               ; Inak shiftnem o 2
                     268            rlc     A               ;
                     269            clr     C               ;
                     270            rlc     A               ;
                     271            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     272    ; LL2:
                     273            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     274    ENDM
                     275    
                     276    NAJVYSSIE  MACRO
                     277            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     278            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
DEBUG                                                                                                         PAGE 6

                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     279            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     280            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     281     ; LL1: 
                     282            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     283            clr     C               ; Inak shiftnem o 2
                     284            rrc     A               ;
                     285            clr     C               ;
                     286            rrc     A               ;
                     287            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     288    ; LL2:
                     289            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     290            clr     C               ;
                     291            subb    A, R0           ;
                     292    ENDM
                     293    
                     294    VYSSIE_KABINA  MACRO  POSCH
                     295            mov     A, INPORTA
                     296            anl     A, #00011110b
                     297            clr     C
                     298            rrc     A
                     299    ;LL1    
                     300            mov     R0, #&POSCH
                     301            clr     C
                     302            rrc     A
                     303            djnz    R0, $-2;LL1
                     304    ENDM
                     305    
                     306    NIZSIE_KABINA  MACRO  POSCH
                     307            mov     A, #5
                     308            clr     C
                     309            subb    A, #&POSCH
                     310            mov     R0, A
                     311            mov     A, INPORTA
                     312            anl     A, #00011110b
                     313            clr     C
                     314            rlc     A
                     315            clr     C
                     316            rlc     A
                     317            clr     C
                     318            rlc     A
                     319    ;LL1   
                     320            clr     C
                     321            rlc     A
                     322            djnz    R0, $-2;LL1
                     323    ENDM
                     324    
                     325    POLOHA_LED  MACRO  POLOHA
                     326            clr     LEDU            
                     327            clr     LEDD 
                     328            clr     FLED1             
                     329            clr     FLED2                
                     330            clr     FLED3           
                     331            clr     FLED4           
DEBUG                                                                                                         PAGE 7

                     332            setb    FLED&POLOHA
                     333            lcall   WRITEPORTS
                     334    ENDM
                     335    
                     336    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               337    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     338                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     339                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     340    ;osetrenie vektorov preruseni
0000                 341            org     0000h           ; adresa odkial startuje program po resete
0000 020033          342            ljmp    START           ; skok na zaciatok kodu programu
                     343            
000B                 344            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 0207C2          345            ljmp    INT_TIMER0      ; pre citac T0
                     346                  
0033                 347            org     0033h           ; od tejto adresy sa zacina kod programu
                     348            
0033                 349    START:
0033                 350    RESET:  
                     351            ; riadiace signaly do pasivnej urovne 
0033 D2B6            352            setb    WRNOT
0035 D2B7            353            setb    RDNOT
0037 753300          354            mov     STOPTIMER, #0
003A 758140          355            mov     SP, #STACK
                     356    
                     357            ; pockame si na inicializaciu obvodov 8255  
003D 7900            358            mov     R1, #0 
003F 7AFF            359            mov     R2, #0ffh
0041 D9FE            360            djnz    R1, $
0043 DAFC            361            djnz    R2, $-2
                     362            
                     363            ; teraz ich mozeme nastavit
0045 75809B          364            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          365            mov     p2, #i8255INCW
004B C2B6            366            clr     WRNOT
004D 00              367            nop
004E 00              368            nop
004F 00              369            nop
0050 00              370            nop
0051 D2B6            371            setb    WRNOT
0053 758080          372            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          373            mov     p2, #i8255OUTCW
0059 C2B6            374            clr     WRNOT
005B 00              375            nop
005C 00              376            nop
005D 00              377            nop
005E 00              378            nop
005F D2B6            379            setb    WRNOT
                     380            
                     381            ;_BP_
                     382            
                     383            ;-----------------------
                     384            ; Prerusenia
                     385            ;----------------------- 
                     386            ;clr     TR1                 ; zastavi sa citac T1
                     387            ;clr     TR0                 ; a tiez citac T0
DEBUG                                                                                                         PAGE 8

                     388            ;mov     SCON,#01010010b     ; nastavenie registra SCON
                     389            ;                            ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     390            ;                            ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     391            ;                            ; RI=0 (prijimaci register - nebol prijaty znak)
                     392            ;mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
                     393            ;mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     394            ;                            ; T1: mod 2 - po preteceni sa TL nastavi na hodnotu TH
                                                                               
                     395            ;                            ; GATE=0 (programove riadenie casovaca)
                     396            ;                            ; C/T#=0 interne hodiny/12
                     397            ;                            ; T0: mod 1 - 16 bitove pocitadlo
                     398            ;                            ; GATE=0 (programove riadenie casovaca)
                     399            ;                            ; C/T#=0 interne hodiny/12
                     400            ;mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila preno
                                                                               sova rychlost seriovej linky
                     401            ;mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
                     402            ;mov     TH1,#TIMERCONST     ; 
                     403            ;mov     TL0, #0D2h           ; inicializacia casovaca T0 65409,92(- 57600 = 0e100h 
                                                                               - to bolo)
                     404            ;mov     TH0, #0FFh
                     405    
                     406            ;setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     407            ;_BP_
                     408    
                     409    ;       ;setb    EX0                 ; prerusenie INT0  - ostava zakazane, signal STOP osetr
                                                                               ime priamo v hlavnej slucke
                     410    ;       ;setb    ES                  ; prerusenie seriovej linky teraz nevyuzivame
                     411            ;setb    ET0                 ; povolime prerusenia od casovaca T0
                     412            ;setb    TR0
                     413            ;setb    EA                  ; spust cely prerusovaci mechanizmus
                     414            
0061 C28E            415            clr     TR1                 ; zastavi sa citac T1
0063 759852          416            mov     SCON,#01010010b     ; nastavenie registra SCON
                     417                                        ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     418                                        ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     419                                        ; RI=0 (prijimaci register - nebol prijaty znak)
0066 758801          420            mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
0069 758921          421            mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     422                                        ; T1: mod 1 - 16 bitove pocitadlo
                     423                                        ; GATE=0 (programove riadenie casovaca)
                     424                                        ; C/T#=0 interne hodiny/12
                     425                                        ; T0: mod 1 - 16 bitove pocitadlo
                     426                                        ; GATE=0 (programove riadenie casovaca)
                     427                                        ; C/T#=0 interne hodiny/12
006C 758700          428            mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila prenos
                                                                               ova rychlost seriovej linky
006F 758BFA          429            mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
0072 758DFA          430            mov     TH1,#TIMERCONST     ; 
0075 758A00          431            mov     TL0, #000h           ; inicializacia casovaca T0 - 57600 = 0e100h
0078 758C4C          432            mov     TH0, #04Ch
                     433            
007B D28C            434            setb    TR0
007D D28E            435            setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     436            
                     437            ;-----------------------
                     438            ; Prerusenia
                     439            ;-----------------------
                     440            
DEBUG                                                                                                         PAGE 9

                     441    
                     442            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
007F 752800          443            mov     INPORTA, #0
0082 75211E          444            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0085 752200          445            mov     INPORTC, #0
0088 75231E          446            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
008B 7524F0          447            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
008E 7525FF          448            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0091 D218            449            setb    KS
0093 C238            450            clr     STOPPED
0095 1208CD          451            call    WRITEPORTS          ; zapis novu informaciu
                     452    ;;;;;;;;
                     453    
0098 752300          454            mov     OUTPORTA, #0
009B 752400          455            mov     OUTPORTB, #0
009E 752500          456            mov     OUTPORTC, #0
00A1 1208CD          457            call    WRITEPORTS          ; zapis novu informaciu
                     458    
00A4 752800          459            mov     INPORTA, #0
00A7 752100          460            mov     INPORTB, #0         
00AA 752200          461            mov     INPORTC, #0
00AD 12086E          462            call    READPORTS           ; prvotne nacitanie udajov
                     463            
                     464            
00B0 900917          465            mov     DPTR, #STR_INIT         ; vypis info 
00B3 120904          466            lcall   DISPSTR                 ; o inicializacii       
                     467    
00B6                 468    CALIB:
                     469            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     470            ;setb    TR0
00B6 12086E          471            lcall   READPORTS                   ; precitaj, co je na portoch
00B9 300C13          472            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00BC D221            473            setb    DOWN                        ; inak pod dole
00BE D222            474            setb    FAST                        ; a rychlo
00C0 C223            475            clr     SLOW                        ;
00C2 C220            476            clr     UP                
00C4 1208CD          477            lcall   WRITEPORTS                  ; zapis informaciu 
00C7                 478    CALIBLOOP:
00C7 12086E          479            lcall   READPORTS                   ; 
00CA 300C02          480            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00CD 80F8            481            jmp     CALIBLOOP
00CF                 482    CALIBEND:                              
00CF C222            483            clr     FAST                        ; zastavime v tomto smere
00D1 C221            484            clr     DOWN                        ;
00D3 D223            485            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00D5 D220            486            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00D7 1208CD          487            lcall   WRITEPORTS 
00DA                 488    CALIBEND2:
00DA 12086E          489            lcall   READPORTS                   ; 
00DD 2009FA          490            jb      MB1, CALIBEND2              ; 
00E0 C223            491            clr     SLOW                        ; A teraz sme uz naozaj spravne
00E2 C220            492            clr     UP                          ; 
00E4 D224            493            setb    FLED1
00E6 1208CD          494            lcall   WRITEPORTS                  ; zapis informaciu
                     495            ;clr     TR0
DEBUG                                                                                                         PAGE 10

                     496            ;_BP_
00E9 900917          497            mov     DPTR, #STR_INIT             ; vypis info o kalibracii
00EC 120904          498            lcall   DISPSTR                     ;
00EF                 499    MAIN:
                     500    
                     501    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     502    ; ****************************************************************************
                     503    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     504    ; ----------------------------------------------------------------------------
                     505    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     506    ; ----------------------------------------------------------------------------
                     507    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     508    ; ****************************************************************************
                     509    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     510    ; ----------------------------------------------------------------------------
                     511    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     512    ; ----------------------------------------------------------------------------
                     513    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     514    ; ****************************************************************************
                     515    ; POSITION
                     516    ; ****************************************************************************
                     517    
                     518    
                     519    
00EF 7D00            520            mov     R5, #0
00F1 7E14            521            mov     R6, #20
00F3 D2A9            522            setb    ET0;
                     523            
                     524    
                     525    
                     526    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     527    
00F5                 528    FLOOR1:
                     529 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00F5 C22F            530 +1         clr     LEDU            
00F7 C22E            531 +1         clr     LEDD 
00F9 C224            532 +1         clr     FLED1             
00FB C225            533 +1         clr     FLED2                
00FD C226            534 +1         clr     FLED3           
00FF C227            535 +1         clr     FLED4           
0101 D224            536 +1         setb    FLED1
0103 1208CD          537 +1         lcall   WRITEPORTS
0106 120826          539            lcall   WAITFORTIMER    ; simulacia TIMERu
0109 12086E          540    F1S:    lcall   READPORTS     ;-; nacitanie dat
010C C219            541            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
010E C228            542            clr     PO1             ;
0110 1208CD          543            lcall   WRITEPORTS      ;
0113 200FF3          544            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0116 E528            545            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
0118 541C            546            anl     A, #00011100b ;-;
011A 7008            547            jnz     F1OK          ;-; ak ano, podme na to
011C E522            548            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
011E 543E            549            anl     A, #00111110b ;-;
0120 7002            550            jnz     F1OK          ;-; ak ano, podme na to
DEBUG                                                                                                         PAGE 11

0122 80E5            551            jmp     F1S             ; Nemam sa kde hnut, opakujem
0124 D220            552    F1OK:   setb    UP              ; rychly pohyb hore
0126 D222            553            setb    FAST            ; 
0128 C223            554            clr     SLOW            ;
012A 1208CD          555            lcall   WRITEPORTS      ; 
012D 020130          556            jmp     UP1           ;-; prejdi do stavu UP1
0130                 557    UP1:
                     558 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0130 C22F            559 +1         clr     LEDU            
0132 C22E            560 +1         clr     LEDD 
0134 C224            561 +1         clr     FLED1             
0136 C225            562 +1         clr     FLED2                
0138 C226            563 +1         clr     FLED3           
013A C227            564 +1         clr     FLED4           
013C D224            565 +1         setb    FLED1
013E 1208CD          566 +1         lcall   WRITEPORTS
                     568 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0141 1207F1          569 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0144 12086E          570 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0147 3009FA          571 +1         jnb     MB1, $-3  ; 
014A 1207F1          572 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
014D 12086E          574    UP1A:   lcall   READPORTS       ; nacitanie dat
                     575 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0150 200B03          576 +1         jb      SKRH, $+6
0153 020774          577 +1         ljmp    ERR_SKRH
0156 00              578 +1         nop
                     580 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0157 200903          581 +1         jb      MB1, $+6
015A 02074D          582 +1         ljmp    ERR_2SPOM_C
015D 00              583 +1         nop
015E 200AEC          585            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     586 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0161 1207F1          587 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0164 12086E          588 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0167 300AFA          589 +1         jnb     MB2, $-3  ; 
016A 1207F1          590 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
016D D22E            592            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
016F 1208CD          593            lcall   WRITEPORTS      ;
0172 020175          594            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0175                 595    UP1_MB2:
0175 12086E          596            lcall   READPORTS       ; nacitanie dat
                     597 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0178 200B03          598 +1         jb      SKRH, $+6
017B 020774          599 +1         ljmp    ERR_SKRH
017E 00              600 +1         nop
                     602 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
017F 200903          603 +1         jb      MB1, $+6
0182 020738          604 +1         ljmp    ERR_1SPOM_C
0185 00              605 +1         nop
0186 200AEC          607            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0189 D22F            608            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
018B 1208CD          609            lcall   WRITEPORTS      ;   
                     610 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
DEBUG                                                                                                         PAGE 12

018E 1207F1          611 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0191 12086E          612 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0194 300AFA          613 +1         jnb     MB2, $-3  ; 
0197 1207F1          614 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     616    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     617    ;        anl     A, #00000100b ;-;
                     618    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     619 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     620 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
019A C3              621 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
019B 7400            622 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
019D 7212            623 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
019F B00E            624 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
01A1 7242            625 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
01A3 720F            626 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
01A5 7238            627 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
01A7 3400            628 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01A9 702E            630            jnz     U1_MB2C       ;-; Ak ano, zastav
                     631 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01AB E522            632 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01AD 33              633 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01AE 547E            634 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
01B0 7805            635 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     636 +1  ; LL1: 
01B2 6006            637 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
01B4 C3              638 +1         clr     C               ; Inak shiftnem o 2
01B5 13              639 +1         rrc     A               ;
01B6 C3              640 +1         clr     C               ;
01B7 13              641 +1         rrc     A               ;
01B8 D8F8            642 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     643 +1 ; LL2:
01BA 7405            644 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
01BC C3              645 +1         clr     C               ;
01BD 98              646 +1         subb    A, R0           ;
                     648 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
01BE B40203          649 +1         cjne    A, #2, $+6
01C1 0201C7          650 +1         jmp     $+6
01C4 0201E3          651 +1         ljmp    UP1_MB1
01C7 00              652 +1         nop
                     654 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
01C8 E528            655 +1         mov     A, INPORTA
01CA 541E            656 +1         anl     A, #00011110b
DEBUG                                                                                                         PAGE 13

01CC C3              657 +1         clr     C
01CD 13              658 +1         rrc     A
                     659 +1 ;LL1    
01CE 7802            660 +1         mov     R0, #2
01D0 C3              661 +1         clr     C
01D1 13              662 +1         rrc     A
01D2 D8FC            663 +1         djnz    R0, $-2;LL1
01D4 6003            665            jz      U1_MB2C         ; |   ak neni zastavujem         
01D6 0201E3          666            jmp     UP1_MB1          ; |   inak nezastavim        
01D9 D223            667    U1_MB2C: setb    SLOW            ;       Ak ano, spomalme
01DB C222            668            clr     FAST            ; 
01DD 1208CD          669            lcall   WRITEPORTS      ;         
01E0 0201FA          670            jmp     UP1_STOP       ;-; a prejdi do stavu UP1_STOP 
01E3                 671    UP1_MB1:
01E3 12086E          672            lcall   READPORTS       ; nacitanie dat
                     673 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01E6 200B03          674 +1         jb      SKRH, $+6
01E9 020774          675 +1         ljmp    ERR_SKRH
01EC 00              676 +1         nop
                     678 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
01ED 200A03          679 +1         jb      MB2, $+6
01F0 020762          680 +1         ljmp    ERR_ZAST_C
01F3 00              681 +1         nop
01F4 2009EC          683            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     684    
                     685    ;        ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0) 
                     686    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
                     687    ;        jnz     U1_MB1C       ;-; Ak ano, zastav
                     688    ;        NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojim
                                                                               e urcite)
                     689    ;        LCJNE   A, #2, UP2      ; |   ak nie, nezastavujeme 
                     690    ;        VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                     691    ;        jz      U1_MB1C         ; |   ak neni zastavujem         
01F7 020298          692            ljmp    UP2             ; |   inak nezastavim        
                     693    ;U1_MB1C: clr     UP              ; zastav motor
                     694    ;        setb    UPOld           ;       (a zalohuj) 
                     695    ;        clr     DOWNOld         ;       (a zalohuj)
                     696    ;        clr     FAST            ; 
                     697    ;        lcall   WRITEPORTS      ; 
                     698    ;        jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
01FA                 699    UP1_STOP:
01FA 12086E          700            lcall   READPORTS       ; nacitanie dat
                     701 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01FD 200B03          702 +1         jb      SKRH, $+6
0200 020774          703 +1         ljmp    ERR_SKRH
0203 00              704 +1         nop
                     706 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0204 200A03          707 +1         jb      MB2, $+6
0207 020762          708 +1         ljmp    ERR_ZAST_C
020A 00              709 +1         nop
020B 2009EC          711            jb      MB1, UP1_STOP  ;-; Sme na zastavovacej clonke?
020E C220            712            clr     UP              ; zastav motor
0210 D23A            713            setb    UPOld           ;       (a zalohuj) 
DEBUG                                                                                                         PAGE 14

0212 C23B            714            clr     DOWNOld         ;       (a zalohuj)
0214 C222            715            clr     FAST            ; 
0216 1208CD          716            lcall   WRITEPORTS      ; 
0219 02021C          717            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2   
                     718    
                     719    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     720    
021C                 721    FLOOR2:
                     722 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
021C C22F            723 +1         clr     LEDU            
021E C22E            724 +1         clr     LEDD 
0220 C224            725 +1         clr     FLED1             
0222 C225            726 +1         clr     FLED2                
0224 C226            727 +1         clr     FLED3           
0226 C227            728 +1         clr     FLED4           
0228 D225            729 +1         setb    FLED2
022A 1208CD          730 +1         lcall   WRITEPORTS
022D 120826          732            lcall   WAITFORTIMER    ; simulacia TIMERu
0230 12086E          733    F2S:    lcall   READPORTS     ;-; nacitanie dat
0233 C21A            734            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0235 C22A            735            clr     PO2U            ;
0237 C229            736            clr     PO2D            ;
0239 1208CD          737            lcall   WRITEPORTS      ;
023C 200FF1          738            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
023F 79F8            739            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0241 7AF8            740            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
0243 203A06          741            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0246 E9              742            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0247 F4              743            cpl     A               ;       |
0248 F9              744            mov     R1, A           ;       |
0249 EA              745            mov     A, R2           ;       A znegujeme aj masku sachty
024A F4              746            cpl     A               ;       |
024B FA              747            mov     R2, A           ;       |
024C                 748    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
024C E528            749            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
024E 541A            750            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0250 59              751            anl     A, R1           ;  | 
0251 7027            752            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     753                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0253 E528            754            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0255 541A            755            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0257 7007            756            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0259 E522            757            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
025B 5439            758            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
025D 5A              759            anl     A, R2           ;  |   
025E 701A            760            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     761            ; Pohyb v opacnom smere (nevieme v ktorom)
0260 B23A            762    F2SW:   cpl     UPOld           ;  Znegujem stary posun
0262 B23B            763            cpl     DOWNOld         ;  |
0264 E9              764            mov     A, R1           ;  Znegujeme masky
0265 F4              765            cpl     A               ;  |
DEBUG                                                                                                         PAGE 15

0266 F9              766            mov     R1, A           ;  |
0267 EA              767            mov     A, R2           ;  |
0268 F4              768            cpl     A               ;  |
0269 FA              769            mov     R2, A           ;  |               
026A E528            770            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
026C 541A            771            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
026E 59              772            anl     A, R1           ;  | 
026F 7009            773            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0271 E522            774            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0273 5439            775            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0275 5A              776            anl     A, R2           ;  | 
0276 7002            777            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0278 80B6            778            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
027A 203A03          779    F2:     jb      UPOld, F2UP     ;   
027D 02028C          780            jmp     F2DOWN          ;
0280 D220            781    F2UP:   setb    UP              ; rychly pohyb hore
0282 D222            782            setb    FAST            ; 
0284 C223            783            clr     SLOW            ;
0286 1208CD          784            lcall   WRITEPORTS      ; 
0289 020298          785            jmp     UP2           ;-; prejdi do stavu UP2    
028C D221            786    F2DOWN: setb    DOWN            ; rychly pohyb hore
028E D222            787            setb    FAST            ; 
0290 C223            788            clr     SLOW            ;
0292 1208CD          789            lcall   WRITEPORTS      ; 
0295 020384          790            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     791            
                     792                
0298                 793    UP2:
                     794 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0298 C22F            795 +1         clr     LEDU            
029A C22E            796 +1         clr     LEDD 
029C C224            797 +1         clr     FLED1             
029E C225            798 +1         clr     FLED2                
02A0 C226            799 +1         clr     FLED3           
02A2 C227            800 +1         clr     FLED4           
02A4 D225            801 +1         setb    FLED2
02A6 1208CD          802 +1         lcall   WRITEPORTS
                     804 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02A9 1207F1          805 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02AC 12086E          806 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02AF 3009FA          807 +1         jnb     MB1, $-3  ; 
02B2 1207F1          808 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02B5 12086E          810    UP2A:   lcall   READPORTS       ; nacitanie dat
                     811 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02B8 200B03          812 +1         jb      SKRH, $+6
02BB 020774          813 +1         ljmp    ERR_SKRH
02BE 00              814 +1         nop
                     816 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02BF 200903          817 +1         jb      MB1, $+6
02C2 02074D          818 +1         ljmp    ERR_2SPOM_C
02C5 00              819 +1         nop
02C6 200AEC          821            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     822 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
DEBUG                                                                                                         PAGE 16

02C9 1207F1          823 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02CC 12086E          824 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02CF 300AFA          825 +1         jnb     MB2, $-3  ; 
02D2 1207F1          826 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02D5 D22E            828            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02D7 1208CD          829            lcall   WRITEPORTS      ;
02DA 0202DD          830            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
02DD                 831    UP2_MB2:
02DD 12086E          832            lcall   READPORTS       ; nacitanie dat
                     833 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02E0 200B03          834 +1         jb      SKRH, $+6
02E3 020774          835 +1         ljmp    ERR_SKRH
02E6 00              836 +1         nop
                     838 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02E7 200903          839 +1         jb      MB1, $+6
02EA 020738          840 +1         ljmp    ERR_1SPOM_C
02ED 00              841 +1         nop
02EE 200AEC          843            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
02F1 D22F            844            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
02F3 1208CD          845            lcall   WRITEPORTS      ;
                     846 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02F6 1207F1          847 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02F9 12086E          848 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02FC 300AFA          849 +1         jnb     MB2, $-3  ; 
02FF 1207F1          850 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     852    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     853    ;        anl     A, #00001000b ;-;
                     854    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                     855 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     856 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0302 C3              857 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0303 7400            858 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0305 7214            859 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0307 B00E            860 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0309 7243            861 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
030B 720F            862 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
030D 7238            863 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
030F 3400            864 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0311 702E            866            jnz     U2_MB2C       ;-; Ak ano, zastav
                     867 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0313 E522            868 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0315 33              869 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0316 547E            870 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0318 7805            871 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
DEBUG                                                                                                         PAGE 17

                                                                               a)
                     872 +1  ; LL1: 
031A 6006            873 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
031C C3              874 +1         clr     C               ; Inak shiftnem o 2
031D 13              875 +1         rrc     A               ;
031E C3              876 +1         clr     C               ;
031F 13              877 +1         rrc     A               ;
0320 D8F8            878 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     879 +1 ; LL2:
0322 7405            880 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0324 C3              881 +1         clr     C               ;
0325 98              882 +1         subb    A, R0           ;
                     884 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
0326 B40303          885 +1         cjne    A, #3, $+6
0329 02032F          886 +1         jmp     $+6
032C 02034B          887 +1         ljmp    UP2_MB1
032F 00              888 +1         nop
                     890 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0330 E528            891 +1         mov     A, INPORTA
0332 541E            892 +1         anl     A, #00011110b
0334 C3              893 +1         clr     C
0335 13              894 +1         rrc     A
                     895 +1 ;LL1    
0336 7803            896 +1         mov     R0, #3
0338 C3              897 +1         clr     C
0339 13              898 +1         rrc     A
033A D8FC            899 +1         djnz    R0, $-2;LL1
033C 6003            901            jz      U2_MB2C         ; |   ak neni zastavujem  
033E 02034B          902            ljmp    UP2_MB1         ; |   inak nezastavim
0341 D223            903    U2_MB2C: setb    SLOW            ;       Ak ano, spomalme
0343 C222            904            clr     FAST            ; 
0345 1208CD          905            lcall   WRITEPORTS      ;
0348 020362          906            jmp     UP2_STOP       ;-; a prejdi do stavu UP2_STOP 
034B                 907    UP2_MB1:
034B 12086E          908            lcall   READPORTS       ; nacitanie dat
                     909 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
034E 200B03          910 +1         jb      SKRH, $+6
0351 020774          911 +1         ljmp    ERR_SKRH
0354 00              912 +1         nop
                     914 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0355 200A03          915 +1         jb      MB2, $+6
0358 020762          916 +1         ljmp    ERR_ZAST_C
035B 00              917 +1         nop
035C 2009EC          919            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     920            
                     921    ;        ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                     922    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
                     923    ;        jnz     U2_MB1C       ;-; Ak ano, zastav
                     924    ;        NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                     925    ;        LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
                     926    ;        VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
DEBUG                                                                                                         PAGE 18

                                                                               
                     927    ;        jz      U2_MB1C         ; |   ak neni zastavujem  
035F 02048E          928            ljmp    UP3             ; |   inak nezastavim
                     929    ;U2_MB1C: clr     UP              ; zastav motor
                     930    ;        setb    UPOld           ;       (a zalohuj)
                     931    ;        clr     DOWNOld         ;       (a zalohuj)
                     932    ;        clr     FAST            ; 
                     933    ;        lcall   WRITEPORTS      ; 
                     934    ;        jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
0362                 935    UP2_STOP:
0362 12086E          936            lcall   READPORTS       ; nacitanie dat
                     937 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0365 200B03          938 +1         jb      SKRH, $+6
0368 020774          939 +1         ljmp    ERR_SKRH
036B 00              940 +1         nop
                     942 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
036C 200A03          943 +1         jb      MB2, $+6
036F 020762          944 +1         ljmp    ERR_ZAST_C
0372 00              945 +1         nop
0373 2009EC          947            jb      MB1, UP2_STOP  ;-; Sme na zastavovacej clonke?        
0376 C220            948            clr     UP              ; zastav motor
0378 D23A            949            setb    UPOld           ;       (a zalohuj)
037A C23B            950            clr     DOWNOld         ;       (a zalohuj)
037C C222            951            clr     FAST            ; 
037E 1208CD          952            lcall   WRITEPORTS      ; 
0381 020412          953            jmp     FLOOR3        ;-; a prejdi do stavu FLOO
                     954            
0384                 955    DOWN2:
                     956 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0384 C22F            957 +1         clr     LEDU            
0386 C22E            958 +1         clr     LEDD 
0388 C224            959 +1         clr     FLED1             
038A C225            960 +1         clr     FLED2                
038C C226            961 +1         clr     FLED3           
038E C227            962 +1         clr     FLED4           
0390 D225            963 +1         setb    FLED2
0392 1208CD          964 +1         lcall   WRITEPORTS
                     966 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0395 1207F1          967 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0398 12086E          968 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
039B 3009FA          969 +1         jnb     MB1, $-3  ; 
039E 1207F1          970 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03A1 12086E          972            lcall   READPORTS       ; nacitanie dat
                     973 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03A4 200C03          974 +1         jb      SKRD, $+6
03A7 02076B          975 +1         ljmp    ERR_SKRD
03AA 00              976 +1         nop
                     978 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03AB 200903          979 +1         jb      MB1, $+6
03AE 02074D          980 +1         ljmp    ERR_2SPOM_C
03B1 00              981 +1         nop
03B2 200ACF          983            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     984 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
03B5 1207F1          985 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
DEBUG                                                                                                         PAGE 19

03B8 12086E          986 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03BB 300AFA          987 +1         jnb     MB2, $-3  ; 
03BE 1207F1          988 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03C1 D22F            990            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03C3 1208CD          991            lcall   WRITEPORTS      ;
03C6 0203C9          992            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
03C9                 993    DOWN2_MB2:
03C9 12086E          994            lcall   READPORTS       ; nacitanie dat
                     995 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03CC 200C03          996 +1         jb      SKRD, $+6
03CF 02076B          997 +1         ljmp    ERR_SKRD
03D2 00              998 +1         nop
                    1000 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
03D3 200903         1001 +1         jb      MB1, $+6
03D6 020738         1002 +1         ljmp    ERR_1SPOM_C
03D9 00             1003 +1         nop
03DA 200AEC         1005            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
03DD D22E           1006            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
03DF 1208CD         1007            lcall   WRITEPORTS      ;
                    1008 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
03E2 1207F1         1009 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03E5 12086E         1010 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03E8 300AFA         1011 +1         jnb     MB2, $-3  ; 
03EB 1207F1         1012 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1014    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1015    ;        anl     A, #00000010b ;-;
                    1016    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
03EE D223           1017            setb    SLOW            ;       Ak ano, spomalme
03F0 C222           1018            clr     FAST            ; 
03F2 1208CD         1019            lcall   WRITEPORTS      ;
03F5 0203F8         1020            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
03F8                1021    DOWN2_MB1:    
03F8 12086E         1022            lcall   READPORTS       ; nacitanie dat
03FB 300C05         1023            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
03FE 300902         1024            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0401 80F5           1025            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
0403 C238           1026    D2_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0405 C221           1027            clr     DOWN            ; zastav motor
0407 D23B           1028            setb    DOWNOld         ;       (a zalohuj)
0409 C23A           1029            clr     UPOld           ;       (a zalohuj)
040B C222           1030            clr     FAST            ; 
040D 1208CD         1031            lcall   WRITEPORTS      ; 
0410 01F5           1032            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                    1033    
                    1034    
                    1035    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                    1036    
0412                1037    FLOOR3:
                    1038 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0412 C22F           1039 +1         clr     LEDU            
0414 C22E           1040 +1         clr     LEDD 
DEBUG                                                                                                         PAGE 20

0416 C224           1041 +1         clr     FLED1             
0418 C225           1042 +1         clr     FLED2                
041A C226           1043 +1         clr     FLED3           
041C C227           1044 +1         clr     FLED4           
041E D226           1045 +1         setb    FLED3
0420 1208CD         1046 +1         lcall   WRITEPORTS
0423 120826         1048            lcall   WAITFORTIMER    ; simulacia TIMERu
0426 12086E         1049    F3S:    lcall   READPORTS     ;-; nacitanie dat
0429 C21B           1050            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
042B C22C           1051            clr     PO3U            ;
042D C22B           1052            clr     PO3D            ;
042F 1208CD         1053            lcall   WRITEPORTS      ;
0432 200FF1         1054            jb      DPK, F3S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0435 79F0           1055            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0437 7AE0           1056            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
0439 203A06         1057            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
043C E9             1058            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
043D F4             1059            cpl     A               ;       |
043E F9             1060            mov     R1, A           ;       |
043F EA             1061            mov     A, R2           ;       A znegujeme aj masku sachty
0440 F4             1062            cpl     A               ;       |
0441 FA             1063            mov     R2, A           ;       |        
0442                1064    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0442 E528           1065            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0444 5416           1066            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0446 59             1067            anl     A, R1           ;  | 
0447 7027           1068            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1069                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0449 E528           1070            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
044B 5416           1071            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
044D 7007           1072            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
044F E522           1073            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0451 5427           1074            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0453 5A             1075            anl     A, R2           ;  |   
0454 701A           1076            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1077            ; Pohyb v opacnom smere (nevieme v ktorom)
0456 B23A           1078    F3SW:   cpl     UPOld           ;  Znegujem stary posun
0458 B23B           1079            cpl     DOWNOld         ;  |
045A E9             1080            mov     A, R1           ;  Znegujeme masky
045B F4             1081            cpl     A               ;  |
045C F9             1082            mov     R1, A           ;  |
045D EA             1083            mov     A, R2           ;  |
045E F4             1084            cpl     A               ;  |
045F FA             1085            mov     R2, A           ;  |               
0460 E528           1086            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0462 5416           1087            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0464 59             1088            anl     A, R1           ;  | 
0465 7009           1089            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0467 E522           1090            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0469 5427           1091            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
046B 5A             1092            anl     A, R2           ;  | 
DEBUG                                                                                                         PAGE 21

046C 7002           1093            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
046E 80B6           1094            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0470 203A03         1095    F3:     jb      UPOld, F3UP     ;   
0473 020482         1096            jmp     F3DOWN          ;
0476 D220           1097    F3UP:   setb    UP              ; rychly pohyb hore
0478 D222           1098            setb    FAST            ; 
047A C223           1099            clr     SLOW            ;
047C 1208CD         1100            lcall   WRITEPORTS      ; 
047F 02048E         1101            jmp     UP3           ;-; prejdi do stavu UP2    
0482 D221           1102    F3DOWN: setb    DOWN            ; rychly pohyb hore
0484 D222           1103            setb    FAST            ; 
0486 C223           1104            clr     SLOW            ;
0488 1208CD         1105            lcall   WRITEPORTS      ; 
048B 02051D         1106            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1107         
                    1108         
048E                1109    UP3:
                    1110 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
048E C22F           1111 +1         clr     LEDU            
0490 C22E           1112 +1         clr     LEDD 
0492 C224           1113 +1         clr     FLED1             
0494 C225           1114 +1         clr     FLED2                
0496 C226           1115 +1         clr     FLED3           
0498 C227           1116 +1         clr     FLED4           
049A D226           1117 +1         setb    FLED3
049C 1208CD         1118 +1         lcall   WRITEPORTS
                    1120 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
049F 1207F1         1121 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04A2 12086E         1122 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04A5 3009FA         1123 +1         jnb     MB1, $-3  ; 
04A8 1207F1         1124 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04AB 12086E         1126    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1127 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04AE 200B03         1128 +1         jb      SKRH, $+6
04B1 020774         1129 +1         ljmp    ERR_SKRH
04B4 00             1130 +1         nop
                    1132 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
04B5 200903         1133 +1         jb      MB1, $+6
04B8 02074D         1134 +1         ljmp    ERR_2SPOM_C
04BB 00             1135 +1         nop
04BC 200AEC         1137            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                    1138 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
04BF 1207F1         1139 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04C2 12086E         1140 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04C5 300AFA         1141 +1         jnb     MB2, $-3  ; 
04C8 1207F1         1142 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04CB D22E           1144            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
04CD 1208CD         1145            lcall   WRITEPORTS      ;
04D0 0204D3         1146            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
04D3                1147    UP3_MB2:
04D3 12086E         1148            lcall   READPORTS       ; nacitanie dat
                    1149 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04D6 200B03         1150 +1         jb      SKRH, $+6
04D9 020774         1151 +1         ljmp    ERR_SKRH
DEBUG                                                                                                         PAGE 22

04DC 00             1152 +1         nop
                    1154 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
04DD 200903         1155 +1         jb      MB1, $+6
04E0 020738         1156 +1         ljmp    ERR_1SPOM_C
04E3 00             1157 +1         nop
04E4 200AEC         1159            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
04E7 D22F           1160            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
04E9 1208CD         1161            lcall   WRITEPORTS      ;
                    1162 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
04EC 1207F1         1163 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04EF 12086E         1164 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04F2 300AFA         1165 +1         jnb     MB2, $-3  ; 
04F5 1207F1         1166 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1168    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1169    ;        anl     A, #00010000b ;-;
                    1170    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
04F8 D223           1171            setb    SLOW            ;       Ak ano, spomalme
04FA C222           1172            clr     FAST            ; 
04FC 1208CD         1173            lcall   WRITEPORTS      ;
04FF 020502         1174            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0502                1175    UP3_MB1:
0502 12086E         1176            lcall   READPORTS       ; nacitanie dat
0505 300B05         1177            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0508 300902         1178            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
050B 80F5           1179            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
050D C238           1180    U3_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
050F C220           1181            clr     UP              ; zastav motor
0511 D23A           1182            setb    UPOld           ;       (a zalohuj)
0513 C23B           1183            clr     DOWNOld         ;       (a zalohuj)
0515 C222           1184            clr     FAST            ; 
0517 1208CD         1185            lcall   WRITEPORTS      ; 
051A 02060D         1186            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
051D                1187    DOWN3:
                    1188 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
051D C22F           1189 +1         clr     LEDU            
051F C22E           1190 +1         clr     LEDD 
0521 C224           1191 +1         clr     FLED1             
0523 C225           1192 +1         clr     FLED2                
0525 C226           1193 +1         clr     FLED3           
0527 C227           1194 +1         clr     FLED4           
0529 D226           1195 +1         setb    FLED3
052B 1208CD         1196 +1         lcall   WRITEPORTS
                    1198 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
052E 1207F1         1199 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0531 12086E         1200 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0534 3009FA         1201 +1         jnb     MB1, $-3  ; 
0537 1207F1         1202 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
053A 12086E         1204            lcall   READPORTS       ; nacitanie dat
                    1205 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
053D 200C03         1206 +1         jb      SKRD, $+6
0540 02076B         1207 +1         ljmp    ERR_SKRD
0543 00             1208 +1         nop
DEBUG                                                                                                         PAGE 23

                    1210 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0544 200903         1211 +1         jb      MB1, $+6
0547 02074D         1212 +1         ljmp    ERR_2SPOM_C
054A 00             1213 +1         nop
054B 200ACF         1215            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                    1216 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
054E 1207F1         1217 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0551 12086E         1218 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0554 300AFA         1219 +1         jnb     MB2, $-3  ; 
0557 1207F1         1220 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
055A D22F           1222            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
055C 1208CD         1223            lcall   WRITEPORTS      ;
055F 020562         1224            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0562                1225    DOWN3_MB2:
0562 12086E         1226            lcall   READPORTS       ; nacitanie dat
                    1227 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0565 200C03         1228 +1         jb      SKRD, $+6
0568 02076B         1229 +1         ljmp    ERR_SKRD
056B 00             1230 +1         nop
                    1232 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
056C 200903         1233 +1         jb      MB1, $+6
056F 020738         1234 +1         ljmp    ERR_1SPOM_C
0572 00             1235 +1         nop
0573 200AEC         1237            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0576 D22E           1238            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0578 1208CD         1239            lcall   WRITEPORTS      ;
                    1240 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
057B 1207F1         1241 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
057E 12086E         1242 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0581 300AFA         1243 +1         jnb     MB2, $-3  ; 
0584 1207F1         1244 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1246    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1247    ;        anl     A, #00000100b ;-;
                    1248    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1249 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1250 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0587 C3             1251 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0588 7400           1252 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
058A 7211           1253 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
058C B00E           1254 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
058E 7242           1255 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0590 720F           1256 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0592 7238           1257 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0594 3400           1258 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0596 7033           1260            jnz     D3_MB2C         ; Ak ano, zastav
                    1261 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
DEBUG                                                                                                         PAGE 24

0598 E522           1262 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
059A 33             1263 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
059B 547E           1264 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
059D 7805           1265 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1266 +1  ; LL1: 
059F 6006           1267 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
05A1 C3             1268 +1         clr     C               ; Inak shiftnem o 2
05A2 33             1269 +1         rlc     A               ;
05A3 C3             1270 +1         clr     C               ;
05A4 33             1271 +1         rlc     A               ;
05A5 D8F8           1272 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1273 +1 ; LL2:
05A7 E8             1274 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1276 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
05A8 B40203         1277 +1         cjne    A, #2, $+6
05AB 0205B1         1278 +1         jmp     $+6
05AE 0205D5         1279 +1         ljmp    DOWN3_MB1
05B1 00             1280 +1         nop
                    1282 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
05B2 7405           1283 +1         mov     A, #5
05B4 C3             1284 +1         clr     C
05B5 9402           1285 +1         subb    A, #2
05B7 F8             1286 +1         mov     R0, A
05B8 E528           1287 +1         mov     A, INPORTA
05BA 541E           1288 +1         anl     A, #00011110b
05BC C3             1289 +1         clr     C
05BD 33             1290 +1         rlc     A
05BE C3             1291 +1         clr     C
05BF 33             1292 +1         rlc     A
05C0 C3             1293 +1         clr     C
05C1 33             1294 +1         rlc     A
                    1295 +1 ;LL1   
05C2 C3             1296 +1         clr     C
05C3 33             1297 +1         rlc     A
05C4 D8FC           1298 +1         djnz    R0, $-2;LL1
05C6 6003           1300            jz      D3_MB2C         ; |   ak neni zastavujem                  
05C8 0205D5         1301            ljmp    DOWN3_MB1       ;-; |        
05CB D223           1302    D3_MB2C: setb    SLOW            ;       Ak ano, spomalme
05CD C222           1303            clr     FAST            ; 
05CF 1208CD         1304            lcall   WRITEPORTS      ;
05D2 0205EC         1305            jmp     DOWN3_STOP     ;-; a prejdi do stavu DOWN3_STOP
05D5                1306    DOWN3_MB1:    
05D5 12086E         1307            lcall   READPORTS       ; nacitanie dat
                    1308 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05D8 200C03         1309 +1         jb      SKRD, $+6
05DB 02076B         1310 +1         ljmp    ERR_SKRD
05DE 00             1311 +1         nop
                    1313 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
05DF 200A03         1314 +1         jb      MB2, $+6
05E2 020762         1315 +1         ljmp    ERR_ZAST_C
DEBUG                                                                                                         PAGE 25

05E5 00             1316 +1         nop
05E6 2009EC         1318            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1319    ;        ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                    1320    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
                    1321    ;        jnz     D3_MB1C         ; Ak ano, zastav
                    1322    ;        NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                    1323    ;        LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
                    1324    ;        NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                    1325    ;        jz      D3_MB1C         ; |   ak neni zastavujem                  
05E9 020384         1326            ljmp    DOWN2         ;-; |        
                    1327    ;D3_MB1C: clr     DOWN            ; zastav motor
                    1328    ;        setb    DOWNOld         ;       (a zalohuj)
                    1329    ;        clr     UPOld           ;       (a zalohuj)
                    1330    ;        clr     FAST            ; 
                    1331    ;        lcall   WRITEPORTS      ; 
                    1332    ;        jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2 
05EC                1333    DOWN3_STOP:    
05EC 12086E         1334            lcall   READPORTS       ; nacitanie dat
                    1335 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05EF 200C03         1336 +1         jb      SKRD, $+6
05F2 02076B         1337 +1         ljmp    ERR_SKRD
05F5 00             1338 +1         nop
                    1340 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
05F6 200A03         1341 +1         jb      MB2, $+6
05F9 020762         1342 +1         ljmp    ERR_ZAST_C
05FC 00             1343 +1         nop
05FD 2009EC         1345            jb      MB1, DOWN3_STOP;-; Sme na zastavovacej clonke?       
0600 C221           1346            clr     DOWN            ; zastav motor
0602 D23B           1347            setb    DOWNOld         ;       (a zalohuj)
0604 C23A           1348            clr     UPOld           ;       (a zalohuj)
0606 C222           1349            clr     FAST            ; 
0608 1208CD         1350            lcall   WRITEPORTS      ; 
060B 411C           1351            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2         
                    1352    
                    1353            
                    1354    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1355    
060D                1356    FLOOR4:
                    1357 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
060D C22F           1358 +1         clr     LEDU            
060F C22E           1359 +1         clr     LEDD 
0611 C224           1360 +1         clr     FLED1             
0613 C225           1361 +1         clr     FLED2                
0615 C226           1362 +1         clr     FLED3           
0617 C227           1363 +1         clr     FLED4           
0619 D227           1364 +1         setb    FLED4
061B 1208CD         1365 +1         lcall   WRITEPORTS
061E 120826         1367            lcall   WAITFORTIMER    ; simulacia TIMERu
0621 12086E         1368    F4S:    lcall   READPORTS     ;-; nacitanie dat
0624 C21C           1369            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0626 C22D           1370            clr     PO4            ;
DEBUG                                                                                                         PAGE 26

0628 1208CD         1371            lcall   WRITEPORTS      ;
062B 200FF3         1372            jb      DPK, F4S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
062E E528           1373            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
0630 540E           1374            anl     A, #00001110b ;-;
0632 7008           1375            jnz     F4OK          ;-; ak ano, ideme na to
0634 E522           1376            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
0636 541F           1377            anl     A, #00011111b ;-;
0638 7002           1378            jnz     F4OK          ;-; ak ano, ideme na to
063A 80E5           1379            jmp     F4S             ; Nemam sa kde hnut, opakujem
063C D221           1380    F4OK:   setb    DOWN            ; rychly pohyb dole
063E D222           1381            setb    FAST            ;
0640 C223           1382            clr     SLOW            ; 
0642 1208CD         1383            lcall   WRITEPORTS      ; 
0645 020648         1384            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
0648                1385    DOWN4:
                    1386 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0648 C22F           1387 +1         clr     LEDU            
064A C22E           1388 +1         clr     LEDD 
064C C224           1389 +1         clr     FLED1             
064E C225           1390 +1         clr     FLED2                
0650 C226           1391 +1         clr     FLED3           
0652 C227           1392 +1         clr     FLED4           
0654 D227           1393 +1         setb    FLED4
0656 1208CD         1394 +1         lcall   WRITEPORTS
                    1396 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0659 1207F1         1397 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
065C 12086E         1398 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
065F 3009FA         1399 +1         jnb     MB1, $-3  ; 
0662 1207F1         1400 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0665 12086E         1402            lcall   READPORTS       ; nacitanie dat
                    1403 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0668 200C03         1404 +1         jb      SKRD, $+6
066B 02076B         1405 +1         ljmp    ERR_SKRD
066E 00             1406 +1         nop
                    1408 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
066F 200903         1409 +1         jb      MB1, $+6
0672 02074D         1410 +1         ljmp    ERR_2SPOM_C
0675 00             1411 +1         nop
0676 200ACF         1413            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1414 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0679 1207F1         1415 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
067C 12086E         1416 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
067F 300AFA         1417 +1         jnb     MB2, $-3  ; 
0682 1207F1         1418 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0685 D22F           1420            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0687 1208CD         1421            lcall   WRITEPORTS      ;
068A 02068D         1422            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
068D                1423    DOWN4_MB2:
068D 12086E         1424            lcall   READPORTS       ; nacitanie dat
                    1425 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0690 200C03         1426 +1         jb      SKRD, $+6
0693 02076B         1427 +1         ljmp    ERR_SKRD
DEBUG                                                                                                         PAGE 27

0696 00             1428 +1         nop
                    1430 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0697 200903         1431 +1         jb      MB1, $+6
069A 020738         1432 +1         ljmp    ERR_1SPOM_C
069D 00             1433 +1         nop
069E 200AEC         1435            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
06A1 D22E           1436            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
06A3 1208CD         1437            lcall   WRITEPORTS      ;
                    1438 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
06A6 1207F1         1439 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06A9 12086E         1440 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06AC 300AFA         1441 +1         jnb     MB2, $-3  ; 
06AF 1207F1         1442 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1444    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1445    ;        anl     A, #00001000b ;-;
                    1446    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1447 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1448 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
06B2 C3             1449 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
06B3 7400           1450 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
06B5 7213           1451 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
06B7 B00E           1452 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
06B9 7243           1453 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
06BB 720F           1454 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
06BD 7238           1455 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
06BF 3400           1456 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
06C1 7033           1458            jnz     D4_MB2C       ;-; Ak ano, zastav
                    1459 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
06C3 E522           1460 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
06C5 33             1461 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
06C6 547E           1462 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
06C8 7805           1463 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1464 +1  ; LL1: 
06CA 6006           1465 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
06CC C3             1466 +1         clr     C               ; Inak shiftnem o 2
06CD 33             1467 +1         rlc     A               ;
06CE C3             1468 +1         clr     C               ;
06CF 33             1469 +1         rlc     A               ;
06D0 D8F8           1470 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1471 +1 ; LL2:
06D2 E8             1472 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1474 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
06D3 B40303         1475 +1         cjne    A, #3, $+6
DEBUG                                                                                                         PAGE 28

06D6 0206DC         1476 +1         jmp     $+6
06D9 020700         1477 +1         ljmp    DOWN4_MB1
06DC 00             1478 +1         nop
                    1480 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
06DD 7405           1481 +1         mov     A, #5
06DF C3             1482 +1         clr     C
06E0 9403           1483 +1         subb    A, #3
06E2 F8             1484 +1         mov     R0, A
06E3 E528           1485 +1         mov     A, INPORTA
06E5 541E           1486 +1         anl     A, #00011110b
06E7 C3             1487 +1         clr     C
06E8 33             1488 +1         rlc     A
06E9 C3             1489 +1         clr     C
06EA 33             1490 +1         rlc     A
06EB C3             1491 +1         clr     C
06EC 33             1492 +1         rlc     A
                    1493 +1 ;LL1   
06ED C3             1494 +1         clr     C
06EE 33             1495 +1         rlc     A
06EF D8FC           1496 +1         djnz    R0, $-2;LL1
06F1 6003           1498            jz      D4_MB2C         ; |   ak neni zastavujem          
06F3 020700         1499            ljmp    DOWN4_MB1       ;-; |       
06F6 D223           1500    D4_MB2C: setb    SLOW            ;       Ak ano, spomalme
06F8 C222           1501            clr     FAST            ; 
06FA 1208CD         1502            lcall   WRITEPORTS      ;
06FD 020717         1503            jmp     DOWN4_STOP     ;-; a prejdi do stavu DOWN4_STOP
0700                1504    DOWN4_MB1:    
0700 12086E         1505            lcall   READPORTS       ; nacitanie dat
                    1506 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0703 200C03         1507 +1         jb      SKRD, $+6
0706 02076B         1508 +1         ljmp    ERR_SKRD
0709 00             1509 +1         nop
                    1511 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
070A 200A03         1512 +1         jb      MB2, $+6
070D 020762         1513 +1         ljmp    ERR_ZAST_C
0710 00             1514 +1         nop
0711 2009EC         1516            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1517    ;        ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                    1518    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril 
                    1519    ;        jnz     D4_MB1C       ;-; Ak ano, zastav
                    1520    ;        NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                    1521    ;        LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
                    1522    ;        NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                    1523    ;        jz      D4_MB1C         ; |   ak neni zastavujem          
0714 02051D         1524            ljmp    DOWN3         ;-; |       
                    1525    ;D4_MB1C: clr     DOWN            ; zastav motor
                    1526    ;        setb    DOWNOld         ;       (a zalohuj)
                    1527    ;        clr     UPOld           ;       (a zalohuj)
                    1528    ;        clr     FAST            ; 
                    1529    ;        lcall   WRITEPORTS      ; 
                    1530    ;        jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
DEBUG                                                                                                         PAGE 29

0717                1531    DOWN4_STOP:    
0717 12086E         1532            lcall   READPORTS       ; nacitanie dat
                    1533 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
071A 200C03         1534 +1         jb      SKRD, $+6
071D 02076B         1535 +1         ljmp    ERR_SKRD
0720 00             1536 +1         nop
                    1538 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
0721 200A03         1539 +1         jb      MB2, $+6
0724 020762         1540 +1         ljmp    ERR_ZAST_C
0727 00             1541 +1         nop
0728 2009EC         1543            jb      MB1, DOWN4_STOP ;-; Sme na zastavovacej clonke?
072B C221           1544            clr     DOWN            ; zastav motor
072D D23B           1545            setb    DOWNOld         ;       (a zalohuj)
072F C23A           1546            clr     UPOld           ;       (a zalohuj)
0731 C222           1547            clr     FAST            ; 
0733 1208CD         1548            lcall   WRITEPORTS      ; 
0736 8112           1549            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                   
                    1550      
0738                1551    ERR_1SPOM_C: 
                    1552            ;clr     UP              ; zastav motor
                    1553            ;clr     DOWN            ; 
                    1554            ;lcall   WRITEPORTS      ; 
                    1555            ;_BP_
                    1556            ;nop
                    1557            ;nop 
                    1558 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0738 1207F1         1559 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
073B 12086E         1560 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
073E 3009FA         1561 +1         jnb     MB1, $-3  ; 
0741 1207F1         1562 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0744 9009A0         1564            mov     DPTR, #STR_ERR_1SPOM_C         ; vypis info 
0747 120904         1565            lcall   DISPSTR         ;          
074A 02077D         1566            ljmp    ERROR1         
                    1567            
074D                1568    ERR_2SPOM_C: 
                    1569            ;clr     UP              ; zastav motor
                    1570            ;clr     DOWN            ; 
                    1571            ;lcall   WRITEPORTS      ; 
                    1572            ;_BP_
                    1573            ;nop
                    1574            ;nop
                    1575 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
074D 1207F1         1576 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0750 12086E         1577 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0753 3009FA         1578 +1         jnb     MB1, $-3  ; 
0756 1207F1         1579 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0759 9009C6         1581            mov     DPTR, #STR_ERR_2SPOM_C         ; vypis info 
075C 120904         1582            lcall   DISPSTR         ;
075F 02077D         1583            ljmp    ERROR1 
                    1584            
0762                1585    ERR_ZAST_C: 
                    1586            ;clr     UP              ; zastav motor
                    1587            ;clr     DOWN            ; 
                    1588            ;lcall   WRITEPORTS      ; 
                    1589            ;_BP_
DEBUG                                                                                                         PAGE 30

                    1590            ;nop
                    1591            ;nop
                    1592            ;lcall   READPORTS
                    1593            ;clr     FAST
                    1594            ;clr     SLOW
0762 9009F0         1595            mov     DPTR, #STR_ERR_ZAST_C         ; vypis info 
0765 120904         1596            lcall   DISPSTR         ;
0768 02077D         1597            ljmp    ERROR1  
                    1598            
076B                1599    ERR_SKRD: 
                    1600            ;clr     UP              ; zastav motor
                    1601            ;clr     DOWN            ; 
                    1602            ;lcall   WRITEPORTS      ; 
                    1603            ;_BP_
                    1604            ;nop
                    1605            ;nop        
076B 900A51         1606            mov     DPTR, #STR_ERR_SKRD         ; vypis info 
076E 120904         1607            lcall   DISPSTR         ;
0771 02077D         1608            ljmp    ERROR1    
                    1609            
0774                1610    ERR_SKRH: 
                    1611            ;clr     UP              ; zastav motor
                    1612            ;clr     DOWN            ; 
                    1613            ;lcall   WRITEPORTS      ; 
                    1614            ;_BP_
                    1615            ;nop
                    1616            ;nop
0774 900A16         1617            mov     DPTR, #STR_ERR_SKRH         ; vypis info 
0777 120904         1618            lcall   DISPSTR         ;        
077A 02077D         1619            ljmp    ERROR1 
                    1620            
077D                1621    ERROR1:         
077D D22F           1622            setb    LEDU
077F D22E           1623            setb    LEDD
0781 C222           1624            clr     FAST
0783 D223           1625            setb    SLOW
0785 1208CD         1626            lcall   WRITEPORTS          
0788 12086E         1627    ERROR1S:lcall   READPORTS       ; nacitanie dat
078B 300B08         1628            jnb     SKRH, ERROR1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
078E 300C05         1629            jnb     SKRD, ERROR1C   ; Sme na dolnej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0791 300902         1630            jnb     MB1, ERROR1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0794 80F2           1631            jmp     ERROR1S         ; Ak sme nechytili ani jednu clonku, opakujeme
0796 C220           1632    ERROR1C:clr     UP              ; zastav motor
0798 C221           1633            clr     DOWN            ; 
079A C222           1634            clr     FAST            ; 
079C C223           1635            clr     SLOW            ; 
079E 1208CD         1636            lcall   WRITEPORTS      ; 
07A1 120826         1637            lcall   WAITFORTIMER    ; simulacia TIMERu
07A4 0207A7         1638            jmp     ERROR2        ;-; a prejdi do stavu ERROR2 
                    1639            
07A7 12086E         1640    ERROR2: lcall   READPORTS       ; nacitanie dat
07AA 200DFA         1641            jb      DP, ERROR2      ; uz vystupili vsetci ludia z kabiny?
07AD 200FF7         1642            jb      DPK, ERROR2     ; uz vystupili vsetci ludia z kabiny?
07B0 200EF4         1643            jb      DPZK, ERROR2    ; uz vystupili vsetci ludia z kabiny?
07B3 020033         1644            ljmp    START
DEBUG                                                                                                         PAGE 31

                    1645                           
                    1646                    
07B6                1647    ENDPROG:
07B6 D218           1648            setb    KS
07B8 1208CD         1649            call    WRITEPORTS                ; zapis novu informaciu
                    1650 +1         _BP_
07BB C2B3           1651 +1         clr     P3.3
07BD D2AA           1652 +1         setb    EX1
07BF 00             1653 +1         nop
07C0 00             1654 +1         nop
07C1 22             1656            ret
                    1657            
                    1658            
                    1659            
                    1660    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1661    ; INT_TIMER0
                    1662    ; Obsluha prerusenia timera 0
                    1663    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;        
07C2                1664    INT_TIMER0:
07C2 C0E0           1665            push    ACC
07C4 C080           1666            push    P0
07C6 C090           1667            push    P1
07C8 C0A0           1668            push    P2
07CA C0B0           1669            push    P3
                    1670            ;push    OUTPORTC
                    1671            
07CC ED             1672            mov     A, R5
07CD 1D             1673            dec     R5
07CE 6002           1674            jz      INT_TIMER0_MAIN    
07D0 8014           1675            sjmp    INT_TIMER0_END
07D2                1676    INT_TIMER0_MAIN:
07D2 EE             1677            mov     A, R6
07D3 FD             1678            mov     R5, A
07D4 B22F           1679            cpl     LEDU
07D6 B22E           1680            cpl     LEDD
                    1681            
07D8 852580         1682            mov     p0, OUTPORTC        ; a nakoniec port C
07DB 75A0C2         1683            mov     p2, #i8255OUTC
07DE C2B6           1684            clr     WRNOT
07E0 00             1685            nop
07E1 00             1686            nop
07E2 00             1687            nop
07E3 00             1688            nop
07E4 D2B6           1689            setb    WRNOT
                    1690            
                    1691            
07E6                1692    INT_TIMER0_END:
                    1693            
                    1694    
                    1695            ;pop     OUTPORTC
07E6 D0B0           1696            pop     P3
07E8 D0A0           1697            pop     P2
07EA D090           1698            pop     P1
07EC D080           1699            pop     P0        
07EE D0E0           1700            pop     ACC
07F0 32             1701            reti 
                    1702            
                    1703    ;INT_TIMER0:
DEBUG                                                                                                         PAGE 32

                    1704    ;        push    ACC
                    1705    ;        mov     A, R7  
                    1706    ;        dec     R7               
                    1707    ;        jnz     INT_TIMER0_END     
                    1708    ;        mov     R7, #20h
                    1709    ;        jb      LEDU, INT_TIMER0_CLEAR       
                    1710    ;        setb    LEDU
                    1711    ;        setb    LEDD
                    1712    ;        jmp     INT_TIMER0_WRITE
                    1713    ;INT_TIMER0_CLEAR:        
                    1714    ;        ;clr     LEDU
                    1715    ;        ;clr     LEDD
                    1716    ;INT_TIMER0_WRITE: 
                    1717    ;        lcall   WRITEPORTS
                    1718    ;INT_TIMER0_END: 
                    1719    ;        setb    LEDU
                    1720    ;        lcall   WRITEPORTS       
                    1721    ;        pop     ACC
                    1722    ;        reti
                    1723            
                    1724            
                    1725    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1726    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1727    ; 11.0592MHz/2000 = zdrzanie 1 ms
07F1                1728    TIME10MS:
07F1 7963           1729            mov     R1,#063h        ; 2
                    1730                                    ; *** 100x
07F3 7AFF           1731    TIME0:  mov     R2,#0FFh        ; 2 
07F5 DAFE           1732    TIME1:  djnz    R2,TIME1        ; 256*2   
07F7 7AFF           1733            mov     R2,#0FFh        ; 2       
07F9 DAFE           1734    TIME2:  djnz    R2,TIME2        ; 256*2 
07FB 7A24           1735            mov     R2,#024h        ; 2       
07FD DAFE           1736    TIME3:  djnz    R2,TIME3        ; 36*2
07FF 00             1737            nop                     ; 1
0800 D9F1           1738            djnz    R1,TIME0        ; 2
                    1739                                    ; ***
0802 792A           1740            mov     R1,#02Ah        ; 2 
0804 D9FE           1741    TIME4:  djnz    R1,TIME4        ; 43*2  
0806 22             1742            ret                     ; koniec
                    1743            
                    1744            
                    1745    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1746    ; STOP
                    1747    ; osetri stlacenie tlacidla STOP
                    1748    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0807                1749    STOP:
0807 D238           1750            setb    STOPPED
0809 C222           1751            clr     FAST
080B C223           1752            clr     SLOW
080D 74E1           1753            mov     A, #11100001b
080F 5223           1754            anl     OUTPORTA, A 
0811 1208CD         1755            lcall   WRITEPORTS
                    1756            
0814 120826         1757            lcall   WAITFORTIMER
0817 12082E         1758    STOPC:  lcall   READPORTS1
081A E528           1759            mov     A, INPORTA
081C 541E           1760            anl     A, #00011110b
081E 60F7           1761            jz      STOPC     
DEBUG                                                                                                         PAGE 33

                    1762            
0820 D223           1763            setb    SLOW
0822 1208CD         1764            lcall   WRITEPORTS
0825 22             1765            ret        
                    1766            
                    1767            
                    1768    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1769    ; DELAY
                    1770    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1771    ; bude timer)
                    1772    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0826                1773    WAITFORTIMER:
0826 7B10           1774            mov     R3, #10h
0828 1207F1         1775    DEL1:   lcall   TIME10MS
082B DBFB           1776            djnz    R3, DEL1
082D 22             1777            ret
                    1778            
                    1779    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1780    ; READPORTS1
                    1781    ; precita nove hodnoty na portoch
                    1782    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
082E                1783    READPORTS1:
082E C2AF           1784            clr     EA                  ;Treba zakazat prerusenia
                    1785            
0830 75A080         1786            mov     p2, #i8255INA       ; citaj data z portu A
0833 75803F         1787            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0836 C2B7           1788            clr     RDNOT
0838 00             1789            nop
0839 00             1790            nop
083A 00             1791            nop
083B 00             1792            nop
083C 858028         1793            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
083F D2B7           1794            setb    RDNOT
                    1795            
0841 75A081         1796            mov     p2, #i8255INB       ; citaj data z portu B
0844 7580FE         1797            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0847 C2B7           1798            clr     RDNOT
0849 00             1799            nop
084A 00             1800            nop
084B 00             1801            nop
084C 00             1802            nop
084D 858021         1803            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0850 D2B7           1804            setb    RDNOT
                    1805    
0852 75A082         1806            mov     p2, #i8255INC       ; citaj data z portu C
0855 75803F         1807            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0858 C2B7           1808            clr     RDNOT
085A 00             1809            nop
085B 00             1810            nop
085C 00             1811            nop
085D 00             1812            nop
085E 858022         1813            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0861 D2B7           1814            setb    RDNOT
0863 00             1815            nop
0864 00             1816            nop
0865 00             1817            nop
0866 00             1818            nop
DEBUG                                                                                                         PAGE 34

0867 00             1819            nop
0868 00             1820            nop
0869 00             1821            nop
086A 00             1822            nop
086B D2AF           1823            setb    EA                 ;znovu spustime prerusenia
086D 22             1824            ret
                    1825    
                    1826    
                    1827    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1828    ; READPORTS
                    1829    ; precita nove hodnoty na portoch
                    1830    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
086E                1831    READPORTS:
086E C2AF           1832            clr     EA                  ;Treba zakazat prerusenia
                    1833            
0870 75A080         1834            mov     p2, #i8255INA       ; citaj data z portu A
0873 75803F         1835            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0876 C2B7           1836            clr     RDNOT
0878 00             1837            nop
0879 00             1838            nop
087A 00             1839            nop
087B 00             1840            nop
087C 858028         1841            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
087F D2B7           1842            setb    RDNOT
                    1843            
0881 75A081         1844            mov     p2, #i8255INB       ; citaj data z portu B
0884 7580FE         1845            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0887 C2B7           1846            clr     RDNOT
0889 00             1847            nop
088A 00             1848            nop
088B 00             1849            nop
088C 00             1850            nop
088D 858021         1851            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0890 D2B7           1852            setb    RDNOT
                    1853    
0892 75A082         1854            mov     p2, #i8255INC       ; citaj data z portu C
0895 75803F         1855            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0898 C2B7           1856            clr     RDNOT
089A 00             1857            nop
089B 00             1858            nop
089C 00             1859            nop
089D 00             1860            nop
089E 858022         1861            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
08A1 D2B7           1862            setb    RDNOT
08A3 00             1863            nop
08A4 00             1864            nop
08A5 00             1865            nop
08A6 00             1866            nop
08A7 00             1867            nop
08A8 00             1868            nop
08A9 00             1869            nop
08AA 00             1870            nop
08AB D2AF           1871            setb    EA                 ;znovu spustime prerusenia
                    1872            
                    1873            
08AD 300F04         1874            jnb     DPK, READPORTS_C1
08B0 C222           1875            clr     FAST
DEBUG                                                                                                         PAGE 35

08B2 D223           1876            setb    SLOW
08B4                1877    READPORTS_C1:         
08B4 204003         1878            jb      STOPNOT, READPORTS_C
08B7 120807         1879            lcall   STOP
08BA                1880    READPORTS_C:        
08BA E528           1881            mov     A, INPORTA
08BC 541E           1882            anl     A, #00011110b
08BE 4223           1883            orl     OUTPORTA, A
08C0 1208CD         1884            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
08C3 E522           1885            mov     A, INPORTC
08C5 543F           1886            anl     A, #00111111b
08C7 4225           1887            orl     OUTPORTC, A
08C9 1208CD         1888            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1889            
                    1890            
08CC 22             1891            ret
                    1892            
                    1893    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1894    ; WRITEPORTS
                    1895    ; spravi zalohu vystupnych registrov a posle data von
                    1896    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08CD                1897    WRITEPORTS:
08CD C2AF           1898            clr     EA                  ;Treba zakazat prerusenia
                    1899            
08CF 852380         1900            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
08D2 75A0C0         1901            mov     p2, #i8255OUTA
08D5 C2B6           1902            clr     WRNOT
08D7 00             1903            nop
08D8 00             1904            nop
08D9 00             1905            nop
08DA 00             1906            nop
08DB D2B6           1907            setb    WRNOT
                    1908            
08DD 852480         1909            mov     p0, OUTPORTB        ; potom port B
08E0 75A0C1         1910            mov     p2, #i8255OUTB
08E3 C2B6           1911            clr     WRNOT
08E5 00             1912            nop
08E6 00             1913            nop
08E7 00             1914            nop
08E8 00             1915            nop
08E9 D2B6           1916            setb    WRNOT
                    1917    
08EB 852580         1918            mov     p0, OUTPORTC        ; a nakoniec port C
08EE 75A0C2         1919            mov     p2, #i8255OUTC
08F1 C2B6           1920            clr     WRNOT
08F3 00             1921            nop
08F4 00             1922            nop
08F5 00             1923            nop
08F6 00             1924            nop
08F7 D2B6           1925            setb    WRNOT
08F9 00             1926            nop
08FA 00             1927            nop
08FB 00             1928            nop
08FC 00             1929            nop
08FD 00             1930            nop
08FE 00             1931            nop
08FF 00             1932            nop
0900 00             1933            nop
DEBUG                                                                                                         PAGE 36

0901 D2AF           1934            setb     EA                  ;Treba zakazat prerusenia
0903 22             1935            ret
                    1936    
                    1937    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1938    
                    1939    
                    1940    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1941    ; DISPSTR
                    1942    ; posle na seriovu linku retazec na adrese DPTR
                    1943    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0904                1944    DISPSTR:
0904 C0E0           1945            push    ACC
0906                1946    DSPS_LOOP:           
0906 E4             1947            clr     A
0907 93             1948            movc    A, @A+DPTR
0908 600A           1949            jz      DSPS_END
090A F599           1950            mov     SBUF, A
090C 3099FD         1951            jnb     TI, $
090F C299           1952            clr     TI
0911 A3             1953            inc     DPTR
0912 80F2           1954            sjmp    DSPS_LOOP
0914                1955    DSPS_END:
0914 D0E0           1956            pop     ACC
0916 22             1957            ret
                    1958            
                    1959    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1960    
0917 0D0A5269       1961    STR_INIT:         db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
091B 61646961   
091F 63692073   
0923 79737465   
0927 6D206A65   
092B 20696E69   
092F 6369616C   
0933 697A6F76   
0937 616E792E   
093B 0D0A00     
093E 52696164       1962    STR_STOP:         db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh,
                                                                                0ah, 00h
0942 69616369   
0946 20737973   
094A 74656D20   
094E 6A652072   
0952 65696E69   
0956 6369616C   
095A 697A6F76   
095E 616E7920   
0962 706F2073   
0966 746C6163   
096A 656E6920   
096E 746C6163   
0972 69646C61   
0976 2053544F   
097A 502E0D0A   
097E 00         
097F 4B616C69       1963    STR_CALIB:        db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0983 62726163   
0987 69612076   
DEBUG                                                                                                         PAGE 37

098B 79746168   
098F 75206A65   
0993 20756B6F   
0997 6E63656E   
099B 612E0D0A   
099F 00         
09A0 43687962       1964    STR_ERR_1SPOM_C:  db  'Chyba! Vypadla spomalovacia clonka!', 0dh, 0ah, 00h
09A4 61212056   
09A8 79706164   
09AC 6C612073   
09B0 706F6D61   
09B4 6C6F7661   
09B8 63696120   
09BC 636C6F6E   
09C0 6B61210D   
09C4 0A00       
09C6 43687962       1965    STR_ERR_2SPOM_C:  db  'Chyba! Vypadli dve spomalovacie clonky!', 0dh, 0ah, 00h
09CA 61212056   
09CE 79706164   
09D2 6C692064   
09D6 76652073   
09DA 706F6D61   
09DE 6C6F7661   
09E2 63696520   
09E6 636C6F6E   
09EA 6B79210D   
09EE 0A00       
09F0 43687962       1966    STR_ERR_ZAST_C:   db  'Chyba! Vypadla zastavovacia clonka!', 0dh, 0ah, 00h
09F4 61212056   
09F8 79706164   
09FC 6C61207A   
0A00 61737461   
0A04 766F7661   
0A08 63696120   
0A0C 636C6F6E   
0A10 6B61210D   
0A14 0A00       
0A16 43687962       1967    STR_ERR_SKRH:     db  'Chyba! Neocakavane nacitanie hornej spomalovacej clonky!', 0dh, 0ah, 
                                                                               00h
0A1A 6121204E   
0A1E 656F6361   
0A22 6B617661   
0A26 6E65206E   
0A2A 61636974   
0A2E 616E6965   
0A32 20686F72   
0A36 6E656A20   
0A3A 73706F6D   
0A3E 616C6F76   
0A42 6163656A   
0A46 20636C6F   
0A4A 6E6B7921   
0A4E 0D0A00     
0A51 43687962       1968    STR_ERR_SKRD:     db  'Chyba! Neocakavane nacitanie dolnej spomalovacej clonky!', 0dh, 0ah, 
                                                                               00h
0A55 6121204E   
0A59 656F6361   
0A5D 6B617661   
DEBUG                                                                                                         PAGE 38

0A61 6E65206E   
0A65 61636974   
0A69 616E6965   
0A6D 20646F6C   
0A71 6E656A20   
0A75 73706F6D   
0A79 616C6F76   
0A7D 6163656A   
0A81 20636C6F   
0A85 6E6B7921   
0A89 0D0A00     
                    1969    
----                1970            DSEG
0040                1971            org     40h
0040                1972    STACK:  DS      10h
                    1973    
                    1974    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
DEBUG                                                                                                         PAGE 39

ACC. . . . . . . . . . . . . . .  D ADDR  00E0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSMERPI1U . . . . . . . . . . .    NUMB  003EH  NOT USED  
BMSMERPI2D . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMSMERPI2U . . . . . . . . . . .    NUMB  0038H  NOT USED  
BMSMERPI3D . . . . . . . . . . .    NUMB  0007H  NOT USED  
BMSMERPI3U . . . . . . . . . . .    NUMB  0020H  NOT USED  
BMSMERPI4D . . . . . . . . . . .    NUMB  001FH  NOT USED  
BMSMERPKI1U. . . . . . . . . . .    NUMB  001CH  NOT USED  
BMSMERPKI2D. . . . . . . . . . .    NUMB  0002H  NOT USED  
BMSMERPKI2U. . . . . . . . . . .    NUMB  0018H  NOT USED  
BMSMERPKI3D. . . . . . . . . . .    NUMB  0006H  NOT USED  
BMSMERPKI3U. . . . . . . . . . .    NUMB  0010H  NOT USED  
BMSMERPKI4D. . . . . . . . . . .    NUMB  000EH  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  00B6H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00CFH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00DAH  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00C7H  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
DEBUG                                                                                                         PAGE 40

D2_MB1C. . . . . . . . . . . . .  C ADDR  0403H  
D3_MB2C. . . . . . . . . . . . .  C ADDR  05CBH  
D4_MB2C. . . . . . . . . . . . .  C ADDR  06F6H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0828H  
DISPSTR. . . . . . . . . . . . .  C ADDR  0904H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  0384H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  03F8H  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  03C9H  
DOWN3. . . . . . . . . . . . . .  C ADDR  051DH  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  05D5H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0562H  
DOWN3_STOP . . . . . . . . . . .  C ADDR  05ECH  
DOWN4. . . . . . . . . . . . . .  C ADDR  0648H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  0700H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  068DH  
DOWN4_STOP . . . . . . . . . . .  C ADDR  0717H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
DSPS_END . . . . . . . . . . . .  C ADDR  0914H  
DSPS_LOOP. . . . . . . . . . . .  C ADDR  0906H  
EA . . . . . . . . . . . . . . .  B ADDR  00AFH  PREDEFINED  
ENDPROG. . . . . . . . . . . . .  C ADDR  07B6H  NOT USED  
ERROR1 . . . . . . . . . . . . .  C ADDR  077DH  
ERROR1C. . . . . . . . . . . . .  C ADDR  0796H  
ERROR1S. . . . . . . . . . . . .  C ADDR  0788H  
ERROR2 . . . . . . . . . . . . .  C ADDR  07A7H  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  0738H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  074DH  
ERR_SKRD . . . . . . . . . . . .  C ADDR  076BH  
ERR_SKRH . . . . . . . . . . . .  C ADDR  0774H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  0762H  
ET0. . . . . . . . . . . . . . .  B ADDR  00A9H  PREDEFINED  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  0124H  
F1S. . . . . . . . . . . . . . .  C ADDR  0109H  
F2 . . . . . . . . . . . . . . .  C ADDR  027AH  
F2DOWN . . . . . . . . . . . . .  C ADDR  028CH  
F2OK . . . . . . . . . . . . . .  C ADDR  024CH  
F2S. . . . . . . . . . . . . . .  C ADDR  0230H  
F2SW . . . . . . . . . . . . . .  C ADDR  0260H  
F2UP . . . . . . . . . . . . . .  C ADDR  0280H  
F3 . . . . . . . . . . . . . . .  C ADDR  0470H  
F3DOWN . . . . . . . . . . . . .  C ADDR  0482H  
F3OK . . . . . . . . . . . . . .  C ADDR  0442H  
F3S. . . . . . . . . . . . . . .  C ADDR  0426H  
F3SW . . . . . . . . . . . . . .  C ADDR  0456H  
F3UP . . . . . . . . . . . . . .  C ADDR  0476H  
F4OK . . . . . . . . . . . . . .  C ADDR  063CH  
F4S. . . . . . . . . . . . . . .  C ADDR  0621H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
DEBUG                                                                                                         PAGE 41

FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00F5H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  021CH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0412H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  060DH  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
INT_TIMER0 . . . . . . . . . . .  C ADDR  07C2H  
INT_TIMER0_END . . . . . . . . .  C ADDR  07E6H  
INT_TIMER0_MAIN. . . . . . . . .  C ADDR  07D2H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00EFH  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P1 . . . . . . . . . . . . . . .  D ADDR  0090H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PCON . . . . . . . . . . . . . .  D ADDR  0087H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
DEBUG                                                                                                         PAGE 42

PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  086EH  
READPORTS1 . . . . . . . . . . .  C ADDR  082EH  
READPORTS_C. . . . . . . . . . .  C ADDR  08BAH  
READPORTS_C1 . . . . . . . . . .  C ADDR  08B4H  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SBUF . . . . . . . . . . . . . .  D ADDR  0099H  PREDEFINED  
SCON . . . . . . . . . . . . . .  D ADDR  0098H  PREDEFINED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOP . . . . . . . . . . . . . .  C ADDR  0807H  
STOPC. . . . . . . . . . . . . .  C ADDR  0817H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  
STOPPED. . . . . . . . . . . . .  B ADDR  0038H  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  097FH  NOT USED  
STR_ERR_1SPOM_C. . . . . . . . .  C ADDR  09A0H  
STR_ERR_2SPOM_C. . . . . . . . .  C ADDR  09C6H  
STR_ERR_SKRD . . . . . . . . . .  C ADDR  0A51H  
STR_ERR_SKRH . . . . . . . . . .  C ADDR  0A16H  
STR_ERR_ZAST_C . . . . . . . . .  C ADDR  09F0H  
STR_INIT . . . . . . . . . . . .  C ADDR  0917H  
STR_STOP . . . . . . . . . . . .  C ADDR  093EH  NOT USED  
TCON . . . . . . . . . . . . . .  D ADDR  0088H  PREDEFINED  
TH0. . . . . . . . . . . . . . .  D ADDR  008CH  PREDEFINED  
TH1. . . . . . . . . . . . . . .  D ADDR  008DH  PREDEFINED  
TI . . . . . . . . . . . . . . .  B ADDR  0099H  PREDEFINED  
TIME0. . . . . . . . . . . . . .  C ADDR  07F3H  
TIME1. . . . . . . . . . . . . .  C ADDR  07F5H  
TIME10MS . . . . . . . . . . . .  C ADDR  07F1H  
TIME2. . . . . . . . . . . . . .  C ADDR  07F9H  
TIME3. . . . . . . . . . . . . .  C ADDR  07FDH  
TIME4. . . . . . . . . . . . . .  C ADDR  0804H  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  
TL0. . . . . . . . . . . . . . .  D ADDR  008AH  PREDEFINED  
TL1. . . . . . . . . . . . . . .  D ADDR  008BH  PREDEFINED  
TMOD . . . . . . . . . . . . . .  D ADDR  0089H  PREDEFINED  
TR0. . . . . . . . . . . . . . .  B ADDR  008CH  PREDEFINED  
TR1. . . . . . . . . . . . . . .  B ADDR  008EH  PREDEFINED  
U1_MB2C. . . . . . . . . . . . .  C ADDR  01D9H  
U2_MB2C. . . . . . . . . . . . .  C ADDR  0341H  
U3_MB1C. . . . . . . . . . . . .  C ADDR  050DH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  0130H  
UP1A . . . . . . . . . . . . . .  C ADDR  014DH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  01E3H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0175H  
DEBUG                                                                                                         PAGE 43

UP1_STOP . . . . . . . . . . . .  C ADDR  01FAH  
UP2. . . . . . . . . . . . . . .  C ADDR  0298H  
UP2A . . . . . . . . . . . . . .  C ADDR  02B5H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  034BH  
UP2_MB2. . . . . . . . . . . . .  C ADDR  02DDH  
UP2_STOP . . . . . . . . . . . .  C ADDR  0362H  
UP3. . . . . . . . . . . . . . .  C ADDR  048EH  
UP3A . . . . . . . . . . . . . .  C ADDR  04ABH  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0502H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  04D3H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAITFORTIMER . . . . . . . . . .  C ADDR  0826H  
WRITEPORTS . . . . . . . . . . .  C ADDR  08CDH  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
