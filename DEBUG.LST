DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umozni stlacat tlacidla aj ked bezi delay
                       7    
                       8    ;Prerusenia pojdu, ale treba dat sakra pozor na zalohovanie veci!!!
                       9    
                      10    
                      11    $MOD51
                      12    $DEBUG
                      13    
                =1    14    $include (lift.inc)
                =1    15    
                =1    16    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    17    ; ****************************************************************************
                =1    18    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    19    ; ----------------------------------------------------------------------------
                =1    20    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    21    ; ----------------------------------------------------------------------------
                =1    22    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    23    ; ****************************************************************************
                =1    24    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    25    ; ----------------------------------------------------------------------------
                =1    26    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    27    ; ----------------------------------------------------------------------------
                =1    28    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    29    ; ****************************************************************************
                =1    30    ; ERRFLOOR > |       |       |       | ErrF4 | ErrF3 | ErrF2 | ErrF1 |       |
                =1    31    ; ****************************************************************************
                =1    32    
                =1    33    
                =1    34    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    35    i8255INA        equ     080h
  0081          =1    36    i8255INB        equ     081h
  0082          =1    37    i8255INC        equ     082h
  0083          =1    38    i8255INCW       equ     083h
  00C0          =1    39    i8255OUTA       equ     0c0h
  00C1          =1    40    i8255OUTB       equ     0c1h
  00C2          =1    41    i8255OUTC       equ     0c2h
  00C3          =1    42    i8255OUTCW      equ     0c3h
                =1    43    
  0028          =1    44    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    45    INPORTB         data    21h
  0022          =1    46    INPORTC         data    22h
  0023          =1    47    OUTPORTA        data    23h
  0024          =1    48    OUTPORTB        data    24h
  0025          =1    49    OUTPORTC        data    25h
  0026          =1    50    INPORTBold      data    26h
  0027          =1    51    CTRLREG         data    27h
                =1    52    
  002A          =1    53    ERRFLOOR_U      data    2Ah
  002B          =1    54    ERRFLOOR_D      data    2Bh
                =1    55    
  0051          =1    56    ERRF1_U         bit     ERRFLOOR_U.1
  0052          =1    57    ERRF2_U         bit     ERRFLOOR_U.2
  0053          =1    58    ERRF3_U         bit     ERRFLOOR_U.3
DEBUG                                                                                                         PAGE 2

  0054          =1    59    ERRF4_U         bit     ERRFLOOR_U.4  
                =1    60    
  0052          =1    61    ERRF12_U        bit     ERRFLOOR_U.2
  0053          =1    62    ERRF23_U        bit     ERRFLOOR_U.3
  0054          =1    63    ERRF34_U        bit     ERRFLOOR_U.4   
                =1    64    
  0059          =1    65    ERRF1_D         bit     ERRFLOOR_D.1
  005A          =1    66    ERRF2_D         bit     ERRFLOOR_D.2
  005B          =1    67    ERRF3_D         bit     ERRFLOOR_D.3
  005C          =1    68    ERRF4_D         bit     ERRFLOOR_D.4   
                =1    69    
  0059          =1    70    ERRF12_D        bit     ERRFLOOR_D.1
  005A          =1    71    ERRF23_D        bit     ERRFLOOR_D.2
  005B          =1    72    ERRF34_D        bit     ERRFLOOR_D.3 
                =1    73    
  0035          =1    74    ERRF1_C         data    35h
  0036          =1    75    ERRF2_C         data    36h
  0037          =1    76    ERRF3_C         data    37h
  0038          =1    77    ERRF4_C         data    38h
                =1    78    
  0039          =1    79    ERRF12_C        data    39h
  003A          =1    80    ERRF23_C        data    3Ah
  003B          =1    81    ERRF34_C        data    3Bh
                =1    82               
  0030          =1    83    POSITION        data    30h
  0031          =1    84    LOWEST          data    31h
  0032          =1    85    HIGHEST         data    32h
  0033          =1    86    STOPTIMER       data    33h
  0034          =1    87    OUTPORTBold     data    34h
                =1    88    
  0040          =1    89    STOPNOT         bit     INPORTA.0
  0041          =1    90    PKI1            bit     INPORTA.1
  0042          =1    91    PKI2            bit     INPORTA.2
  0043          =1    92    PKI3            bit     INPORTA.3
  0044          =1    93    PKI4            bit     INPORTA.4
  0045          =1    94    DOORCLSD        bit     INPORTA.5 
                =1    95    
  0009          =1    96    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    97    MB2             bit     INPORTB.2
  000B          =1    98    SKRH            bit     INPORTB.3
  000C          =1    99    SKRD            bit     INPORTB.4
  000D          =1   100    DP              bit     INPORTB.5
  000E          =1   101    DPZK            bit     INPORTB.6
  000F          =1   102    DPK             bit     INPORTB.7
                =1   103    
  0031          =1   104    MB1old          bit     INPORTBold.1
  0032          =1   105    MB2old          bit     INPORTBold.2
  0033          =1   106    SKRHold         bit     INPORTBold.3
  0034          =1   107    SKRDold         bit     INPORTBold.4
                =1   108    
  0010          =1   109    PI1             bit     INPORTC.0
  0011          =1   110    PI2D            bit     INPORTC.1
  0012          =1   111    PI2U            bit     INPORTC.2
  0013          =1   112    PI3D            bit     INPORTC.3
  0014          =1   113    PI3U            bit     INPORTC.4
  0015          =1   114    PI4             bit     INPORTC.5
                =1   115    
  0018          =1   116    KS              bit     OUTPORTA.0
DEBUG                                                                                                         PAGE 3

  0019          =1   117    PKO1            bit     OUTPORTA.1
  001A          =1   118    PKO2            bit     OUTPORTA.2
  001B          =1   119    PKO3            bit     OUTPORTA.3
  001C          =1   120    PKO4            bit     OUTPORTA.4
                =1   121    
  0020          =1   122    UP              bit     OUTPORTB.0
  0021          =1   123    DOWN            bit     OUTPORTB.1
  0022          =1   124    FAST            bit     OUTPORTB.2
  0023          =1   125    SLOW            bit     OUTPORTB.3
  0024          =1   126    FLED1           bit     OUTPORTB.4
  0025          =1   127    FLED2           bit     OUTPORTB.5
  0026          =1   128    FLED3           bit     OUTPORTB.6
  0027          =1   129    FLED4           bit     OUTPORTB.7
                =1   130    
  0028          =1   131    PO1             bit     OUTPORTC.0
  0029          =1   132    PO2D            bit     OUTPORTC.1
  002A          =1   133    PO2U            bit     OUTPORTC.2
  002B          =1   134    PO3D            bit     OUTPORTC.3
  002C          =1   135    PO3U            bit     OUTPORTC.4
  002D          =1   136    PO4             bit     OUTPORTC.5
  002E          =1   137    LEDD            bit     OUTPORTC.6
  002F          =1   138    LEDU            bit     OUTPORTC.7
                =1   139    
  0038          =1   140    STOPPED         bit     CTRLREG.0
  0039          =1   141    DOORCLSDold     bit     CTRLREG.1
  003A          =1   142    UPold           bit     CTRLREG.2
  003B          =1   143    DOWNold         bit     CTRLREG.3
  003C          =1   144    FASTold         bit     CTRLREG.4
  003D          =1   145    SLOWold         bit     CTRLREG.5
                =1   146    
  00B6          =1   147    WRNOT           bit     0b6h        ; p3.6
  00B7          =1   148    RDNOT           bit     0b7h        ; p3.7
                =1   149    
                =1   150    ; bitove masky
                =1   151    ; 8255OUT 
                =1   152    ; port A
  0001          =1   153    bmKS              equ    00000001b
  0002          =1   154    bmPKO1            equ    00000010b
  0004          =1   155    bmPKO2            equ    00000100b
  0008          =1   156    bmPKO3            equ    00001000b
  0010          =1   157    bmPKO4            equ    00010000b
                =1   158    
                =1   159    ; port B
  0001          =1   160    bmUP              equ    00000001b
  0002          =1   161    bmDOWN            equ    00000010b
  0004          =1   162    bmFAST            equ    00000100b
  0008          =1   163    bmSLOW            equ    00001000b
  0010          =1   164    bmFLED1           equ    00010000b
  0020          =1   165    bmFLED2           equ    00100000b
  0040          =1   166    bmFLED3           equ    01000000b
  0080          =1   167    bmFLED4           equ    10000000b
                =1   168    
                =1   169    ; port C
  0001          =1   170    bmPO1             equ    00000001b
  0002          =1   171    bmPO2D            equ    00000010b
  0004          =1   172    bmPO2U            equ    00000100b
  0008          =1   173    bmPO3D            equ    00001000b
  0010          =1   174    bmPO3U            equ    00010000b
DEBUG                                                                                                         PAGE 4

  0020          =1   175    bmPO4             equ    00100000b
  0040          =1   176    bmLEDD            equ    01000000b
  0080          =1   177    bmLEDU            equ    10000000b
                =1   178    
                =1   179    ; 8255IN
                =1   180    ; port A
  0001          =1   181    bmSTOP            equ    00000001b
  0002          =1   182    bmPKI1            equ    00000010b
  0004          =1   183    bmPKI2            equ    00000100b
  0008          =1   184    bmPKI3            equ    00001000b
  0010          =1   185    bmPKI4            equ    00010000b
  0020          =1   186    bmDOORCLSD        equ    00100000b
                =1   187    
                =1   188    ; port B
  0002          =1   189    bmMB1I            equ    00000010b
  0004          =1   190    bmMB2I            equ    00000100b
  0008          =1   191    bmSKRHI           equ    00001000b
  0010          =1   192    bmSKRHD           equ    00010000b
  0020          =1   193    bmDPI             equ    00100000b
  0040          =1   194    bmDPZKI           equ    01000000b
  0080          =1   195    bmDPKI            equ    10000000b
                =1   196    
                =1   197    ; port C
  0001          =1   198    bmPI1             equ    00000001b
  0002          =1   199    bmPI2D            equ    00000010b
  0004          =1   200    bmPI2U            equ    00000100b
  0008          =1   201    bmPI3D            equ    00001000b
  0010          =1   202    bmPI3U            equ    00010000b
  0020          =1   203    bmPI4             equ    00100000b
                     204    
                     205    _BP_    MACRO 
                     206            clr     P3.3
                     207            setb    EX1
                     208            nop
                     209            nop
                     210    ENDM
                     211                        
                     212    ANLBN   MACRO   BIT1, BIT2
                     213            mov   C, BIT1
                     214            anl   C, /BIT2
                     215            mov   BIT1, C
                     216    ENDM
                     217    
                     218    LJZ     MACRO   NAVESTIE
                     219            jnz     $+5
                     220            ljmp    NAVESTIE
                     221            nop
                     222    ENDM
                     223    
                     224    LJNZ    MACRO   NAVESTIE
                     225            jz      $+5
                     226            ljmp    NAVESTIE
                     227            nop
                     228    ENDM
                     229    
                     230    LJB     MACRO   TESTBIT, NAVESTIE
                     231            jnb     TESTBIT, $+6
                     232            ljmp    NAVESTIE
DEBUG                                                                                                         PAGE 5

                     233            nop
                     234    ENDM
                     235    
                     236    LJNB    MACRO   TESTBIT, NAVESTIE
                     237            jb      TESTBIT, $+6
                     238            ljmp    NAVESTIE
                     239            nop
                     240    ENDM
                     241    
                     242    CJE     MACRO   OP1, OP2, NAVESTIE
                     243            cjne    OP1, OP2, $+7
                     244            jmp    NAVESTIE
                     245            nop
                     246    ENDM
                     247    
                     248    LCJNE   MACRO   OP1, OP2, NAVESTIE
                     249            cjne    OP1, OP2, $+6
                     250            jmp     $+6
                     251            ljmp    NAVESTIE
                     252            nop
                     253    ENDM
                     254    
  0000               255    COUNT    SET    0
                     256    
                     257    
                     258    ;NEVYSKUSANE (ANI NESKOMPILOVANE) !
                     259    
                     260    SET_FLOOR_ERR   MACRO   TESTBIT, FLOORBIT, NAVESTIE, POSCH, LABEL    ;; nastavi dane poschod
                                                                               ie ako poruchove ak je TESTBIT rovny 0 
                     261                                                                                                
                                                                                                                        
                                                                                   ;;   FLOORBIT:   ERRF1, .. ERRF4, ERR
                                                                               F12, ERRF23, ERRF34
                     262                                                                                                
                                                                                                                        
                                                                                   ;;   TESTBIT:    MB1, MB2
                     263            ;INCREMENT SUFFIX  FOR  NEXT LABEL             
                     264            COUNT    SET    COUNT+1                   
                     265            
                     266            jb      TESTBIT, ENDD&LABEL
                     267            jnb     PKI&POSCH, $+7
                     268            setb    SLOW
                     269            setb    STOPPED         
                     270            setb    FLOORBIT&_U
                     271            setb    FLOORBIT&_D
                     272            inc     FLOORBIT&_C
                     273                    clr     PKO&POSCH                               ;; vynulovanie volby poschod
                                                                               ia na ktorom stojim
                     274            clr     PO&POSCH&U            
                     275            clr     PO&POSCH&D              
                     276                    lcall   WRITEPORTS
                     277            ljmp    NAVESTIE
                     278    ENDD&LABEL:
                     279            nop
                     280    ENDM
                     281    
                     282    CLR_FLOOR_ERR   MACRO   FLOORBIT,   ;; nastavi dane poschodie ako bezporuchove           
                     283            clr    FLOORBIT&_U
DEBUG                                                                                                         PAGE 6

                     284            clr    FLOORBIT&_D
                     285            nop
                     286    ENDM
                     287    
                     288    ZAKMITC MACRO   TYPCLONKY
                     289            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     290            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     291            jnb     TYPCLONKY, $-3  ; 
                     292            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     293    ENDM
                     294    
                     295    ZASTAV  MACRO  C_POSCH, SMER
                     296                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     297            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     298            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     299            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     300            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
                     301            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
                     302            anl     C, /ERRF&C_POSCH&_&SMER ; | a mam v tomto smere poruchu na tomto poschodi (A
                                                                               k ano, tak nema zmysel stat)
                     303            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     304            orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
                     305            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     306    ENDM
                     307    
                     308    NAJNIZSIE  MACRO
                     309            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     310            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     311            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     312    
                     313            ANLBN   ACC.1, ERRF1_D  ; maskujem chybne poschodia
                     314            ANLBN   ACC.2, ERRF2_D  ; |
                     315            ANLBN   ACC.3, ERRF2_D  ; |
                     316            ANLBN   ACC.4, ERRF3_D  ; |
                     317            ANLBN   ACC.5, ERRF3_D  ; |
                     318    
                     319            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     320     ; LL1: 
                     321            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     322            clr     C               ; Inak shiftnem o 2
                     323            rlc     A               ;
                     324            clr     C               ;
                     325            rlc     A               ;
                     326            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     327    ; LL2:
                     328            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
DEBUG                                                                                                         PAGE 7

                     329    ENDM
                     330    
                     331    NAJVYSSIE  MACRO
                     332            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     333            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     334            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     335            
                     336            ANLBN   ACC.2, ERRF2_U  ; maskujem chybne poschodia
                     337            ANLBN   ACC.3, ERRF2_U  ; |
                     338            ANLBN   ACC.4, ERRF3_U  ; |
                     339            ANLBN   ACC.5, ERRF3_U  ; |
                     340            ANLBN   ACC.6, ERRF4_U  ; |
                     341            
                     342            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     343     ; LL1: 
                     344            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     345            clr     C               ; Inak shiftnem o 2
                     346            rrc     A               ;
                     347            clr     C               ;
                     348            rrc     A               ;
                     349            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     350    ; LL2:
                     351            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     352            clr     C               ;
                     353            subb    A, R0           ;
                     354    ENDM
                     355    
                     356    VYSSIE_KABINA  MACRO  POSCH
                     357            mov     A, INPORTA
                     358            anl     A, #00011110b
                     359            mov     B, ERRFLOOR_U   ; maskujem chybne poschodia
                     360            xrl     B, #0FFH
                     361            anl     A, B
                     362            clr     C
                     363            rrc     A
                     364    ;LL1    
                     365            mov     R0, #&POSCH
                     366            clr     C
                     367            rrc     A
                     368            djnz    R0, $-2;LL1
                     369    ENDM
                     370    
                     371    NIZSIE_KABINA  MACRO  POSCH
                     372            mov     A, #5
                     373            clr     C
                     374            subb    A, #&POSCH
                     375            mov     R0, A
                     376            mov     A, INPORTA
                     377            anl     A, #00011110b
                     378            mov     B, ERRFLOOR_D   ; maskujem chybne poschodia
                     379            xrl     B, #0FFH
                     380            anl     A, B
                     381            clr     C
DEBUG                                                                                                         PAGE 8

                     382            rlc     A
                     383            clr     C
                     384            rlc     A
                     385            clr     C
                     386            rlc     A
                     387    ;LL1   
                     388            clr     C
                     389            rlc     A
                     390            djnz    R0, $-2;LL1
                     391    ENDM
                     392    
                     393    POLOHA_LED  MACRO  POLOHA
                     394            clr     LEDU            
                     395            clr     LEDD 
                     396            clr     FLED1             
                     397            clr     FLED2                
                     398            clr     FLED3           
                     399            clr     FLED4           
                     400            setb    FLED&POLOHA
                     401            lcall   WRITEPORTS
                     402    ENDM
                     403    
                     404    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               405    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     406                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     407                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     408    ;osetrenie vektorov preruseni
0000                 409            org     0000h           ; adresa odkial startuje program po resete
0000 020033          410            ljmp    START           ; skok na zaciatok kodu programu
                     411            
000B                 412            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 020AC0          413            ljmp    INT_TIMER0      ; pre citac T0
                     414                  
0033                 415            org     0033h           ; od tejto adresy sa zacina kod programu
                     416            
0033                 417    START:
0033                 418    RESET:  
                     419            ; riadiace signaly do pasivnej urovne 
0033 D2B6            420            setb    WRNOT
0035 D2B7            421            setb    RDNOT
0037 753300          422            mov     STOPTIMER, #0
003A 758140          423            mov     SP, #STACK
                     424    
                     425            ; pockame si na inicializaciu obvodov 8255  
003D 7900            426            mov     R1, #0 
003F 7AFF            427            mov     R2, #0ffh
0041 D9FE            428            djnz    R1, $
0043 DAFC            429            djnz    R2, $-2
                     430            
                     431            ; teraz ich mozeme nastavit
0045 75809B          432            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          433            mov     p2, #i8255INCW
004B C2B6            434            clr     WRNOT
004D 00              435            nop
004E 00              436            nop
004F 00              437            nop
DEBUG                                                                                                         PAGE 9

0050 00              438            nop
0051 D2B6            439            setb    WRNOT
0053 758080          440            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          441            mov     p2, #i8255OUTCW
0059 C2B6            442            clr     WRNOT
005B 00              443            nop
005C 00              444            nop
005D 00              445            nop
005E 00              446            nop
005F D2B6            447            setb    WRNOT
                     448            
                     449            ;_BP_
                     450            
                     451            ;-----------------------
                     452            ; Prerusenia
                     453            ;----------------------- 
                     454            ;clr     TR1                 ; zastavi sa citac T1
                     455            ;clr     TR0                 ; a tiez citac T0
                     456            ;mov     SCON,#01010010b     ; nastavenie registra SCON
                     457            ;                            ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     458            ;                            ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     459            ;                            ; RI=0 (prijimaci register - nebol prijaty znak)
                     460            ;mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
                     461            ;mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     462            ;                            ; T1: mod 2 - po preteceni sa TL nastavi na hodnotu TH
                                                                               
                     463            ;                            ; GATE=0 (programove riadenie casovaca)
                     464            ;                            ; C/T#=0 interne hodiny/12
                     465            ;                            ; T0: mod 1 - 16 bitove pocitadlo
                     466            ;                            ; GATE=0 (programove riadenie casovaca)
                     467            ;                            ; C/T#=0 interne hodiny/12
                     468            ;mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila preno
                                                                               sova rychlost seriovej linky
                     469            ;mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
                     470            ;mov     TH1,#TIMERCONST     ; 
                     471            ;mov     TL0, #0D2h           ; inicializacia casovaca T0 65409,92(- 57600 = 0e100h 
                                                                               - to bolo)
                     472            ;mov     TH0, #0FFh
                     473    
                     474            ;setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     475            ;_BP_
                     476    
                     477    ;       ;setb    EX0                 ; prerusenie INT0  - ostava zakazane, signal STOP osetr
                                                                               ime priamo v hlavnej slucke
                     478    ;       ;setb    ES                  ; prerusenie seriovej linky teraz nevyuzivame
                     479            ;setb    ET0                 ; povolime prerusenia od casovaca T0
                     480            ;setb    TR0
                     481            ;setb    EA                  ; spust cely prerusovaci mechanizmus
                     482            
0061 C28E            483            clr     TR1                 ; zastavi sa citac T1
0063 759852          484            mov     SCON,#01010010b     ; nastavenie registra SCON
                     485                                        ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     486                                        ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     487                                        ; RI=0 (prijimaci register - nebol prijaty znak)
0066 758801          488            mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
0069 758921          489            mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     490                                        ; T1: mod 1 - 16 bitove pocitadlo
                     491                                        ; GATE=0 (programove riadenie casovaca)
DEBUG                                                                                                         PAGE 10

                     492                                        ; C/T#=0 interne hodiny/12
                     493                                        ; T0: mod 1 - 16 bitove pocitadlo
                     494                                        ; GATE=0 (programove riadenie casovaca)
                     495                                        ; C/T#=0 interne hodiny/12
006C 758700          496            mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila prenos
                                                                               ova rychlost seriovej linky
006F 758BFA          497            mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
0072 758DFA          498            mov     TH1,#TIMERCONST     ; 
0075 758A00          499            mov     TL0, #000h           ; inicializacia casovaca T0 - 57600 = 0e100h
0078 758C4C          500            mov     TH0, #04Ch
                     501            
007B D28C            502            setb    TR0
007D D28E            503            setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     504            
                     505            ;-----------------------
                     506            ; Prerusenia
                     507            ;-----------------------
                     508            
                     509    
                     510            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
007F 752800          511            mov     INPORTA, #0
0082 75211E          512            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0085 752200          513            mov     INPORTC, #0
0088 75231E          514            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
008B 7524F0          515            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
008E 7525FF          516            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0091 D218            517            setb    KS
0093 C238            518            clr     STOPPED
0095 120BD6          519            call    WRITEPORTS          ; zapis novu informaciu
                     520    ;;;;;;;;
                     521    
0098 752300          522            mov     OUTPORTA, #0
009B 752400          523            mov     OUTPORTB, #0
009E 752500          524            mov     OUTPORTC, #0
00A1 120BD6          525            call    WRITEPORTS          ; zapis novu informaciu
                     526    
00A4 752800          527            mov     INPORTA, #0
00A7 752100          528            mov     INPORTB, #0         
00AA 752200          529            mov     INPORTC, #0
00AD 120B77          530            call    READPORTS           ; prvotne nacitanie udajov
                     531            
00B0 752A00          532            mov     ERRFLOOR_U, #0h     ; vynuluj chybovy register
00B3 752B00          533            mov     ERRFLOOR_D, #0h      
                     534    
                     535            
00B6 900C20          536            mov     DPTR, #STR_INIT         ; vypis info 
00B9 120C0D          537            lcall   DISPSTR                 ; o inicializacii       
                     538    
00BC                 539    CALIB:
                     540            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     541            ;setb    TR0
00BC 120B77          542            lcall   READPORTS                   ; precitaj, co je na portoch
00BF 300C13          543            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00C2 D221            544            setb    DOWN                        ; inak pod dole
00C4 D222            545            setb    FAST                        ; a rychlo
00C6 C223            546            clr     SLOW                        ;
DEBUG                                                                                                         PAGE 11

00C8 C220            547            clr     UP                
00CA 120BD6          548            lcall   WRITEPORTS                  ; zapis informaciu 
00CD                 549    CALIBLOOP:
00CD 120B77          550            lcall   READPORTS                   ; 
00D0 300C02          551            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00D3 80F8            552            jmp     CALIBLOOP
00D5                 553    CALIBEND:                              
00D5 C222            554            clr     FAST                        ; zastavime v tomto smere
00D7 C221            555            clr     DOWN                        ;
00D9 D223            556            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00DB D220            557            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00DD 120BD6          558            lcall   WRITEPORTS 
00E0                 559    CALIBEND2:
00E0 120B77          560            lcall   READPORTS                   ; 
00E3 2009FA          561            jb      MB1, CALIBEND2              ; 
00E6 C223            562            clr     SLOW                        ; A teraz sme uz naozaj spravne
00E8 C220            563            clr     UP                          ; 
00EA D224            564            setb    FLED1
00EC 120BD6          565            lcall   WRITEPORTS                  ; zapis informaciu
                     566            ;clr     TR0
                     567            ;_BP_
00EF 900C20          568            mov     DPTR, #STR_INIT             ; vypis info o kalibracii
00F2 120C0D          569            lcall   DISPSTR                     ;
00F5                 570    MAIN:
                     571    
                     572    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     573    ; ****************************************************************************
                     574    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     575    ; ----------------------------------------------------------------------------
                     576    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     577    ; ----------------------------------------------------------------------------
                     578    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     579    ; ****************************************************************************
                     580    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     581    ; ----------------------------------------------------------------------------
                     582    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     583    ; ----------------------------------------------------------------------------
                     584    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     585    ; ****************************************************************************
                     586    ; POSITION
                     587    ; ****************************************************************************
                     588    
                     589    
                     590    
00F5 7D00            591            mov     R5, #0
00F7 7E14            592            mov     R6, #20
00F9 D2A9            593            setb    ET0;
                     594            
                     595    
                     596    
                     597    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     598    
00FB                 599    FLOOR1:
                     600 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00FB C22F            601 +1         clr     LEDU            
DEBUG                                                                                                         PAGE 12

00FD C22E            602 +1         clr     LEDD 
00FF C224            603 +1         clr     FLED1             
0101 C225            604 +1         clr     FLED2                
0103 C226            605 +1         clr     FLED3           
0105 C227            606 +1         clr     FLED4           
0107 D224            607 +1         setb    FLED1
0109 120BD6          608 +1         lcall   WRITEPORTS
010C 120B2F          610            lcall   WAITFORTIMER    ; simulacia TIMERu
010F 120B77          611    F1S:    lcall   READPORTS     ;-; nacitanie dat
0112 C219            612            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
0114 C228            613            clr     PO1             ;
0116 120BD6          614            lcall   WRITEPORTS      ;
0119 200FF3          615            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
011C E528            616            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
011E 852AF0          617            mov     B, ERRFLOOR_U   ; | maskujem chybne poschodia
0121 63F0FF          618            xrl     B, #0FFH        ; | |
0124 55F0            619            anl     A, B            ; | |
0126 541C            620            anl     A, #00011100b ;-; |
0128 7026            621            jnz     F1OK          ;-; ak ano, podme na to
012A E522            622            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
012C 543E            623            anl     A, #00111110b ;-;
                     624 +1         ANLBN   ACC.1, ERRF2_U  ; maskujem chybne poschodia (v smere hore)
012E A2E1            625 +1         mov   C, ACC.1
0130 B052            626 +1         anl   C, /ERRF2_U
0132 92E1            627 +1         mov   ACC.1, C
                     629 +1         ANLBN   ACC.2, ERRF2_U  ; |
0134 A2E2            630 +1         mov   C, ACC.2
0136 B052            631 +1         anl   C, /ERRF2_U
0138 92E2            632 +1         mov   ACC.2, C
                     634 +1         ANLBN   ACC.3, ERRF3_U  ; |
013A A2E3            635 +1         mov   C, ACC.3
013C B053            636 +1         anl   C, /ERRF3_U
013E 92E3            637 +1         mov   ACC.3, C
                     639 +1         ANLBN   ACC.4, ERRF3_U  ; |
0140 A2E4            640 +1         mov   C, ACC.4
0142 B053            641 +1         anl   C, /ERRF3_U
0144 92E4            642 +1         mov   ACC.4, C
                     644 +1         ANLBN   ACC.5, ERRF4_U  ; |
0146 A2E5            645 +1         mov   C, ACC.5
0148 B054            646 +1         anl   C, /ERRF4_U
014A 92E5            647 +1         mov   ACC.5, C
014C 7002            649            jnz     F1OK          ;-; ak ano, podme na to
014E 80BF            650            jmp     F1S             ; Nemam sa kde hnut, opakujem
0150 D220            651    F1OK:   setb    UP              ; rychly pohyb hore
0152 D222            652            setb    FAST            ; 
0154 C223            653            clr     SLOW            ;
0156 120BD6          654            lcall   WRITEPORTS      ; 
0159 02015C          655            jmp     UP1           ;-; prejdi do stavu UP1
015C                 656    UP1:
                     657 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
015C C22F            658 +1         clr     LEDU            
015E C22E            659 +1         clr     LEDD 
0160 C224            660 +1         clr     FLED1             
0162 C225            661 +1         clr     FLED2                
0164 C226            662 +1         clr     FLED3           
DEBUG                                                                                                         PAGE 13

0166 C227            663 +1         clr     FLED4           
0168 D224            664 +1         setb    FLED1
016A 120BD6          665 +1         lcall   WRITEPORTS
                     667 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
016D 120AFA          668 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0170 120B77          669 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0173 3009FA          670 +1         jnb     MB1, $-3  ; 
0176 120AFA          671 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0179 120B77          673    UP1A:   lcall   READPORTS       ; nacitanie dat
                     674 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
017C 200B03          675 +1         jb      SKRH, $+6
017F 020A72          676 +1         ljmp    ERR_SKRH
0182 00              677 +1         nop
                     679 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0183 200903          680 +1         jb      MB1, $+6
0186 020A4B          681 +1         ljmp    ERR_2SPOM_C
0189 00              682 +1         nop
                     684            ;SET_FLOOR_ERR   MB1, ERRF1, UP1_MB2
018A 200AEC          685            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     686 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
018D 120AFA          687 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0190 120B77          688 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0193 300AFA          689 +1         jnb     MB2, $-3  ; 
0196 120AFA          690 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0199 D22E            692            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
019B 120BD6          693            lcall   WRITEPORTS      ;
019E 0201A1          694            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
01A1                 695    UP1_MB2:
                     696 +1         ZAKMITC MB2             ; Pockame, kym odideme z poschodia (Clonky MB1)
01A1 120AFA          697 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
01A4 120B77          698 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
01A7 300AFA          699 +1         jnb     MB2, $-3  ; 
01AA 120AFA          700 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
01AD 120B77          702    UP1_MB2A: lcall   READPORTS       ; nacitanie dat
                     703 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01B0 200B03          704 +1         jb      SKRH, $+6
01B3 020A72          705 +1         ljmp    ERR_SKRH
01B6 00              706 +1         nop
                     708 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
01B7 200903          709 +1         jb      MB1, $+6
01BA 020A36          710 +1         ljmp    ERR_1SPOM_C
01BD 00              711 +1         nop
                     713            ;SET_FLOOR_ERR   MB1, ERRF1, UP1_MB1
01BE 200AEC          714            jb      MB2, UP1_MB2A  ;-; mame uz aj druhu spomalovaciu clonku?     
01C1 D22F            715            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
01C3 120BD6          716            lcall   WRITEPORTS      ;   
                     717 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
01C6 120AFA          718 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
01C9 120B77          719 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
01CC 300AFA          720 +1         jnb     MB2, $-3  ; 
01CF 120AFA          721 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     723    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
DEBUG                                                                                                         PAGE 14

                     724    ;        anl     A, #00000100b ;-;
                     725    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     726 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     727 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
01D2 C3              728 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
01D3 7400            729 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
01D5 7212            730 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
01D7 B00E            731 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
01D9 7242            732 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
01DB B052            733 +1         anl     C, /ERRF2_U ; | a mam v tomto smere poruchu na tomto poschodi (Ak ano, tak n
                                                                               ema zmysel stat)
01DD 720F            734 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
01DF 7238            735 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
01E1 3400            736 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01E3 7054            738            jnz     U1_MB2C       ;-; Ak ano, zastav
                     739 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01E5 E522            740 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01E7 33              741 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01E8 547E            742 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     743 +1         
                     744 +2         ANLBN   ACC.2, ERRF2_U  ; maskujem chybne poschodia
01EA A2E2            745 +2         mov   C, ACC.2
01EC B052            746 +2         anl   C, /ERRF2_U
01EE 92E2            747 +2         mov   ACC.2, C
                     748 +2         ANLBN   ACC.3, ERRF2_U  ; |
01F0 A2E3            749 +2         mov   C, ACC.3
01F2 B052            750 +2         anl   C, /ERRF2_U
01F4 92E3            751 +2         mov   ACC.3, C
                     752 +2         ANLBN   ACC.4, ERRF3_U  ; |
01F6 A2E4            753 +2         mov   C, ACC.4
01F8 B053            754 +2         anl   C, /ERRF3_U
01FA 92E4            755 +2         mov   ACC.4, C
                     756 +2         ANLBN   ACC.5, ERRF3_U  ; |
01FC A2E5            757 +2         mov   C, ACC.5
01FE B053            758 +2         anl   C, /ERRF3_U
0200 92E5            759 +2         mov   ACC.5, C
                     760 +2         ANLBN   ACC.6, ERRF4_U  ; |
0202 A2E6            761 +2         mov   C, ACC.6
0204 B054            762 +2         anl   C, /ERRF4_U
0206 92E6            763 +2         mov   ACC.6, C
                     764 +1         
0208 7805            765 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     766 +1  ; LL1: 
020A 6006            767 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
020C C3              768 +1         clr     C               ; Inak shiftnem o 2
DEBUG                                                                                                         PAGE 15

020D 13              769 +1         rrc     A               ;
020E C3              770 +1         clr     C               ;
020F 13              771 +1         rrc     A               ;
0210 D8F8            772 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     773 +1 ; LL2:
0212 7405            774 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0214 C3              775 +1         clr     C               ;
0215 98              776 +1         subb    A, R0           ;
                     778 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
0216 B40203          779 +1         cjne    A, #2, $+6
0219 02021F          780 +1         jmp     $+6
021C 020243          781 +1         ljmp    UP1_MB1
021F 00              782 +1         nop
                     784 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0220 E528            785 +1         mov     A, INPORTA
0222 541E            786 +1         anl     A, #00011110b
0224 852AF0          787 +1         mov     B, ERRFLOOR_U   ; maskujem chybne poschodia
0227 63F0FF          788 +1         xrl     B, #0FFH
022A 55F0            789 +1         anl     A, B
022C C3              790 +1         clr     C
022D 13              791 +1         rrc     A
                     792 +1 ;LL1    
022E 7802            793 +1         mov     R0, #2
0230 C3              794 +1         clr     C
0231 13              795 +1         rrc     A
0232 D8FC            796 +1         djnz    R0, $-2;LL1
0234 6003            798            jz      U1_MB2C         ; |   ak neni zastavujem         
0236 020243          799            jmp     UP1_MB1          ; |   inak nezastavim        
0239 D223            800    U1_MB2C: setb    SLOW            ;       Ak ano, spomalme
023B C222            801            clr     FAST            ; 
023D 120BD6          802            lcall   WRITEPORTS      ;         
0240 020281          803            jmp     UP1_STOP       ;-; a prejdi do stavu UP1_STOP 
0243                 804    UP1_MB1:
                     805 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0243 120AFA          806 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0246 120B77          807 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0249 300AFA          808 +1         jnb     MB2, $-3  ; 
024C 120AFA          809 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
024F 120B77          811            lcall   READPORTS       ; nacitanie dat
                     812 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0252 200B03          813 +1         jb      SKRH, $+6
0255 020A72          814 +1         ljmp    ERR_SKRH
0258 00              815 +1         nop
                     817            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                     818 +1         SET_FLOOR_ERR   MB2, ERRF2, UP2_MB2, 2, %COUNT
                     819 +1                                                                                             
                                                                                                                 
                     820 +1                                                                                             
                                                                                                                 
                     821 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0001               822 +1         COUNT    SET    COUNT+1                   
                     823 +1         
0259 200A19          824 +1         jb      MB2, ENDD0
025C 304204          825 +1         jnb     PKI2, $+7
DEBUG                                                                                                         PAGE 16

025F D223            826 +1         setb    SLOW
0261 D238            827 +1         setb    STOPPED         
0263 D252            828 +1         setb    ERRF2_U
0265 D25A            829 +1         setb    ERRF2_D
0267 0536            830 +1         inc     ERRF2_C
0269 C21A            831 +1                 clr     PKO2                               
026B C22A            832 +1         clr     PO2U            
026D C229            833 +1         clr     PO2D              
026F 120BD6          834 +1                 lcall   WRITEPORTS
0272 0203EE          835 +1         ljmp    UP2_MB2
0275                 836 +1 ENDD0:
0275 00              837 +1         nop
0276 2009CA          839            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     840 +1         CLR_FLOOR_ERR   ERRF2
0279 C252            841 +1         clr    ERRF2_U
027B C25A            842 +1         clr    ERRF2_D
027D 00              843 +1         nop
                     845            
                     846            ;Ak mame priznak STOPPED a hybeme sa pomaly, zastavme!
                     847    ;        jnb     SLOW, UP1_MB1C
                     848    ;        jnb     STOPPED, UP1_MB1C 
                     849    ;        clr     UP              ; zastav motor
                     850    ;        setb    UPOld           ;       (a zalohuj) 
                     851    ;        clr     DOWNOld         ;       (a zalohuj)
                     852    ;        clr     FAST            ; 
                     853    ;        lcall   WRITEPORTS      ; 
                     854    ;        jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     855             
027E 0203A9          856    UP1_MB1C: ljmp    UP2             ; |   inak nezastavim        
                     857    
0281                 858    UP1_STOP:
0281 120B77          859            lcall   READPORTS       ; nacitanie dat
                     860 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0284 200B03          861 +1         jb      SKRH, $+6
0287 020A72          862 +1         ljmp    ERR_SKRH
028A 00              863 +1         nop
                     865            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                     866 +1         SET_FLOOR_ERR   MB2, ERRF2, UP2_MB2, 2, %COUNT
                     867 +1                                                                                             
                                                                                                                 
                     868 +1                                                                                             
                                                                                                                 
                     869 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0002               870 +1         COUNT    SET    COUNT+1                   
                     871 +1         
028B 200A19          872 +1         jb      MB2, ENDD1
028E 304204          873 +1         jnb     PKI2, $+7
0291 D223            874 +1         setb    SLOW
0293 D238            875 +1         setb    STOPPED         
0295 D252            876 +1         setb    ERRF2_U
0297 D25A            877 +1         setb    ERRF2_D
0299 0536            878 +1         inc     ERRF2_C
029B C21A            879 +1                 clr     PKO2                               
029D C22A            880 +1         clr     PO2U            
029F C229            881 +1         clr     PO2D              
02A1 120BD6          882 +1                 lcall   WRITEPORTS
02A4 0203EE          883 +1         ljmp    UP2_MB2
DEBUG                                                                                                         PAGE 17

02A7                 884 +1 ENDD1:
02A7 00              885 +1         nop
02A8 2009D6          887            jb      MB1, UP1_STOP  ;-; Sme na zastavovacej clonke?      
                     888 +1         CLR_FLOOR_ERR   ERRF2
02AB C252            889 +1         clr    ERRF2_U
02AD C25A            890 +1         clr    ERRF2_D
02AF 00              891 +1         nop
02B0 C220            893            clr     UP              ; zastav motor
02B2 D23A            894            setb    UPOld           ;       (a zalohuj) 
02B4 C23B            895            clr     DOWNOld         ;       (a zalohuj)
02B6 C222            896            clr     FAST            ; 
02B8 120BD6          897            lcall   WRITEPORTS      ; 
02BB 0202BE          898            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2   
                     899    
                     900    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     901    
02BE                 902    FLOOR2:
                     903 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02BE C22F            904 +1         clr     LEDU            
02C0 C22E            905 +1         clr     LEDD 
02C2 C224            906 +1         clr     FLED1             
02C4 C225            907 +1         clr     FLED2                
02C6 C226            908 +1         clr     FLED3           
02C8 C227            909 +1         clr     FLED4           
02CA D225            910 +1         setb    FLED2
02CC 120BD6          911 +1         lcall   WRITEPORTS
02CF 120B2F          913            lcall   WAITFORTIMER    ; simulacia TIMERu
02D2 120B77          914    F2S:    lcall   READPORTS     ;-; nacitanie dat
02D5 C21A            915            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
02D7 C22A            916            clr     PO2U            ;
02D9 C229            917            clr     PO2D            ;
02DB 120BD6          918            lcall   WRITEPORTS      ;
02DE 200FF1          919            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
                     920            ;_BP_
02E1 782A            921            mov     R0, #ERRFLOOR_U ;   Default predpokladam, ze mam namierene hore (pozeram por
                                                                               uchy poschodia smerom hore)
02E3 79F8            922            mov     R1, #11111000b  ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
                                                                                kabina
02E5 7AF8            923            mov     R2, #11111000b  ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
                                                                                sachta
02E7 203A0A          924            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
02EA E9              925            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
02EB F4              926            cpl     A               ;       |
02EC F9              927            mov     R1, A           ;       |
02ED EA              928            mov     A, R2           ;       A znegujeme aj masku sachty
02EE F4              929            cpl     A               ;       |
02EF FA              930            mov     R2, A           ;       |  
02F0 E8              931            mov     A, R0           ;       A budeme pozerat poruchy poschodi smerom DOLE (ERRFL
                                                                               OOR_U+1 = ERRFLOOR_D)
02F1 6401            932            xrl     A, #01h         ;       | Znegujem posledny bit adresy registra s poruchovym
                                                                               i poschodiami (ERRFLOOR_U na ERRFLOOR_D a
                                                                                naopak)
02F3 F8              933            mov     R0, A           ;       |  
02F4                 934    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
02F4 E528            935            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
DEBUG                                                                                                         PAGE 18

02F6 86F0            936            mov     B, @R0          ;  | Maskujem chybne poschodia
02F8 63F0FF          937            xrl     B, #0FFH        ;  |
02FB 55F0            938            anl     A, B            ;  |
02FD 541A            939            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
02FF 59              940            anl     A, R1           ;  | 
                     941 +1         ljnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0300 6003            942 +1         jz      $+5
0302 02038B          943 +1         ljmp    F2
0305 00              944 +1         nop
                     946                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0306 E528            947            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0308 86F0            948            mov     B, @R0          ;  | Maskujem chybne poschodia
030A 63F0FF          949            xrl     B, #0FFH        ;  | |
030D 55F0            950            anl     A, B            ;  | |
030F 541A            951            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               ) 
0311 702D            952            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0313 E522            953            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0315 5439            954            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0317 5A              955            anl     A, R2           ;  |   
0318 86F0            956            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)      
                     957 +1         ANLBN   ACC.0, B.1      ;  | 
031A A2E0            958 +1         mov   C, ACC.0
031C B0F1            959 +1         anl   C, /B.1
031E 92E0            960 +1         mov   ACC.0, C
                     962 +1         ANLBN   ACC.1, B.2      ;  | 
0320 A2E1            963 +1         mov   C, ACC.1
0322 B0F2            964 +1         anl   C, /B.2
0324 92E1            965 +1         mov   ACC.1, C
                     967 +1         ANLBN   ACC.2, B.2      ;  |
0326 A2E2            968 +1         mov   C, ACC.2
0328 B0F2            969 +1         anl   C, /B.2
032A 92E2            970 +1         mov   ACC.2, C
                     972 +1         ANLBN   ACC.3, B.3      ;  |
032C A2E3            973 +1         mov   C, ACC.3
032E B0F3            974 +1         anl   C, /B.3
0330 92E3            975 +1         mov   ACC.3, C
                     977 +1         ANLBN   ACC.4, B.3      ;  |
0332 A2E4            978 +1         mov   C, ACC.4
0334 B0F3            979 +1         anl   C, /B.3
0336 92E4            980 +1         mov   ACC.4, C
                     982 +1         ANLBN   ACC.5, B.4      ;  |
0338 A2E5            983 +1         mov   C, ACC.5
033A B0F4            984 +1         anl   C, /B.4
033C 92E5            985 +1         mov   ACC.5, C
033E 704B            987            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     988            ; Pohyb v opacnom smere (nevieme v ktorom)
0340 E8              989    F2SW:   mov     A, R0           ;  Znegujem posledny bit adresy registra s poruchovymi posch
                                                                               odiami (ERRFLOOR_U na ERRFLOOR_D a naopak
                                                                               )
0341 6401            990            xrl     A, #01h         ;  |
0343 F8              991            mov     R0, A           ;  |
0344 B23A            992            cpl     UPOld           ;  Znegujem stary posun
0346 B23B            993            cpl     DOWNOld         ;  |
0348 E9              994            mov     A, R1           ;  Znegujeme masky
0349 F4              995            cpl     A               ;  |
034A F9              996            mov     R1, A           ;  |
DEBUG                                                                                                         PAGE 19

034B EA              997            mov     A, R2           ;  |
034C F4              998            cpl     A               ;  |
034D FA              999            mov     R2, A           ;  |               
034E E528           1000            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0350 86F0           1001            mov     B, @R0          ;  | Maskujem chybne poschodia
0352 63F0FF         1002            xrl     B, #0FFH        ;  | |
0355 55F0           1003            anl     A, B            ;  | |
0357 541A           1004            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi   
0359 59             1005            anl     A, R1           ;  | 
035A 702F           1006            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
035C E522           1007            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
035E 5439           1008            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0360 5A             1009            anl     A, R2           ;  | 
0361 86F0           1010            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)      
                    1011 +1         ANLBN   ACC.0, B.1      ;  | 
0363 A2E0           1012 +1         mov   C, ACC.0
0365 B0F1           1013 +1         anl   C, /B.1
0367 92E0           1014 +1         mov   ACC.0, C
                    1016 +1         ANLBN   ACC.1, B.2      ;  | 
0369 A2E1           1017 +1         mov   C, ACC.1
036B B0F2           1018 +1         anl   C, /B.2
036D 92E1           1019 +1         mov   ACC.1, C
                    1021 +1         ANLBN   ACC.2, B.2      ;  |
036F A2E2           1022 +1         mov   C, ACC.2
0371 B0F2           1023 +1         anl   C, /B.2
0373 92E2           1024 +1         mov   ACC.2, C
                    1026 +1         ANLBN   ACC.3, B.3      ;  |
0375 A2E3           1027 +1         mov   C, ACC.3
0377 B0F3           1028 +1         anl   C, /B.3
0379 92E3           1029 +1         mov   ACC.3, C
                    1031 +1         ANLBN   ACC.4, B.3      ;  |
037B A2E4           1032 +1         mov   C, ACC.4
037D B0F3           1033 +1         anl   C, /B.3
037F 92E4           1034 +1         mov   ACC.4, C
                    1036 +1         ANLBN   ACC.5, B.4      ;  |
0381 A2E5           1037 +1         mov   C, ACC.5
0383 B0F4           1038 +1         anl   C, /B.4
0385 92E5           1039 +1         mov   ACC.5, C
0387 7002           1041            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0389 41D2           1042            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
038B 203A03         1043    F2:     jb      UPOld, F2UP     ;   
038E 02039D         1044            jmp     F2DOWN          ;
0391 D220           1045    F2UP:   setb    UP              ; rychly pohyb hore
0393 D222           1046            setb    FAST            ; 
0395 C223           1047            clr     SLOW            ;
0397 120BD6         1048            lcall   WRITEPORTS      ; 
039A 0203A9         1049            jmp     UP2           ;-; prejdi do stavu UP2    
039D D221           1050    F2DOWN: setb    DOWN            ; rychly pohyb hore
039F D222           1051            setb    FAST            ; 
03A1 C223           1052            clr     SLOW            ;
03A3 120BD6         1053            lcall   WRITEPORTS      ; 
03A6 0204FF         1054            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                    1055            
                    1056                
03A9                1057    UP2:
                    1058 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
DEBUG                                                                                                         PAGE 20

                                                                               ny", nechaj len aktualne poschodie)
03A9 C22F           1059 +1         clr     LEDU            
03AB C22E           1060 +1         clr     LEDD 
03AD C224           1061 +1         clr     FLED1             
03AF C225           1062 +1         clr     FLED2                
03B1 C226           1063 +1         clr     FLED3           
03B3 C227           1064 +1         clr     FLED4           
03B5 D225           1065 +1         setb    FLED2
03B7 120BD6         1066 +1         lcall   WRITEPORTS
                    1068 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03BA 120AFA         1069 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03BD 120B77         1070 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03C0 3009FA         1071 +1         jnb     MB1, $-3  ; 
03C3 120AFA         1072 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03C6 120B77         1074    UP2A:   lcall   READPORTS       ; nacitanie dat
                    1075 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03C9 200B03         1076 +1         jb      SKRH, $+6
03CC 020A72         1077 +1         ljmp    ERR_SKRH
03CF 00             1078 +1         nop
                    1080 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03D0 200903         1081 +1         jb      MB1, $+6
03D3 020A4B         1082 +1         ljmp    ERR_2SPOM_C
03D6 00             1083 +1         nop
03D7 200AEC         1085            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                    1086 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
03DA 120AFA         1087 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03DD 120B77         1088 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03E0 300AFA         1089 +1         jnb     MB2, $-3  ; 
03E3 120AFA         1090 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03E6 D22E           1092            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03E8 120BD6         1093            lcall   WRITEPORTS      ;
03EB 0203EE         1094            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
03EE                1095    UP2_MB2:
                    1096 +1         ZAKMITC MB2             ; Pockame, kym odideme z predchadzajucej clonky       
03EE 120AFA         1097 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03F1 120B77         1098 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03F4 300AFA         1099 +1         jnb     MB2, $-3  ; 
03F7 120AFA         1100 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03FA 120B77         1102    UP2_MB2A: lcall   READPORTS       ; nacitanie dat
                    1103 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03FD 200B03         1104 +1         jb      SKRH, $+6
0400 020A72         1105 +1         ljmp    ERR_SKRH
0403 00             1106 +1         nop
                    1108 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0404 200903         1109 +1         jb      MB1, $+6
0407 020A36         1110 +1         ljmp    ERR_1SPOM_C
040A 00             1111 +1         nop
040B 200AEC         1113            jb      MB2, UP2_MB2A  ;-; mame uz aj druhu spomalovaciu clonku?          
040E D22F           1114            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0410 120BD6         1115            lcall   WRITEPORTS      ;
                    1116 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0413 120AFA         1117 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0416 120B77         1118 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
DEBUG                                                                                                         PAGE 21

0419 300AFA         1119 +1         jnb     MB2, $-3  ; 
041C 120AFA         1120 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1122    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1123    ;        anl     A, #00001000b ;-;
                    1124    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                    1125 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1126 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
041F C3             1127 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0420 7400           1128 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0422 7214           1129 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0424 B00E           1130 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0426 7243           1131 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0428 B053           1132 +1         anl     C, /ERRF3_U ; | a mam v tomto smere poruchu na tomto poschodi (Ak ano, tak n
                                                                               ema zmysel stat)
042A 720F           1133 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
042C 7238           1134 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
042E 3400           1135 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0430 7054           1137            jnz     U2_MB2C       ;-; Ak ano, zastav
                    1138 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0432 E522           1139 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0434 33             1140 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0435 547E           1141 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
                    1142 +1         
                    1143 +2         ANLBN   ACC.2, ERRF2_U  ; maskujem chybne poschodia
0437 A2E2           1144 +2         mov   C, ACC.2
0439 B052           1145 +2         anl   C, /ERRF2_U
043B 92E2           1146 +2         mov   ACC.2, C
                    1147 +2         ANLBN   ACC.3, ERRF2_U  ; |
043D A2E3           1148 +2         mov   C, ACC.3
043F B052           1149 +2         anl   C, /ERRF2_U
0441 92E3           1150 +2         mov   ACC.3, C
                    1151 +2         ANLBN   ACC.4, ERRF3_U  ; |
0443 A2E4           1152 +2         mov   C, ACC.4
0445 B053           1153 +2         anl   C, /ERRF3_U
0447 92E4           1154 +2         mov   ACC.4, C
                    1155 +2         ANLBN   ACC.5, ERRF3_U  ; |
0449 A2E5           1156 +2         mov   C, ACC.5
044B B053           1157 +2         anl   C, /ERRF3_U
044D 92E5           1158 +2         mov   ACC.5, C
                    1159 +2         ANLBN   ACC.6, ERRF4_U  ; |
044F A2E6           1160 +2         mov   C, ACC.6
0451 B054           1161 +2         anl   C, /ERRF4_U
0453 92E6           1162 +2         mov   ACC.6, C
                    1163 +1         
0455 7805           1164 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
DEBUG                                                                                                         PAGE 22

                    1165 +1  ; LL1: 
0457 6006           1166 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0459 C3             1167 +1         clr     C               ; Inak shiftnem o 2
045A 13             1168 +1         rrc     A               ;
045B C3             1169 +1         clr     C               ;
045C 13             1170 +1         rrc     A               ;
045D D8F8           1171 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1172 +1 ; LL2:
045F 7405           1173 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0461 C3             1174 +1         clr     C               ;
0462 98             1175 +1         subb    A, R0           ;
                    1177 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
0463 B40303         1178 +1         cjne    A, #3, $+6
0466 02046C         1179 +1         jmp     $+6
0469 020490         1180 +1         ljmp    UP2_MB1
046C 00             1181 +1         nop
                    1183 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
046D E528           1184 +1         mov     A, INPORTA
046F 541E           1185 +1         anl     A, #00011110b
0471 852AF0         1186 +1         mov     B, ERRFLOOR_U   ; maskujem chybne poschodia
0474 63F0FF         1187 +1         xrl     B, #0FFH
0477 55F0           1188 +1         anl     A, B
0479 C3             1189 +1         clr     C
047A 13             1190 +1         rrc     A
                    1191 +1 ;LL1    
047B 7803           1192 +1         mov     R0, #3
047D C3             1193 +1         clr     C
047E 13             1194 +1         rrc     A
047F D8FC           1195 +1         djnz    R0, $-2;LL1
0481 6003           1197            jz      U2_MB2C         ; |   ak neni zastavujem  
0483 020490         1198            ljmp    UP2_MB1         ; |   inak nezastavim
0486 D223           1199    U2_MB2C: setb    SLOW            ;       Ak ano, spomalme
0488 C222           1200            clr     FAST            ; 
048A 120BD6         1201            lcall   WRITEPORTS      ;
048D 0204C2         1202            jmp     UP2_STOP       ;-; a prejdi do stavu UP2_STOP 
0490                1203    UP2_MB1:
0490 120B77         1204            lcall   READPORTS       ; nacitanie dat
                    1205 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0493 200B03         1206 +1         jb      SKRH, $+6
0496 020A72         1207 +1         ljmp    ERR_SKRH
0499 00             1208 +1         nop
                    1210            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                    1211 +1         SET_FLOOR_ERR   MB2, ERRF3, UP3_MB2, 3, %COUNT
                    1212 +1                                                                                             
                                                                                                                 
                    1213 +1                                                                                             
                                                                                                                 
                    1214 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0003              1215 +1         COUNT    SET    COUNT+1                   
                    1216 +1         
049A 200A19         1217 +1         jb      MB2, ENDD2
049D 304304         1218 +1         jnb     PKI3, $+7
04A0 D223           1219 +1         setb    SLOW
04A2 D238           1220 +1         setb    STOPPED         
DEBUG                                                                                                         PAGE 23

04A4 D253           1221 +1         setb    ERRF3_U
04A6 D25B           1222 +1         setb    ERRF3_D
04A8 0537           1223 +1         inc     ERRF3_C
04AA C21B           1224 +1                 clr     PKO3                               
04AC C22C           1225 +1         clr     PO3U            
04AE C22B           1226 +1         clr     PO3D              
04B0 120BD6         1227 +1                 lcall   WRITEPORTS
04B3 0206C9         1228 +1         ljmp    UP3_MB2
04B6                1229 +1 ENDD2:
04B6 00             1230 +1         nop
04B7 2009D6         1232            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                    1233 +1         CLR_FLOOR_ERR   ERRF3
04BA C253           1234 +1         clr    ERRF3_U
04BC C25B           1235 +1         clr    ERRF3_D
04BE 00             1236 +1         nop
                    1238            
                    1239    ;        ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                    1240    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
                    1241    ;        jnz     U2_MB1C       ;-; Ak ano, zastav
                    1242    ;        NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                    1243    ;        LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
                    1244    ;        VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                    1245    ;        jz      U2_MB1C         ; |   ak neni zastavujem  
04BF 020684         1246            ljmp    UP3             ; |   inak nezastavim
                    1247    ;U2_MB1C: clr     UP              ; zastav motor
                    1248    ;        setb    UPOld           ;       (a zalohuj)
                    1249    ;        clr     DOWNOld         ;       (a zalohuj)
                    1250    ;        clr     FAST            ; 
                    1251    ;        lcall   WRITEPORTS      ; 
                    1252    ;        jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
04C2                1253    UP2_STOP:
04C2 120B77         1254            lcall   READPORTS       ; nacitanie dat
                    1255 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04C5 200B03         1256 +1         jb      SKRH, $+6
04C8 020A72         1257 +1         ljmp    ERR_SKRH
04CB 00             1258 +1         nop
                    1260            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                    1261 +1         SET_FLOOR_ERR   MB2, ERRF3, UP3_MB2, 3, %COUNT
                    1262 +1                                                                                             
                                                                                                                 
                    1263 +1                                                                                             
                                                                                                                 
                    1264 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0004              1265 +1         COUNT    SET    COUNT+1                   
                    1266 +1         
04CC 200A19         1267 +1         jb      MB2, ENDD3
04CF 304304         1268 +1         jnb     PKI3, $+7
04D2 D223           1269 +1         setb    SLOW
04D4 D238           1270 +1         setb    STOPPED         
04D6 D253           1271 +1         setb    ERRF3_U
04D8 D25B           1272 +1         setb    ERRF3_D
04DA 0537           1273 +1         inc     ERRF3_C
04DC C21B           1274 +1                 clr     PKO3                               
DEBUG                                                                                                         PAGE 24

04DE C22C           1275 +1         clr     PO3U            
04E0 C22B           1276 +1         clr     PO3D              
04E2 120BD6         1277 +1                 lcall   WRITEPORTS
04E5 0206C9         1278 +1         ljmp    UP3_MB2
04E8                1279 +1 ENDD3:
04E8 00             1280 +1         nop
04E9 2009D6         1282            jb      MB1, UP2_STOP  ;-; Sme na zastavovacej clonke? 
                    1283 +1         CLR_FLOOR_ERR   ERRF3    
04EC C253           1284 +1         clr    ERRF3_U
04EE C25B           1285 +1         clr    ERRF3_D
04F0 00             1286 +1         nop
04F1 C220           1288            clr     UP              ; zastav motor
04F3 D23A           1289            setb    UPOld           ;       (a zalohuj)
04F5 C23B           1290            clr     DOWNOld         ;       (a zalohuj)
04F7 C222           1291            clr     FAST            ; 
04F9 120BD6         1292            lcall   WRITEPORTS      ; 
04FC 020599         1293            jmp     FLOOR3        ;-; a prejdi do stavu FLOO
                    1294            
04FF                1295    DOWN2:
                    1296 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04FF C22F           1297 +1         clr     LEDU            
0501 C22E           1298 +1         clr     LEDD 
0503 C224           1299 +1         clr     FLED1             
0505 C225           1300 +1         clr     FLED2                
0507 C226           1301 +1         clr     FLED3           
0509 C227           1302 +1         clr     FLED4           
050B D225           1303 +1         setb    FLED2
050D 120BD6         1304 +1         lcall   WRITEPORTS
                    1306 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0510 120AFA         1307 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0513 120B77         1308 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0516 3009FA         1309 +1         jnb     MB1, $-3  ; 
0519 120AFA         1310 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
051C 120B77         1312            lcall   READPORTS       ; nacitanie dat
                    1313 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
051F 200C03         1314 +1         jb      SKRD, $+6
0522 020A69         1315 +1         ljmp    ERR_SKRD
0525 00             1316 +1         nop
                    1318 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0526 200903         1319 +1         jb      MB1, $+6
0529 020A4B         1320 +1         ljmp    ERR_2SPOM_C
052C 00             1321 +1         nop
052D 200ACF         1323            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                    1324 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0530 120AFA         1325 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0533 120B77         1326 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0536 300AFA         1327 +1         jnb     MB2, $-3  ; 
0539 120AFA         1328 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
053C D22F           1330            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
053E 120BD6         1331            lcall   WRITEPORTS      ;
0541 020544         1332            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
0544                1333    DOWN2_MB2:
                    1334 +1         ZAKMITC MB2             ; Pockame, kym odideme z predchadzajucej clonky       
0544 120AFA         1335 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
DEBUG                                                                                                         PAGE 25

0547 120B77         1336 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
054A 300AFA         1337 +1         jnb     MB2, $-3  ; 
054D 120AFA         1338 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0550                1340    DOWN2_MB2A:
0550 120B77         1341            lcall   READPORTS       ; nacitanie dat
                    1342 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0553 200C03         1343 +1         jb      SKRD, $+6
0556 020A69         1344 +1         ljmp    ERR_SKRD
0559 00             1345 +1         nop
                    1347 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
055A 200903         1348 +1         jb      MB1, $+6
055D 020A36         1349 +1         ljmp    ERR_1SPOM_C
0560 00             1350 +1         nop
0561 200AEC         1352            jb      MB2, DOWN2_MB2A ;-; mame uz aj druhu spomalovaciu clonku?          
0564 D22E           1353            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0566 120BD6         1354            lcall   WRITEPORTS      ;
                    1355 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0569 120AFA         1356 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
056C 120B77         1357 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
056F 300AFA         1358 +1         jnb     MB2, $-3  ; 
0572 120AFA         1359 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1361    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1362    ;        anl     A, #00000010b ;-;
                    1363    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0575 D223           1364            setb    SLOW            ;       Ak ano, spomalme
0577 C222           1365            clr     FAST            ; 
0579 120BD6         1366            lcall   WRITEPORTS      ;
057C 02057F         1367            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
057F                1368    DOWN2_MB1:    
057F 120B77         1369            lcall   READPORTS       ; nacitanie dat
0582 300C05         1370            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0585 300902         1371            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0588 80F5           1372            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
058A C238           1373    D2_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
058C C221           1374            clr     DOWN            ; zastav motor
058E D23B           1375            setb    DOWNOld         ;       (a zalohuj)
0590 C23A           1376            clr     UPOld           ;       (a zalohuj)
0592 C222           1377            clr     FAST            ; 
0594 120BD6         1378            lcall   WRITEPORTS      ; 
0597 01FB           1379            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                    1380    
                    1381    
                    1382    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                    1383    
0599                1384    FLOOR3:
                    1385 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0599 C22F           1386 +1         clr     LEDU            
059B C22E           1387 +1         clr     LEDD 
059D C224           1388 +1         clr     FLED1             
059F C225           1389 +1         clr     FLED2                
05A1 C226           1390 +1         clr     FLED3           
DEBUG                                                                                                         PAGE 26

05A3 C227           1391 +1         clr     FLED4           
05A5 D226           1392 +1         setb    FLED3
05A7 120BD6         1393 +1         lcall   WRITEPORTS
05AA 120B2F         1395            lcall   WAITFORTIMER    ; simulacia TIMERu
05AD 120B77         1396    F3S:    lcall   READPORTS     ;-; nacitanie dat
05B0 C21B           1397            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
05B2 C22C           1398            clr     PO3U            ;
05B4 C22B           1399            clr     PO3D            ;
05B6 120BD6         1400            lcall   WRITEPORTS      ;
05B9 200FF1         1401            jb      DPK, F3S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
05BC 782A           1402            mov     R0, #ERRFLOOR_U ; Default predpokladam, ze mam namierene hore (pozeram poruc
                                                                               hy poschodia smerom hore)
05BE 79F0           1403            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
05C0 7AE0           1404            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
05C2 203A0A         1405            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
05C5 E9             1406            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
05C6 F4             1407            cpl     A               ;       |
05C7 F9             1408            mov     R1, A           ;       |
05C8 EA             1409            mov     A, R2           ;       A znegujeme aj masku sachty
05C9 F4             1410            cpl     A               ;       |
05CA FA             1411            mov     R2, A           ;       |     
05CB E8             1412            mov     A, R0           ;       A budeme pozerat poruchy poschodi smerom DOLE (ERRFL
                                                                               OOR_U+1 = ERRFLOOR_D)
05CC 6401           1413            xrl     A, #01h         ;       | Znegujem posledny bit adresy registra s poruchovym
                                                                               i poschodiami (ERRFLOOR_U na ERRFLOOR_D a
                                                                                naopak)
05CE F8             1414            mov     R0, A           ;       |    
05CF                1415    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
05CF E528           1416            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
05D1 86F0           1417            mov     B, @R0          ;  | Maskujem chybne poschodia
05D3 63F0FF         1418            xrl     B, #0FFH        ;  | |
05D6 55F0           1419            anl     A, B            ;  | |
05D8 5416           1420            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
05DA 59             1421            anl     A, R1           ;  | 
                    1422 +1         ljnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
05DB 6003           1423 +1         jz      $+5
05DD 020666         1424 +1         ljmp    F3
05E0 00             1425 +1         nop
                    1427                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
05E1 E528           1428            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
05E3 86F0           1429            mov     B, @R0          ;  | Maskujem chybne poschodia
05E5 63F0FF         1430            xrl     B, #0FFH        ;  | |
05E8 55F0           1431            anl     A, B            ;  | |
05EA 5416           1432            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
05EC 702D           1433            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
05EE E522           1434            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
05F0 5427           1435            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
05F2 5A             1436            anl     A, R2           ;  |   
05F3 86F0           1437            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)      
                    1438 +1         ANLBN   ACC.0, B.1      ;  | 
05F5 A2E0           1439 +1         mov   C, ACC.0
05F7 B0F1           1440 +1         anl   C, /B.1
05F9 92E0           1441 +1         mov   ACC.0, C
DEBUG                                                                                                         PAGE 27

                    1443 +1         ANLBN   ACC.1, B.2      ;  | 
05FB A2E1           1444 +1         mov   C, ACC.1
05FD B0F2           1445 +1         anl   C, /B.2
05FF 92E1           1446 +1         mov   ACC.1, C
                    1448 +1         ANLBN   ACC.2, B.2      ;  |
0601 A2E2           1449 +1         mov   C, ACC.2
0603 B0F2           1450 +1         anl   C, /B.2
0605 92E2           1451 +1         mov   ACC.2, C
                    1453 +1         ANLBN   ACC.3, B.3      ;  |
0607 A2E3           1454 +1         mov   C, ACC.3
0609 B0F3           1455 +1         anl   C, /B.3
060B 92E3           1456 +1         mov   ACC.3, C
                    1458 +1         ANLBN   ACC.4, B.3      ;  |
060D A2E4           1459 +1         mov   C, ACC.4
060F B0F3           1460 +1         anl   C, /B.3
0611 92E4           1461 +1         mov   ACC.4, C
                    1463 +1         ANLBN   ACC.5, B.4      ;  |
0613 A2E5           1464 +1         mov   C, ACC.5
0615 B0F4           1465 +1         anl   C, /B.4
0617 92E5           1466 +1         mov   ACC.5, C
0619 704B           1468            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1469            ; Pohyb v opacnom smere (nevieme v ktorom)
061B E8             1470    F3SW:   mov     A, R0           ;  Znegujem posledny bit adresy registra s poruchovymi posch
                                                                               odiami (ERRFLOOR_U na ERRFLOOR_D a naopak
                                                                               )
061C 6401           1471            xrl     A, #01h         ;  |
061E F8             1472            mov     R0, A           ;  |
061F B23A           1473            cpl     UPOld           ;  Znegujem stary posun
0621 B23B           1474            cpl     DOWNOld         ;  |
0623 E9             1475            mov     A, R1           ;  Znegujeme masky
0624 F4             1476            cpl     A               ;  |
0625 F9             1477            mov     R1, A           ;  |
0626 EA             1478            mov     A, R2           ;  |
0627 F4             1479            cpl     A               ;  |
0628 FA             1480            mov     R2, A           ;  |               
0629 E528           1481            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
062B 86F0           1482            mov     B, @R0          ;  | Maskujem chybne poschodia
062D 63F0FF         1483            xrl     B, #0FFH        ;  | |
0630 55F0           1484            anl     A, B            ;  | |
0632 5416           1485            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0634 59             1486            anl     A, R1           ;  | 
0635 702F           1487            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0637 E522           1488            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0639 5427           1489            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
063B 5A             1490            anl     A, R2           ;  | 
063C 86F0           1491            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)      
                    1492 +1         ANLBN   ACC.0, B.1      ;  | 
063E A2E0           1493 +1         mov   C, ACC.0
0640 B0F1           1494 +1         anl   C, /B.1
0642 92E0           1495 +1         mov   ACC.0, C
                    1497 +1         ANLBN   ACC.1, B.2      ;  | 
0644 A2E1           1498 +1         mov   C, ACC.1
0646 B0F2           1499 +1         anl   C, /B.2
0648 92E1           1500 +1         mov   ACC.1, C
                    1502 +1         ANLBN   ACC.2, B.2      ;  |
064A A2E2           1503 +1         mov   C, ACC.2
DEBUG                                                                                                         PAGE 28

064C B0F2           1504 +1         anl   C, /B.2
064E 92E2           1505 +1         mov   ACC.2, C
                    1507 +1         ANLBN   ACC.3, B.3      ;  |
0650 A2E3           1508 +1         mov   C, ACC.3
0652 B0F3           1509 +1         anl   C, /B.3
0654 92E3           1510 +1         mov   ACC.3, C
                    1512 +1         ANLBN   ACC.4, B.3      ;  |
0656 A2E4           1513 +1         mov   C, ACC.4
0658 B0F3           1514 +1         anl   C, /B.3
065A 92E4           1515 +1         mov   ACC.4, C
                    1517 +1         ANLBN   ACC.5, B.4      ;  |
065C A2E5           1518 +1         mov   C, ACC.5
065E B0F4           1519 +1         anl   C, /B.4
0660 92E5           1520 +1         mov   ACC.5, C
0662 7002           1522            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0664 A1AD           1523            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0666 203A03         1524    F3:     jb      UPOld, F3UP     ;   
0669 020678         1525            jmp     F3DOWN          ;
066C D220           1526    F3UP:   setb    UP              ; rychly pohyb hore
066E D222           1527            setb    FAST            ; 
0670 C223           1528            clr     SLOW            ;
0672 120BD6         1529            lcall   WRITEPORTS      ; 
0675 020684         1530            jmp     UP3           ;-; prejdi do stavu UP2    
0678 D221           1531    F3DOWN: setb    DOWN            ; rychly pohyb hore
067A D222           1532            setb    FAST            ; 
067C C223           1533            clr     SLOW            ;
067E 120BD6         1534            lcall   WRITEPORTS      ; 
0681 02071F         1535            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1536         
                    1537         
0684                1538    UP3:
                    1539 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0684 C22F           1540 +1         clr     LEDU            
0686 C22E           1541 +1         clr     LEDD 
0688 C224           1542 +1         clr     FLED1             
068A C225           1543 +1         clr     FLED2                
068C C226           1544 +1         clr     FLED3           
068E C227           1545 +1         clr     FLED4           
0690 D226           1546 +1         setb    FLED3
0692 120BD6         1547 +1         lcall   WRITEPORTS
                    1549 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0695 120AFA         1550 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0698 120B77         1551 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
069B 3009FA         1552 +1         jnb     MB1, $-3  ; 
069E 120AFA         1553 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06A1 120B77         1555    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1556 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
06A4 200B03         1557 +1         jb      SKRH, $+6
06A7 020A72         1558 +1         ljmp    ERR_SKRH
06AA 00             1559 +1         nop
                    1561 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
06AB 200903         1562 +1         jb      MB1, $+6
06AE 020A4B         1563 +1         ljmp    ERR_2SPOM_C
06B1 00             1564 +1         nop
06B2 200AEC         1566            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
DEBUG                                                                                                         PAGE 29

                    1567 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
06B5 120AFA         1568 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06B8 120B77         1569 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06BB 300AFA         1570 +1         jnb     MB2, $-3  ; 
06BE 120AFA         1571 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06C1 D22E           1573            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
06C3 120BD6         1574            lcall   WRITEPORTS      ;
06C6 0206C9         1575            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
06C9                1576    UP3_MB2:
                    1577 +1         ZAKMITC MB2             ; Pockame, kym odideme z predchadzajucej clonky       
06C9 120AFA         1578 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06CC 120B77         1579 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06CF 300AFA         1580 +1         jnb     MB2, $-3  ; 
06D2 120AFA         1581 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06D5                1583    UP3_MB2A:
06D5 120B77         1584            lcall   READPORTS       ; nacitanie dat
                    1585 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
06D8 200B03         1586 +1         jb      SKRH, $+6
06DB 020A72         1587 +1         ljmp    ERR_SKRH
06DE 00             1588 +1         nop
                    1590 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
06DF 200903         1591 +1         jb      MB1, $+6
06E2 020A36         1592 +1         ljmp    ERR_1SPOM_C
06E5 00             1593 +1         nop
06E6 200AEC         1595            jb      MB2, UP3_MB2A  ;-; mame uz aj druhu spomalovaciu clonku?          
06E9 D22F           1596            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
06EB 120BD6         1597            lcall   WRITEPORTS      ;
                    1598 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
06EE 120AFA         1599 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06F1 120B77         1600 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06F4 300AFA         1601 +1         jnb     MB2, $-3  ; 
06F7 120AFA         1602 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1604    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1605    ;        anl     A, #00010000b ;-;
                    1606    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
06FA D223           1607            setb    SLOW            ;       Ak ano, spomalme
06FC C222           1608            clr     FAST            ; 
06FE 120BD6         1609            lcall   WRITEPORTS      ;
0701 020704         1610            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0704                1611    UP3_MB1:
0704 120B77         1612            lcall   READPORTS       ; nacitanie dat
0707 300B05         1613            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
070A 300902         1614            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
070D 80F5           1615            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
070F C238           1616    U3_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0711 C220           1617            clr     UP              ; zastav motor
0713 D23A           1618            setb    UPOld           ;       (a zalohuj)
0715 C23B           1619            clr     DOWNOld         ;       (a zalohuj)
0717 C222           1620            clr     FAST            ; 
0719 120BD6         1621            lcall   WRITEPORTS      ; 
071C 02087A         1622            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
071F                1623    DOWN3:
DEBUG                                                                                                         PAGE 30

                    1624 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
071F C22F           1625 +1         clr     LEDU            
0721 C22E           1626 +1         clr     LEDD 
0723 C224           1627 +1         clr     FLED1             
0725 C225           1628 +1         clr     FLED2                
0727 C226           1629 +1         clr     FLED3           
0729 C227           1630 +1         clr     FLED4           
072B D226           1631 +1         setb    FLED3
072D 120BD6         1632 +1         lcall   WRITEPORTS
                    1634 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0730 120AFA         1635 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0733 120B77         1636 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0736 3009FA         1637 +1         jnb     MB1, $-3  ; 
0739 120AFA         1638 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
073C 120B77         1640            lcall   READPORTS       ; nacitanie dat
                    1641 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
073F 200C03         1642 +1         jb      SKRD, $+6
0742 020A69         1643 +1         ljmp    ERR_SKRD
0745 00             1644 +1         nop
                    1646 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0746 200903         1647 +1         jb      MB1, $+6
0749 020A4B         1648 +1         ljmp    ERR_2SPOM_C
074C 00             1649 +1         nop
074D 200ACF         1651            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                    1652 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
0750 120AFA         1653 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0753 120B77         1654 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0756 300AFA         1655 +1         jnb     MB2, $-3  ; 
0759 120AFA         1656 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
075C D22F           1658            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
075E 120BD6         1659            lcall   WRITEPORTS      ;
0761 020764         1660            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0764                1661    DOWN3_MB2:
                    1662 +1         ZAKMITC MB2             ; Pockame, kym odideme z predchadzajucej clonky       
0764 120AFA         1663 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0767 120B77         1664 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
076A 300AFA         1665 +1         jnb     MB2, $-3  ; 
076D 120AFA         1666 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0770                1668    DOWN3_MB2A:
0770 120B77         1669            lcall   READPORTS       ; nacitanie dat
                    1670 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0773 200C03         1671 +1         jb      SKRD, $+6
0776 020A69         1672 +1         ljmp    ERR_SKRD
0779 00             1673 +1         nop
                    1675 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
077A 200903         1676 +1         jb      MB1, $+6
077D 020A36         1677 +1         ljmp    ERR_1SPOM_C
0780 00             1678 +1         nop
0781 200AEC         1680            jb      MB2, DOWN3_MB2A ;-; mame uz aj druhu spomalovaciu clonku?          
0784 D22E           1681            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0786 120BD6         1682            lcall   WRITEPORTS      ;
                    1683 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
DEBUG                                                                                                         PAGE 31

0789 120AFA         1684 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
078C 120B77         1685 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
078F 300AFA         1686 +1         jnb     MB2, $-3  ; 
0792 120AFA         1687 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1689    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1690    ;        anl     A, #00000100b ;-;
                    1691    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1692 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1693 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0795 C3             1694 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0796 7400           1695 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0798 7211           1696 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
079A B00E           1697 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
079C 7242           1698 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
079E B05A           1699 +1         anl     C, /ERRF2_D ; | a mam v tomto smere poruchu na tomto poschodi (Ak ano, tak n
                                                                               ema zmysel stat)
07A0 720F           1700 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
07A2 7238           1701 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
07A4 3400           1702 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
07A6 7059           1704            jnz     D3_MB2C         ; Ak ano, zastav
                    1705 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
07A8 E522           1706 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
07AA 33             1707 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
07AB 547E           1708 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
                    1709 +1 
                    1710 +2         ANLBN   ACC.1, ERRF1_D  ; maskujem chybne poschodia
07AD A2E1           1711 +2         mov   C, ACC.1
07AF B059           1712 +2         anl   C, /ERRF1_D
07B1 92E1           1713 +2         mov   ACC.1, C
                    1714 +2         ANLBN   ACC.2, ERRF2_D  ; |
07B3 A2E2           1715 +2         mov   C, ACC.2
07B5 B05A           1716 +2         anl   C, /ERRF2_D
07B7 92E2           1717 +2         mov   ACC.2, C
                    1718 +2         ANLBN   ACC.3, ERRF2_D  ; |
07B9 A2E3           1719 +2         mov   C, ACC.3
07BB B05A           1720 +2         anl   C, /ERRF2_D
07BD 92E3           1721 +2         mov   ACC.3, C
                    1722 +2         ANLBN   ACC.4, ERRF3_D  ; |
07BF A2E4           1723 +2         mov   C, ACC.4
07C1 B05B           1724 +2         anl   C, /ERRF3_D
07C3 92E4           1725 +2         mov   ACC.4, C
                    1726 +2         ANLBN   ACC.5, ERRF3_D  ; |
07C5 A2E5           1727 +2         mov   C, ACC.5
07C7 B05B           1728 +2         anl   C, /ERRF3_D
07C9 92E5           1729 +2         mov   ACC.5, C
                    1730 +1 
07CB 7805           1731 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
DEBUG                                                                                                         PAGE 32

                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1732 +1  ; LL1: 
07CD 6006           1733 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
07CF C3             1734 +1         clr     C               ; Inak shiftnem o 2
07D0 33             1735 +1         rlc     A               ;
07D1 C3             1736 +1         clr     C               ;
07D2 33             1737 +1         rlc     A               ;
07D3 D8F8           1738 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1739 +1 ; LL2:
07D5 E8             1740 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1742 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
07D6 B40203         1743 +1         cjne    A, #2, $+6
07D9 0207DF         1744 +1         jmp     $+6
07DC 02080B         1745 +1         ljmp    DOWN3_MB1
07DF 00             1746 +1         nop
                    1748 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
07E0 7405           1749 +1         mov     A, #5
07E2 C3             1750 +1         clr     C
07E3 9402           1751 +1         subb    A, #2
07E5 F8             1752 +1         mov     R0, A
07E6 E528           1753 +1         mov     A, INPORTA
07E8 541E           1754 +1         anl     A, #00011110b
07EA 852BF0         1755 +1         mov     B, ERRFLOOR_D   ; maskujem chybne poschodia
07ED 63F0FF         1756 +1         xrl     B, #0FFH
07F0 55F0           1757 +1         anl     A, B
07F2 C3             1758 +1         clr     C
07F3 33             1759 +1         rlc     A
07F4 C3             1760 +1         clr     C
07F5 33             1761 +1         rlc     A
07F6 C3             1762 +1         clr     C
07F7 33             1763 +1         rlc     A
                    1764 +1 ;LL1   
07F8 C3             1765 +1         clr     C
07F9 33             1766 +1         rlc     A
07FA D8FC           1767 +1         djnz    R0, $-2;LL1
07FC 6003           1769            jz      D3_MB2C         ; |   ak neni zastavujem                  
07FE 02080B         1770            ljmp    DOWN3_MB1       ;-; |        
0801 D223           1771    D3_MB2C: setb    SLOW            ;       Ak ano, spomalme
0803 C222           1772            clr     FAST            ; 
0805 120BD6         1773            lcall   WRITEPORTS      ;
0808 02083D         1774            jmp     DOWN3_STOP     ;-; a prejdi do stavu DOWN3_STOP
080B                1775    DOWN3_MB1:    
080B 120B77         1776            lcall   READPORTS       ; nacitanie dat
                    1777 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
080E 200C03         1778 +1         jb      SKRD, $+6
0811 020A69         1779 +1         ljmp    ERR_SKRD
0814 00             1780 +1         nop
                    1782            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                    1783 +1         SET_FLOOR_ERR   MB2, ERRF2, DOWN2_MB2, 2, %COUNT
                    1784 +1                                                                                             
                                                                                                                 
                    1785 +1                                                                                             
                                                                                                                 
DEBUG                                                                                                         PAGE 33

                    1786 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0005              1787 +1         COUNT    SET    COUNT+1                   
                    1788 +1         
0815 200A19         1789 +1         jb      MB2, ENDD4
0818 304204         1790 +1         jnb     PKI2, $+7
081B D223           1791 +1         setb    SLOW
081D D238           1792 +1         setb    STOPPED         
081F D252           1793 +1         setb    ERRF2_U
0821 D25A           1794 +1         setb    ERRF2_D
0823 0536           1795 +1         inc     ERRF2_C
0825 C21A           1796 +1                 clr     PKO2                               
0827 C22A           1797 +1         clr     PO2U            
0829 C229           1798 +1         clr     PO2D              
082B 120BD6         1799 +1                 lcall   WRITEPORTS
082E 020544         1800 +1         ljmp    DOWN2_MB2
0831                1801 +1 ENDD4:
0831 00             1802 +1         nop
0832 2009D6         1804            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1805 +1         CLR_FLOOR_ERR   ERRF2
0835 C252           1806 +1         clr    ERRF2_U
0837 C25A           1807 +1         clr    ERRF2_D
0839 00             1808 +1         nop
                    1810    ;        ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                    1811    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
                    1812    ;        jnz     D3_MB1C         ; Ak ano, zastav
                    1813    ;        NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                    1814    ;        LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
                    1815    ;        NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                    1816    ;        jz      D3_MB1C         ; |   ak neni zastavujem                  
083A 0204FF         1817            ljmp    DOWN2         ;-; |        
                    1818    ;D3_MB1C: clr     DOWN            ; zastav motor
                    1819    ;        setb    DOWNOld         ;       (a zalohuj)
                    1820    ;        clr     UPOld           ;       (a zalohuj)
                    1821    ;        clr     FAST            ; 
                    1822    ;        lcall   WRITEPORTS      ; 
                    1823    ;        jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2 
083D                1824    DOWN3_STOP:    
083D 120B77         1825            lcall   READPORTS       ; nacitanie dat
                    1826 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0840 200C03         1827 +1         jb      SKRD, $+6
0843 020A69         1828 +1         ljmp    ERR_SKRD
0846 00             1829 +1         nop
                    1831            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                    1832 +1         SET_FLOOR_ERR   MB2, ERRF2, DOWN2_MB2, 2, %COUNT
                    1833 +1                                                                                             
                                                                                                                 
                    1834 +1                                                                                             
                                                                                                                 
                    1835 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0006              1836 +1         COUNT    SET    COUNT+1                   
                    1837 +1         
0847 200A19         1838 +1         jb      MB2, ENDD5
084A 304204         1839 +1         jnb     PKI2, $+7
DEBUG                                                                                                         PAGE 34

084D D223           1840 +1         setb    SLOW
084F D238           1841 +1         setb    STOPPED         
0851 D252           1842 +1         setb    ERRF2_U
0853 D25A           1843 +1         setb    ERRF2_D
0855 0536           1844 +1         inc     ERRF2_C
0857 C21A           1845 +1                 clr     PKO2                               
0859 C22A           1846 +1         clr     PO2U            
085B C229           1847 +1         clr     PO2D              
085D 120BD6         1848 +1                 lcall   WRITEPORTS
0860 020544         1849 +1         ljmp    DOWN2_MB2
0863                1850 +1 ENDD5:
0863 00             1851 +1         nop
0864 2009D6         1853            jb      MB1, DOWN3_STOP;-; Sme na zastavovacej clonke?  
                    1854 +1         CLR_FLOOR_ERR   ERRF2     
0867 C252           1855 +1         clr    ERRF2_U
0869 C25A           1856 +1         clr    ERRF2_D
086B 00             1857 +1         nop
086C C221           1859            clr     DOWN            ; zastav motor
086E D23B           1860            setb    DOWNOld         ;       (a zalohuj)
0870 C23A           1861            clr     UPOld           ;       (a zalohuj)
0872 C222           1862            clr     FAST            ; 
0874 120BD6         1863            lcall   WRITEPORTS      ; 
0877 0202BE         1864            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2         
                    1865    
                    1866            
                    1867    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1868    
087A                1869    FLOOR4:
                    1870 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
087A C22F           1871 +1         clr     LEDU            
087C C22E           1872 +1         clr     LEDD 
087E C224           1873 +1         clr     FLED1             
0880 C225           1874 +1         clr     FLED2                
0882 C226           1875 +1         clr     FLED3           
0884 C227           1876 +1         clr     FLED4           
0886 D227           1877 +1         setb    FLED4
0888 120BD6         1878 +1         lcall   WRITEPORTS
088B 120B2F         1880            lcall   WAITFORTIMER    ; simulacia TIMERu
088E 120B77         1881    F4S:    lcall   READPORTS     ;-; nacitanie dat
0891 C21C           1882            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0893 C22D           1883            clr     PO4            ;
0895 120BD6         1884            lcall   WRITEPORTS      ;
0898 200FF3         1885            jb      DPK, F4S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
089B E528           1886            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
089D 852BF0         1887            mov     B, ERRFLOOR_D   ; | maskujem chybne poschodia
08A0 63F0FF         1888            xrl     B, #0FFH        ; | |
08A3 55F0           1889            anl     A, B            ; | |
08A5 540E           1890            anl     A, #00001110b ;-;
08A7 7026           1891            jnz     F4OK          ;-; ak ano, ideme na to
08A9 E522           1892            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
08AB 541F           1893            anl     A, #00011111b ;-;
                    1894 +1         ANLBN   ACC.0, ERRF1_D  ; maskujem chybne poschodia (v smere hore)
08AD A2E0           1895 +1         mov   C, ACC.0
08AF B059           1896 +1         anl   C, /ERRF1_D
DEBUG                                                                                                         PAGE 35

08B1 92E0           1897 +1         mov   ACC.0, C
                    1899 +1         ANLBN   ACC.1, ERRF2_D  ; |
08B3 A2E1           1900 +1         mov   C, ACC.1
08B5 B05A           1901 +1         anl   C, /ERRF2_D
08B7 92E1           1902 +1         mov   ACC.1, C
                    1904 +1         ANLBN   ACC.2, ERRF2_D  ; |
08B9 A2E2           1905 +1         mov   C, ACC.2
08BB B05A           1906 +1         anl   C, /ERRF2_D
08BD 92E2           1907 +1         mov   ACC.2, C
                    1909 +1         ANLBN   ACC.3, ERRF3_D  ; |
08BF A2E3           1910 +1         mov   C, ACC.3
08C1 B05B           1911 +1         anl   C, /ERRF3_D
08C3 92E3           1912 +1         mov   ACC.3, C
                    1914 +1         ANLBN   ACC.4, ERRF3_D  ; |
08C5 A2E4           1915 +1         mov   C, ACC.4
08C7 B05B           1916 +1         anl   C, /ERRF3_D
08C9 92E4           1917 +1         mov   ACC.4, C
08CB 7002           1919            jnz     F4OK          ;-; ak ano, ideme na to
08CD 80BF           1920            jmp     F4S             ; Nemam sa kde hnut, opakujem
08CF D221           1921    F4OK:   setb    DOWN            ; rychly pohyb dole
08D1 D222           1922            setb    FAST            ;
08D3 C223           1923            clr     SLOW            ; 
08D5 120BD6         1924            lcall   WRITEPORTS      ; 
08D8 0208DB         1925            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
08DB                1926    DOWN4:
                    1927 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
08DB C22F           1928 +1         clr     LEDU            
08DD C22E           1929 +1         clr     LEDD 
08DF C224           1930 +1         clr     FLED1             
08E1 C225           1931 +1         clr     FLED2                
08E3 C226           1932 +1         clr     FLED3           
08E5 C227           1933 +1         clr     FLED4           
08E7 D227           1934 +1         setb    FLED4
08E9 120BD6         1935 +1         lcall   WRITEPORTS
                    1937 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
08EC 120AFA         1938 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
08EF 120B77         1939 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
08F2 3009FA         1940 +1         jnb     MB1, $-3  ; 
08F5 120AFA         1941 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
08F8 120B77         1943            lcall   READPORTS       ; nacitanie dat
                    1944 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
08FB 200C03         1945 +1         jb      SKRD, $+6
08FE 020A69         1946 +1         ljmp    ERR_SKRD
0901 00             1947 +1         nop
                    1949 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0902 200903         1950 +1         jb      MB1, $+6
0905 020A4B         1951 +1         ljmp    ERR_2SPOM_C
0908 00             1952 +1         nop
0909 200ACF         1954            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1955 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
090C 120AFA         1956 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
090F 120B77         1957 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0912 300AFA         1958 +1         jnb     MB2, $-3  ; 
0915 120AFA         1959 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
DEBUG                                                                                                         PAGE 36

0918 D22F           1961            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
091A 120BD6         1962            lcall   WRITEPORTS      ;
091D 020920         1963            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
0920                1964    DOWN4_MB2:
                    1965 +1         ZAKMITC MB2             ; Pockame, kym odideme z predchadzajucej clonky       
0920 120AFA         1966 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0923 120B77         1967 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0926 300AFA         1968 +1         jnb     MB2, $-3  ; 
0929 120AFA         1969 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
092C                1971    DOWN4_MB2A:
092C 120B77         1972            lcall   READPORTS       ; nacitanie dat
                    1973 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
092F 200C03         1974 +1         jb      SKRD, $+6
0932 020A69         1975 +1         ljmp    ERR_SKRD
0935 00             1976 +1         nop
                    1978 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0936 200903         1979 +1         jb      MB1, $+6
0939 020A36         1980 +1         ljmp    ERR_1SPOM_C
093C 00             1981 +1         nop
093D 200AEC         1983            jb      MB2, DOWN4_MB2A ;-; mame uz aj druhu spomalovaciu clonku?          
0940 D22E           1984            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0942 120BD6         1985            lcall   WRITEPORTS      ;
                    1986 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0945 120AFA         1987 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0948 120B77         1988 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
094B 300AFA         1989 +1         jnb     MB2, $-3  ; 
094E 120AFA         1990 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1992    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1993    ;        anl     A, #00001000b ;-;
                    1994    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1995 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1996 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0951 C3             1997 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0952 7400           1998 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0954 7213           1999 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0956 B00E           2000 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0958 7243           2001 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
095A B05B           2002 +1         anl     C, /ERRF3_D ; | a mam v tomto smere poruchu na tomto poschodi (Ak ano, tak n
                                                                               ema zmysel stat)
095C 720F           2003 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
095E 7238           2004 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0960 3400           2005 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0962 7059           2007            jnz     D4_MB2C       ;-; Ak ano, zastav
                    2008 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0964 E522           2009 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0966 33             2010 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
DEBUG                                                                                                         PAGE 37

                                                                                X | 
0967 547E           2011 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
                    2012 +1 
                    2013 +2         ANLBN   ACC.1, ERRF1_D  ; maskujem chybne poschodia
0969 A2E1           2014 +2         mov   C, ACC.1
096B B059           2015 +2         anl   C, /ERRF1_D
096D 92E1           2016 +2         mov   ACC.1, C
                    2017 +2         ANLBN   ACC.2, ERRF2_D  ; |
096F A2E2           2018 +2         mov   C, ACC.2
0971 B05A           2019 +2         anl   C, /ERRF2_D
0973 92E2           2020 +2         mov   ACC.2, C
                    2021 +2         ANLBN   ACC.3, ERRF2_D  ; |
0975 A2E3           2022 +2         mov   C, ACC.3
0977 B05A           2023 +2         anl   C, /ERRF2_D
0979 92E3           2024 +2         mov   ACC.3, C
                    2025 +2         ANLBN   ACC.4, ERRF3_D  ; |
097B A2E4           2026 +2         mov   C, ACC.4
097D B05B           2027 +2         anl   C, /ERRF3_D
097F 92E4           2028 +2         mov   ACC.4, C
                    2029 +2         ANLBN   ACC.5, ERRF3_D  ; |
0981 A2E5           2030 +2         mov   C, ACC.5
0983 B05B           2031 +2         anl   C, /ERRF3_D
0985 92E5           2032 +2         mov   ACC.5, C
                    2033 +1 
0987 7805           2034 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    2035 +1  ; LL1: 
0989 6006           2036 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
098B C3             2037 +1         clr     C               ; Inak shiftnem o 2
098C 33             2038 +1         rlc     A               ;
098D C3             2039 +1         clr     C               ;
098E 33             2040 +1         rlc     A               ;
098F D8F8           2041 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    2042 +1 ; LL2:
0991 E8             2043 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    2045 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
0992 B40303         2046 +1         cjne    A, #3, $+6
0995 02099B         2047 +1         jmp     $+6
0998 0209C7         2048 +1         ljmp    DOWN4_MB1
099B 00             2049 +1         nop
                    2051 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
099C 7405           2052 +1         mov     A, #5
099E C3             2053 +1         clr     C
099F 9403           2054 +1         subb    A, #3
09A1 F8             2055 +1         mov     R0, A
09A2 E528           2056 +1         mov     A, INPORTA
09A4 541E           2057 +1         anl     A, #00011110b
09A6 852BF0         2058 +1         mov     B, ERRFLOOR_D   ; maskujem chybne poschodia
09A9 63F0FF         2059 +1         xrl     B, #0FFH
09AC 55F0           2060 +1         anl     A, B
09AE C3             2061 +1         clr     C
09AF 33             2062 +1         rlc     A
09B0 C3             2063 +1         clr     C
09B1 33             2064 +1         rlc     A
DEBUG                                                                                                         PAGE 38

09B2 C3             2065 +1         clr     C
09B3 33             2066 +1         rlc     A
                    2067 +1 ;LL1   
09B4 C3             2068 +1         clr     C
09B5 33             2069 +1         rlc     A
09B6 D8FC           2070 +1         djnz    R0, $-2;LL1
09B8 6003           2072            jz      D4_MB2C         ; |   ak neni zastavujem          
09BA 0209C7         2073            ljmp    DOWN4_MB1       ;-; |       
09BD D223           2074    D4_MB2C: setb    SLOW            ;       Ak ano, spomalme
09BF C222           2075            clr     FAST            ; 
09C1 120BD6         2076            lcall   WRITEPORTS      ;
09C4 0209F9         2077            jmp     DOWN4_STOP     ;-; a prejdi do stavu DOWN4_STOP
09C7                2078    DOWN4_MB1:    
09C7 120B77         2079            lcall   READPORTS       ; nacitanie dat
                    2080 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
09CA 200C03         2081 +1         jb      SKRD, $+6
09CD 020A69         2082 +1         ljmp    ERR_SKRD
09D0 00             2083 +1         nop
                    2085            ;ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na sp
                                                                               omalovaciu) <<<
                    2086 +1         SET_FLOOR_ERR   MB2, ERRF3, DOWN3_MB2, 3, %COUNT
                    2087 +1                                                                                             
                                                                                                                 
                    2088 +1                                                                                             
                                                                                                                 
                    2089 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0007              2090 +1         COUNT    SET    COUNT+1                   
                    2091 +1         
09D1 200A19         2092 +1         jb      MB2, ENDD6
09D4 304304         2093 +1         jnb     PKI3, $+7
09D7 D223           2094 +1         setb    SLOW
09D9 D238           2095 +1         setb    STOPPED         
09DB D253           2096 +1         setb    ERRF3_U
09DD D25B           2097 +1         setb    ERRF3_D
09DF 0537           2098 +1         inc     ERRF3_C
09E1 C21B           2099 +1                 clr     PKO3                               
09E3 C22C           2100 +1         clr     PO3U            
09E5 C22B           2101 +1         clr     PO3D              
09E7 120BD6         2102 +1                 lcall   WRITEPORTS
09EA 020764         2103 +1         ljmp    DOWN3_MB2
09ED                2104 +1 ENDD6:
09ED 00             2105 +1         nop
09EE 2009D6         2107            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    2108 +1         CLR_FLOOR_ERR   ERRF3
09F1 C253           2109 +1         clr    ERRF3_U
09F3 C25B           2110 +1         clr    ERRF3_D
09F5 00             2111 +1         nop
                    2113    ;        ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               (Vrati do A 1 ak ano, inak 0)
                    2114    ;        clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril 
                    2115    ;        jnz     D4_MB1C       ;-; Ak ano, zastav
                    2116    ;        NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (pot
                                                                               om stojime urcite)
                    2117    ;        LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
                    2118    ;        NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale
                                                                                neni nad nami uz nic v kabine stlacene? 
                                                                               
                    2119    ;        jz      D4_MB1C         ; |   ak neni zastavujem          
DEBUG                                                                                                         PAGE 39

09F6 02071F         2120            ljmp    DOWN3         ;-; |       
                    2121    ;D4_MB1C: clr     DOWN            ; zastav motor
                    2122    ;        setb    DOWNOld         ;       (a zalohuj)
                    2123    ;        clr     UPOld           ;       (a zalohuj)
                    2124    ;        clr     FAST            ; 
                    2125    ;        lcall   WRITEPORTS      ; 
                    2126    ;        jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
09F9                2127    DOWN4_STOP:    
09F9 120B77         2128            lcall   READPORTS       ; nacitanie dat
                    2129 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
09FC 200C03         2130 +1         jb      SKRD, $+6
09FF 020A69         2131 +1         ljmp    ERR_SKRD
0A02 00             2132 +1         nop
                    2134            ;ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
                    2135 +1         SET_FLOOR_ERR   MB2, ERRF3, DOWN3_MB2, 3, %COUNT
                    2136 +1                                                                                             
                                                                                                                 
                    2137 +1                                                                                             
                                                                                                                 
                    2138 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0008              2139 +1         COUNT    SET    COUNT+1                   
                    2140 +1         
0A03 200A19         2141 +1         jb      MB2, ENDD7
0A06 304304         2142 +1         jnb     PKI3, $+7
0A09 D223           2143 +1         setb    SLOW
0A0B D238           2144 +1         setb    STOPPED         
0A0D D253           2145 +1         setb    ERRF3_U
0A0F D25B           2146 +1         setb    ERRF3_D
0A11 0537           2147 +1         inc     ERRF3_C
0A13 C21B           2148 +1                 clr     PKO3                               
0A15 C22C           2149 +1         clr     PO3U            
0A17 C22B           2150 +1         clr     PO3D              
0A19 120BD6         2151 +1                 lcall   WRITEPORTS
0A1C 020764         2152 +1         ljmp    DOWN3_MB2
0A1F                2153 +1 ENDD7:
0A1F 00             2154 +1         nop
0A20 2009D6         2156            jb      MB1, DOWN4_STOP ;-; Sme na zastavovacej clonke?
                    2157 +1         CLR_FLOOR_ERR   ERRF3
0A23 C253           2158 +1         clr    ERRF3_U
0A25 C25B           2159 +1         clr    ERRF3_D
0A27 00             2160 +1         nop
0A28 C221           2162            clr     DOWN            ; zastav motor
0A2A D23B           2163            setb    DOWNOld         ;       (a zalohuj)
0A2C C23A           2164            clr     UPOld           ;       (a zalohuj)
0A2E C222           2165            clr     FAST            ; 
0A30 120BD6         2166            lcall   WRITEPORTS      ; 
0A33 020599         2167            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                   
                    2168      
0A36                2169    ERR_1SPOM_C: 
                    2170            ;clr     UP              ; zastav motor
                    2171            ;clr     DOWN            ; 
                    2172            ;lcall   WRITEPORTS      ; 
                    2173            ;_BP_
                    2174            ;nop
                    2175            ;nop 
                    2176 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0A36 120AFA         2177 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
DEBUG                                                                                                         PAGE 40

0A39 120B77         2178 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0A3C 3009FA         2179 +1         jnb     MB1, $-3  ; 
0A3F 120AFA         2180 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0A42 900CA9         2182            mov     DPTR, #STR_ERR_1SPOM_C         ; vypis info 
0A45 120C0D         2183            lcall   DISPSTR         ;          
0A48 020A7B         2184            ljmp    ERROR1         
                    2185            
0A4B                2186    ERR_2SPOM_C: 
                    2187            ;clr     UP              ; zastav motor
                    2188            ;clr     DOWN            ; 
                    2189            ;lcall   WRITEPORTS      ; 
                    2190            ;_BP_
                    2191            ;nop
                    2192            ;nop
                    2193 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0A4B 120AFA         2194 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0A4E 120B77         2195 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0A51 3009FA         2196 +1         jnb     MB1, $-3  ; 
0A54 120AFA         2197 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0A57 900CCF         2199            mov     DPTR, #STR_ERR_2SPOM_C         ; vypis info 
0A5A 120C0D         2200            lcall   DISPSTR         ;
0A5D 020A7B         2201            ljmp    ERROR1 
                    2202            
0A60                2203    ERR_ZAST_C: 
                    2204            ;clr     UP              ; zastav motor
                    2205            ;clr     DOWN            ; 
                    2206            ;lcall   WRITEPORTS      ; 
                    2207            ;_BP_
                    2208            ;nop
                    2209            ;nop
                    2210            ;lcall   READPORTS
                    2211            ;clr     FAST
                    2212            ;clr     SLOW
0A60 900CF9         2213            mov     DPTR, #STR_ERR_ZAST_C         ; vypis info 
0A63 120C0D         2214            lcall   DISPSTR         ;
0A66 020A7B         2215            ljmp    ERROR1  
                    2216            
0A69                2217    ERR_SKRD: 
                    2218            ;clr     UP              ; zastav motor
                    2219            ;clr     DOWN            ; 
                    2220            ;lcall   WRITEPORTS      ; 
                    2221            ;_BP_
                    2222            ;nop
                    2223            ;nop        
0A69 900D5A         2224            mov     DPTR, #STR_ERR_SKRD         ; vypis info 
0A6C 120C0D         2225            lcall   DISPSTR         ;
0A6F 020A7B         2226            ljmp    ERROR1    
                    2227            
0A72                2228    ERR_SKRH: 
                    2229            ;clr     UP              ; zastav motor
                    2230            ;clr     DOWN            ; 
                    2231            ;lcall   WRITEPORTS      ; 
                    2232            ;_BP_
                    2233            ;nop
                    2234            ;nop
0A72 900D1F         2235            mov     DPTR, #STR_ERR_SKRH         ; vypis info 
DEBUG                                                                                                         PAGE 41

0A75 120C0D         2236            lcall   DISPSTR         ;        
0A78 020A7B         2237            ljmp    ERROR1 
                    2238            
0A7B                2239    ERROR1:         
0A7B D22F           2240            setb    LEDU
0A7D D22E           2241            setb    LEDD
0A7F C222           2242            clr     FAST
0A81 D223           2243            setb    SLOW
0A83 120BD6         2244            lcall   WRITEPORTS          
0A86 120B77         2245    ERROR1S:lcall   READPORTS       ; nacitanie dat
0A89 300B08         2246            jnb     SKRH, ERROR1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0A8C 300C05         2247            jnb     SKRD, ERROR1C   ; Sme na dolnej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0A8F 300902         2248            jnb     MB1, ERROR1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0A92 80F2           2249            jmp     ERROR1S         ; Ak sme nechytili ani jednu clonku, opakujeme
0A94 C220           2250    ERROR1C:clr     UP              ; zastav motor
0A96 C221           2251            clr     DOWN            ; 
0A98 C222           2252            clr     FAST            ; 
0A9A C223           2253            clr     SLOW            ; 
0A9C 120BD6         2254            lcall   WRITEPORTS      ; 
0A9F 120B2F         2255            lcall   WAITFORTIMER    ; simulacia TIMERu
0AA2 020AA5         2256            jmp     ERROR2        ;-; a prejdi do stavu ERROR2 
                    2257            
0AA5 120B77         2258    ERROR2: lcall   READPORTS       ; nacitanie dat
0AA8 200DFA         2259            jb      DP, ERROR2      ; uz vystupili vsetci ludia z kabiny?
0AAB 200FF7         2260            jb      DPK, ERROR2     ; uz vystupili vsetci ludia z kabiny?
0AAE 200EF4         2261            jb      DPZK, ERROR2    ; uz vystupili vsetci ludia z kabiny?
0AB1 020033         2262            ljmp    START
                    2263                           
                    2264                    
0AB4                2265    ENDPROG:
0AB4 D218           2266            setb    KS
0AB6 120BD6         2267            call    WRITEPORTS                ; zapis novu informaciu
                    2268 +1         _BP_
0AB9 C2B3           2269 +1         clr     P3.3
0ABB D2AA           2270 +1         setb    EX1
0ABD 00             2271 +1         nop
0ABE 00             2272 +1         nop
0ABF 22             2274            ret
                    2275            
                    2276            
                    2277            
                    2278    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2279    ; INT_TIMER0
                    2280    ; Obsluha prerusenia timera 0
                    2281    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;        
0AC0                2282    INT_TIMER0:
0AC0 C0E0           2283            push    ACC
0AC2 C0F0           2284            push    B
0AC4 C080           2285            push    P0
0AC6 C090           2286            push    P1
0AC8 C0A0           2287            push    P2
0ACA C0B0           2288            push    P3
                    2289            ;push    OUTPORTC
                    2290            
0ACC ED             2291            mov     A, R5
DEBUG                                                                                                         PAGE 42

0ACD 1D             2292            dec     R5
0ACE 6002           2293            jz      INT_TIMER0_MAIN    
0AD0 801B           2294            sjmp    INT_TIMER0_END
0AD2                2295    INT_TIMER0_MAIN:
0AD2 EE             2296            mov     A, R6
0AD3 FD             2297            mov     R5, A
0AD4 E52A           2298            mov     A, ERRFLOOR_U
0AD6 452B           2299            orl     A, ERRFLOOR_D
0AD8 541E           2300            anl     A, #00011110b
0ADA 23             2301            rl      A
0ADB 23             2302            rl      A
0ADC 23             2303            rl      A    
0ADD 6224           2304            xrl     OUTPORTB, A     
                    2305                          
0ADF 852480         2306            mov     p0, OUTPORTB 
0AE2 75A0C1         2307            mov     p2, #i8255OUTB
0AE5 C2B6           2308            clr     WRNOT
0AE7 00             2309            nop
0AE8 00             2310            nop
0AE9 00             2311            nop
0AEA 00             2312            nop
0AEB D2B6           2313            setb    WRNOT
                    2314            
                    2315            
0AED                2316    INT_TIMER0_END:
                    2317            
                    2318    
                    2319            ;pop     OUTPORTC
0AED D0B0           2320            pop     P3
0AEF D0A0           2321            pop     P2
0AF1 D090           2322            pop     P1
0AF3 D080           2323            pop     P0 
0AF5 D0F0           2324            pop     B       
0AF7 D0E0           2325            pop     ACC
0AF9 32             2326            reti 
                    2327            
                    2328    ;INT_TIMER0:
                    2329    ;        push    ACC
                    2330    ;        mov     A, R7  
                    2331    ;        dec     R7               
                    2332    ;        jnz     INT_TIMER0_END     
                    2333    ;        mov     R7, #20h
                    2334    ;        jb      LEDU, INT_TIMER0_CLEAR       
                    2335    ;        setb    LEDU
                    2336    ;        setb    LEDD
                    2337    ;        jmp     INT_TIMER0_WRITE
                    2338    ;INT_TIMER0_CLEAR:        
                    2339    ;        ;clr     LEDU
                    2340    ;        ;clr     LEDD
                    2341    ;INT_TIMER0_WRITE: 
                    2342    ;        lcall   WRITEPORTS
                    2343    ;INT_TIMER0_END: 
                    2344    ;        setb    LEDU
                    2345    ;        lcall   WRITEPORTS       
                    2346    ;        pop     ACC
                    2347    ;        reti
                    2348            
                    2349            
DEBUG                                                                                                         PAGE 43

                    2350    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    2351    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    2352    ; 11.0592MHz/2000 = zdrzanie 1 ms
0AFA                2353    TIME10MS:
0AFA 7963           2354            mov     R1,#063h        ; 2
                    2355                                    ; *** 100x
0AFC 7AFF           2356    TIME0:  mov     R2,#0FFh        ; 2 
0AFE DAFE           2357    TIME1:  djnz    R2,TIME1        ; 256*2   
0B00 7AFF           2358            mov     R2,#0FFh        ; 2       
0B02 DAFE           2359    TIME2:  djnz    R2,TIME2        ; 256*2 
0B04 7A24           2360            mov     R2,#024h        ; 2       
0B06 DAFE           2361    TIME3:  djnz    R2,TIME3        ; 36*2
0B08 00             2362            nop                     ; 1
0B09 D9F1           2363            djnz    R1,TIME0        ; 2
                    2364                                    ; ***
0B0B 792A           2365            mov     R1,#02Ah        ; 2 
0B0D D9FE           2366    TIME4:  djnz    R1,TIME4        ; 43*2  
0B0F 22             2367            ret                     ; koniec
                    2368            
                    2369            
                    2370    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2371    ; STOP
                    2372    ; osetri stlacenie tlacidla STOP
                    2373    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0B10                2374    STOP:
0B10 D238           2375            setb    STOPPED
0B12 C222           2376            clr     FAST
0B14 C223           2377            clr     SLOW
0B16 74E1           2378            mov     A, #11100001b
0B18 5223           2379            anl     OUTPORTA, A 
0B1A 120BD6         2380            lcall   WRITEPORTS
                    2381            
0B1D 120B2F         2382            lcall   WAITFORTIMER
0B20 120B37         2383    STOPC:  lcall   READPORTS1
0B23 E528           2384            mov     A, INPORTA
0B25 541E           2385            anl     A, #00011110b
0B27 60F7           2386            jz      STOPC     
                    2387            
0B29 D223           2388            setb    SLOW
0B2B 120BD6         2389            lcall   WRITEPORTS
0B2E 22             2390            ret        
                    2391            
                    2392            
                    2393    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2394    ; DELAY
                    2395    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    2396    ; bude timer)
                    2397    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0B2F                2398    WAITFORTIMER:
0B2F 7B10           2399            mov     R3, #10h
0B31 120AFA         2400    DEL1:   lcall   TIME10MS
0B34 DBFB           2401            djnz    R3, DEL1
0B36 22             2402            ret
                    2403            
                    2404    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2405    ; READPORTS1
                    2406    ; precita nove hodnoty na portoch
                    2407    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DEBUG                                                                                                         PAGE 44

0B37                2408    READPORTS1:
0B37 C2AF           2409            clr     EA                  ;Treba zakazat prerusenia
                    2410            
0B39 75A080         2411            mov     p2, #i8255INA       ; citaj data z portu A
0B3C 75803F         2412            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0B3F C2B7           2413            clr     RDNOT
0B41 00             2414            nop
0B42 00             2415            nop
0B43 00             2416            nop
0B44 00             2417            nop
0B45 858028         2418            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
0B48 D2B7           2419            setb    RDNOT
                    2420            
0B4A 75A081         2421            mov     p2, #i8255INB       ; citaj data z portu B
0B4D 7580FE         2422            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0B50 C2B7           2423            clr     RDNOT
0B52 00             2424            nop
0B53 00             2425            nop
0B54 00             2426            nop
0B55 00             2427            nop
0B56 858021         2428            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0B59 D2B7           2429            setb    RDNOT
                    2430    
0B5B 75A082         2431            mov     p2, #i8255INC       ; citaj data z portu C
0B5E 75803F         2432            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0B61 C2B7           2433            clr     RDNOT
0B63 00             2434            nop
0B64 00             2435            nop
0B65 00             2436            nop
0B66 00             2437            nop
0B67 858022         2438            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0B6A D2B7           2439            setb    RDNOT
0B6C 00             2440            nop
0B6D 00             2441            nop
0B6E 00             2442            nop
0B6F 00             2443            nop
0B70 00             2444            nop
0B71 00             2445            nop
0B72 00             2446            nop
0B73 00             2447            nop
0B74 D2AF           2448            setb    EA                 ;znovu spustime prerusenia
0B76 22             2449            ret
                    2450    
                    2451    
                    2452    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2453    ; READPORTS
                    2454    ; precita nove hodnoty na portoch
                    2455    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0B77                2456    READPORTS:
0B77 C2AF           2457            clr     EA                  ;Treba zakazat prerusenia
                    2458            
0B79 75A080         2459            mov     p2, #i8255INA       ; citaj data z portu A
0B7C 75803F         2460            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0B7F C2B7           2461            clr     RDNOT
0B81 00             2462            nop
0B82 00             2463            nop
0B83 00             2464            nop
DEBUG                                                                                                         PAGE 45

0B84 00             2465            nop
0B85 858028         2466            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
0B88 D2B7           2467            setb    RDNOT
                    2468            
0B8A 75A081         2469            mov     p2, #i8255INB       ; citaj data z portu B
0B8D 7580FE         2470            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0B90 C2B7           2471            clr     RDNOT
0B92 00             2472            nop
0B93 00             2473            nop
0B94 00             2474            nop
0B95 00             2475            nop
0B96 858021         2476            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0B99 D2B7           2477            setb    RDNOT
                    2478    
0B9B 75A082         2479            mov     p2, #i8255INC       ; citaj data z portu C
0B9E 75803F         2480            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0BA1 C2B7           2481            clr     RDNOT
0BA3 00             2482            nop
0BA4 00             2483            nop
0BA5 00             2484            nop
0BA6 00             2485            nop
0BA7 858022         2486            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0BAA D2B7           2487            setb    RDNOT
0BAC 00             2488            nop
0BAD 00             2489            nop
0BAE 00             2490            nop
0BAF 00             2491            nop
0BB0 00             2492            nop
0BB1 00             2493            nop
0BB2 00             2494            nop
0BB3 00             2495            nop
0BB4 D2AF           2496            setb    EA                 ;znovu spustime prerusenia
                    2497            
                    2498            
0BB6 300F04         2499            jnb     DPK, READPORTS_C1
0BB9 C222           2500            clr     FAST
0BBB D223           2501            setb    SLOW
0BBD                2502    READPORTS_C1:         
0BBD 204003         2503            jb      STOPNOT, READPORTS_C
0BC0 120B10         2504            lcall   STOP
0BC3                2505    READPORTS_C:        
0BC3 E528           2506            mov     A, INPORTA
0BC5 541E           2507            anl     A, #00011110b
0BC7 4223           2508            orl     OUTPORTA, A
0BC9 120BD6         2509            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
0BCC E522           2510            mov     A, INPORTC
0BCE 543F           2511            anl     A, #00111111b
0BD0 4225           2512            orl     OUTPORTC, A
0BD2 120BD6         2513            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    2514            
                    2515            
0BD5 22             2516            ret
                    2517            
                    2518    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2519    ; WRITEPORTS
                    2520    ; spravi zalohu vystupnych registrov a posle data von
                    2521    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
DEBUG                                                                                                         PAGE 46

0BD6                2522    WRITEPORTS:
0BD6 C2AF           2523            clr     EA                  ;Treba zakazat prerusenia
                    2524            
0BD8 852380         2525            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
0BDB 75A0C0         2526            mov     p2, #i8255OUTA
0BDE C2B6           2527            clr     WRNOT
0BE0 00             2528            nop
0BE1 00             2529            nop
0BE2 00             2530            nop
0BE3 00             2531            nop
0BE4 D2B6           2532            setb    WRNOT
                    2533            
0BE6 852480         2534            mov     p0, OUTPORTB        ; potom port B
0BE9 75A0C1         2535            mov     p2, #i8255OUTB
0BEC C2B6           2536            clr     WRNOT
0BEE 00             2537            nop
0BEF 00             2538            nop
0BF0 00             2539            nop
0BF1 00             2540            nop
0BF2 D2B6           2541            setb    WRNOT
                    2542    
0BF4 852580         2543            mov     p0, OUTPORTC        ; a nakoniec port C
0BF7 75A0C2         2544            mov     p2, #i8255OUTC
0BFA C2B6           2545            clr     WRNOT
0BFC 00             2546            nop
0BFD 00             2547            nop
0BFE 00             2548            nop
0BFF 00             2549            nop
0C00 D2B6           2550            setb    WRNOT
0C02 00             2551            nop
0C03 00             2552            nop
0C04 00             2553            nop
0C05 00             2554            nop
0C06 00             2555            nop
0C07 00             2556            nop
0C08 00             2557            nop
0C09 00             2558            nop
0C0A D2AF           2559            setb     EA                  ;Treba zakazat prerusenia
0C0C 22             2560            ret
                    2561    
                    2562    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2563    
                    2564    
                    2565    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2566    ; DISPSTR
                    2567    ; posle na seriovu linku retazec na adrese DPTR
                    2568    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0C0D                2569    DISPSTR:
0C0D C0E0           2570            push    ACC
0C0F                2571    DSPS_LOOP:           
0C0F E4             2572            clr     A
0C10 93             2573            movc    A, @A+DPTR
0C11 600A           2574            jz      DSPS_END
0C13 F599           2575            mov     SBUF, A
0C15 3099FD         2576            jnb     TI, $
0C18 C299           2577            clr     TI
0C1A A3             2578            inc     DPTR
0C1B 80F2           2579            sjmp    DSPS_LOOP
DEBUG                                                                                                         PAGE 47

0C1D                2580    DSPS_END:
0C1D D0E0           2581            pop     ACC
0C1F 22             2582            ret
                    2583            
                    2584    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2585    
0C20 0D0A5269       2586    STR_INIT:         db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0C24 61646961   
0C28 63692073   
0C2C 79737465   
0C30 6D206A65   
0C34 20696E69   
0C38 6369616C   
0C3C 697A6F76   
0C40 616E792E   
0C44 0D0A00     
0C47 52696164       2587    STR_STOP:         db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh,
                                                                                0ah, 00h
0C4B 69616369   
0C4F 20737973   
0C53 74656D20   
0C57 6A652072   
0C5B 65696E69   
0C5F 6369616C   
0C63 697A6F76   
0C67 616E7920   
0C6B 706F2073   
0C6F 746C6163   
0C73 656E6920   
0C77 746C6163   
0C7B 69646C61   
0C7F 2053544F   
0C83 502E0D0A   
0C87 00         
0C88 4B616C69       2588    STR_CALIB:        db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0C8C 62726163   
0C90 69612076   
0C94 79746168   
0C98 75206A65   
0C9C 20756B6F   
0CA0 6E63656E   
0CA4 612E0D0A   
0CA8 00         
0CA9 43687962       2589    STR_ERR_1SPOM_C:  db  'Chyba! Vypadla spomalovacia clonka!', 0dh, 0ah, 00h
0CAD 61212056   
0CB1 79706164   
0CB5 6C612073   
0CB9 706F6D61   
0CBD 6C6F7661   
0CC1 63696120   
0CC5 636C6F6E   
0CC9 6B61210D   
0CCD 0A00       
0CCF 43687962       2590    STR_ERR_2SPOM_C:  db  'Chyba! Vypadli dve spomalovacie clonky!', 0dh, 0ah, 00h
0CD3 61212056   
0CD7 79706164   
0CDB 6C692064   
0CDF 76652073   
DEBUG                                                                                                         PAGE 48

0CE3 706F6D61   
0CE7 6C6F7661   
0CEB 63696520   
0CEF 636C6F6E   
0CF3 6B79210D   
0CF7 0A00       
0CF9 43687962       2591    STR_ERR_ZAST_C:   db  'Chyba! Vypadla zastavovacia clonka!', 0dh, 0ah, 00h
0CFD 61212056   
0D01 79706164   
0D05 6C61207A   
0D09 61737461   
0D0D 766F7661   
0D11 63696120   
0D15 636C6F6E   
0D19 6B61210D   
0D1D 0A00       
0D1F 43687962       2592    STR_ERR_SKRH:     db  'Chyba! Neocakavane nacitanie hornej spomalovacej clonky!', 0dh, 0ah, 
                                                                               00h
0D23 6121204E   
0D27 656F6361   
0D2B 6B617661   
0D2F 6E65206E   
0D33 61636974   
0D37 616E6965   
0D3B 20686F72   
0D3F 6E656A20   
0D43 73706F6D   
0D47 616C6F76   
0D4B 6163656A   
0D4F 20636C6F   
0D53 6E6B7921   
0D57 0D0A00     
0D5A 43687962       2593    STR_ERR_SKRD:     db  'Chyba! Neocakavane nacitanie dolnej spomalovacej clonky!', 0dh, 0ah, 
                                                                               00h
0D5E 6121204E   
0D62 656F6361   
0D66 6B617661   
0D6A 6E65206E   
0D6E 61636974   
0D72 616E6965   
0D76 20646F6C   
0D7A 6E656A20   
0D7E 73706F6D   
0D82 616C6F76   
0D86 6163656A   
0D8A 20636C6F   
0D8E 6E6B7921   
0D92 0D0A00     
                    2594    
----                2595            DSEG
0040                2596            org     40h
0040                2597    STACK:  DS      10h
                    2598    
                    2599    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
DEBUG                                                                                                         PAGE 49

ACC. . . . . . . . . . . . . . .  D ADDR  00E0H  PREDEFINED  
B. . . . . . . . . . . . . . . .  D ADDR  00F0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  00BCH  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00D5H  
CALIBEND2. . . . . . . . . . . .  C ADDR  00E0H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00CDH  
COUNT. . . . . . . . . . . . . .    NUMB  0008H  REDEFINABLE  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  058AH  
D3_MB2C. . . . . . . . . . . . .  C ADDR  0801H  
D4_MB2C. . . . . . . . . . . . .  C ADDR  09BDH  
DEL1 . . . . . . . . . . . . . .  C ADDR  0B31H  
DISPSTR. . . . . . . . . . . . .  C ADDR  0C0DH  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  04FFH  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  057FH  
DEBUG                                                                                                         PAGE 50

DOWN2_MB2. . . . . . . . . . . .  C ADDR  0544H  
DOWN2_MB2A . . . . . . . . . . .  C ADDR  0550H  
DOWN3. . . . . . . . . . . . . .  C ADDR  071FH  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  080BH  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0764H  
DOWN3_MB2A . . . . . . . . . . .  C ADDR  0770H  
DOWN3_STOP . . . . . . . . . . .  C ADDR  083DH  
DOWN4. . . . . . . . . . . . . .  C ADDR  08DBH  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  09C7H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  0920H  
DOWN4_MB2A . . . . . . . . . . .  C ADDR  092CH  
DOWN4_STOP . . . . . . . . . . .  C ADDR  09F9H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
DSPS_END . . . . . . . . . . . .  C ADDR  0C1DH  
DSPS_LOOP. . . . . . . . . . . .  C ADDR  0C0FH  
EA . . . . . . . . . . . . . . .  B ADDR  00AFH  PREDEFINED  
ENDD0. . . . . . . . . . . . . .  C ADDR  0275H  
ENDD1. . . . . . . . . . . . . .  C ADDR  02A7H  
ENDD2. . . . . . . . . . . . . .  C ADDR  04B6H  
ENDD3. . . . . . . . . . . . . .  C ADDR  04E8H  
ENDD4. . . . . . . . . . . . . .  C ADDR  0831H  
ENDD5. . . . . . . . . . . . . .  C ADDR  0863H  
ENDD6. . . . . . . . . . . . . .  C ADDR  09EDH  
ENDD7. . . . . . . . . . . . . .  C ADDR  0A1FH  
ENDPROG. . . . . . . . . . . . .  C ADDR  0AB4H  NOT USED  
ERRF12_C . . . . . . . . . . . .  D ADDR  0039H  NOT USED  
ERRF12_D . . . . . . . . . . . .  B ADDR  0059H  NOT USED  
ERRF12_U . . . . . . . . . . . .  B ADDR  0052H  NOT USED  
ERRF1_C. . . . . . . . . . . . .  D ADDR  0035H  NOT USED  
ERRF1_D. . . . . . . . . . . . .  B ADDR  0059H  
ERRF1_U. . . . . . . . . . . . .  B ADDR  0051H  NOT USED  
ERRF23_C . . . . . . . . . . . .  D ADDR  003AH  NOT USED  
ERRF23_D . . . . . . . . . . . .  B ADDR  005AH  NOT USED  
ERRF23_U . . . . . . . . . . . .  B ADDR  0053H  NOT USED  
ERRF2_C. . . . . . . . . . . . .  D ADDR  0036H  
ERRF2_D. . . . . . . . . . . . .  B ADDR  005AH  
ERRF2_U. . . . . . . . . . . . .  B ADDR  0052H  
ERRF34_C . . . . . . . . . . . .  D ADDR  003BH  NOT USED  
ERRF34_D . . . . . . . . . . . .  B ADDR  005BH  NOT USED  
ERRF34_U . . . . . . . . . . . .  B ADDR  0054H  NOT USED  
ERRF3_C. . . . . . . . . . . . .  D ADDR  0037H  
ERRF3_D. . . . . . . . . . . . .  B ADDR  005BH  
ERRF3_U. . . . . . . . . . . . .  B ADDR  0053H  
ERRF4_C. . . . . . . . . . . . .  D ADDR  0038H  NOT USED  
ERRF4_D. . . . . . . . . . . . .  B ADDR  005CH  NOT USED  
ERRF4_U. . . . . . . . . . . . .  B ADDR  0054H  
ERRFLOOR_D . . . . . . . . . . .  D ADDR  002BH  
ERRFLOOR_U . . . . . . . . . . .  D ADDR  002AH  
ERROR1 . . . . . . . . . . . . .  C ADDR  0A7BH  
ERROR1C. . . . . . . . . . . . .  C ADDR  0A94H  
ERROR1S. . . . . . . . . . . . .  C ADDR  0A86H  
ERROR2 . . . . . . . . . . . . .  C ADDR  0AA5H  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  0A36H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  0A4BH  
ERR_SKRD . . . . . . . . . . . .  C ADDR  0A69H  
DEBUG                                                                                                         PAGE 51

ERR_SKRH . . . . . . . . . . . .  C ADDR  0A72H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  0A60H  NOT USED  
ET0. . . . . . . . . . . . . . .  B ADDR  00A9H  PREDEFINED  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  0150H  
F1S. . . . . . . . . . . . . . .  C ADDR  010FH  
F2 . . . . . . . . . . . . . . .  C ADDR  038BH  
F2DOWN . . . . . . . . . . . . .  C ADDR  039DH  
F2OK . . . . . . . . . . . . . .  C ADDR  02F4H  
F2S. . . . . . . . . . . . . . .  C ADDR  02D2H  
F2SW . . . . . . . . . . . . . .  C ADDR  0340H  
F2UP . . . . . . . . . . . . . .  C ADDR  0391H  
F3 . . . . . . . . . . . . . . .  C ADDR  0666H  
F3DOWN . . . . . . . . . . . . .  C ADDR  0678H  
F3OK . . . . . . . . . . . . . .  C ADDR  05CFH  
F3S. . . . . . . . . . . . . . .  C ADDR  05ADH  
F3SW . . . . . . . . . . . . . .  C ADDR  061BH  
F3UP . . . . . . . . . . . . . .  C ADDR  066CH  
F4OK . . . . . . . . . . . . . .  C ADDR  08CFH  
F4S. . . . . . . . . . . . . . .  C ADDR  088EH  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00FBH  
FLOOR2 . . . . . . . . . . . . .  C ADDR  02BEH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0599H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  087AH  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
INT_TIMER0 . . . . . . . . . . .  C ADDR  0AC0H  
INT_TIMER0_END . . . . . . . . .  C ADDR  0AEDH  
INT_TIMER0_MAIN. . . . . . . . .  C ADDR  0AD2H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00F5H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
DEBUG                                                                                                         PAGE 52

OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P1 . . . . . . . . . . . . . . .  D ADDR  0090H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PCON . . . . . . . . . . . . . .  D ADDR  0087H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  0B77H  
READPORTS1 . . . . . . . . . . .  C ADDR  0B37H  
READPORTS_C. . . . . . . . . . .  C ADDR  0BC3H  
READPORTS_C1 . . . . . . . . . .  C ADDR  0BBDH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SBUF . . . . . . . . . . . . . .  D ADDR  0099H  PREDEFINED  
SCON . . . . . . . . . . . . . .  D ADDR  0098H  PREDEFINED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOP . . . . . . . . . . . . . .  C ADDR  0B10H  
STOPC. . . . . . . . . . . . . .  C ADDR  0B20H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  
STOPPED. . . . . . . . . . . . .  B ADDR  0038H  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0C88H  NOT USED  
STR_ERR_1SPOM_C. . . . . . . . .  C ADDR  0CA9H  
STR_ERR_2SPOM_C. . . . . . . . .  C ADDR  0CCFH  
STR_ERR_SKRD . . . . . . . . . .  C ADDR  0D5AH  
STR_ERR_SKRH . . . . . . . . . .  C ADDR  0D1FH  
STR_ERR_ZAST_C . . . . . . . . .  C ADDR  0CF9H  
STR_INIT . . . . . . . . . . . .  C ADDR  0C20H  
STR_STOP . . . . . . . . . . . .  C ADDR  0C47H  NOT USED  
TCON . . . . . . . . . . . . . .  D ADDR  0088H  PREDEFINED  
DEBUG                                                                                                         PAGE 53

TH0. . . . . . . . . . . . . . .  D ADDR  008CH  PREDEFINED  
TH1. . . . . . . . . . . . . . .  D ADDR  008DH  PREDEFINED  
TI . . . . . . . . . . . . . . .  B ADDR  0099H  PREDEFINED  
TIME0. . . . . . . . . . . . . .  C ADDR  0AFCH  
TIME1. . . . . . . . . . . . . .  C ADDR  0AFEH  
TIME10MS . . . . . . . . . . . .  C ADDR  0AFAH  
TIME2. . . . . . . . . . . . . .  C ADDR  0B02H  
TIME3. . . . . . . . . . . . . .  C ADDR  0B06H  
TIME4. . . . . . . . . . . . . .  C ADDR  0B0DH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  
TL0. . . . . . . . . . . . . . .  D ADDR  008AH  PREDEFINED  
TL1. . . . . . . . . . . . . . .  D ADDR  008BH  PREDEFINED  
TMOD . . . . . . . . . . . . . .  D ADDR  0089H  PREDEFINED  
TR0. . . . . . . . . . . . . . .  B ADDR  008CH  PREDEFINED  
TR1. . . . . . . . . . . . . . .  B ADDR  008EH  PREDEFINED  
U1_MB2C. . . . . . . . . . . . .  C ADDR  0239H  
U2_MB2C. . . . . . . . . . . . .  C ADDR  0486H  
U3_MB1C. . . . . . . . . . . . .  C ADDR  070FH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  015CH  
UP1A . . . . . . . . . . . . . .  C ADDR  0179H  
UP1_MB1. . . . . . . . . . . . .  C ADDR  0243H  
UP1_MB1C . . . . . . . . . . . .  C ADDR  027EH  NOT USED  
UP1_MB2. . . . . . . . . . . . .  C ADDR  01A1H  
UP1_MB2A . . . . . . . . . . . .  C ADDR  01ADH  
UP1_STOP . . . . . . . . . . . .  C ADDR  0281H  
UP2. . . . . . . . . . . . . . .  C ADDR  03A9H  
UP2A . . . . . . . . . . . . . .  C ADDR  03C6H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0490H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  03EEH  
UP2_MB2A . . . . . . . . . . . .  C ADDR  03FAH  
UP2_STOP . . . . . . . . . . . .  C ADDR  04C2H  
UP3. . . . . . . . . . . . . . .  C ADDR  0684H  
UP3A . . . . . . . . . . . . . .  C ADDR  06A1H  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0704H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  06C9H  
UP3_MB2A . . . . . . . . . . . .  C ADDR  06D5H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAITFORTIMER . . . . . . . . . .  C ADDR  0B2FH  
WRITEPORTS . . . . . . . . . . .  C ADDR  0BD6H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
