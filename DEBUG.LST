VYTAH/ORI                                                                                                     PAGE 1

                       1    $MOD51
                       2    $DEBUG
                       3    
                =1     4    $include (lift.inc)
                =1     5    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1     6    i8255INA        equ     080h
  0081          =1     7    i8255INB        equ     081h
  0082          =1     8    i8255INC        equ     082h
  0083          =1     9    i8255INCW       equ     083h
  00C0          =1    10    i8255OUTA       equ     0c0h
  00C1          =1    11    i8255OUTB       equ     0c1h
  00C2          =1    12    i8255OUTC       equ     0c2h
  00C3          =1    13    i8255OUTCW      equ     0c3h
                =1    14    
  0028          =1    15    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    16    INPORTB         data    21h
  0022          =1    17    INPORTC         data    22h
  0023          =1    18    OUTPORTA        data    23h
  0024          =1    19    OUTPORTB        data    24h
  0025          =1    20    OUTPORTC        data    25h
  0026          =1    21    INPORTBold      data    26h
  0027          =1    22    CTRLREG         data    27h
                =1    23    
  0030          =1    24    POSITION        data    30h
  0031          =1    25    LOWEST          data    31h
  0032          =1    26    HIGHEST         data    32h
  0033          =1    27    STOPTIMER       data    33h
  0034          =1    28    OUTPORTBold     data    34h
                =1    29    
  0040          =1    30    STOPNOT         bit     INPORTA.0
  0041          =1    31    PKI1            bit     INPORTA.1
  0042          =1    32    PKI2            bit     INPORTA.2
  0043          =1    33    PKI3            bit     INPORTA.3
  0044          =1    34    PKI4            bit     INPORTA.4
  0045          =1    35    DOORCLSD        bit     INPORTA.5 
                =1    36    
  0009          =1    37    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    38    MB2             bit     INPORTB.2
  000B          =1    39    SKRH            bit     INPORTB.3
  000C          =1    40    SKRD            bit     INPORTB.4
  000D          =1    41    DP              bit     INPORTB.5
  000E          =1    42    DPZK            bit     INPORTB.6
  000F          =1    43    DPK             bit     INPORTB.7
                =1    44    
  0031          =1    45    MB1old          bit     INPORTBold.1
  0032          =1    46    MB2old          bit     INPORTBold.2
  0033          =1    47    SKRHold         bit     INPORTBold.3
  0034          =1    48    SKRDold         bit     INPORTBold.4
                =1    49    
  0010          =1    50    PI1             bit     INPORTC.0
  0011          =1    51    PI2D            bit     INPORTC.1
  0012          =1    52    PI2U            bit     INPORTC.2
  0013          =1    53    PI3D            bit     INPORTC.3
  0014          =1    54    PI3U            bit     INPORTC.4
  0015          =1    55    PI4             bit     INPORTC.5
                =1    56    
  0018          =1    57    KS              bit     OUTPORTA.0
  0019          =1    58    PKO1            bit     OUTPORTA.1
VYTAH/ORI/D                                                                                                  PAGE 2

  001A          =1    59    PKO2            bit     OUTPORTA.2
  001B          =1    60    PKO3            bit     OUTPORTA.3
  001C          =1    61    PKO4            bit     OUTPORTA.4
                =1    62    
  0020          =1    63    UP              bit     OUTPORTB.0
  0021          =1    64    DOWN            bit     OUTPORTB.1
  0022          =1    65    FAST            bit     OUTPORTB.2
  0023          =1    66    SLOW            bit     OUTPORTB.3
  0024          =1    67    FLED1           bit     OUTPORTB.4
  0025          =1    68    FLED2           bit     OUTPORTB.5
  0026          =1    69    FLED3           bit     OUTPORTB.6
  0027          =1    70    FLED4           bit     OUTPORTB.7
                =1    71    
  0028          =1    72    PO1             bit     OUTPORTC.0
  0029          =1    73    PO2D            bit     OUTPORTC.1
  002A          =1    74    PO2U            bit     OUTPORTC.2
  002B          =1    75    PO3D            bit     OUTPORTC.3
  002C          =1    76    PO3U            bit     OUTPORTC.4
  002D          =1    77    PO4             bit     OUTPORTC.5
  002E          =1    78    LEDD            bit     OUTPORTC.6
  002F          =1    79    LEDU            bit     OUTPORTC.7
                =1    80    
  0038          =1    81    CANGO           bit     CTRLREG.0
  0039          =1    82    DOORCLSDold     bit     CTRLREG.1
  003A          =1    83    UPold           bit     CTRLREG.2
  003B          =1    84    DOWNold         bit     CTRLREG.3
  003C          =1    85    FASTold         bit     CTRLREG.4
  003D          =1    86    SLOWold         bit     CTRLREG.5
                =1    87    
  00B6          =1    88    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    89    RDNOT           bit     0b7h        ; p3.7
                =1    90    
                =1    91    ; bitove masky
                =1    92    ; 8255OUT 
                =1    93    ; port A
  0001          =1    94    bmKS              equ    00000001b
  0002          =1    95    bmPKO1            equ    00000010b
  0004          =1    96    bmPKO2            equ    00000100b
  0008          =1    97    bmPKO3            equ    00001000b
  0010          =1    98    bmPKO4            equ    00010000b
                =1    99    
                =1   100    ; port B
  0001          =1   101    bmUP              equ    00000001b
  0002          =1   102    bmDOWN            equ    00000010b
  0004          =1   103    bmFAST            equ    00000100b
  0008          =1   104    bmSLOW            equ    00001000b
  0010          =1   105    bmFLED1           equ    00010000b
  0020          =1   106    bmFLED2           equ    00100000b
  0040          =1   107    bmFLED3           equ    01000000b
  0080          =1   108    bmFLED4           equ    10000000b
                =1   109    
                =1   110    ; port C
  0001          =1   111    bmPO1             equ    00000001b
  0002          =1   112    bmPO2D            equ    00000010b
  0004          =1   113    bmPO2U            equ    00000100b
  0008          =1   114    bmPO3D            equ    00001000b
  0010          =1   115    bmPO3U            equ    00010000b
  0020          =1   116    bmPO4             equ    00100000b
VYTAH/ORI/D                                                                                                  PAGE 3

  0040          =1   117    bmLEDD            equ    01000000b
  0080          =1   118    bmLEDU            equ    10000000b
                =1   119    
                =1   120    ; 8255IN
                =1   121    ; port A
  0001          =1   122    bmSTOP            equ    00000001b
  0002          =1   123    bmPKI1            equ    00000010b
  0004          =1   124    bmPKI2            equ    00000100b
  0008          =1   125    bmPKI3            equ    00001000b
  0010          =1   126    bmPKI4            equ    00010000b
  0020          =1   127    bmDOORCLSD        equ    00100000b
                =1   128    
                =1   129    ; port B
  0002          =1   130    bmMB1I            equ    00000010b
  0004          =1   131    bmMB2I            equ    00000100b
  0008          =1   132    bmSKRHI           equ    00001000b
  0010          =1   133    bmSKRHD           equ    00010000b
  0020          =1   134    bmDPI             equ    00100000b
  0040          =1   135    bmDPZKI           equ    01000000b
  0080          =1   136    bmDPKI            equ    10000000b
                =1   137    
                =1   138    ; port C
  0001          =1   139    bmPI1             equ    00000001b
  0002          =1   140    bmPI2D            equ    00000010b
  0004          =1   141    bmPI2U            equ    00000100b
  0008          =1   142    bmPI3D            equ    00001000b
  0010          =1   143    bmPI3U            equ    00010000b
  0020          =1   144    bmPI4             equ    00100000b
                =1   145    
                     146    
                     147    _BP_    MACRO 
                     148            clr     P3.3
                     149            setb    EX1
                     150            nop
                     151            nop
                     152    ENDM
                     153    
                     154    LJZ     MACRO   NAVESTIE
                     155            jnz     $+4
                     156            ljmp    NAVESTIE
                     157            nop
                     158    ENDM
                     159    
                     160    POLOHA_LED  MACRO  POLOHA
                     161            clr     LEDU            
                     162            clr     LEDD 
                     163            clr     FLED1             
                     164            clr     FLED2                
                     165            clr     FLED3           
                     166            clr     FLED4           
                     167            setb    FLED&POLOHA
                     168            lcall   WRITEPORTS
                     169    ENDM
                     170    
  0036               171    FLOORREQ        data    36h
                     172    
                     173    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               174    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
VYTAH/ORI/D                                                                                                  PAGE 4

                                                                               cie
                     175                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     176                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     177    ;osetrenie vektorov preruseni
0000                 178            org     0000h           ; adresa odkial startuje program po resete
0000 020033          179            ljmp    START           ; skok na zaciatok kodu programu
                     180                  
0033                 181            org     0033h           ; od tejto adresy sa zacina kod programu
0033                 182    START:
0033 7405            183            mov     A, #5h
                     184 +1         ljz     CALIB     
0035 7002            185 +1         jnz     $+4
0037 02009E          186 +1         ljmp    CALIB
003A 00              187 +1         nop
                     189    
003B                 190    RESET:  
                     191            ; riadiace signaly do pasivnej urovne 
003B D2B6            192            setb    WRNOT
003D D2B7            193            setb    RDNOT
003F 753300          194            mov     STOPTIMER, #0
0042 758140          195            mov     SP, #STACK
                     196    
                     197            ; pockame si na inicializaciu obvodov 8255  
0045 7900            198            mov     R1, #0 
0047 7AFF            199            mov     R2, #0ffh
0049 D9FE            200            djnz    R1, $
004B DAFC            201            djnz    R2, $-2
                     202            
                     203            ; teraz ich mozeme nastavit
004D 75809B          204            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0050 75A083          205            mov     p2, #i8255INCW
0053 C2B6            206            clr     WRNOT
0055 00              207            nop
0056 00              208            nop
0057 00              209            nop
0058 00              210            nop
0059 D2B6            211            setb    WRNOT
005B 758080          212            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
005E 75A0C3          213            mov     p2, #i8255OUTCW
0061 C2B6            214            clr     WRNOT
0063 00              215            nop
0064 00              216            nop
0065 00              217            nop
0066 00              218            nop
0067 D2B6            219            setb    WRNOT
                     220            
                     221 +1         _BP_
0069 C2B3            222 +1         clr     P3.3
006B D2AA            223 +1         setb    EX1
006D 00              224 +1         nop
006E 00              225 +1         nop
                     227    
                     228            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
006F 752800          229            mov     INPORTA, #0
0072 75211E          230            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0075 752200          231            mov     INPORTC, #0
0078 75231E          232            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
VYTAH/ORIEKD                                                                                                  PAGE 5

007B 7524F0          233            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
007E 7525FF          234            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0081 D218            235            setb    KS
0083 12049C          236            call    WRITEPORTS          ; zapis novu informaciu
                     237    ;;;;;;;;
                     238    
0086 752300          239            mov     OUTPORTA, #0
0089 752400          240            mov     OUTPORTB, #0
008C 752500          241            mov     OUTPORTC, #0
008F 12049C          242            call    WRITEPORTS          ; zapis novu informaciu
                     243    
0092 752800          244            mov     INPORTA, #0
0095 752100          245            mov     INPORTB, #0         
0098 752200          246            mov     INPORTC, #0
009B 12045F          247            call    READPORTS           ; prvotne nacitanie udajov
                     248    
009E                 249    CALIB:
                     250            ;kalibracia vytahu podla dolnej porovnavacej clonky
009E 12045F          251            lcall   READPORTS                   ; precitaj, co je na portoch
00A1 300C11          252            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00A4 D221            253            setb    DOWN                        ; inak pod dole
00A6 D222            254            setb    FAST                        ; a rychlo
00A8 C223            255            clr     SLOW                        ;
00AA 12049C          256            lcall   WRITEPORTS                  ; zapis informaciu 
00AD                 257    CALIBLOOP:
00AD 12045F          258            lcall   READPORTS                   ; 
00B0 300C02          259            jnb     SKRD, CALIBEND              ; ak sme dole, konci
                     260            ;jnb     MB2, CALIBEND               ; ak sme na poschodi, konci
00B3 80F8            261            jmp     CALIBLOOP
00B5                 262    CALIBEND:
00B5 753600          263            mov     FLOORREQ, #0                                
00B8 C222            264            clr     FAST                        ; stojime
00BA C221            265            clr     DOWN                        ;
00BC D224            266            setb    FLED1
00BE 12049C          267            lcall   WRITEPORTS                  ; zapis informaciu
                     268 +1         _BP_
00C1 C2B3            269 +1         clr     P3.3
00C3 D2AA            270 +1         setb    EX1
00C5 00              271 +1         nop
00C6 00              272 +1         nop
00C7                 274    MAIN:
                     275    
                     276    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     277    ; ****************************************************************************
                     278    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     279    ; ----------------------------------------------------------------------------
                     280    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     281    ; ----------------------------------------------------------------------------
                     282    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     283    ; ****************************************************************************
                     284    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     285    ; ----------------------------------------------------------------------------
                     286    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     287    ; ----------------------------------------------------------------------------
                     288    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     289    ; ****************************************************************************
VYTAH/ORI                                                                                                     PAGE 6

                     290    ; POSITION
                     291    ; ****************************************************************************
                     292    
                     293    
                     294    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     295    
00C7                 296    FLOOR1:
                     297 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C7 C22F            298 +1         clr     LEDU            
00C9 C22E            299 +1         clr     LEDD 
00CB C224            300 +1         clr     FLED1             
00CD C225            301 +1         clr     FLED2                
00CF C226            302 +1         clr     FLED3           
00D1 C227            303 +1         clr     FLED4           
00D3 D224            304 +1         setb    FLED1
00D5 12049C          305 +1         lcall   WRITEPORTS
00D8 12044E          307            lcall   WAITFORTIMER    ; simulacia TIMERu
00DB 12045F          308    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DE C219            309            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00E0 12049C          310            lcall   WRITEPORTS      ;
00E3 E528            311            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
00E5 541C            312            anl     A, #00011100b ;-;
00E7 60F2            313            jz      F1S           ;-; ak nie, opakuj
00E9 D220            314            setb    UP              ; rychly pohyb hore
00EB D222            315            setb    FAST            ; 
00ED C223            316            clr     SLOW            ;
00EF 12049C          317            lcall   WRITEPORTS      ; 
00F2 0200F5          318            jmp     UP1           ;-; prejdi do stavu UP1
00F5                 319    UP1:
                     320 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00F5 C22F            321 +1         clr     LEDU            
00F7 C22E            322 +1         clr     LEDD 
00F9 C224            323 +1         clr     FLED1             
00FB C225            324 +1         clr     FLED2                
00FD C226            325 +1         clr     FLED3           
00FF C227            326 +1         clr     FLED4           
0101 D224            327 +1         setb    FLED1
0103 12049C          328 +1         lcall   WRITEPORTS
0106 12045F          330    UP1A:   lcall   READPORTS       ; nacitanie dat
0109 200AFA          331            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
010C 12045F          332            lcall   READPORTS       ; ak ano, sme z nej uz prec?
010F 300AFA          333            jnb     MB2, $-3        ;       
0112 D22E            334            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0114 12049C          335            lcall   WRITEPORTS      ;
0117 02011A          336            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
011A                 337    UP1_MB2:
011A 12045F          338            lcall   READPORTS       ; nacitanie dat
011D 200AFA          339            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0120 D22F            340            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0122 12049C          341            lcall   WRITEPORTS      ;   
0125 E528            342            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0127 5404            343            anl     A, #00000100b ;-;
0129 600A            344            jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1
012B D223            345            setb    SLOW            ;       Ak ano, spomalme
VYTAH/ORI |D'©4                                                                                              PAGE 7

012D C222            346            clr     FAST            ; 
012F 12049C          347            lcall   WRITEPORTS      ;         
0132 020135          348            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
0135                 349    UP1_MB1:
0135 12045F          350            lcall   READPORTS       ; nacitanie dat
0138 2009FA          351            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
013B E528            352            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
013D 5404            353            anl     A, #00000100b ;-;
013F 606D            354            jz      UP2           ;-; Ak nie, chod do stavu UP2
0141 C220            355            clr     UP              ; zastav motor
0143 D23A            356            setb    UPOld           ;       (a zalohuj) 
0145 C23B            357            clr     DOWNOld         ;       (a zalohuj)
0147 C222            358            clr     FAST            ; 
0149 12049C          359            lcall   WRITEPORTS      ; 
014C 02014F          360            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     361    
                     362    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     363    
014F                 364    FLOOR2:
                     365 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
014F C22F            366 +1         clr     LEDU            
0151 C22E            367 +1         clr     LEDD 
0153 C224            368 +1         clr     FLED1             
0155 C225            369 +1         clr     FLED2                
0157 C226            370 +1         clr     FLED3           
0159 C227            371 +1         clr     FLED4           
015B D225            372 +1         setb    FLED2
015D 12049C          373 +1         lcall   WRITEPORTS
0160 12044E          375            lcall   WAITFORTIMER    ; simulacia TIMERu
0163 12045F          376    F2S:    lcall   READPORTS     ;-; nacitanie dat
0166 C21A            377            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0168 12049C          378            lcall   WRITEPORTS      ;
                     379            
016B 7418            380            mov     A, #00011000b ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
016D 203A01          381            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0170 F4              382            cpl     A               ;       Ak nie, znegujeme
0171 F5F0            383    F2OK:   mov     B, A            ; Masku dame do Bcka
                     384            
                     385            ; Pohyb v jednom smere (nevieme v ktorom)
0173 53F01A          386            anl     B, #00011010b  ;-; este ju kozmeticky upravime
0176 E528            387            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0178 55F0            388            anl     A, B            ; tu ju pouzijeme       
017A 7014            389            jnz     F2              ; nasli sme poschodie v tomto smere
                     390            ; Pohyb v opacnom smere (nevieme v ktorom)
017C B23A            391            cpl     UPOld           ;  Znegujem stary posun
017E B23B            392            cpl     DOWNOld         ;  |
0180 E5F0            393            mov     A, B            ;  Znegujeme masku
0182 F4              394            cpl     A               ;  |
0183 F5F0            395            mov     B, A            ;  |
0185 53F01A          396            anl     B, #00011010b  ;-; este ju kozmeticky upravime
0188 E528            397            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
018A 55F0            398            anl     A, B            ; tu ju pouzijeme       
018C 7002            399            jnz     F2              ; nasli sme poschodie v tomto smere
                     400            
VYTAH/ORI]DN'©4                                                                                              PAGE 8

018E 80D3            401            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0190 203A03          402    F2:     jb      UPOld, F2UP     ;   
0193 0201A2          403            jmp     F2DOWN          ;
0196 D220            404    F2UP:   setb    UP              ; rychly pohyb hore
0198 D222            405            setb    FAST            ; 
019A C223            406            clr     SLOW            ;
019C 12049C          407            lcall   WRITEPORTS      ; 
019F 0201AE          408            jmp     UP2           ;-; prejdi do stavu UP2    
01A2 D221            409    F2DOWN: setb    DOWN            ; rychly pohyb hore
01A4 D222            410            setb    FAST            ; 
01A6 C223            411            clr     SLOW            ;
01A8 12049C          412            lcall   WRITEPORTS      ; 
01AB 02020B          413            jmp     DOWN2         ;-; prejdi do stavu UP2    
                     414            
                     415                
01AE                 416    UP2:
                     417 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01AE C22F            418 +1         clr     LEDU            
01B0 C22E            419 +1         clr     LEDD 
01B2 C224            420 +1         clr     FLED1             
01B4 C225            421 +1         clr     FLED2                
01B6 C226            422 +1         clr     FLED3           
01B8 C227            423 +1         clr     FLED4           
01BA D225            424 +1         setb    FLED2
01BC 12049C          425 +1         lcall   WRITEPORTS
01BF 12045F          427    UP2A:   lcall   READPORTS       ; nacitanie dat
01C2 200AFA          428            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
01C5 12045F          429            lcall   READPORTS       ; ak ano, sme z nej uz prec?
01C8 300AFA          430            jnb     MB2, $-3        ;       
01CB D22E            431            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
01CD 12049C          432            lcall   WRITEPORTS      ;
01D0 0201D3          433            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
01D3                 434    UP2_MB2:
01D3 12045F          435            lcall   READPORTS       ; nacitanie dat
01D6 200AFA          436            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
01D9 D22F            437            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
01DB 12049C          438            lcall   WRITEPORTS      ;
01DE E528            439            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
01E0 5408            440            anl     A, #00001000b ;-;
01E2 600A            441            jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
01E4 D223            442            setb    SLOW            ;       Ak ano, spomalme
01E6 C222            443            clr     FAST            ; 
01E8 12049C          444            lcall   WRITEPORTS      ;
01EB 0201EE          445            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
01EE                 446    UP2_MB1:
01EE 12045F          447            lcall   READPORTS       ; nacitanie dat
01F1 2009FA          448            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
01F4 E528            449            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
01F6 5408            450            anl     A, #00001000b ;-;
01F8 7003            451            jnz     U2_MB1C       ;-; Ak nie, chod do stavu UP3
01FA 0202BD          452            ljmp    UP3             ; |
01FD C220            453    U2_MB1C:clr     UP              ; zastav motor
01FF D23A            454            setb    UPOld           ;       (a zalohuj)
0201 C23B            455            clr     DOWNOld         ;       (a zalohuj)
0203 C222            456            clr     FAST            ; 
0205 12049C          457            lcall   WRITEPORTS      ; 
0208 02025E          458            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
VYTAH/ORIXDš'©4                                                                                              PAGE 9

020B                 459    DOWN2:
                     460 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
020B C22F            461 +1         clr     LEDU            
020D C22E            462 +1         clr     LEDD 
020F C224            463 +1         clr     FLED1             
0211 C225            464 +1         clr     FLED2                
0213 C226            465 +1         clr     FLED3           
0215 C227            466 +1         clr     FLED4           
0217 D225            467 +1         setb    FLED2
0219 12049C          468 +1         lcall   WRITEPORTS
021C 12045F          470            lcall   READPORTS       ; nacitanie dat
021F 200AE9          471            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
0222 12045F          472            lcall   READPORTS       ; ak ano, sme z nej uz prec?
0225 300AFA          473            jnb     MB2, $-3        ;       
0228 D22F            474            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
022A 12049C          475            lcall   WRITEPORTS      ;
022D 020230          476            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
0230                 477    DOWN2_MB2:
0230 12045F          478            lcall   READPORTS       ; nacitanie dat
0233 200AFA          479            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0236 D22E            480            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0238 12049C          481            lcall   WRITEPORTS      ;
023B E528            482            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
023D 5402            483            anl     A, #00000010b ;-;
023F 600A            484            jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0241 D223            485            setb    SLOW            ;       Ak ano, spomalme
0243 C222            486            clr     FAST            ; 
0245 12049C          487            lcall   WRITEPORTS      ;
0248 02024B          488            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
024B                 489    DOWN2_MB1:    
024B 12045F          490            lcall   READPORTS       ; nacitanie dat
024E 2009FA          491            jb      MB1, DOWN2_MB1;-; Sme na zastavovacej clonke?
0251 C221            492            clr     DOWN            ; zastav motor
0253 D23B            493            setb    DOWNOld         ;       (a zalohuj)
0255 C23A            494            clr     UPOld           ;       (a zalohuj)
0257 C222            495            clr     FAST            ; 
0259 12049C          496            lcall   WRITEPORTS      ; 
025C 01C7            497            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                     498    
                     499    
                     500    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     501    
025E                 502    FLOOR3:
                     503 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
025E C22F            504 +1         clr     LEDU            
0260 C22E            505 +1         clr     LEDD 
0262 C224            506 +1         clr     FLED1             
0264 C225            507 +1         clr     FLED2                
0266 C226            508 +1         clr     FLED3           
0268 C227            509 +1         clr     FLED4           
026A D226            510 +1         setb    FLED3
026C 12049C          511 +1         lcall   WRITEPORTS
026F 12044E          513            lcall   WAITFORTIMER    ; simulacia TIMERu
0272 12045F          514    F3S:    lcall   READPORTS     ;-; nacitanie dat
0275 C21B            515            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
VYTAH/ORI GD2(©4                                                                                              PAGE 10

0277 12049C          516            lcall   WRITEPORTS      ;
                     517    
027A 7410            518            mov     A, #00010000b ;-; Default predpokladam, ze idem hore (na 4.)
027C 203A01          519            jb      UPOld, F3OK   ;-;   Je to pravda? Naozaj idem hore?
027F F4              520            cpl     A               ;       Ak nie, znegujeme
0280 F5F0            521    F3OK:   mov     B, A            ; Masku dame do Bcka
                     522            
                     523            ; Pohyb v jednom smere (nevieme v ktorom)
0282 53F016          524            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0285 E528            525            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0287 55F0            526            anl     A, B            ; tu ju pouzijeme       
0289 7014            527            jnz     F3              ; nasli sme poschodie v tomto smere
                     528            ; Pohyb v opacnom smere (nevieme v ktorom)
028B B23A            529            cpl     UPOld           ;  Znegujem stary posun
028D B23B            530            cpl     DOWNOld         ;  |
028F E5F0            531            mov     A, B            ;  Znegujeme masku
0291 F4              532            cpl     A               ;  |
0292 F5F0            533            mov     B, A            ;  |
0294 53F016          534            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0297 E528            535            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0299 55F0            536            anl     A, B            ; tu ju pouzijeme       
029B 7002            537            jnz     F3              ; nasli sme poschodie v tomto smere
                     538            
029D 80D3            539            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
029F 203A03          540    F3:     jb      UPOld, F3UP     ;   
02A2 0202B1          541            jmp     F3DOWN          ;
02A5 D220            542    F3UP:   setb    UP              ; rychly pohyb hore
02A7 D222            543            setb    FAST            ; 
02A9 C223            544            clr     SLOW            ;
02AB 12049C          545            lcall   WRITEPORTS      ; 
02AE 0202BD          546            jmp     UP3           ;-; prejdi do stavu UP2    
02B1 D221            547    F3DOWN: setb    DOWN            ; rychly pohyb hore
02B3 D222            548            setb    FAST            ; 
02B5 C223            549            clr     SLOW            ;
02B7 12049C          550            lcall   WRITEPORTS      ; 
02BA 020311          551            jmp     DOWN3         ;-; prejdi do stavu UP2    
                     552    
                     553            
                     554            
                     555            
                     556    ;        mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim
                     557    ;        anl     A, #00010000b ;-;
                     558    ;        jz      F3S           ;-; ak nie, opakuj
                     559    ;        setb    UP              ; rychly pohyb hore
                     560    ;        setb    FAST            ; 
                     561    ;        lcall   WRITEPORTS      ; 
                     562    ;        jmp     UP3           ;-; prejdi do stavu UP3        
02BD                 563    UP3:
                     564 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02BD C22F            565 +1         clr     LEDU            
02BF C22E            566 +1         clr     LEDD 
02C1 C224            567 +1         clr     FLED1             
02C3 C225            568 +1         clr     FLED2                
02C5 C226            569 +1         clr     FLED3           
VYTAH/ORI D~(©4                                                                                              PAGE 11

02C7 C227            570 +1         clr     FLED4           
02C9 D226            571 +1         setb    FLED3
02CB 12049C          572 +1         lcall   WRITEPORTS
02CE 12045F          574    UP3A:   lcall   READPORTS       ; nacitanie dat
02D1 200AFA          575            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
02D4 12045F          576            lcall   READPORTS       ; ak ano, sme z nej uz prec?
02D7 300AFA          577            jnb     MB2, $-3        ;       
02DA D22E            578            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02DC 12049C          579            lcall   WRITEPORTS      ;
02DF 0202E2          580            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
02E2                 581    UP3_MB2:
02E2 12045F          582            lcall   READPORTS       ; nacitanie dat
02E5 200AFA          583            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
02E8 D22F            584            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
02EA 12049C          585            lcall   WRITEPORTS      ;
02ED E528            586            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
02EF 5410            587            anl     A, #00010000b ;-;
02F1 600A            588            jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
02F3 D223            589            setb    SLOW            ;       Ak ano, spomalme
02F5 C222            590            clr     FAST            ; 
02F7 12049C          591            lcall   WRITEPORTS      ;
02FA 0202FD          592            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
02FD                 593    UP3_MB1:
02FD 12045F          594            lcall   READPORTS       ; nacitanie dat
0300 2009FA          595            jb      MB1, UP3_MB1  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0303 C220            596            clr     UP              ; zastav motor
0305 D23A            597            setb    UPOld           ;       (a zalohuj)
0307 C23B            598            clr     DOWNOld         ;       (a zalohuj)
0309 C222            599            clr     FAST            ; 
030B 12049C          600            lcall   WRITEPORTS      ; 
030E 02036D          601            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
0311                 602    DOWN3:
                     603 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0311 C22F            604 +1         clr     LEDU            
0313 C22E            605 +1         clr     LEDD 
0315 C224            606 +1         clr     FLED1             
0317 C225            607 +1         clr     FLED2                
0319 C226            608 +1         clr     FLED3           
031B C227            609 +1         clr     FLED4           
031D D226            610 +1         setb    FLED3
031F 12049C          611 +1         lcall   WRITEPORTS
0322 12045F          613            lcall   READPORTS       ; nacitanie dat
0325 200AE9          614            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
0328 12045F          615            lcall   READPORTS       ; ak ano, sme z nej uz prec?
032B 300AFA          616            jnb     MB2, $-3        ;       
032E D22F            617            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0330 12049C          618            lcall   WRITEPORTS      ;
0333 020336          619            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0336                 620    DOWN3_MB2:
0336 12045F          621            lcall   READPORTS       ; nacitanie dat
0339 200AFA          622            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
033C D22E            623            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
033E 12049C          624            lcall   WRITEPORTS      ;
0341 E528            625            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0343 5404            626            anl     A, #00000100b ;-;
0345 600A            627            jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
VYTAH/ORI DÊ(©4                                                                                              PAGE 12

0347 D223            628            setb    SLOW            ;       Ak ano, spomalme
0349 C222            629            clr     FAST            ; 
034B 12049C          630            lcall   WRITEPORTS      ;
034E 020351          631            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
0351                 632    DOWN3_MB1:    
0351 12045F          633            lcall   READPORTS       ; nacitanie dat
0354 2009FA          634            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
0357 E528            635            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0359 5404            636            anl     A, #00000100b ;-;
035B 7003            637            jnz     D3_MB1C         ; Ak nie, chod do stavu DOWN2
035D 02020B          638            ljmp    DOWN2         ;-; |
0360 C221            639    D3_MB1C:clr     DOWN            ; zastav motor
0362 D23B            640            setb    DOWNOld         ;       (a zalohuj)
0364 C23A            641            clr     UPOld           ;       (a zalohuj)
0366 C222            642            clr     FAST            ; 
0368 12049C          643            lcall   WRITEPORTS      ; 
036B 214F            644            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                     645          
                     646            
                     647    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                     648    
036D                 649    FLOOR4:
                     650 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
036D C22F            651 +1         clr     LEDU            
036F C22E            652 +1         clr     LEDD 
0371 C224            653 +1         clr     FLED1             
0373 C225            654 +1         clr     FLED2                
0375 C226            655 +1         clr     FLED3           
0377 C227            656 +1         clr     FLED4           
0379 D227            657 +1         setb    FLED4
037B 12049C          658 +1         lcall   WRITEPORTS
037E 12044E          660            lcall   WAITFORTIMER    ; simulacia TIMERu
0381 12045F          661    F4S:    lcall   READPORTS     ;-; nacitanie dat
0384 C21C            662            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0386 12049C          663            lcall   WRITEPORTS      ;
0389 E528            664            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco menej ako poschodie na kto
                                                                               rom stojim
038B 540E            665            anl     A, #00001110b ;-;
038D 60F2            666            jz      F4S           ;-; ak nie, opakuj
038F D221            667            setb    DOWN            ; rychly pohyb dole
0391 D222            668            setb    FAST            ;
0393 C223            669            clr     SLOW            ; 
0395 12049C          670            lcall   WRITEPORTS      ; 
0398 02039B          671            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
039B                 672    DOWN4:
                     673 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
039B C22F            674 +1         clr     LEDU            
039D C22E            675 +1         clr     LEDD 
039F C224            676 +1         clr     FLED1             
03A1 C225            677 +1         clr     FLED2                
03A3 C226            678 +1         clr     FLED3           
03A5 C227            679 +1         clr     FLED4           
03A7 D227            680 +1         setb    FLED4
03A9 12049C          681 +1         lcall   WRITEPORTS
03AC 12045F          683            lcall   READPORTS       ; nacitanie dat
VYTAH/ORIDb)©4                                                                                              PAGE 13

03AF 200AE9          684            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
03B2 12045F          685            lcall   READPORTS       ; ak ano, sme z nej uz prec?
03B5 300AFA          686            jnb     MB2, $-3        ;       
03B8 D22F            687            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03BA 12049C          688            lcall   WRITEPORTS      ;
03BD 0203C0          689            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
03C0                 690    DOWN4_MB2:
03C0 12045F          691            lcall   READPORTS       ; nacitanie dat
03C3 200AFA          692            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
03C6 D22E            693            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
03C8 12049C          694            lcall   WRITEPORTS      ;
03CB E528            695            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
03CD 5408            696            anl     A, #00001000b ;-;
03CF 600A            697            jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
03D1 D223            698            setb    SLOW            ;       Ak ano, spomalme
03D3 C222            699            clr     FAST            ; 
03D5 12049C          700            lcall   WRITEPORTS      ;
03D8 0203DB          701            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
03DB                 702    DOWN4_MB1:    
03DB 12045F          703            lcall   READPORTS       ; nacitanie dat
03DE 2009FA          704            jb      MB1, DOWN4_MB1;-; Sme na zastavovacej clonke?
03E1 E528            705            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
03E3 5408            706            anl     A, #00001000b ;-;
03E5 7003            707            jnz     D4_MB1C         ; Ak nie, chod do stavu DOWN3
03E7 020311          708            ljmp    DOWN3         ;-; |
03EA C221            709    D4_MB1C:clr     DOWN            ; zastav motor
03EC D23B            710            setb    DOWNOld         ;       (a zalohuj)
03EE C23A            711            clr     UPOld           ;       (a zalohuj)
03F0 C222            712            clr     FAST            ; 
03F2 12049C          713            lcall   WRITEPORTS      ; 
03F5 415E            714            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                     715                    
                     716      
03F7                 717    ERR_1SPOM_C: 
03F7 C220            718            clr     UP              ; zastav motor
03F9 C221            719            clr     DOWN            ; 
03FB 12049C          720            lcall   WRITEPORTS      ; 
                     721 +1         _BP_
03FE C2B3            722 +1         clr     P3.3
0400 D2AA            723 +1         setb    EX1
0402 00              724 +1         nop
0403 00              725 +1         nop
0404 00              727            nop
0405 00              728            nop 
                     729            
0406                 730    ERR_2SPOM_C: 
0406 C220            731            clr     UP              ; zastav motor
0408 C221            732            clr     DOWN            ; 
040A 12049C          733            lcall   WRITEPORTS      ; 
                     734 +1         _BP_
040D C2B3            735 +1         clr     P3.3
040F D2AA            736 +1         setb    EX1
0411 00              737 +1         nop
0412 00              738 +1         nop
0413 00              740            nop
0414 00              741            nop 
                     742            
0415                 743    ERR_ZAST_C: 
VYTAH/ORI dD                                                                                                  PAGE 14

0415 C220            744            clr     UP              ; zastav motor
0417 C221            745            clr     DOWN            ; 
0419 12049C          746            lcall   WRITEPORTS      ; 
                     747 +1         _BP_
041C C2B3            748 +1         clr     P3.3
041E D2AA            749 +1         setb    EX1
0420 00              750 +1         nop
0421 00              751 +1         nop
0422 00              753            nop
0423 00              754            nop 
                     755            
0424                 756    ERR_SKRD: 
0424 C220            757            clr     UP              ; zastav motor
0426 C221            758            clr     DOWN            ; 
0428 12049C          759            lcall   WRITEPORTS      ; 
                     760 +1         _BP_
042B C2B3            761 +1         clr     P3.3
042D D2AA            762 +1         setb    EX1
042F 00              763 +1         nop
0430 00              764 +1         nop
0431 00              766            nop
0432 00              767            nop    
                     768            
0433                 769    ERR_SKRH: 
0433 C220            770            clr     UP              ; zastav motor
0435 C221            771            clr     DOWN            ; 
0437 12049C          772            lcall   WRITEPORTS      ; 
                     773 +1         _BP_
043A C2B3            774 +1         clr     P3.3
043C D2AA            775 +1         setb    EX1
043E 00              776 +1         nop
043F 00              777 +1         nop
0440 00              779            nop
0441 00              780            nop             
                     781                    
                     782                    
0442                 783    ENDPROG:
0442 D218            784            setb    KS
0444 12049C          785            call    WRITEPORTS                ; zapis novu informaciu
                     786 +1         _BP_
0447 C2B3            787 +1         clr     P3.3
0449 D2AA            788 +1         setb    EX1
044B 00              789 +1         nop
044C 00              790 +1         nop
044D 22              792            ret
                     793    
                     794    
                     795    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     796    ; WAITFORTIMER
                     797    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                     798    ; bude timer)
                     799    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
044E                 800    WAITFORTIMER:
044E D22C            801            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
0450 12049C          802            lcall   WRITEPORTS                  ;
0453 12045F          803    WAIT:   lcall   READPORTS                   ; 
0456 3013F5          804            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0459 C22C            805            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
VYTAH/ORI+D                                                                                                  PAGE 15

045B 12049C          806            lcall   WRITEPORTS
045E 22              807            ret
                     808    
                     809    
                     810    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     811    ; READPORTS
                     812    ; precita nove hodnoty na portoch
                     813    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
045F                 814    READPORTS:
045F 75A080          815            mov     p2, #i8255INA       ; citaj data z portu A
0462 75803F          816            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0465 C2B7            817            clr     RDNOT
0467 00              818            nop
0468 00              819            nop
0469 00              820            nop
046A 00              821            nop
046B 858028          822            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
046E D2B7            823            setb    RDNOT
                     824            
0470 75A081          825            mov     p2, #i8255INB       ; citaj data z portu B
0473 7580FE          826            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0476 C2B7            827            clr     RDNOT
0478 00              828            nop
0479 00              829            nop
047A 00              830            nop
047B 00              831            nop
047C 858021          832            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
047F D2B7            833            setb    RDNOT
                     834    
0481 75A082          835            mov     p2, #i8255INC       ; citaj data z portu C
0484 75803F          836            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0487 C2B7            837            clr     RDNOT
0489 00              838            nop
048A 00              839            nop
048B 00              840            nop
048C 00              841            nop
048D 858022          842            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0490 D2B7            843            setb    RDNOT
                     844            
                     845            
0492 E528            846            mov     A, INPORTA
0494 541E            847            anl     A, #00011110b
0496 4223            848            orl     OUTPORTA, A
0498 12049C          849            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                     850            
049B 22              851            ret
                     852            
                     853    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     854    ; WRITEPORTS
                     855    ; spravi zalohu vystupnych registrov a posle data von
                     856    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
049C                 857    WRITEPORTS:
049C 852380          858            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
049F 75A0C0          859            mov     p2, #i8255OUTA
04A2 C2B6            860            clr     WRNOT
04A4 00              861            nop
04A5 00              862            nop
VYTAH/ORItD                                                                                                  PAGE 16

04A6 00              863            nop
04A7 00              864            nop
04A8 D2B6            865            setb    WRNOT
                     866            
04AA 852480          867            mov     p0, OUTPORTB        ; potom port B
04AD 75A0C1          868            mov     p2, #i8255OUTB
04B0 C2B6            869            clr     WRNOT
04B2 00              870            nop
04B3 00              871            nop
04B4 00              872            nop
04B5 00              873            nop
04B6 D2B6            874            setb    WRNOT
                     875    
04B8 852580          876            mov     p0, OUTPORTC        ; a nakoniec port C
04BB 75A0C2          877            mov     p2, #i8255OUTC
04BE C2B6            878            clr     WRNOT
04C0 00              879            nop
04C1 00              880            nop
04C2 00              881            nop
04C3 00              882            nop
04C4 D2B6            883            setb    WRNOT
                     884            
04C6 22              885            ret
                     886    
                     887    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     888    
04C7 0D0A5269        889    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
04CB 61646961   
04CF 63692073   
04D3 79737465   
04D7 6D206A65   
04DB 20696E69   
04DF 6369616C   
04E3 697A6F76   
04E7 616E792E   
04EB 0D0A00     
04EE 52696164        890    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
04F2 69616369   
04F6 20737973   
04FA 74656D20   
04FE 6A652072   
0502 65696E69   
0506 6369616C   
050A 697A6F76   
050E 616E7920   
0512 706F2073   
0516 746C6163   
051A 656E6920   
051E 746C6163   
0522 69646C61   
0526 2053544F   
052A 502E0D0A   
052E 00         
052F 4B616C69        891    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0533 62726163   
0537 69612076   
053B 79746168   
VYTAH/ORI|D                                                                                                  PAGE 17

053F 75206A65   
0543 20756B6F   
0547 6E63656E   
054B 612E0D0A   
054F 00         
                     892    
----                 893            DSEG
0040                 894            org     40h
0040                 895    STACK:  DS      10h
                     896    
                     897    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 18

B. . . . . . . . . . . . . . . .  D ADDR  00F0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  009EH  
CALIBEND . . . . . . . . . . . .  C ADDR  00B5H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00ADH  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D3_MB1C. . . . . . . . . . . . .  C ADDR  0360H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  03EAH  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  020BH  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  024BH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  0230H  
DOWN3. . . . . . . . . . . . . .  C ADDR  0311H  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  0351H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0336H  
DOWN4. . . . . . . . . . . . . .  C ADDR  039BH  
VYTAH/ORI                                                                                                     PAGE 19

DOWN4_MB1. . . . . . . . . . . .  C ADDR  03DBH  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  03C0H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  NOT USED  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  NOT USED  
ENDPROG. . . . . . . . . . . . .  C ADDR  0442H  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  03F7H  NOT USED  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  0406H  NOT USED  
ERR_SKRD . . . . . . . . . . . .  C ADDR  0424H  NOT USED  
ERR_SKRH . . . . . . . . . . . .  C ADDR  0433H  NOT USED  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  0415H  NOT USED  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1S. . . . . . . . . . . . . . .  C ADDR  00DBH  
F2 . . . . . . . . . . . . . . .  C ADDR  0190H  
F2DOWN . . . . . . . . . . . . .  C ADDR  01A2H  
F2OK . . . . . . . . . . . . . .  C ADDR  0171H  
F2S. . . . . . . . . . . . . . .  C ADDR  0163H  
F2UP . . . . . . . . . . . . . .  C ADDR  0196H  
F3 . . . . . . . . . . . . . . .  C ADDR  029FH  
F3DOWN . . . . . . . . . . . . .  C ADDR  02B1H  
F3OK . . . . . . . . . . . . . .  C ADDR  0280H  
F3S. . . . . . . . . . . . . . .  C ADDR  0272H  
F3UP . . . . . . . . . . . . . .  C ADDR  02A5H  
F4S. . . . . . . . . . . . . . .  C ADDR  0381H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C7H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  014FH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  025EH  
FLOOR4 . . . . . . . . . . . . .  C ADDR  036DH  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C7H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
VYTAH/ORI                                                                                                     PAGE 20

OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  NOT USED  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  NOT USED  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  NOT USED  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  NOT USED  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  NOT USED  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  NOT USED  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  NOT USED  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  NOT USED  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  NOT USED  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  NOT USED  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  045FH  
RESET. . . . . . . . . . . . . .  C ADDR  003BH  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  NOT USED  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  052FH  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  04C7H  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  04EEH  NOT USED  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U2_MB1C. . . . . . . . . . . . .  C ADDR  01FDH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  00F5H  
UP1A . . . . . . . . . . . . . .  C ADDR  0106H  
UP1_MB1. . . . . . . . . . . . .  C ADDR  0135H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  011AH  
UP2. . . . . . . . . . . . . . .  C ADDR  01AEH  
UP2A . . . . . . . . . . . . . .  C ADDR  01BFH  
UP2_MB1. . . . . . . . . . . . .  C ADDR  01EEH  
UP2_MB2. . . . . . . . . . . . .  C ADDR  01D3H  
UP3. . . . . . . . . . . . . . .  C ADDR  02BDH  
UP3A . . . . . . . . . . . . . .  C ADDR  02CEH  
VYTAH/ORI                                                                                                     PAGE 21

UP3_MB1. . . . . . . . . . . . .  C ADDR  02FDH  
UP3_MB2. . . . . . . . . . . . .  C ADDR  02E2H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  0453H  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  044EH  
WRITEPORTS . . . . . . . . . . .  C ADDR  049CH  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
