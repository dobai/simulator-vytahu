DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umo+zni stlacat tlacidla aj ked bezi delay
                       7    
                       8    
                       9    $MOD51
                      10    $DEBUG
                      11    
                =1    12    $include (lift.inc)
                =1    13    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    14    i8255INA        equ     080h
  0081          =1    15    i8255INB        equ     081h
  0082          =1    16    i8255INC        equ     082h
  0083          =1    17    i8255INCW       equ     083h
  00C0          =1    18    i8255OUTA       equ     0c0h
  00C1          =1    19    i8255OUTB       equ     0c1h
  00C2          =1    20    i8255OUTC       equ     0c2h
  00C3          =1    21    i8255OUTCW      equ     0c3h
                =1    22    
  0028          =1    23    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    24    INPORTB         data    21h
  0022          =1    25    INPORTC         data    22h
  0023          =1    26    OUTPORTA        data    23h
  0024          =1    27    OUTPORTB        data    24h
  0025          =1    28    OUTPORTC        data    25h
  0026          =1    29    INPORTBold      data    26h
  0027          =1    30    CTRLREG         data    27h
                =1    31    
  0030          =1    32    POSITION        data    30h
  0031          =1    33    LOWEST          data    31h
  0032          =1    34    HIGHEST         data    32h
  0033          =1    35    STOPTIMER       data    33h
  0034          =1    36    OUTPORTBold     data    34h
                =1    37    
                =1    38    ;----------------
  0036          =1    39    FLOORREQ        data    36h
                =1    40    ;----------------
                =1    41    
  0040          =1    42    STOPNOT         bit     INPORTA.0
  0041          =1    43    PKI1            bit     INPORTA.1
  0042          =1    44    PKI2            bit     INPORTA.2
  0043          =1    45    PKI3            bit     INPORTA.3
  0044          =1    46    PKI4            bit     INPORTA.4
  0045          =1    47    DOORCLSD        bit     INPORTA.5 
                =1    48    
  0009          =1    49    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    50    MB2             bit     INPORTB.2
  000B          =1    51    SKRH            bit     INPORTB.3
  000C          =1    52    SKRD            bit     INPORTB.4
  000D          =1    53    DP              bit     INPORTB.5
  000E          =1    54    DPZK            bit     INPORTB.6
  000F          =1    55    DPK             bit     INPORTB.7
                =1    56    
  0031          =1    57    MB1old          bit     INPORTBold.1
  0032          =1    58    MB2old          bit     INPORTBold.2
DEBUG                                                                                                         PAGE 2

  0033          =1    59    SKRHold         bit     INPORTBold.3
  0034          =1    60    SKRDold         bit     INPORTBold.4
                =1    61    
                =1    62    
                =1    63    
                =1    64    
                =1    65    
  0010          =1    66    PI1             bit     INPORTC.0       
  0011          =1    67    PI2D            bit     INPORTC.1
  0012          =1    68    PI2U            bit     INPORTC.2
  0013          =1    69    PI3D            bit     INPORTC.3
  0014          =1    70    PI3U            bit     INPORTC.4
  0015          =1    71    PI4             bit     INPORTC.5
                =1    72    
                =1    73    
                =1    74    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    75    ; ****************************************************************************
                =1    76    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    77    ; ----------------------------------------------------------------------------
                =1    78    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    79    ; ----------------------------------------------------------------------------
                =1    80    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    81    ; ****************************************************************************
                =1    82    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    83    ; ----------------------------------------------------------------------------
                =1    84    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    85    ; ----------------------------------------------------------------------------
                =1    86    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    87    ; ----------------------------------------------------------------------------
                =1    88    
                =1    89    
  0018          =1    90    KS              bit     OUTPORTA.0
  0019          =1    91    PKO1            bit     OUTPORTA.1
  001A          =1    92    PKO2            bit     OUTPORTA.2
  001B          =1    93    PKO3            bit     OUTPORTA.3
  001C          =1    94    PKO4            bit     OUTPORTA.4
                =1    95    
  0020          =1    96    UP              bit     OUTPORTB.0
  0021          =1    97    DOWN            bit     OUTPORTB.1
  0022          =1    98    FAST            bit     OUTPORTB.2
  0023          =1    99    SLOW            bit     OUTPORTB.3
  0024          =1   100    FLED1           bit     OUTPORTB.4
  0025          =1   101    FLED2           bit     OUTPORTB.5
  0026          =1   102    FLED3           bit     OUTPORTB.6
  0027          =1   103    FLED4           bit     OUTPORTB.7
                =1   104    
  0028          =1   105    PO1             bit     OUTPORTC.0
  0029          =1   106    PO2D            bit     OUTPORTC.1
  002A          =1   107    PO2U            bit     OUTPORTC.2
  002B          =1   108    PO3D            bit     OUTPORTC.3
  002C          =1   109    PO3U            bit     OUTPORTC.4
  002D          =1   110    PO4             bit     OUTPORTC.5
  002E          =1   111    LEDD            bit     OUTPORTC.6
  002F          =1   112    LEDU            bit     OUTPORTC.7
                =1   113    
  0038          =1   114    STOPPED         bit     CTRLREG.0
  0039          =1   115    DOORCLSDold     bit     CTRLREG.1
  003A          =1   116    UPold           bit     CTRLREG.2
DEBUG                                                                                                         PAGE 3

  003B          =1   117    DOWNold         bit     CTRLREG.3
  003C          =1   118    FASTold         bit     CTRLREG.4
  003D          =1   119    SLOWold         bit     CTRLREG.5
                =1   120    
  00B6          =1   121    WRNOT           bit     0b6h        ; p3.6
  00B7          =1   122    RDNOT           bit     0b7h        ; p3.7
                =1   123    
                =1   124    ; bitove masky
                =1   125    ; 8255OUT 
                =1   126    ; port A
  0001          =1   127    bmKS              equ    00000001b
  0002          =1   128    bmPKO1            equ    00000010b
  0004          =1   129    bmPKO2            equ    00000100b
  0008          =1   130    bmPKO3            equ    00001000b
  0010          =1   131    bmPKO4            equ    00010000b
                =1   132    
                =1   133    ; port B
  0001          =1   134    bmUP              equ    00000001b
  0002          =1   135    bmDOWN            equ    00000010b
  0004          =1   136    bmFAST            equ    00000100b
  0008          =1   137    bmSLOW            equ    00001000b
  0010          =1   138    bmFLED1           equ    00010000b
  0020          =1   139    bmFLED2           equ    00100000b
  0040          =1   140    bmFLED3           equ    01000000b
  0080          =1   141    bmFLED4           equ    10000000b
                =1   142    
                =1   143    ; port C
  0001          =1   144    bmPO1             equ    00000001b
  0002          =1   145    bmPO2D            equ    00000010b
  0004          =1   146    bmPO2U            equ    00000100b
  0008          =1   147    bmPO3D            equ    00001000b
  0010          =1   148    bmPO3U            equ    00010000b
  0020          =1   149    bmPO4             equ    00100000b
  0040          =1   150    bmLEDD            equ    01000000b
  0080          =1   151    bmLEDU            equ    10000000b
                =1   152    
                =1   153    ; 8255IN
                =1   154    ; port A
  0001          =1   155    bmSTOP            equ    00000001b
  0002          =1   156    bmPKI1            equ    00000010b
  0004          =1   157    bmPKI2            equ    00000100b
  0008          =1   158    bmPKI3            equ    00001000b
  0010          =1   159    bmPKI4            equ    00010000b
  0020          =1   160    bmDOORCLSD        equ    00100000b
                =1   161    
                =1   162    ; port B
  0002          =1   163    bmMB1I            equ    00000010b
  0004          =1   164    bmMB2I            equ    00000100b
  0008          =1   165    bmSKRHI           equ    00001000b
  0010          =1   166    bmSKRHD           equ    00010000b
  0020          =1   167    bmDPI             equ    00100000b
  0040          =1   168    bmDPZKI           equ    01000000b
  0080          =1   169    bmDPKI            equ    10000000b
                =1   170    
                =1   171    ; port C
  0001          =1   172    bmPI1             equ    00000001b
  0002          =1   173    bmPI2D            equ    00000010b
  0004          =1   174    bmPI2U            equ    00000100b
DEBUG                                                                                                         PAGE 4

  0008          =1   175    bmPI3D            equ    00001000b
  0010          =1   176    bmPI3U            equ    00010000b
  0020          =1   177    bmPI4             equ    00100000b
                =1   178    
                =1   179    ; Sachta - masky
  003E          =1   180    bmSmerPI1U            equ    00111110b
  0001          =1   181    bmSmerPI2D            equ    00000001b
  0038          =1   182    bmSmerPI2U            equ    00111000b
  0007          =1   183    bmSmerPI3D            equ    00000111b
  0020          =1   184    bmSmerPI3U            equ    00100000b
  001F          =1   185    bmSmerPI4D            equ    00011111b
                =1   186    
                =1   187    ; Kabina - masky
  001C          =1   188    bmSmerPKI1U           equ    00011100b
  0002          =1   189    bmSmerPKI2D           equ    00000010b
  0018          =1   190    bmSmerPKI2U           equ    00011000b
  0006          =1   191    bmSmerPKI3D           equ    00000110b
  0010          =1   192    bmSmerPKI3U           equ    00010000b
  000E          =1   193    bmSmerPKI4D           equ    00001110b
                     194    
                     195    _BP_    MACRO 
                     196            clr     P3.3
                     197            setb    EX1
                     198            nop
                     199            nop
                     200    ENDM
                     201    
                     202    LJZ     MACRO   NAVESTIE
                     203            jnz     $+5
                     204            ljmp    NAVESTIE
                     205            nop
                     206    ENDM
                     207    
                     208    LJNZ    MACRO   NAVESTIE
                     209            jz      $+5
                     210            ljmp    NAVESTIE
                     211            nop
                     212    ENDM
                     213    
                     214    LJB     MACRO   TESTBIT, NAVESTIE
                     215            jnb     TESTBIT, $+6
                     216            ljmp    NAVESTIE
                     217            nop
                     218    ENDM
                     219    
                     220    LJNB    MACRO   TESTBIT, NAVESTIE
                     221            jb      TESTBIT, $+6
                     222            ljmp    NAVESTIE
                     223            nop
                     224    ENDM
                     225    
                     226    CJE     MACRO   OP1, OP2, NAVESTIE
                     227            cjne    OP1, OP2, $+7
                     228            jmp    NAVESTIE
                     229            nop
                     230    ENDM
                     231    
                     232    LCJNE   MACRO   OP1, OP2, NAVESTIE
DEBUG                                                                                                         PAGE 5

                     233            cjne    OP1, OP2, $+6
                     234            jmp     $+6
                     235            ljmp    NAVESTIE
                     236            nop
                     237    ENDM
                     238    
                     239    ZAKMITC MACRO   TYPCLONKY
                     240            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     241            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     242            jnb     TYPCLONKY, $-3  ; 
                     243            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     244    ENDM
                     245    
                     246    ZASTAV  MACRO  C_POSCH, SMER
                     247                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     248            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     249            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     250            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     251            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
                     252            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
                     253            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     254            orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
                     255            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     256    ENDM
                     257    
                     258    NAJNIZSIE  MACRO
                     259            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     260            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     261            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     262            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     263     ; LL1: 
                     264            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     265            clr     C               ; Inak shiftnem o 2
                     266            rlc     A               ;
                     267            clr     C               ;
                     268            rlc     A               ;
                     269            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     270    ; LL2:
                     271            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     272    ENDM
                     273    
                     274    NAJVYSSIE  MACRO
                     275            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     276            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
DEBUG                                                                                                         PAGE 6

                     277            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     278            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     279     ; LL1: 
                     280            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     281            clr     C               ; Inak shiftnem o 2
                     282            rrc     A               ;
                     283            clr     C               ;
                     284            rrc     A               ;
                     285            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     286    ; LL2:
                     287            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     288            clr     C               ;
                     289            subb    A, R0           ;
                     290    ENDM
                     291    
                     292    VYSSIE_KABINA  MACRO  POSCH
                     293            mov     A, INPORTA
                     294            anl     A, #00011110b
                     295            clr     C
                     296            rrc     A
                     297    ;LL1    
                     298            mov     R0, #&POSCH
                     299            clr     C
                     300            rrc     A
                     301            djnz    R0, $-2;LL1
                     302    ENDM
                     303    
                     304    NIZSIE_KABINA  MACRO  POSCH
                     305            mov     A, #5
                     306            clr     C
                     307            subb    A, #&POSCH
                     308            mov     R0, A
                     309            mov     A, INPORTA
                     310            anl     A, #00011110b
                     311            clr     C
                     312            rlc     A
                     313            clr     C
                     314            rlc     A
                     315            clr     C
                     316            rlc     A
                     317    ;LL1   
                     318            clr     C
                     319            rlc     A
                     320            djnz    R0, $-2;LL1
                     321    ENDM
                     322    
                     323    POLOHA_LED  MACRO  POLOHA
                     324            clr     LEDU            
                     325            clr     LEDD 
                     326            clr     FLED1             
                     327            clr     FLED2                
                     328            clr     FLED3           
                     329            clr     FLED4           
                     330            setb    FLED&POLOHA
                     331            lcall   WRITEPORTS
DEBUG                                                                                                         PAGE 7

                     332    ENDM
                     333    
                     334    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               335    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     336                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     337                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     338    ;osetrenie vektorov preruseni
0000                 339            org     0000h           ; adresa odkial startuje program po resete
0000 020033          340            ljmp    START           ; skok na zaciatok kodu programu
                     341            
000B                 342            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 02083D          343            ljmp    INT_TIMER0      ; pre citac T0
                     344                  
0033                 345            org     0033h           ; od tejto adresy sa zacina kod programu
                     346            
0033                 347    START:
0033                 348    RESET:  
                     349            ; riadiace signaly do pasivnej urovne 
0033 D2B6            350            setb    WRNOT
0035 D2B7            351            setb    RDNOT
0037 753300          352            mov     STOPTIMER, #0
003A 758140          353            mov     SP, #STACK
                     354    
                     355            ; pockame si na inicializaciu obvodov 8255  
003D 7900            356            mov     R1, #0 
003F 7AFF            357            mov     R2, #0ffh
0041 D9FE            358            djnz    R1, $
0043 DAFC            359            djnz    R2, $-2
                     360            
                     361            ; teraz ich mozeme nastavit
0045 75809B          362            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          363            mov     p2, #i8255INCW
004B C2B6            364            clr     WRNOT
004D 00              365            nop
004E 00              366            nop
004F 00              367            nop
0050 00              368            nop
0051 D2B6            369            setb    WRNOT
0053 758080          370            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          371            mov     p2, #i8255OUTCW
0059 C2B6            372            clr     WRNOT
005B 00              373            nop
005C 00              374            nop
005D 00              375            nop
005E 00              376            nop
005F D2B6            377            setb    WRNOT
                     378            
                     379            ;_BP_
                     380            
                     381            ;-----------------------
                     382            ; Prerusenia
                     383            ;----------------------- 
                     384            ;clr     TR1                 ; zastavi sa citac T1
                     385            ;clr     TR0                 ; a tiez citac T0
                     386            ;mov     SCON,#01010010b     ; nastavenie registra SCON
                     387            ;                            ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
DEBUG                                                                                                         PAGE 8

                     388            ;                            ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     389            ;                            ; RI=0 (prijimaci register - nebol prijaty znak)
                     390            ;mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
                     391            ;mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     392            ;                            ; T1: mod 2 - po preteceni sa TL nastavi na hodnotu TH
                                                                               
                     393            ;                            ; GATE=0 (programove riadenie casovaca)
                     394            ;                            ; C/T#=0 interne hodiny/12
                     395            ;                            ; T0: mod 1 - 16 bitove pocitadlo
                     396            ;                            ; GATE=0 (programove riadenie casovaca)
                     397            ;                            ; C/T#=0 interne hodiny/12
                     398            ;mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila preno
                                                                               sova rychlost seriovej linky
                     399            ;mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
                     400            ;mov     TH1,#TIMERCONST     ; 
                     401            ;mov     TL0, #0D2h           ; inicializacia casovaca T0 65409,92(- 57600 = 0e100h 
                                                                               - to bolo)
                     402            ;mov     TH0, #0FFh
                     403    
                     404            ;setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     405            ;_BP_
                     406    
                     407    ;       ;setb    EX0                 ; prerusenie INT0  - ostava zakazane, signal STOP osetr
                                                                               ime priamo v hlavnej slucke
                     408    ;       ;setb    ES                  ; prerusenie seriovej linky teraz nevyuzivame
                     409            ;setb    ET0                 ; povolime prerusenia od casovaca T0
                     410            ;setb    TR0
                     411            ;setb    EA                  ; spust cely prerusovaci mechanizmus
                     412            
0061 758801          413            mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
0064 758911          414            mov     TMOD,#00010001b     ; nastavenie TMOD registra
                     415                                        ; T1: mod 1 - 16 bitove pocitadlo
                     416                                        ; GATE=0 (programove riadenie casovaca)
                     417                                        ; C/T#=0 interne hodiny/12
                     418                                        ; T0: mod 1 - 16 bitove pocitadlo
                     419                                        ; GATE=0 (programove riadenie casovaca)
                     420                                        ; C/T#=0 interne hodiny/12
0067 758700          421            mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila prenos
                                                                               ova rychlost seriovej linky
006A 758A00          422            mov     TL0, #000h           ; inicializacia casovaca T0 - 57600 = 0e100h
006D 758C4C          423            mov     TH0, #04Ch
                     424            
0070 D28C            425            setb    TR0
                     426            
                     427            ;-----------------------
                     428            ; Prerusenia
                     429            ;-----------------------
                     430            
                     431    
                     432            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0072 752800          433            mov     INPORTA, #0
0075 75211E          434            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0078 752200          435            mov     INPORTC, #0
007B 75231E          436            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
007E 7524F0          437            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0081 7525FF          438            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0084 D218            439            setb    KS
DEBUG                                                                                                         PAGE 9

0086 C238            440            clr     STOPPED
0088 120925          441            call    WRITEPORTS          ; zapis novu informaciu
                     442    ;;;;;;;;
                     443    
008B 752300          444            mov     OUTPORTA, #0
008E 752400          445            mov     OUTPORTB, #0
0091 752500          446            mov     OUTPORTC, #0
0094 120925          447            call    WRITEPORTS          ; zapis novu informaciu
                     448    
0097 752800          449            mov     INPORTA, #0
009A 752100          450            mov     INPORTB, #0         
009D 752200          451            mov     INPORTC, #0
00A0 1208CA          452            call    READPORTS           ; prvotne nacitanie udajov
                     453 +1         _BP_
00A3 C2B3            454 +1         clr     P3.3
00A5 D2AA            455 +1         setb    EX1
00A7 00              456 +1         nop
00A8 00              457 +1         nop
00A9                 459    CALIB:
                     460            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     461            ;mov     R6, #20
                     462            ;setb    ET0
00A9 1208CA          463            lcall   READPORTS                   ; precitaj, co je na portoch
00AC 300C13          464            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00AF D221            465            setb    DOWN                        ; inak pod dole
00B1 D222            466            setb    FAST                        ; a rychlo
00B3 C223            467            clr     SLOW                        ;
00B5 C220            468            clr     UP
00B7 120925          469            lcall   WRITEPORTS                  ; zapis informaciu 
00BA                 470    CALIBLOOP:
00BA 1208CA          471            lcall   READPORTS                   ; 
00BD 300C02          472            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00C0 80F8            473            jmp     CALIBLOOP
00C2                 474    CALIBEND:                              
00C2 C222            475            clr     FAST                        ; zastavime v tomto smere
00C4 C221            476            clr     DOWN                        ;
00C6 D223            477            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00C8 D220            478            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00CA 120925          479            lcall   WRITEPORTS 
00CD                 480    CALIBEND2:
00CD 1208CA          481            lcall   READPORTS                   ; 
00D0 2009FA          482            jb      MB1, CALIBEND2              ; 
00D3 C223            483            clr     SLOW                        ; A teraz sme uz naozaj spravne
00D5 C220            484            clr     UP                          ; 
00D7 D224            485            setb    FLED1
00D9 120925          486            lcall   WRITEPORTS                  ; zapis informaciu
                     487            ;clr     ET0
                     488    ;        _BP_
00DC                 489    MAIN:
                     490    
                     491    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     492    ; ****************************************************************************
                     493    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     494    ; ----------------------------------------------------------------------------
                     495    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     496    ; ----------------------------------------------------------------------------
DEBUG                                                                                                         PAGE 10

                     497    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     498    ; ****************************************************************************
                     499    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     500    ; ----------------------------------------------------------------------------
                     501    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     502    ; ----------------------------------------------------------------------------
                     503    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     504    ; ****************************************************************************
                     505    ; POSITION
                     506    ; ****************************************************************************
                     507    
                     508    
                     509    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     510    
00DC                 511    FLOOR1:
                     512 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00DC C22F            513 +1         clr     LEDU            
00DE C22E            514 +1         clr     LEDD 
00E0 C224            515 +1         clr     FLED1             
00E2 C225            516 +1         clr     FLED2                
00E4 C226            517 +1         clr     FLED3           
00E6 C227            518 +1         clr     FLED4           
00E8 D224            519 +1         setb    FLED1
00EA 120925          520 +1         lcall   WRITEPORTS
00ED 120886          522            lcall   WAITFORTIMER    ; simulacia TIMERu
00F0 1208CA          523    F1S:    lcall   READPORTS     ;-; nacitanie dat
00F3 C219            524            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00F5 C228            525            clr     PO1             ;
00F7 120925          526            lcall   WRITEPORTS      ;
00FA 200FF3          527            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
00FD E528            528            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
00FF 541C            529            anl     A, #00011100b ;-;
0101 7008            530            jnz     F1OK          ;-; ak ano, podme na to
0103 E522            531            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
0105 543E            532            anl     A, #00111110b ;-;
0107 7002            533            jnz     F1OK          ;-; ak ano, podme na to
0109 80E5            534            jmp     F1S             ; Nemam sa kde hnut, opakujem
010B D220            535    F1OK:   setb    UP              ; rychly pohyb hore
010D D222            536            setb    FAST            ; 
010F C223            537            clr     SLOW            ;
0111 120925          538            lcall   WRITEPORTS      ; 
0114 020117          539            jmp     UP1           ;-; prejdi do stavu UP1
0117                 540    UP1:
                     541 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0117 C22F            542 +1         clr     LEDU            
0119 C22E            543 +1         clr     LEDD 
011B C224            544 +1         clr     FLED1             
011D C225            545 +1         clr     FLED2                
011F C226            546 +1         clr     FLED3           
0121 C227            547 +1         clr     FLED4           
0123 D224            548 +1         setb    FLED1
0125 120925          549 +1         lcall   WRITEPORTS
                     551 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
DEBUG                                                                                                         PAGE 11

0128 120851          552 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
012B 1208CA          553 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
012E 3009FA          554 +1         jnb     MB1, $-3  ; 
0131 120851          555 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0134 1208CA          557    UP1A:   lcall   READPORTS       ; nacitanie dat
                     558 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0137 200B03          559 +1         jb      SKRH, $+6
013A 0207F5          560 +1         ljmp    ERR_SKRH
013D 00              561 +1         nop
                     563 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
013E 200903          564 +1         jb      MB1, $+6
0141 0207E0          565 +1         ljmp    ERR_2SPOM_C
0144 00              566 +1         nop
0145 200AEC          568            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     569 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0148 120851          570 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
014B 1208CA          571 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
014E 300AFA          572 +1         jnb     MB2, $-3  ; 
0151 120851          573 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0154 D22E            575            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0156 120925          576            lcall   WRITEPORTS      ;
0159 02015C          577            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
015C                 578    UP1_MB2:
015C 1208CA          579            lcall   READPORTS       ; nacitanie dat
                     580 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
015F 200B03          581 +1         jb      SKRH, $+6
0162 0207F5          582 +1         ljmp    ERR_SKRH
0165 00              583 +1         nop
                     585 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0166 200903          586 +1         jb      MB1, $+6
0169 0207D1          587 +1         ljmp    ERR_1SPOM_C
016C 00              588 +1         nop
016D 200AEC          590            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0170 D22F            591            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0172 120925          592            lcall   WRITEPORTS      ;   
                     593 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0175 120851          594 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0178 1208CA          595 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
017B 300AFA          596 +1         jnb     MB2, $-3  ; 
017E 120851          597 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     599    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     600    ;        anl     A, #00000100b ;-;
                     601    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     602 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     603 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0181 C3              604 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0182 7400            605 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0184 7212            606 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0186 B00E            607 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0188 7242            608 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
DEBUG                                                                                                         PAGE 12

018A 720F            609 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
018C 7238            610 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
018E 3400            611 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0190 702E            613            jnz     U1_MB2C       ;-; Ak ano, zastav
                     614 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
0192 E522            615 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0194 33              616 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0195 547E            617 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0197 7805            618 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     619 +1  ; LL1: 
0199 6006            620 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
019B C3              621 +1         clr     C               ; Inak shiftnem o 2
019C 13              622 +1         rrc     A               ;
019D C3              623 +1         clr     C               ;
019E 13              624 +1         rrc     A               ;
019F D8F8            625 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     626 +1 ; LL2:
01A1 7405            627 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
01A3 C3              628 +1         clr     C               ;
01A4 98              629 +1         subb    A, R0           ;
                     631 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
01A5 B40203          632 +1         cjne    A, #2, $+6
01A8 0201AE          633 +1         jmp     $+6
01AB 0201CA          634 +1         ljmp    UP1_MB1
01AE 00              635 +1         nop
                     637 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
01AF E528            638 +1         mov     A, INPORTA
01B1 541E            639 +1         anl     A, #00011110b
01B3 C3              640 +1         clr     C
01B4 13              641 +1         rrc     A
                     642 +1 ;LL1    
01B5 7802            643 +1         mov     R0, #2
01B7 C3              644 +1         clr     C
01B8 13              645 +1         rrc     A
01B9 D8FC            646 +1         djnz    R0, $-2;LL1
01BB 6003            648            jz      U1_MB2C         ; |   ak neni zastavujem         
01BD 0201CA          649            jmp     UP1_MB1          ; |   inak nezastavim        
01C0 D223            650    U1_MB2C:setb    SLOW            ;       Ak ano, spomalme
01C2 C222            651            clr     FAST            ; 
01C4 120925          652            lcall   WRITEPORTS      ;         
01C7 0201CA          653            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
01CA                 654    UP1_MB1:
01CA 1208CA          655            lcall   READPORTS       ; nacitanie dat
                     656 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01CD 200B03          657 +1         jb      SKRH, $+6
01D0 0207F5          658 +1         ljmp    ERR_SKRH
DEBUG                                                                                                         PAGE 13

01D3 00              659 +1         nop
                     661 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
01D4 200A03          662 +1         jb      MB2, $+6
01D7 0207EF          663 +1         ljmp    ERR_ZAST_C
01DA 00              664 +1         nop
01DB 2009EC          666            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     667    
                     668 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     669 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
01DE C3              670 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
01DF 7400            671 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
01E1 7212            672 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
01E3 B00E            673 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
01E5 7242            674 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
01E7 720F            675 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
01E9 7238            676 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
01EB 3400            677 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01ED C238            679            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
01EF 702E            680            jnz     U1_MB1C       ;-; Ak ano, zastav
                     681 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01F1 E522            682 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01F3 33              683 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01F4 547E            684 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
01F6 7805            685 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     686 +1  ; LL1: 
01F8 6006            687 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
01FA C3              688 +1         clr     C               ; Inak shiftnem o 2
01FB 13              689 +1         rrc     A               ;
01FC C3              690 +1         clr     C               ;
01FD 13              691 +1         rrc     A               ;
01FE D8F8            692 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     693 +1 ; LL2:
0200 7405            694 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0202 C3              695 +1         clr     C               ;
0203 98              696 +1         subb    A, R0           ;
                     698 +1         LCJNE   A, #2, UP2      ; |   ak nie, nezastavujeme 
0204 B40203          699 +1         cjne    A, #2, $+6
0207 02020D          700 +1         jmp     $+6
020A 0202A9          701 +1         ljmp    UP2
020D 00              702 +1         nop
                     704 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
020E E528            705 +1         mov     A, INPORTA
DEBUG                                                                                                         PAGE 14

0210 541E            706 +1         anl     A, #00011110b
0212 C3              707 +1         clr     C
0213 13              708 +1         rrc     A
                     709 +1 ;LL1    
0214 7802            710 +1         mov     R0, #2
0216 C3              711 +1         clr     C
0217 13              712 +1         rrc     A
0218 D8FC            713 +1         djnz    R0, $-2;LL1
021A 6003            715            jz      U1_MB1C         ; |   ak neni zastavujem         
021C 0202A9          716            ljmp    UP2             ; |   inak nezastavim        
021F C220            717    U1_MB1C:clr     UP              ; zastav motor
0221 D23A            718            setb    UPOld           ;       (a zalohuj) 
0223 C23B            719            clr     DOWNOld         ;       (a zalohuj)
0225 C222            720            clr     FAST            ; 
0227 120925          721            lcall   WRITEPORTS      ; 
022A 02022D          722            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     723    
                     724    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     725    
022D                 726    FLOOR2:
                     727 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
022D C22F            728 +1         clr     LEDU            
022F C22E            729 +1         clr     LEDD 
0231 C224            730 +1         clr     FLED1             
0233 C225            731 +1         clr     FLED2                
0235 C226            732 +1         clr     FLED3           
0237 C227            733 +1         clr     FLED4           
0239 D225            734 +1         setb    FLED2
023B 120925          735 +1         lcall   WRITEPORTS
023E 120886          737            lcall   WAITFORTIMER    ; simulacia TIMERu
0241 1208CA          738    F2S:    lcall   READPORTS     ;-; nacitanie dat
0244 C21A            739            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0246 C22A            740            clr     PO2U            ;
0248 C229            741            clr     PO2D            ;
024A 120925          742            lcall   WRITEPORTS      ;
024D 200FF1          743            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0250 79F8            744            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0252 7AF8            745            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
0254 203A06          746            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0257 E9              747            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0258 F4              748            cpl     A               ;       |
0259 F9              749            mov     R1, A           ;       |
025A EA              750            mov     A, R2           ;       A znegujeme aj masku sachty
025B F4              751            cpl     A               ;       |
025C FA              752            mov     R2, A           ;       |
025D                 753    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
025D E528            754            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
025F 541A            755            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0261 59              756            anl     A, R1           ;  | 
0262 7027            757            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     758                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0264 E528            759            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
DEBUG                                                                                                         PAGE 15

0266 541A            760            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0268 7007            761            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
026A E522            762            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
026C 5439            763            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
026E 5A              764            anl     A, R2           ;  |   
026F 701A            765            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     766            ; Pohyb v opacnom smere (nevieme v ktorom)
0271 B23A            767    F2SW:   cpl     UPOld           ;  Znegujem stary posun
0273 B23B            768            cpl     DOWNOld         ;  |
0275 E9              769            mov     A, R1           ;  Znegujeme masky
0276 F4              770            cpl     A               ;  |
0277 F9              771            mov     R1, A           ;  |
0278 EA              772            mov     A, R2           ;  |
0279 F4              773            cpl     A               ;  |
027A FA              774            mov     R2, A           ;  |               
027B E528            775            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
027D 541A            776            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
027F 59              777            anl     A, R1           ;  | 
0280 7009            778            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0282 E522            779            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0284 5439            780            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0286 5A              781            anl     A, R2           ;  | 
0287 7002            782            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0289 80B6            783            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
028B 203A03          784    F2:     jb      UPOld, F2UP     ;   
028E 02029D          785            jmp     F2DOWN          ;
0291 D220            786    F2UP:   setb    UP              ; rychly pohyb hore
0293 D222            787            setb    FAST            ; 
0295 C223            788            clr     SLOW            ;
0297 120925          789            lcall   WRITEPORTS      ; 
029A 0202A9          790            jmp     UP2           ;-; prejdi do stavu UP2    
029D D221            791    F2DOWN: setb    DOWN            ; rychly pohyb hore
029F D222            792            setb    FAST            ; 
02A1 C223            793            clr     SLOW            ;
02A3 120925          794            lcall   WRITEPORTS      ; 
02A6 0203BF          795            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     796            
                     797                
02A9                 798    UP2:
                     799 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02A9 C22F            800 +1         clr     LEDU            
02AB C22E            801 +1         clr     LEDD 
02AD C224            802 +1         clr     FLED1             
02AF C225            803 +1         clr     FLED2                
02B1 C226            804 +1         clr     FLED3           
02B3 C227            805 +1         clr     FLED4           
02B5 D225            806 +1         setb    FLED2
02B7 120925          807 +1         lcall   WRITEPORTS
                     809 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02BA 120851          810 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02BD 1208CA          811 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02C0 3009FA          812 +1         jnb     MB1, $-3  ; 
02C3 120851          813 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
DEBUG                                                                                                         PAGE 16

02C6 1208CA          815    UP2A:   lcall   READPORTS       ; nacitanie dat
                     816 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02C9 200B03          817 +1         jb      SKRH, $+6
02CC 0207F5          818 +1         ljmp    ERR_SKRH
02CF 00              819 +1         nop
                     821 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02D0 200903          822 +1         jb      MB1, $+6
02D3 0207E0          823 +1         ljmp    ERR_2SPOM_C
02D6 00              824 +1         nop
02D7 200AEC          826            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     827 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02DA 120851          828 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02DD 1208CA          829 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02E0 300AFA          830 +1         jnb     MB2, $-3  ; 
02E3 120851          831 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02E6 D22E            833            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02E8 120925          834            lcall   WRITEPORTS      ;
02EB 0202EE          835            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
02EE                 836    UP2_MB2:
02EE 1208CA          837            lcall   READPORTS       ; nacitanie dat
                     838 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02F1 200B03          839 +1         jb      SKRH, $+6
02F4 0207F5          840 +1         ljmp    ERR_SKRH
02F7 00              841 +1         nop
                     843 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02F8 200903          844 +1         jb      MB1, $+6
02FB 0207D1          845 +1         ljmp    ERR_1SPOM_C
02FE 00              846 +1         nop
02FF 200AEC          848            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0302 D22F            849            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0304 120925          850            lcall   WRITEPORTS      ;
                     851 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0307 120851          852 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
030A 1208CA          853 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
030D 300AFA          854 +1         jnb     MB2, $-3  ; 
0310 120851          855 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     857    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     858    ;        anl     A, #00001000b ;-;
                     859    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                     860 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     861 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0313 C3              862 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0314 7400            863 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0316 7214            864 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0318 B00E            865 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
031A 7243            866 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
031C 720F            867 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
031E 7238            868 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0320 3400            869 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
DEBUG                                                                                                         PAGE 17

                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0322 702E            871            jnz     U2_MB2C       ;-; Ak ano, zastav
                     872 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0324 E522            873 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0326 33              874 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0327 547E            875 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0329 7805            876 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     877 +1  ; LL1: 
032B 6006            878 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
032D C3              879 +1         clr     C               ; Inak shiftnem o 2
032E 13              880 +1         rrc     A               ;
032F C3              881 +1         clr     C               ;
0330 13              882 +1         rrc     A               ;
0331 D8F8            883 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     884 +1 ; LL2:
0333 7405            885 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0335 C3              886 +1         clr     C               ;
0336 98              887 +1         subb    A, R0           ;
                     889 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
0337 B40303          890 +1         cjne    A, #3, $+6
033A 020340          891 +1         jmp     $+6
033D 02035C          892 +1         ljmp    UP2_MB1
0340 00              893 +1         nop
                     895 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0341 E528            896 +1         mov     A, INPORTA
0343 541E            897 +1         anl     A, #00011110b
0345 C3              898 +1         clr     C
0346 13              899 +1         rrc     A
                     900 +1 ;LL1    
0347 7803            901 +1         mov     R0, #3
0349 C3              902 +1         clr     C
034A 13              903 +1         rrc     A
034B D8FC            904 +1         djnz    R0, $-2;LL1
034D 6003            906            jz      U2_MB2C         ; |   ak neni zastavujem  
034F 02035C          907            ljmp    UP2_MB1         ; |   inak nezastavim
0352 D223            908    U2_MB2C:setb    SLOW            ;       Ak ano, spomalme
0354 C222            909            clr     FAST            ; 
0356 120925          910            lcall   WRITEPORTS      ;
0359 02035C          911            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
035C                 912    UP2_MB1:
035C 1208CA          913            lcall   READPORTS       ; nacitanie dat
                     914 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
035F 200B03          915 +1         jb      SKRH, $+6
0362 0207F5          916 +1         ljmp    ERR_SKRH
0365 00              917 +1         nop
                     919 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0366 200A03          920 +1         jb      MB2, $+6
0369 0207EF          921 +1         ljmp    ERR_ZAST_C
DEBUG                                                                                                         PAGE 18

036C 00              922 +1         nop
036D 2009EC          924            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     925            
                     926 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     927 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0370 C3              928 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0371 7400            929 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0373 7214            930 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0375 B00E            931 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0377 7243            932 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0379 720F            933 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
037B 7238            934 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
037D 3400            935 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
037F C238            937            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0381 702E            938            jnz     U2_MB1C       ;-; Ak ano, zastav
                     939 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0383 E522            940 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0385 33              941 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0386 547E            942 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0388 7805            943 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     944 +1  ; LL1: 
038A 6006            945 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
038C C3              946 +1         clr     C               ; Inak shiftnem o 2
038D 13              947 +1         rrc     A               ;
038E C3              948 +1         clr     C               ;
038F 13              949 +1         rrc     A               ;
0390 D8F8            950 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     951 +1 ; LL2:
0392 7405            952 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0394 C3              953 +1         clr     C               ;
0395 98              954 +1         subb    A, R0           ;
                     956 +1         LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
0396 B40303          957 +1         cjne    A, #3, $+6
0399 02039F          958 +1         jmp     $+6
039C 0204C9          959 +1         ljmp    UP3
039F 00              960 +1         nop
                     962 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
03A0 E528            963 +1         mov     A, INPORTA
03A2 541E            964 +1         anl     A, #00011110b
03A4 C3              965 +1         clr     C
03A5 13              966 +1         rrc     A
                     967 +1 ;LL1    
03A6 7803            968 +1         mov     R0, #3
DEBUG                                                                                                         PAGE 19

03A8 C3              969 +1         clr     C
03A9 13              970 +1         rrc     A
03AA D8FC            971 +1         djnz    R0, $-2;LL1
03AC 6003            973            jz      U2_MB1C         ; |   ak neni zastavujem  
03AE 0204C9          974            ljmp    UP3             ; |   inak nezastavim
03B1 C220            975    U2_MB1C:clr     UP              ; zastav motor
03B3 D23A            976            setb    UPOld           ;       (a zalohuj)
03B5 C23B            977            clr     DOWNOld         ;       (a zalohuj)
03B7 C222            978            clr     FAST            ; 
03B9 120925          979            lcall   WRITEPORTS      ; 
03BC 02044D          980            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
03BF                 981    DOWN2:
                     982 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03BF C22F            983 +1         clr     LEDU            
03C1 C22E            984 +1         clr     LEDD 
03C3 C224            985 +1         clr     FLED1             
03C5 C225            986 +1         clr     FLED2                
03C7 C226            987 +1         clr     FLED3           
03C9 C227            988 +1         clr     FLED4           
03CB D225            989 +1         setb    FLED2
03CD 120925          990 +1         lcall   WRITEPORTS
                     992 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03D0 120851          993 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03D3 1208CA          994 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03D6 3009FA          995 +1         jnb     MB1, $-3  ; 
03D9 120851          996 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03DC 1208CA          998            lcall   READPORTS       ; nacitanie dat
                     999 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03DF 200C03         1000 +1         jb      SKRD, $+6
03E2 0207F2         1001 +1         ljmp    ERR_SKRD
03E5 00             1002 +1         nop
                    1004 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03E6 200903         1005 +1         jb      MB1, $+6
03E9 0207E0         1006 +1         ljmp    ERR_2SPOM_C
03EC 00             1007 +1         nop
03ED 200ACF         1009            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                    1010 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
03F0 120851         1011 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03F3 1208CA         1012 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03F6 300AFA         1013 +1         jnb     MB2, $-3  ; 
03F9 120851         1014 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03FC D22F           1016            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03FE 120925         1017            lcall   WRITEPORTS      ;
0401 020404         1018            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
0404                1019    DOWN2_MB2:
0404 1208CA         1020            lcall   READPORTS       ; nacitanie dat
                    1021 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0407 200C03         1022 +1         jb      SKRD, $+6
040A 0207F2         1023 +1         ljmp    ERR_SKRD
040D 00             1024 +1         nop
                    1026 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
040E 200903         1027 +1         jb      MB1, $+6
0411 0207D1         1028 +1         ljmp    ERR_1SPOM_C
DEBUG                                                                                                         PAGE 20

0414 00             1029 +1         nop
0415 200AEC         1031            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0418 D22E           1032            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
041A 120925         1033            lcall   WRITEPORTS      ;
                    1034 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
041D 120851         1035 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0420 1208CA         1036 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0423 300AFA         1037 +1         jnb     MB2, $-3  ; 
0426 120851         1038 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1040    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1041    ;        anl     A, #00000010b ;-;
                    1042    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0429 D223           1043            setb    SLOW            ;       Ak ano, spomalme
042B C222           1044            clr     FAST            ; 
042D 120925         1045            lcall   WRITEPORTS      ;
0430 020433         1046            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
0433                1047    DOWN2_MB1:    
0433 1208CA         1048            lcall   READPORTS       ; nacitanie dat
0436 300C05         1049            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0439 300902         1050            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
043C 80F5           1051            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
043E C238           1052    D2_MB1C:clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0440 C221           1053            clr     DOWN            ; zastav motor
0442 D23B           1054            setb    DOWNOld         ;       (a zalohuj)
0444 C23A           1055            clr     UPOld           ;       (a zalohuj)
0446 C222           1056            clr     FAST            ; 
0448 120925         1057            lcall   WRITEPORTS      ; 
044B 01DC           1058            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                    1059    
                    1060    
                    1061    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                    1062    
044D                1063    FLOOR3:
                    1064 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
044D C22F           1065 +1         clr     LEDU            
044F C22E           1066 +1         clr     LEDD 
0451 C224           1067 +1         clr     FLED1             
0453 C225           1068 +1         clr     FLED2                
0455 C226           1069 +1         clr     FLED3           
0457 C227           1070 +1         clr     FLED4           
0459 D226           1071 +1         setb    FLED3
045B 120925         1072 +1         lcall   WRITEPORTS
045E 120886         1074            lcall   WAITFORTIMER    ; simulacia TIMERu
0461 1208CA         1075    F3S:    lcall   READPORTS     ;-; nacitanie dat
0464 C21B           1076            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0466 C22C           1077            clr     PO3U            ;
0468 C22B           1078            clr     PO3D            ;
046A 120925         1079            lcall   WRITEPORTS      ;
046D 200FF1         1080            jb      DPK, F3S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0470 79F0           1081            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0472 7AE0           1082            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
DEBUG                                                                                                         PAGE 21

0474 203A06         1083            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0477 E9             1084            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0478 F4             1085            cpl     A               ;       |
0479 F9             1086            mov     R1, A           ;       |
047A EA             1087            mov     A, R2           ;       A znegujeme aj masku sachty
047B F4             1088            cpl     A               ;       |
047C FA             1089            mov     R2, A           ;       |        
047D                1090    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
047D E528           1091            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
047F 5416           1092            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0481 59             1093            anl     A, R1           ;  | 
0482 7027           1094            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1095                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0484 E528           1096            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0486 5416           1097            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0488 7007           1098            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
048A E522           1099            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
048C 5427           1100            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
048E 5A             1101            anl     A, R2           ;  |   
048F 701A           1102            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1103            ; Pohyb v opacnom smere (nevieme v ktorom)
0491 B23A           1104    F3SW:   cpl     UPOld           ;  Znegujem stary posun
0493 B23B           1105            cpl     DOWNOld         ;  |
0495 E9             1106            mov     A, R1           ;  Znegujeme masky
0496 F4             1107            cpl     A               ;  |
0497 F9             1108            mov     R1, A           ;  |
0498 EA             1109            mov     A, R2           ;  |
0499 F4             1110            cpl     A               ;  |
049A FA             1111            mov     R2, A           ;  |               
049B E528           1112            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
049D 5416           1113            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
049F 59             1114            anl     A, R1           ;  | 
04A0 7009           1115            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
04A2 E522           1116            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
04A4 5427           1117            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
04A6 5A             1118            anl     A, R2           ;  | 
04A7 7002           1119            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
04A9 80B6           1120            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
04AB 203A03         1121    F3:     jb      UPOld, F3UP     ;   
04AE 0204BD         1122            jmp     F3DOWN          ;
04B1 D220           1123    F3UP:   setb    UP              ; rychly pohyb hore
04B3 D222           1124            setb    FAST            ; 
04B5 C223           1125            clr     SLOW            ;
04B7 120925         1126            lcall   WRITEPORTS      ; 
04BA 0204C9         1127            jmp     UP3           ;-; prejdi do stavu UP2    
04BD D221           1128    F3DOWN: setb    DOWN            ; rychly pohyb hore
04BF D222           1129            setb    FAST            ; 
04C1 C223           1130            clr     SLOW            ;
04C3 120925         1131            lcall   WRITEPORTS      ; 
04C6 020558         1132            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1133         
                    1134         
04C9                1135    UP3:
DEBUG                                                                                                         PAGE 22

                    1136 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04C9 C22F           1137 +1         clr     LEDU            
04CB C22E           1138 +1         clr     LEDD 
04CD C224           1139 +1         clr     FLED1             
04CF C225           1140 +1         clr     FLED2                
04D1 C226           1141 +1         clr     FLED3           
04D3 C227           1142 +1         clr     FLED4           
04D5 D226           1143 +1         setb    FLED3
04D7 120925         1144 +1         lcall   WRITEPORTS
                    1146 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
04DA 120851         1147 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04DD 1208CA         1148 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04E0 3009FA         1149 +1         jnb     MB1, $-3  ; 
04E3 120851         1150 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04E6 1208CA         1152    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1153 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04E9 200B03         1154 +1         jb      SKRH, $+6
04EC 0207F5         1155 +1         ljmp    ERR_SKRH
04EF 00             1156 +1         nop
                    1158 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
04F0 200903         1159 +1         jb      MB1, $+6
04F3 0207E0         1160 +1         ljmp    ERR_2SPOM_C
04F6 00             1161 +1         nop
04F7 200AEC         1163            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                    1164 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
04FA 120851         1165 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04FD 1208CA         1166 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0500 300AFA         1167 +1         jnb     MB2, $-3  ; 
0503 120851         1168 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0506 D22E           1170            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0508 120925         1171            lcall   WRITEPORTS      ;
050B 02050E         1172            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
050E                1173    UP3_MB2:
050E 1208CA         1174            lcall   READPORTS       ; nacitanie dat
                    1175 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0511 200B03         1176 +1         jb      SKRH, $+6
0514 0207F5         1177 +1         ljmp    ERR_SKRH
0517 00             1178 +1         nop
                    1180 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0518 200903         1181 +1         jb      MB1, $+6
051B 0207D1         1182 +1         ljmp    ERR_1SPOM_C
051E 00             1183 +1         nop
051F 200AEC         1185            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0522 D22F           1186            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0524 120925         1187            lcall   WRITEPORTS      ;
                    1188 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
0527 120851         1189 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
052A 1208CA         1190 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
052D 300AFA         1191 +1         jnb     MB2, $-3  ; 
0530 120851         1192 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1194    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1195    ;        anl     A, #00010000b ;-;
DEBUG                                                                                                         PAGE 23

                    1196    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
0533 D223           1197            setb    SLOW            ;       Ak ano, spomalme
0535 C222           1198            clr     FAST            ; 
0537 120925         1199            lcall   WRITEPORTS      ;
053A 02053D         1200            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
053D                1201    UP3_MB1:
053D 1208CA         1202            lcall   READPORTS       ; nacitanie dat
0540 300B05         1203            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0543 300902         1204            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0546 80F5           1205            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
0548 C238           1206    U3_MB1C:clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
054A C220           1207            clr     UP              ; zastav motor
054C D23A           1208            setb    UPOld           ;       (a zalohuj)
054E C23B           1209            clr     DOWNOld         ;       (a zalohuj)
0550 C222           1210            clr     FAST            ; 
0552 120925         1211            lcall   WRITEPORTS      ; 
0555 020677         1212            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
0558                1213    DOWN3:
                    1214 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0558 C22F           1215 +1         clr     LEDU            
055A C22E           1216 +1         clr     LEDD 
055C C224           1217 +1         clr     FLED1             
055E C225           1218 +1         clr     FLED2                
0560 C226           1219 +1         clr     FLED3           
0562 C227           1220 +1         clr     FLED4           
0564 D226           1221 +1         setb    FLED3
0566 120925         1222 +1         lcall   WRITEPORTS
                    1224 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0569 120851         1225 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
056C 1208CA         1226 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
056F 3009FA         1227 +1         jnb     MB1, $-3  ; 
0572 120851         1228 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0575 1208CA         1230            lcall   READPORTS       ; nacitanie dat
                    1231 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0578 200C03         1232 +1         jb      SKRD, $+6
057B 0207F2         1233 +1         ljmp    ERR_SKRD
057E 00             1234 +1         nop
                    1236 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
057F 200903         1237 +1         jb      MB1, $+6
0582 0207E0         1238 +1         ljmp    ERR_2SPOM_C
0585 00             1239 +1         nop
0586 200ACF         1241            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                    1242 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
0589 120851         1243 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
058C 1208CA         1244 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
058F 300AFA         1245 +1         jnb     MB2, $-3  ; 
0592 120851         1246 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0595 D22F           1248            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0597 120925         1249            lcall   WRITEPORTS      ;
059A 02059D         1250            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
059D                1251    DOWN3_MB2:
059D 1208CA         1252            lcall   READPORTS       ; nacitanie dat
DEBUG                                                                                                         PAGE 24

                    1253 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05A0 200C03         1254 +1         jb      SKRD, $+6
05A3 0207F2         1255 +1         ljmp    ERR_SKRD
05A6 00             1256 +1         nop
                    1258 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
05A7 200903         1259 +1         jb      MB1, $+6
05AA 0207D1         1260 +1         ljmp    ERR_1SPOM_C
05AD 00             1261 +1         nop
05AE 200AEC         1263            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
05B1 D22E           1264            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
05B3 120925         1265            lcall   WRITEPORTS      ;
                    1266 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
05B6 120851         1267 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
05B9 1208CA         1268 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
05BC 300AFA         1269 +1         jnb     MB2, $-3  ; 
05BF 120851         1270 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1272    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1273    ;        anl     A, #00000100b ;-;
                    1274    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1275 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1276 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
05C2 C3             1277 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
05C3 7400           1278 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
05C5 7211           1279 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
05C7 B00E           1280 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
05C9 7242           1281 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
05CB 720F           1282 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
05CD 7238           1283 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
05CF 3400           1284 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
05D1 7033           1286            jnz     D3_MB2C         ; Ak ano, zastav
                    1287 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
05D3 E522           1288 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
05D5 33             1289 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
05D6 547E           1290 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
05D8 7805           1291 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1292 +1  ; LL1: 
05DA 6006           1293 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
05DC C3             1294 +1         clr     C               ; Inak shiftnem o 2
05DD 33             1295 +1         rlc     A               ;
05DE C3             1296 +1         clr     C               ;
05DF 33             1297 +1         rlc     A               ;
05E0 D8F8           1298 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1299 +1 ; LL2:
DEBUG                                                                                                         PAGE 25

05E2 E8             1300 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1302 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
05E3 B40203         1303 +1         cjne    A, #2, $+6
05E6 0205EC         1304 +1         jmp     $+6
05E9 020610         1305 +1         ljmp    DOWN3_MB1
05EC 00             1306 +1         nop
                    1308 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
05ED 7405           1309 +1         mov     A, #5
05EF C3             1310 +1         clr     C
05F0 9402           1311 +1         subb    A, #2
05F2 F8             1312 +1         mov     R0, A
05F3 E528           1313 +1         mov     A, INPORTA
05F5 541E           1314 +1         anl     A, #00011110b
05F7 C3             1315 +1         clr     C
05F8 33             1316 +1         rlc     A
05F9 C3             1317 +1         clr     C
05FA 33             1318 +1         rlc     A
05FB C3             1319 +1         clr     C
05FC 33             1320 +1         rlc     A
                    1321 +1 ;LL1   
05FD C3             1322 +1         clr     C
05FE 33             1323 +1         rlc     A
05FF D8FC           1324 +1         djnz    R0, $-2;LL1
0601 6003           1326            jz      D3_MB2C         ; |   ak neni zastavujem                  
0603 020610         1327            ljmp    DOWN3_MB1       ;-; |        
0606 D223           1328    D3_MB2C:setb    SLOW            ;       Ak ano, spomalme
0608 C222           1329            clr     FAST            ; 
060A 120925         1330            lcall   WRITEPORTS      ;
060D 020610         1331            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
0610                1332    DOWN3_MB1:    
0610 1208CA         1333            lcall   READPORTS       ; nacitanie dat
                    1334 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0613 200C03         1335 +1         jb      SKRD, $+6
0616 0207F2         1336 +1         ljmp    ERR_SKRD
0619 00             1337 +1         nop
                    1339 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
061A 200A03         1340 +1         jb      MB2, $+6
061D 0207EF         1341 +1         ljmp    ERR_ZAST_C
0620 00             1342 +1         nop
0621 2009EC         1344            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1345 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1346 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0624 C3             1347 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0625 7400           1348 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0627 7211           1349 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0629 B00E           1350 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
062B 7242           1351 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
062D 720F           1352 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
062F 7238           1353 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0631 3400           1354 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
DEBUG                                                                                                         PAGE 26

                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0633 C238           1356            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0635 7033           1357            jnz     D3_MB1C         ; Ak ano, zastav
                    1358 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0637 E522           1359 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0639 33             1360 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
063A 547E           1361 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
063C 7805           1362 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1363 +1  ; LL1: 
063E 6006           1364 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0640 C3             1365 +1         clr     C               ; Inak shiftnem o 2
0641 33             1366 +1         rlc     A               ;
0642 C3             1367 +1         clr     C               ;
0643 33             1368 +1         rlc     A               ;
0644 D8F8           1369 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1370 +1 ; LL2:
0646 E8             1371 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1373 +1         LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
0647 B40203         1374 +1         cjne    A, #2, $+6
064A 020650         1375 +1         jmp     $+6
064D 0203BF         1376 +1         ljmp    DOWN2
0650 00             1377 +1         nop
                    1379 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0651 7405           1380 +1         mov     A, #5
0653 C3             1381 +1         clr     C
0654 9402           1382 +1         subb    A, #2
0656 F8             1383 +1         mov     R0, A
0657 E528           1384 +1         mov     A, INPORTA
0659 541E           1385 +1         anl     A, #00011110b
065B C3             1386 +1         clr     C
065C 33             1387 +1         rlc     A
065D C3             1388 +1         clr     C
065E 33             1389 +1         rlc     A
065F C3             1390 +1         clr     C
0660 33             1391 +1         rlc     A
                    1392 +1 ;LL1   
0661 C3             1393 +1         clr     C
0662 33             1394 +1         rlc     A
0663 D8FC           1395 +1         djnz    R0, $-2;LL1
0665 6003           1397            jz      D3_MB1C         ; |   ak neni zastavujem                  
0667 0203BF         1398            ljmp    DOWN2         ;-; |        
066A C221           1399    D3_MB1C:clr     DOWN            ; zastav motor
066C D23B           1400            setb    DOWNOld         ;       (a zalohuj)
066E C23A           1401            clr     UPOld           ;       (a zalohuj)
0670 C222           1402            clr     FAST            ; 
0672 120925         1403            lcall   WRITEPORTS      ; 
0675 412D           1404            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                    1405          
                    1406            
DEBUG                                                                                                         PAGE 27

                    1407    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1408    
0677                1409    FLOOR4:
                    1410 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0677 C22F           1411 +1         clr     LEDU            
0679 C22E           1412 +1         clr     LEDD 
067B C224           1413 +1         clr     FLED1             
067D C225           1414 +1         clr     FLED2                
067F C226           1415 +1         clr     FLED3           
0681 C227           1416 +1         clr     FLED4           
0683 D227           1417 +1         setb    FLED4
0685 120925         1418 +1         lcall   WRITEPORTS
0688 120886         1420            lcall   WAITFORTIMER    ; simulacia TIMERu
068B 1208CA         1421    F4S:    lcall   READPORTS     ;-; nacitanie dat
068E C21C           1422            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0690 C22D           1423            clr     PO4            ;
0692 120925         1424            lcall   WRITEPORTS      ;
0695 200FF3         1425            jb      DPK, F4S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0698 E528           1426            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
069A 540E           1427            anl     A, #00001110b ;-;
069C 7008           1428            jnz     F4OK          ;-; ak ano, ideme na to
069E E522           1429            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
06A0 541F           1430            anl     A, #00011111b ;-;
06A2 7002           1431            jnz     F4OK          ;-; ak ano, ideme na to
06A4 80E5           1432            jmp     F4S             ; Nemam sa kde hnut, opakujem
06A6 D221           1433    F4OK:   setb    DOWN            ; rychly pohyb dole
06A8 D222           1434            setb    FAST            ;
06AA C223           1435            clr     SLOW            ; 
06AC 120925         1436            lcall   WRITEPORTS      ; 
06AF 0206B2         1437            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
06B2                1438    DOWN4:
                    1439 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
06B2 C22F           1440 +1         clr     LEDU            
06B4 C22E           1441 +1         clr     LEDD 
06B6 C224           1442 +1         clr     FLED1             
06B8 C225           1443 +1         clr     FLED2                
06BA C226           1444 +1         clr     FLED3           
06BC C227           1445 +1         clr     FLED4           
06BE D227           1446 +1         setb    FLED4
06C0 120925         1447 +1         lcall   WRITEPORTS
                    1449 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
06C3 120851         1450 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06C6 1208CA         1451 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06C9 3009FA         1452 +1         jnb     MB1, $-3  ; 
06CC 120851         1453 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06CF 1208CA         1455            lcall   READPORTS       ; nacitanie dat
                    1456 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06D2 200C03         1457 +1         jb      SKRD, $+6
06D5 0207F2         1458 +1         ljmp    ERR_SKRD
06D8 00             1459 +1         nop
                    1461 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
DEBUG                                                                                                         PAGE 28

06D9 200903         1462 +1         jb      MB1, $+6
06DC 0207E0         1463 +1         ljmp    ERR_2SPOM_C
06DF 00             1464 +1         nop
06E0 200ACF         1466            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1467 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
06E3 120851         1468 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06E6 1208CA         1469 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06E9 300AFA         1470 +1         jnb     MB2, $-3  ; 
06EC 120851         1471 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06EF D22F           1473            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
06F1 120925         1474            lcall   WRITEPORTS      ;
06F4 0206F7         1475            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
06F7                1476    DOWN4_MB2:
06F7 1208CA         1477            lcall   READPORTS       ; nacitanie dat
                    1478 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06FA 200C03         1479 +1         jb      SKRD, $+6
06FD 0207F2         1480 +1         ljmp    ERR_SKRD
0700 00             1481 +1         nop
                    1483 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0701 200903         1484 +1         jb      MB1, $+6
0704 0207D1         1485 +1         ljmp    ERR_1SPOM_C
0707 00             1486 +1         nop
0708 200AEC         1488            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
070B D22E           1489            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
070D 120925         1490            lcall   WRITEPORTS      ;
                    1491 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0710 120851         1492 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0713 1208CA         1493 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0716 300AFA         1494 +1         jnb     MB2, $-3  ; 
0719 120851         1495 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1497    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1498    ;        anl     A, #00001000b ;-;
                    1499    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1500 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1501 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
071C C3             1502 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
071D 7400           1503 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
071F 7213           1504 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0721 B00E           1505 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0723 7243           1506 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0725 720F           1507 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0727 7238           1508 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0729 3400           1509 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
072B 7033           1511            jnz     D4_MB2C       ;-; Ak ano, zastav
                    1512 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
072D E522           1513 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
072F 33             1514 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
DEBUG                                                                                                         PAGE 29

                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0730 547E           1515 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0732 7805           1516 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1517 +1  ; LL1: 
0734 6006           1518 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0736 C3             1519 +1         clr     C               ; Inak shiftnem o 2
0737 33             1520 +1         rlc     A               ;
0738 C3             1521 +1         clr     C               ;
0739 33             1522 +1         rlc     A               ;
073A D8F8           1523 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1524 +1 ; LL2:
073C E8             1525 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1527 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
073D B40303         1528 +1         cjne    A, #3, $+6
0740 020746         1529 +1         jmp     $+6
0743 02076A         1530 +1         ljmp    DOWN4_MB1
0746 00             1531 +1         nop
                    1533 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0747 7405           1534 +1         mov     A, #5
0749 C3             1535 +1         clr     C
074A 9403           1536 +1         subb    A, #3
074C F8             1537 +1         mov     R0, A
074D E528           1538 +1         mov     A, INPORTA
074F 541E           1539 +1         anl     A, #00011110b
0751 C3             1540 +1         clr     C
0752 33             1541 +1         rlc     A
0753 C3             1542 +1         clr     C
0754 33             1543 +1         rlc     A
0755 C3             1544 +1         clr     C
0756 33             1545 +1         rlc     A
                    1546 +1 ;LL1   
0757 C3             1547 +1         clr     C
0758 33             1548 +1         rlc     A
0759 D8FC           1549 +1         djnz    R0, $-2;LL1
075B 6003           1551            jz      D4_MB2C         ; |   ak neni zastavujem          
075D 02076A         1552            ljmp    DOWN4_MB1       ;-; |       
0760 D223           1553    D4_MB2C:setb    SLOW            ;       Ak ano, spomalme
0762 C222           1554            clr     FAST            ; 
0764 120925         1555            lcall   WRITEPORTS      ;
0767 02076A         1556            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
076A                1557    DOWN4_MB1:    
076A 1208CA         1558            lcall   READPORTS       ; nacitanie dat
                    1559 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
076D 200C03         1560 +1         jb      SKRD, $+6
0770 0207F2         1561 +1         ljmp    ERR_SKRD
0773 00             1562 +1         nop
                    1564 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
0774 200A03         1565 +1         jb      MB2, $+6
0777 0207EF         1566 +1         ljmp    ERR_ZAST_C
077A 00             1567 +1         nop
077B 2009EC         1569            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
DEBUG                                                                                                         PAGE 30

                    1570 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1571 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
077E C3             1572 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
077F 7400           1573 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0781 7213           1574 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0783 B00E           1575 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0785 7243           1576 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0787 720F           1577 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0789 7238           1578 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
078B 3400           1579 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
078D C238           1581            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril 
078F 7033           1582            jnz     D4_MB1C       ;-; Ak ano, zastav
                    1583 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0791 E522           1584 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0793 33             1585 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0794 547E           1586 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0796 7805           1587 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1588 +1  ; LL1: 
0798 6006           1589 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
079A C3             1590 +1         clr     C               ; Inak shiftnem o 2
079B 33             1591 +1         rlc     A               ;
079C C3             1592 +1         clr     C               ;
079D 33             1593 +1         rlc     A               ;
079E D8F8           1594 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1595 +1 ; LL2:
07A0 E8             1596 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1598 +1         LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
07A1 B40303         1599 +1         cjne    A, #3, $+6
07A4 0207AA         1600 +1         jmp     $+6
07A7 020558         1601 +1         ljmp    DOWN3
07AA 00             1602 +1         nop
                    1604 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
07AB 7405           1605 +1         mov     A, #5
07AD C3             1606 +1         clr     C
07AE 9403           1607 +1         subb    A, #3
07B0 F8             1608 +1         mov     R0, A
07B1 E528           1609 +1         mov     A, INPORTA
07B3 541E           1610 +1         anl     A, #00011110b
07B5 C3             1611 +1         clr     C
07B6 33             1612 +1         rlc     A
07B7 C3             1613 +1         clr     C
07B8 33             1614 +1         rlc     A
07B9 C3             1615 +1         clr     C
DEBUG                                                                                                         PAGE 31

07BA 33             1616 +1         rlc     A
                    1617 +1 ;LL1   
07BB C3             1618 +1         clr     C
07BC 33             1619 +1         rlc     A
07BD D8FC           1620 +1         djnz    R0, $-2;LL1
07BF 6003           1622            jz      D4_MB1C         ; |   ak neni zastavujem          
07C1 020558         1623            ljmp    DOWN3         ;-; |       
07C4 C221           1624    D4_MB1C:clr     DOWN            ; zastav motor
07C6 D23B           1625            setb    DOWNOld         ;       (a zalohuj)
07C8 C23A           1626            clr     UPOld           ;       (a zalohuj)
07CA C222           1627            clr     FAST            ; 
07CC 120925         1628            lcall   WRITEPORTS      ; 
07CF 814D           1629            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1630                    
                    1631      
07D1                1632    ERR_1SPOM_C: 
                    1633            ;clr     UP              ; zastav motor
                    1634            ;clr     DOWN            ; 
                    1635            ;lcall   WRITEPORTS      ; 
                    1636            ;_BP_
                    1637            ;nop
                    1638            ;nop 
                    1639 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07D1 120851         1640 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07D4 1208CA         1641 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07D7 3009FA         1642 +1         jnb     MB1, $-3  ; 
07DA 120851         1643 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07DD 0207F8         1645            ljmp    ERROR1         
                    1646            
07E0                1647    ERR_2SPOM_C: 
                    1648            ;clr     UP              ; zastav motor
                    1649            ;clr     DOWN            ; 
                    1650            ;lcall   WRITEPORTS      ; 
                    1651            ;_BP_
                    1652            ;nop
                    1653            ;nop
                    1654 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07E0 120851         1655 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07E3 1208CA         1656 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07E6 3009FA         1657 +1         jnb     MB1, $-3  ; 
07E9 120851         1658 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07EC 0207F8         1660            ljmp    ERROR1 
                    1661            
07EF                1662    ERR_ZAST_C: 
                    1663            ;clr     UP              ; zastav motor
                    1664            ;clr     DOWN            ; 
                    1665            ;lcall   WRITEPORTS      ; 
                    1666            ;_BP_
                    1667            ;nop
                    1668            ;nop
                    1669            ;lcall   READPORTS
                    1670            ;clr     FAST
                    1671            ;clr     SLOW
                    1672            ;_BP_
07EF 0207F8         1673            ljmp    ERROR1  
                    1674            
DEBUG                                                                                                         PAGE 32

07F2                1675    ERR_SKRD: 
                    1676            ;clr     UP              ; zastav motor
                    1677            ;clr     DOWN            ; 
                    1678            ;lcall   WRITEPORTS      ; 
                    1679            ;_BP_
                    1680            ;nop
                    1681            ;nop
07F2 0207F8         1682            ljmp    ERROR1    
                    1683            
07F5                1684    ERR_SKRH: 
                    1685            ;clr     UP              ; zastav motor
                    1686            ;clr     DOWN            ; 
                    1687            ;lcall   WRITEPORTS      ; 
                    1688            ;_BP_
                    1689            ;nop
                    1690            ;nop
07F5 0207F8         1691            ljmp    ERROR1 
                    1692            
07F8                1693    ERROR1:         
07F8 D22F           1694            setb    LEDU
07FA D22E           1695            setb    LEDD
07FC C222           1696            clr     FAST
07FE D223           1697            setb    SLOW
0800 120925         1698            lcall   WRITEPORTS          
0803 1208CA         1699    ERROR1S:lcall   READPORTS       ; nacitanie dat
0806 300B08         1700            jnb     SKRH, ERROR1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0809 300C05         1701            jnb     SKRD, ERROR1C   ; Sme na dolnej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
080C 300902         1702            jnb     MB1, ERROR1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
080F 80F2           1703            jmp     ERROR1S         ; Ak sme nechytili ani jednu clonku, opakujeme
0811 C220           1704    ERROR1C:clr     UP              ; zastav motor
0813 C221           1705            clr     DOWN            ; 
0815 C222           1706            clr     FAST            ; 
0817 C223           1707            clr     SLOW            ; 
0819 120925         1708            lcall   WRITEPORTS      ; 
081C 120886         1709            lcall   WAITFORTIMER    ; simulacia TIMERu
081F 020822         1710            jmp     ERROR2        ;-; a prejdi do stavu ERROR2 
                    1711            
0822 1208CA         1712    ERROR2: lcall   READPORTS       ; nacitanie dat
0825 200DFA         1713            jb      DP, ERROR2      ; uz vystupili vsetci ludia z kabiny?
0828 200FF7         1714            jb      DPK, ERROR2     ; uz vystupili vsetci ludia z kabiny?
082B 200EF4         1715            jb      DPZK, ERROR2    ; uz vystupili vsetci ludia z kabiny?
082E 020033         1716            ljmp    START
                    1717                           
                    1718                    
0831                1719    ENDPROG:
0831 D218           1720            setb    KS
0833 120925         1721            call    WRITEPORTS                ; zapis novu informaciu
                    1722 +1         _BP_
0836 C2B3           1723 +1         clr     P3.3
0838 D2AA           1724 +1         setb    EX1
083A 00             1725 +1         nop
083B 00             1726 +1         nop
083C 22             1728            ret
                    1729            
                    1730            
DEBUG                                                                                                         PAGE 33

                    1731            
                    1732    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1733    ; INT_TIMER0
                    1734    ; Obsluha prerusenia timera 0
                    1735    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;        
083D                1736    INT_TIMER0:
083D C0E0           1737            push    ACC
083F ED             1738            mov     A, R5
0840 1D             1739            dec     R5
0841 6002           1740            jz      INT_TIMER0_MAIN    
0843 8009           1741            sjmp    INT_TIMER0_END
0845                1742    INT_TIMER0_MAIN:
0845 EE             1743            mov     A, R6
0846 FD             1744            mov     R5, A
0847 B22F           1745            cpl     LEDU
0849 B22E           1746            cpl     LEDD
084B 120925         1747            lcall   WRITEPORTS  
                    1748            
084E                1749    INT_TIMER0_END:        
084E D0E0           1750            pop     ACC
0850 32             1751            reti 
                    1752            
                    1753    ;INT_TIMER0:
                    1754    ;        push    ACC
                    1755    ;        mov     A, R7  
                    1756    ;        dec     R7               
                    1757    ;        jnz     INT_TIMER0_END     
                    1758    ;        mov     R7, #20h
                    1759    ;        jb      LEDU, INT_TIMER0_CLEAR       
                    1760    ;        setb    LEDU
                    1761    ;        setb    LEDD
                    1762    ;        jmp     INT_TIMER0_WRITE
                    1763    ;INT_TIMER0_CLEAR:        
                    1764    ;        ;clr     LEDU
                    1765    ;        ;clr     LEDD
                    1766    ;INT_TIMER0_WRITE: 
                    1767    ;        lcall   WRITEPORTS
                    1768    ;INT_TIMER0_END: 
                    1769    ;        setb    LEDU
                    1770    ;        lcall   WRITEPORTS       
                    1771    ;        pop     ACC
                    1772    ;        reti
                    1773            
                    1774            
                    1775    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1776    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1777    ; 11.0592MHz/2000 = zdrzanie 1 ms
0851                1778    TIME10MS:
0851 7963           1779            mov     R1,#063h        ; 2
                    1780                                    ; *** 100x
0853 7AFF           1781    TIME0:  mov     R2,#0FFh        ; 2 
0855 DAFE           1782    TIME1:  djnz    R2,TIME1        ; 256*2   
0857 7AFF           1783            mov     R2,#0FFh        ; 2       
0859 DAFE           1784    TIME2:  djnz    R2,TIME2        ; 256*2 
085B 7A24           1785            mov     R2,#024h        ; 2       
085D DAFE           1786    TIME3:  djnz    R2,TIME3        ; 36*2
085F 00             1787            nop                     ; 1
0860 D9F1           1788            djnz    R1,TIME0        ; 2
DEBUG                                                                                                         PAGE 34

                    1789                                    ; ***
0862 792A           1790            mov     R1,#02Ah        ; 2 
0864 D9FE           1791    TIME4:  djnz    R1,TIME4        ; 43*2  
0866 22             1792            ret                     ; koniec
                    1793            
                    1794            
                    1795    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1796    ; STOP
                    1797    ; osetri stlacenie tlacidla STOP
                    1798    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0867                1799    STOP:
0867 D238           1800            setb    STOPPED
0869 C222           1801            clr     FAST
086B C223           1802            clr     SLOW
086D 74E1           1803            mov     A, #11100001b
086F 5223           1804            anl     OUTPORTA, A 
0871 120925         1805            lcall   WRITEPORTS
                    1806            
0874 120886         1807            lcall   WAITFORTIMER
0877 12088E         1808    STOPC:  lcall   READPORTS1
087A E528           1809            mov     A, INPORTA
087C 541E           1810            anl     A, #00011110b
087E 60F7           1811            jz      STOPC     
                    1812            
0880 D223           1813            setb    SLOW
0882 120925         1814            lcall   WRITEPORTS
0885 22             1815            ret        
                    1816            
                    1817            
                    1818    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1819    ; DELAY
                    1820    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1821    ; bude timer)
                    1822    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0886                1823    WAITFORTIMER:
0886 7B10           1824            mov     R3, #10h
0888 120851         1825    DEL1:   lcall   TIME10MS
088B DBFB           1826            djnz    R3, DEL1
088D 22             1827            ret
                    1828            
                    1829    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1830    ; READPORTS1
                    1831    ; precita nove hodnoty na portoch
                    1832    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
088E                1833    READPORTS1:
088E 75A080         1834            mov     p2, #i8255INA       ; citaj data z portu A
0891 75803F         1835            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0894 C2B7           1836            clr     RDNOT
0896 00             1837            nop
0897 00             1838            nop
0898 00             1839            nop
0899 00             1840            nop
089A 858028         1841            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
089D D2B7           1842            setb    RDNOT
                    1843            
089F 75A081         1844            mov     p2, #i8255INB       ; citaj data z portu B
08A2 7580FE         1845            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
DEBUG                                                                                                         PAGE 35

08A5 C2B7           1846            clr     RDNOT
08A7 00             1847            nop
08A8 00             1848            nop
08A9 00             1849            nop
08AA 00             1850            nop
08AB 858021         1851            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
08AE D2B7           1852            setb    RDNOT
                    1853    
08B0 75A082         1854            mov     p2, #i8255INC       ; citaj data z portu C
08B3 75803F         1855            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
08B6 C2B7           1856            clr     RDNOT
08B8 00             1857            nop
08B9 00             1858            nop
08BA 00             1859            nop
08BB 00             1860            nop
08BC 858022         1861            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
08BF D2B7           1862            setb    RDNOT
08C1 00             1863            nop
08C2 00             1864            nop
08C3 00             1865            nop
08C4 00             1866            nop
08C5 00             1867            nop
08C6 00             1868            nop
08C7 00             1869            nop
08C8 00             1870            nop
08C9 22             1871            ret
                    1872    
                    1873    
                    1874    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1875    ; READPORTS
                    1876    ; precita nove hodnoty na portoch
                    1877    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08CA                1878    READPORTS:
08CA 75A080         1879            mov     p2, #i8255INA       ; citaj data z portu A
08CD 75803F         1880            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
08D0 C2B7           1881            clr     RDNOT
08D2 00             1882            nop
08D3 00             1883            nop
08D4 00             1884            nop
08D5 00             1885            nop
08D6 858028         1886            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
08D9 D2B7           1887            setb    RDNOT
                    1888            
08DB 75A081         1889            mov     p2, #i8255INB       ; citaj data z portu B
08DE 7580FE         1890            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
08E1 C2B7           1891            clr     RDNOT
08E3 00             1892            nop
08E4 00             1893            nop
08E5 00             1894            nop
08E6 00             1895            nop
08E7 858021         1896            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
08EA D2B7           1897            setb    RDNOT
                    1898    
08EC 75A082         1899            mov     p2, #i8255INC       ; citaj data z portu C
08EF 75803F         1900            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
08F2 C2B7           1901            clr     RDNOT
08F4 00             1902            nop
DEBUG                                                                                                         PAGE 36

08F5 00             1903            nop
08F6 00             1904            nop
08F7 00             1905            nop
08F8 858022         1906            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
08FB D2B7           1907            setb    RDNOT
08FD 00             1908            nop
08FE 00             1909            nop
08FF 00             1910            nop
0900 00             1911            nop
0901 00             1912            nop
0902 00             1913            nop
0903 00             1914            nop
0904 00             1915            nop
                    1916            
0905 300F04         1917            jnb     DPK, READPORTS_C1
0908 C222           1918            clr     FAST
090A D223           1919            setb    SLOW
090C                1920    READPORTS_C1:         
090C 204003         1921            jb      STOPNOT, READPORTS_C
090F 120867         1922            lcall   STOP
0912                1923    READPORTS_C:        
0912 E528           1924            mov     A, INPORTA
0914 541E           1925            anl     A, #00011110b
0916 4223           1926            orl     OUTPORTA, A
0918 120925         1927            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
091B E522           1928            mov     A, INPORTC
091D 543F           1929            anl     A, #00111111b
091F 4225           1930            orl     OUTPORTC, A
0921 120925         1931            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1932            
0924 22             1933            ret
                    1934            
                    1935    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1936    ; WRITEPORTS
                    1937    ; spravi zalohu vystupnych registrov a posle data von
                    1938    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0925                1939    WRITEPORTS:
0925 852380         1940            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
0928 75A0C0         1941            mov     p2, #i8255OUTA
092B C2B6           1942            clr     WRNOT
092D 00             1943            nop
092E 00             1944            nop
092F 00             1945            nop
0930 00             1946            nop
0931 D2B6           1947            setb    WRNOT
                    1948            
0933 852480         1949            mov     p0, OUTPORTB        ; potom port B
0936 75A0C1         1950            mov     p2, #i8255OUTB
0939 C2B6           1951            clr     WRNOT
093B 00             1952            nop
093C 00             1953            nop
093D 00             1954            nop
093E 00             1955            nop
093F D2B6           1956            setb    WRNOT
                    1957    
0941 852580         1958            mov     p0, OUTPORTC        ; a nakoniec port C
0944 75A0C2         1959            mov     p2, #i8255OUTC
0947 C2B6           1960            clr     WRNOT
DEBUG                                                                                                         PAGE 37

0949 00             1961            nop
094A 00             1962            nop
094B 00             1963            nop
094C 00             1964            nop
094D D2B6           1965            setb    WRNOT
094F 00             1966            nop
0950 00             1967            nop
0951 00             1968            nop
0952 00             1969            nop
0953 00             1970            nop
0954 00             1971            nop
0955 00             1972            nop
0956 00             1973            nop
0957 22             1974            ret
                    1975    
                    1976    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1977    
0958 0D0A5269       1978    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
095C 61646961   
0960 63692073   
0964 79737465   
0968 6D206A65   
096C 20696E69   
0970 6369616C   
0974 697A6F76   
0978 616E792E   
097C 0D0A00     
097F 52696164       1979    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
0983 69616369   
0987 20737973   
098B 74656D20   
098F 6A652072   
0993 65696E69   
0997 6369616C   
099B 697A6F76   
099F 616E7920   
09A3 706F2073   
09A7 746C6163   
09AB 656E6920   
09AF 746C6163   
09B3 69646C61   
09B7 2053544F   
09BB 502E0D0A   
09BF 00         
09C0 4B616C69       1980    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
09C4 62726163   
09C8 69612076   
09CC 79746168   
09D0 75206A65   
09D4 20756B6F   
09D8 6E63656E   
09DC 612E0D0A   
09E0 00         
                    1981    
----                1982            DSEG
0040                1983            org     40h
0040                1984    STACK:  DS      10h
DEBUG                                                                                                         PAGE 38

                    1985    
                    1986    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
DEBUG                                                                                                         PAGE 39

ACC. . . . . . . . . . . . . . .  D ADDR  00E0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSMERPI1U . . . . . . . . . . .    NUMB  003EH  NOT USED  
BMSMERPI2D . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMSMERPI2U . . . . . . . . . . .    NUMB  0038H  NOT USED  
BMSMERPI3D . . . . . . . . . . .    NUMB  0007H  NOT USED  
BMSMERPI3U . . . . . . . . . . .    NUMB  0020H  NOT USED  
BMSMERPI4D . . . . . . . . . . .    NUMB  001FH  NOT USED  
BMSMERPKI1U. . . . . . . . . . .    NUMB  001CH  NOT USED  
BMSMERPKI2D. . . . . . . . . . .    NUMB  0002H  NOT USED  
BMSMERPKI2U. . . . . . . . . . .    NUMB  0018H  NOT USED  
BMSMERPKI3D. . . . . . . . . . .    NUMB  0006H  NOT USED  
BMSMERPKI3U. . . . . . . . . . .    NUMB  0010H  NOT USED  
BMSMERPKI4D. . . . . . . . . . .    NUMB  000EH  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  00A9H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00C2H  
CALIBEND2. . . . . . . . . . . .  C ADDR  00CDH  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00BAH  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
DEBUG                                                                                                         PAGE 40

D2_MB1C. . . . . . . . . . . . .  C ADDR  043EH  
D3_MB1C. . . . . . . . . . . . .  C ADDR  066AH  
D3_MB2C. . . . . . . . . . . . .  C ADDR  0606H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  07C4H  
D4_MB2C. . . . . . . . . . . . .  C ADDR  0760H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0888H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  03BFH  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  0433H  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  0404H  
DOWN3. . . . . . . . . . . . . .  C ADDR  0558H  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  0610H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  059DH  
DOWN4. . . . . . . . . . . . . .  C ADDR  06B2H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  076AH  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  06F7H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
ENDPROG. . . . . . . . . . . . .  C ADDR  0831H  NOT USED  
ERROR1 . . . . . . . . . . . . .  C ADDR  07F8H  
ERROR1C. . . . . . . . . . . . .  C ADDR  0811H  
ERROR1S. . . . . . . . . . . . .  C ADDR  0803H  
ERROR2 . . . . . . . . . . . . .  C ADDR  0822H  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  07D1H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  07E0H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  07F2H  
ERR_SKRH . . . . . . . . . . . .  C ADDR  07F5H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  07EFH  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  010BH  
F1S. . . . . . . . . . . . . . .  C ADDR  00F0H  
F2 . . . . . . . . . . . . . . .  C ADDR  028BH  
F2DOWN . . . . . . . . . . . . .  C ADDR  029DH  
F2OK . . . . . . . . . . . . . .  C ADDR  025DH  
F2S. . . . . . . . . . . . . . .  C ADDR  0241H  
F2SW . . . . . . . . . . . . . .  C ADDR  0271H  
F2UP . . . . . . . . . . . . . .  C ADDR  0291H  
F3 . . . . . . . . . . . . . . .  C ADDR  04ABH  
F3DOWN . . . . . . . . . . . . .  C ADDR  04BDH  
F3OK . . . . . . . . . . . . . .  C ADDR  047DH  
F3S. . . . . . . . . . . . . . .  C ADDR  0461H  
F3SW . . . . . . . . . . . . . .  C ADDR  0491H  
F3UP . . . . . . . . . . . . . .  C ADDR  04B1H  
F4OK . . . . . . . . . . . . . .  C ADDR  06A6H  
F4S. . . . . . . . . . . . . . .  C ADDR  068BH  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00DCH  
FLOOR2 . . . . . . . . . . . . .  C ADDR  022DH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  044DH  
DEBUG                                                                                                         PAGE 41

FLOOR4 . . . . . . . . . . . . .  C ADDR  0677H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
INT_TIMER0 . . . . . . . . . . .  C ADDR  083DH  
INT_TIMER0_END . . . . . . . . .  C ADDR  084EH  
INT_TIMER0_MAIN. . . . . . . . .  C ADDR  0845H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00DCH  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PCON . . . . . . . . . . . . . .  D ADDR  0087H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  08CAH  
DEBUG                                                                                                         PAGE 42

READPORTS1 . . . . . . . . . . .  C ADDR  088EH  
READPORTS_C. . . . . . . . . . .  C ADDR  0912H  
READPORTS_C1 . . . . . . . . . .  C ADDR  090CH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOP . . . . . . . . . . . . . .  C ADDR  0867H  
STOPC. . . . . . . . . . . . . .  C ADDR  0877H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  
STOPPED. . . . . . . . . . . . .  B ADDR  0038H  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  09C0H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  0958H  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  097FH  NOT USED  
TCON . . . . . . . . . . . . . .  D ADDR  0088H  PREDEFINED  
TH0. . . . . . . . . . . . . . .  D ADDR  008CH  PREDEFINED  
TIME0. . . . . . . . . . . . . .  C ADDR  0853H  
TIME1. . . . . . . . . . . . . .  C ADDR  0855H  
TIME10MS . . . . . . . . . . . .  C ADDR  0851H  
TIME2. . . . . . . . . . . . . .  C ADDR  0859H  
TIME3. . . . . . . . . . . . . .  C ADDR  085DH  
TIME4. . . . . . . . . . . . . .  C ADDR  0864H  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
TL0. . . . . . . . . . . . . . .  D ADDR  008AH  PREDEFINED  
TMOD . . . . . . . . . . . . . .  D ADDR  0089H  PREDEFINED  
TR0. . . . . . . . . . . . . . .  B ADDR  008CH  PREDEFINED  
U1_MB1C. . . . . . . . . . . . .  C ADDR  021FH  
U1_MB2C. . . . . . . . . . . . .  C ADDR  01C0H  
U2_MB1C. . . . . . . . . . . . .  C ADDR  03B1H  
U2_MB2C. . . . . . . . . . . . .  C ADDR  0352H  
U3_MB1C. . . . . . . . . . . . .  C ADDR  0548H  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  0117H  
UP1A . . . . . . . . . . . . . .  C ADDR  0134H  
UP1_MB1. . . . . . . . . . . . .  C ADDR  01CAH  
UP1_MB2. . . . . . . . . . . . .  C ADDR  015CH  
UP2. . . . . . . . . . . . . . .  C ADDR  02A9H  
UP2A . . . . . . . . . . . . . .  C ADDR  02C6H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  035CH  
UP2_MB2. . . . . . . . . . . . .  C ADDR  02EEH  
UP3. . . . . . . . . . . . . . .  C ADDR  04C9H  
UP3A . . . . . . . . . . . . . .  C ADDR  04E6H  
UP3_MB1. . . . . . . . . . . . .  C ADDR  053DH  
UP3_MB2. . . . . . . . . . . . .  C ADDR  050EH  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAITFORTIMER . . . . . . . . . .  C ADDR  0886H  
WRITEPORTS . . . . . . . . . . .  C ADDR  0925H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
