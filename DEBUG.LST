DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umo+zni stlacat tlacidla aj ked bezi delay
                       7    
                       8    ;Prerusenia pojdu, ale treba dat sakra pozor na zalohovanie veci!!!
                       9    
                      10    
                      11    $MOD51
                      12    $DEBUG
                      13    
                =1    14    $include (lift.inc)
                =1    15    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    16    i8255INA        equ     080h
  0081          =1    17    i8255INB        equ     081h
  0082          =1    18    i8255INC        equ     082h
  0083          =1    19    i8255INCW       equ     083h
  00C0          =1    20    i8255OUTA       equ     0c0h
  00C1          =1    21    i8255OUTB       equ     0c1h
  00C2          =1    22    i8255OUTC       equ     0c2h
  00C3          =1    23    i8255OUTCW      equ     0c3h
                =1    24    
  0028          =1    25    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    26    INPORTB         data    21h
  0022          =1    27    INPORTC         data    22h
  0023          =1    28    OUTPORTA        data    23h
  0024          =1    29    OUTPORTB        data    24h
  0025          =1    30    OUTPORTC        data    25h
  0026          =1    31    INPORTBold      data    26h
  0027          =1    32    CTRLREG         data    27h
                =1    33    
  0030          =1    34    POSITION        data    30h
  0031          =1    35    LOWEST          data    31h
  0032          =1    36    HIGHEST         data    32h
  0033          =1    37    STOPTIMER       data    33h
  0034          =1    38    OUTPORTBold     data    34h
                =1    39    
                =1    40    ;----------------
  0036          =1    41    FLOORREQ        data    36h
                =1    42    ;----------------
                =1    43    
  0040          =1    44    STOPNOT         bit     INPORTA.0
  0041          =1    45    PKI1            bit     INPORTA.1
  0042          =1    46    PKI2            bit     INPORTA.2
  0043          =1    47    PKI3            bit     INPORTA.3
  0044          =1    48    PKI4            bit     INPORTA.4
  0045          =1    49    DOORCLSD        bit     INPORTA.5 
                =1    50    
  0009          =1    51    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    52    MB2             bit     INPORTB.2
  000B          =1    53    SKRH            bit     INPORTB.3
  000C          =1    54    SKRD            bit     INPORTB.4
  000D          =1    55    DP              bit     INPORTB.5
  000E          =1    56    DPZK            bit     INPORTB.6
  000F          =1    57    DPK             bit     INPORTB.7
                =1    58    
DEBUG                                                                                                         PAGE 2

  0031          =1    59    MB1old          bit     INPORTBold.1
  0032          =1    60    MB2old          bit     INPORTBold.2
  0033          =1    61    SKRHold         bit     INPORTBold.3
  0034          =1    62    SKRDold         bit     INPORTBold.4
                =1    63    
                =1    64    
                =1    65    
                =1    66    
                =1    67    
  0010          =1    68    PI1             bit     INPORTC.0       
  0011          =1    69    PI2D            bit     INPORTC.1
  0012          =1    70    PI2U            bit     INPORTC.2
  0013          =1    71    PI3D            bit     INPORTC.3
  0014          =1    72    PI3U            bit     INPORTC.4
  0015          =1    73    PI4             bit     INPORTC.5
                =1    74    
                =1    75    
                =1    76    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    77    ; ****************************************************************************
                =1    78    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    79    ; ----------------------------------------------------------------------------
                =1    80    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    81    ; ----------------------------------------------------------------------------
                =1    82    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    83    ; ****************************************************************************
                =1    84    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    85    ; ----------------------------------------------------------------------------
                =1    86    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    87    ; ----------------------------------------------------------------------------
                =1    88    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    89    ; ----------------------------------------------------------------------------
                =1    90    
                =1    91    
  0018          =1    92    KS              bit     OUTPORTA.0
  0019          =1    93    PKO1            bit     OUTPORTA.1
  001A          =1    94    PKO2            bit     OUTPORTA.2
  001B          =1    95    PKO3            bit     OUTPORTA.3
  001C          =1    96    PKO4            bit     OUTPORTA.4
                =1    97    
  0020          =1    98    UP              bit     OUTPORTB.0
  0021          =1    99    DOWN            bit     OUTPORTB.1
  0022          =1   100    FAST            bit     OUTPORTB.2
  0023          =1   101    SLOW            bit     OUTPORTB.3
  0024          =1   102    FLED1           bit     OUTPORTB.4
  0025          =1   103    FLED2           bit     OUTPORTB.5
  0026          =1   104    FLED3           bit     OUTPORTB.6
  0027          =1   105    FLED4           bit     OUTPORTB.7
                =1   106    
  0028          =1   107    PO1             bit     OUTPORTC.0
  0029          =1   108    PO2D            bit     OUTPORTC.1
  002A          =1   109    PO2U            bit     OUTPORTC.2
  002B          =1   110    PO3D            bit     OUTPORTC.3
  002C          =1   111    PO3U            bit     OUTPORTC.4
  002D          =1   112    PO4             bit     OUTPORTC.5
  002E          =1   113    LEDD            bit     OUTPORTC.6
  002F          =1   114    LEDU            bit     OUTPORTC.7
                =1   115    
  0038          =1   116    STOPPED         bit     CTRLREG.0
DEBUG                                                                                                         PAGE 3

  0039          =1   117    DOORCLSDold     bit     CTRLREG.1
  003A          =1   118    UPold           bit     CTRLREG.2
  003B          =1   119    DOWNold         bit     CTRLREG.3
  003C          =1   120    FASTold         bit     CTRLREG.4
  003D          =1   121    SLOWold         bit     CTRLREG.5
                =1   122    
  00B6          =1   123    WRNOT           bit     0b6h        ; p3.6
  00B7          =1   124    RDNOT           bit     0b7h        ; p3.7
                =1   125    
                =1   126    ; bitove masky
                =1   127    ; 8255OUT 
                =1   128    ; port A
  0001          =1   129    bmKS              equ    00000001b
  0002          =1   130    bmPKO1            equ    00000010b
  0004          =1   131    bmPKO2            equ    00000100b
  0008          =1   132    bmPKO3            equ    00001000b
  0010          =1   133    bmPKO4            equ    00010000b
                =1   134    
                =1   135    ; port B
  0001          =1   136    bmUP              equ    00000001b
  0002          =1   137    bmDOWN            equ    00000010b
  0004          =1   138    bmFAST            equ    00000100b
  0008          =1   139    bmSLOW            equ    00001000b
  0010          =1   140    bmFLED1           equ    00010000b
  0020          =1   141    bmFLED2           equ    00100000b
  0040          =1   142    bmFLED3           equ    01000000b
  0080          =1   143    bmFLED4           equ    10000000b
                =1   144    
                =1   145    ; port C
  0001          =1   146    bmPO1             equ    00000001b
  0002          =1   147    bmPO2D            equ    00000010b
  0004          =1   148    bmPO2U            equ    00000100b
  0008          =1   149    bmPO3D            equ    00001000b
  0010          =1   150    bmPO3U            equ    00010000b
  0020          =1   151    bmPO4             equ    00100000b
  0040          =1   152    bmLEDD            equ    01000000b
  0080          =1   153    bmLEDU            equ    10000000b
                =1   154    
                =1   155    ; 8255IN
                =1   156    ; port A
  0001          =1   157    bmSTOP            equ    00000001b
  0002          =1   158    bmPKI1            equ    00000010b
  0004          =1   159    bmPKI2            equ    00000100b
  0008          =1   160    bmPKI3            equ    00001000b
  0010          =1   161    bmPKI4            equ    00010000b
  0020          =1   162    bmDOORCLSD        equ    00100000b
                =1   163    
                =1   164    ; port B
  0002          =1   165    bmMB1I            equ    00000010b
  0004          =1   166    bmMB2I            equ    00000100b
  0008          =1   167    bmSKRHI           equ    00001000b
  0010          =1   168    bmSKRHD           equ    00010000b
  0020          =1   169    bmDPI             equ    00100000b
  0040          =1   170    bmDPZKI           equ    01000000b
  0080          =1   171    bmDPKI            equ    10000000b
                =1   172    
                =1   173    ; port C
  0001          =1   174    bmPI1             equ    00000001b
DEBUG                                                                                                         PAGE 4

  0002          =1   175    bmPI2D            equ    00000010b
  0004          =1   176    bmPI2U            equ    00000100b
  0008          =1   177    bmPI3D            equ    00001000b
  0010          =1   178    bmPI3U            equ    00010000b
  0020          =1   179    bmPI4             equ    00100000b
                =1   180    
                =1   181    ; Sachta - masky
  003E          =1   182    bmSmerPI1U            equ    00111110b
  0001          =1   183    bmSmerPI2D            equ    00000001b
  0038          =1   184    bmSmerPI2U            equ    00111000b
  0007          =1   185    bmSmerPI3D            equ    00000111b
  0020          =1   186    bmSmerPI3U            equ    00100000b
  001F          =1   187    bmSmerPI4D            equ    00011111b
                =1   188    
                =1   189    ; Kabina - masky
  001C          =1   190    bmSmerPKI1U           equ    00011100b
  0002          =1   191    bmSmerPKI2D           equ    00000010b
  0018          =1   192    bmSmerPKI2U           equ    00011000b
  0006          =1   193    bmSmerPKI3D           equ    00000110b
  0010          =1   194    bmSmerPKI3U           equ    00010000b
  000E          =1   195    bmSmerPKI4D           equ    00001110b
                     196    
                     197    _BP_    MACRO 
                     198            clr     P3.3
                     199            setb    EX1
                     200            nop
                     201            nop
                     202    ENDM
                     203    
                     204    LJZ     MACRO   NAVESTIE
                     205            jnz     $+5
                     206            ljmp    NAVESTIE
                     207            nop
                     208    ENDM
                     209    
                     210    LJNZ    MACRO   NAVESTIE
                     211            jz      $+5
                     212            ljmp    NAVESTIE
                     213            nop
                     214    ENDM
                     215    
                     216    LJB     MACRO   TESTBIT, NAVESTIE
                     217            jnb     TESTBIT, $+6
                     218            ljmp    NAVESTIE
                     219            nop
                     220    ENDM
                     221    
                     222    LJNB    MACRO   TESTBIT, NAVESTIE
                     223            jb      TESTBIT, $+6
                     224            ljmp    NAVESTIE
                     225            nop
                     226    ENDM
                     227    
                     228    CJE     MACRO   OP1, OP2, NAVESTIE
                     229            cjne    OP1, OP2, $+7
                     230            jmp    NAVESTIE
                     231            nop
                     232    ENDM
DEBUG                                                                                                         PAGE 5

                     233    
                     234    LCJNE   MACRO   OP1, OP2, NAVESTIE
                     235            cjne    OP1, OP2, $+6
                     236            jmp     $+6
                     237            ljmp    NAVESTIE
                     238            nop
                     239    ENDM
                     240    
                     241    ZAKMITC MACRO   TYPCLONKY
                     242            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     243            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     244            jnb     TYPCLONKY, $-3  ; 
                     245            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     246    ENDM
                     247    
                     248    ZASTAV  MACRO  C_POSCH, SMER
                     249                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     250            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     251            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     252            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     253            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
                     254            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
                     255            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     256            orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
                     257            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     258    ENDM
                     259    
                     260    NAJNIZSIE  MACRO
                     261            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     262            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     263            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     264            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     265     ; LL1: 
                     266            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     267            clr     C               ; Inak shiftnem o 2
                     268            rlc     A               ;
                     269            clr     C               ;
                     270            rlc     A               ;
                     271            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     272    ; LL2:
                     273            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     274    ENDM
                     275    
                     276    NAJVYSSIE  MACRO
                     277            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     278            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
DEBUG                                                                                                         PAGE 6

                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     279            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     280            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     281     ; LL1: 
                     282            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     283            clr     C               ; Inak shiftnem o 2
                     284            rrc     A               ;
                     285            clr     C               ;
                     286            rrc     A               ;
                     287            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     288    ; LL2:
                     289            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     290            clr     C               ;
                     291            subb    A, R0           ;
                     292    ENDM
                     293    
                     294    VYSSIE_KABINA  MACRO  POSCH
                     295            mov     A, INPORTA
                     296            anl     A, #00011110b
                     297            clr     C
                     298            rrc     A
                     299    ;LL1    
                     300            mov     R0, #&POSCH
                     301            clr     C
                     302            rrc     A
                     303            djnz    R0, $-2;LL1
                     304    ENDM
                     305    
                     306    NIZSIE_KABINA  MACRO  POSCH
                     307            mov     A, #5
                     308            clr     C
                     309            subb    A, #&POSCH
                     310            mov     R0, A
                     311            mov     A, INPORTA
                     312            anl     A, #00011110b
                     313            clr     C
                     314            rlc     A
                     315            clr     C
                     316            rlc     A
                     317            clr     C
                     318            rlc     A
                     319    ;LL1   
                     320            clr     C
                     321            rlc     A
                     322            djnz    R0, $-2;LL1
                     323    ENDM
                     324    
                     325    POLOHA_LED  MACRO  POLOHA
                     326            clr     LEDU            
                     327            clr     LEDD 
                     328            clr     FLED1             
                     329            clr     FLED2                
                     330            clr     FLED3           
                     331            clr     FLED4           
DEBUG                                                                                                         PAGE 7

                     332            setb    FLED&POLOHA
                     333            lcall   WRITEPORTS
                     334    ENDM
                     335    
                     336    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               337    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     338                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     339                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     340    ;osetrenie vektorov preruseni
0000                 341            org     0000h           ; adresa odkial startuje program po resete
0000 020033          342            ljmp    START           ; skok na zaciatok kodu programu
                     343            
000B                 344            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 02084D          345            ljmp    INT_TIMER0      ; pre citac T0
                     346                  
0033                 347            org     0033h           ; od tejto adresy sa zacina kod programu
                     348            
0033                 349    START:
0033                 350    RESET:  
                     351            ; riadiace signaly do pasivnej urovne 
0033 D2B6            352            setb    WRNOT
0035 D2B7            353            setb    RDNOT
0037 753300          354            mov     STOPTIMER, #0
003A 758140          355            mov     SP, #STACK
                     356    
                     357            ; pockame si na inicializaciu obvodov 8255  
003D 7900            358            mov     R1, #0 
003F 7AFF            359            mov     R2, #0ffh
0041 D9FE            360            djnz    R1, $
0043 DAFC            361            djnz    R2, $-2
                     362            
                     363            ; teraz ich mozeme nastavit
0045 75809B          364            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          365            mov     p2, #i8255INCW
004B C2B6            366            clr     WRNOT
004D 00              367            nop
004E 00              368            nop
004F 00              369            nop
0050 00              370            nop
0051 D2B6            371            setb    WRNOT
0053 758080          372            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          373            mov     p2, #i8255OUTCW
0059 C2B6            374            clr     WRNOT
005B 00              375            nop
005C 00              376            nop
005D 00              377            nop
005E 00              378            nop
005F D2B6            379            setb    WRNOT
                     380            
                     381            ;_BP_
                     382            
                     383            ;-----------------------
                     384            ; Prerusenia
                     385            ;----------------------- 
                     386            ;clr     TR1                 ; zastavi sa citac T1
                     387            ;clr     TR0                 ; a tiez citac T0
DEBUG                                                                                                         PAGE 8

                     388            ;mov     SCON,#01010010b     ; nastavenie registra SCON
                     389            ;                            ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     390            ;                            ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     391            ;                            ; RI=0 (prijimaci register - nebol prijaty znak)
                     392            ;mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
                     393            ;mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     394            ;                            ; T1: mod 2 - po preteceni sa TL nastavi na hodnotu TH
                                                                               
                     395            ;                            ; GATE=0 (programove riadenie casovaca)
                     396            ;                            ; C/T#=0 interne hodiny/12
                     397            ;                            ; T0: mod 1 - 16 bitove pocitadlo
                     398            ;                            ; GATE=0 (programove riadenie casovaca)
                     399            ;                            ; C/T#=0 interne hodiny/12
                     400            ;mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila preno
                                                                               sova rychlost seriovej linky
                     401            ;mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
                     402            ;mov     TH1,#TIMERCONST     ; 
                     403            ;mov     TL0, #0D2h           ; inicializacia casovaca T0 65409,92(- 57600 = 0e100h 
                                                                               - to bolo)
                     404            ;mov     TH0, #0FFh
                     405    
                     406            ;setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     407            ;_BP_
                     408    
                     409    ;       ;setb    EX0                 ; prerusenie INT0  - ostava zakazane, signal STOP osetr
                                                                               ime priamo v hlavnej slucke
                     410    ;       ;setb    ES                  ; prerusenie seriovej linky teraz nevyuzivame
                     411            ;setb    ET0                 ; povolime prerusenia od casovaca T0
                     412            ;setb    TR0
                     413            ;setb    EA                  ; spust cely prerusovaci mechanizmus
                     414            
0061 758801          415            mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
0064 758911          416            mov     TMOD,#00010001b     ; nastavenie TMOD registra
                     417                                        ; T1: mod 1 - 16 bitove pocitadlo
                     418                                        ; GATE=0 (programove riadenie casovaca)
                     419                                        ; C/T#=0 interne hodiny/12
                     420                                        ; T0: mod 1 - 16 bitove pocitadlo
                     421                                        ; GATE=0 (programove riadenie casovaca)
                     422                                        ; C/T#=0 interne hodiny/12
0067 758700          423            mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila prenos
                                                                               ova rychlost seriovej linky
006A 758A00          424            mov     TL0, #000h           ; inicializacia casovaca T0 - 57600 = 0e100h
006D 758C4C          425            mov     TH0, #04Ch
                     426            
0070 D28C            427            setb    TR0
                     428            
                     429            ;-----------------------
                     430            ; Prerusenia
                     431            ;-----------------------
                     432            
                     433    
                     434            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0072 752800          435            mov     INPORTA, #0
0075 75211E          436            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0078 752200          437            mov     INPORTC, #0
007B 75231E          438            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
007E 7524F0          439            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0081 7525FF          440            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
DEBUG                                                                                                         PAGE 9

                                                                                or bmLEDU)
0084 D218            441            setb    KS
0086 C238            442            clr     STOPPED
0088 120958          443            call    WRITEPORTS          ; zapis novu informaciu
                     444    ;;;;;;;;
                     445    
008B 752300          446            mov     OUTPORTA, #0
008E 752400          447            mov     OUTPORTB, #0
0091 752500          448            mov     OUTPORTC, #0
0094 120958          449            call    WRITEPORTS          ; zapis novu informaciu
                     450    
0097 752800          451            mov     INPORTA, #0
009A 752100          452            mov     INPORTB, #0         
009D 752200          453            mov     INPORTC, #0
00A0 1208F9          454            call    READPORTS           ; prvotne nacitanie udajov
                     455    
00A3                 456    CALIB:
                     457            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     458            ;setb    TR0
00A3 1208F9          459            lcall   READPORTS                   ; precitaj, co je na portoch
00A6 300C11          460            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00A9 D221            461            setb    DOWN                        ; inak pod dole
00AB D222            462            setb    FAST                        ; a rychlo
00AD C223            463            clr     SLOW                        ;
00AF 120958          464            lcall   WRITEPORTS                  ; zapis informaciu 
00B2                 465    CALIBLOOP:
00B2 1208F9          466            lcall   READPORTS                   ; 
00B5 300C02          467            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00B8 80F8            468            jmp     CALIBLOOP
00BA                 469    CALIBEND:                              
00BA C222            470            clr     FAST                        ; zastavime v tomto smere
00BC C221            471            clr     DOWN                        ;
00BE D223            472            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00C0 D220            473            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00C2 120958          474            lcall   WRITEPORTS 
00C5                 475    CALIBEND2:
00C5 1208F9          476            lcall   READPORTS                   ; 
00C8 2009FA          477            jb      MB1, CALIBEND2              ; 
00CB C223            478            clr     SLOW                        ; A teraz sme uz naozaj spravne
00CD C220            479            clr     UP                          ; 
00CF D224            480            setb    FLED1
00D1 120958          481            lcall   WRITEPORTS                  ; zapis informaciu
                     482            ;clr     TR0
                     483 +1         _BP_
00D4 C2B3            484 +1         clr     P3.3
00D6 D2AA            485 +1         setb    EX1
00D8 00              486 +1         nop
00D9 00              487 +1         nop
00DA                 489    MAIN:
                     490    
                     491    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     492    ; ****************************************************************************
                     493    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     494    ; ----------------------------------------------------------------------------
                     495    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     496    ; ----------------------------------------------------------------------------
DEBUG                                                                                                         PAGE 10

                     497    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     498    ; ****************************************************************************
                     499    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     500    ; ----------------------------------------------------------------------------
                     501    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     502    ; ----------------------------------------------------------------------------
                     503    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     504    ; ****************************************************************************
                     505    ; POSITION
                     506    ; ****************************************************************************
                     507    
                     508    
                     509 +1         _BP_
00DA C2B3            510 +1         clr     P3.3
00DC D2AA            511 +1         setb    EX1
00DE 00              512 +1         nop
00DF 00              513 +1         nop
00E0 7D00            515            mov     R5, #0
00E2 7E14            516            mov     R6, #20
00E4 D2A9            517            setb    ET0;
                     518            
                     519    
                     520    
                     521    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     522    
00E6                 523    FLOOR1:
                     524 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00E6 C22F            525 +1         clr     LEDU            
00E8 C22E            526 +1         clr     LEDD 
00EA C224            527 +1         clr     FLED1             
00EC C225            528 +1         clr     FLED2                
00EE C226            529 +1         clr     FLED3           
00F0 C227            530 +1         clr     FLED4           
00F2 D224            531 +1         setb    FLED1
00F4 120958          532 +1         lcall   WRITEPORTS
00F7 1208B1          534            lcall   WAITFORTIMER    ; simulacia TIMERu
00FA 1208F9          535    F1S:    lcall   READPORTS     ;-; nacitanie dat
00FD C219            536            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00FF C228            537            clr     PO1             ;
0101 120958          538            lcall   WRITEPORTS      ;
0104 200FF3          539            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0107 E528            540            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
0109 541C            541            anl     A, #00011100b ;-;
010B 7008            542            jnz     F1OK          ;-; ak ano, podme na to
010D E522            543            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
010F 543E            544            anl     A, #00111110b ;-;
0111 7002            545            jnz     F1OK          ;-; ak ano, podme na to
0113 80E5            546            jmp     F1S             ; Nemam sa kde hnut, opakujem
0115 D220            547    F1OK:   setb    UP              ; rychly pohyb hore
0117 D222            548            setb    FAST            ; 
0119 C223            549            clr     SLOW            ;
011B 120958          550            lcall   WRITEPORTS      ; 
011E 020121          551            jmp     UP1           ;-; prejdi do stavu UP1
0121                 552    UP1:
DEBUG                                                                                                         PAGE 11

                     553 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0121 C22F            554 +1         clr     LEDU            
0123 C22E            555 +1         clr     LEDD 
0125 C224            556 +1         clr     FLED1             
0127 C225            557 +1         clr     FLED2                
0129 C226            558 +1         clr     FLED3           
012B C227            559 +1         clr     FLED4           
012D D224            560 +1         setb    FLED1
012F 120958          561 +1         lcall   WRITEPORTS
                     563 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0132 12087C          564 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0135 1208F9          565 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0138 3009FA          566 +1         jnb     MB1, $-3  ; 
013B 12087C          567 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
013E 1208F9          569    UP1A:   lcall   READPORTS       ; nacitanie dat
                     570 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0141 200B03          571 +1         jb      SKRH, $+6
0144 020805          572 +1         ljmp    ERR_SKRH
0147 00              573 +1         nop
                     575 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0148 200903          576 +1         jb      MB1, $+6
014B 0207EA          577 +1         ljmp    ERR_2SPOM_C
014E 00              578 +1         nop
014F 200AEC          580            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     581 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0152 12087C          582 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0155 1208F9          583 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0158 300AFA          584 +1         jnb     MB2, $-3  ; 
015B 12087C          585 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
015E D22E            587            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0160 120958          588            lcall   WRITEPORTS      ;
0163 020166          589            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0166                 590    UP1_MB2:
0166 1208F9          591            lcall   READPORTS       ; nacitanie dat
                     592 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0169 200B03          593 +1         jb      SKRH, $+6
016C 020805          594 +1         ljmp    ERR_SKRH
016F 00              595 +1         nop
                     597 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0170 200903          598 +1         jb      MB1, $+6
0173 0207DB          599 +1         ljmp    ERR_1SPOM_C
0176 00              600 +1         nop
0177 200AEC          602            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
017A D22F            603            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
017C 120958          604            lcall   WRITEPORTS      ;   
                     605 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
017F 12087C          606 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0182 1208F9          607 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0185 300AFA          608 +1         jnb     MB2, $-3  ; 
0188 12087C          609 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     611    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     612    ;        anl     A, #00000100b ;-;
DEBUG                                                                                                         PAGE 12

                     613    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     614 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     615 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
018B C3              616 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
018C 7400            617 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
018E 7212            618 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0190 B00E            619 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0192 7242            620 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0194 720F            621 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0196 7238            622 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0198 3400            623 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
019A 702E            625            jnz     U1_MB2C       ;-; Ak ano, zastav
                     626 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
019C E522            627 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
019E 33              628 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
019F 547E            629 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
01A1 7805            630 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     631 +1  ; LL1: 
01A3 6006            632 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
01A5 C3              633 +1         clr     C               ; Inak shiftnem o 2
01A6 13              634 +1         rrc     A               ;
01A7 C3              635 +1         clr     C               ;
01A8 13              636 +1         rrc     A               ;
01A9 D8F8            637 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     638 +1 ; LL2:
01AB 7405            639 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
01AD C3              640 +1         clr     C               ;
01AE 98              641 +1         subb    A, R0           ;
                     643 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
01AF B40203          644 +1         cjne    A, #2, $+6
01B2 0201B8          645 +1         jmp     $+6
01B5 0201D4          646 +1         ljmp    UP1_MB1
01B8 00              647 +1         nop
                     649 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
01B9 E528            650 +1         mov     A, INPORTA
01BB 541E            651 +1         anl     A, #00011110b
01BD C3              652 +1         clr     C
01BE 13              653 +1         rrc     A
                     654 +1 ;LL1    
01BF 7802            655 +1         mov     R0, #2
01C1 C3              656 +1         clr     C
01C2 13              657 +1         rrc     A
01C3 D8FC            658 +1         djnz    R0, $-2;LL1
DEBUG                                                                                                         PAGE 13

01C5 6003            660            jz      U1_MB2C         ; |   ak neni zastavujem         
01C7 0201D4          661            jmp     UP1_MB1          ; |   inak nezastavim        
01CA D223            662    U1_MB2C: setb    SLOW            ;       Ak ano, spomalme
01CC C222            663            clr     FAST            ; 
01CE 120958          664            lcall   WRITEPORTS      ;         
01D1 0201D4          665            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
01D4                 666    UP1_MB1:
01D4 1208F9          667            lcall   READPORTS       ; nacitanie dat
                     668 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01D7 200B03          669 +1         jb      SKRH, $+6
01DA 020805          670 +1         ljmp    ERR_SKRH
01DD 00              671 +1         nop
                     673 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
01DE 200A03          674 +1         jb      MB2, $+6
01E1 0207F9          675 +1         ljmp    ERR_ZAST_C
01E4 00              676 +1         nop
01E5 2009EC          678            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     679    
                     680 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     681 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
01E8 C3              682 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
01E9 7400            683 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
01EB 7212            684 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
01ED B00E            685 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
01EF 7242            686 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
01F1 720F            687 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
01F3 7238            688 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
01F5 3400            689 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01F7 C238            691            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
01F9 702E            692            jnz     U1_MB1C       ;-; Ak ano, zastav
                     693 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01FB E522            694 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01FD 33              695 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01FE 547E            696 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0200 7805            697 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     698 +1  ; LL1: 
0202 6006            699 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0204 C3              700 +1         clr     C               ; Inak shiftnem o 2
0205 13              701 +1         rrc     A               ;
0206 C3              702 +1         clr     C               ;
0207 13              703 +1         rrc     A               ;
0208 D8F8            704 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     705 +1 ; LL2:
020A 7405            706 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
DEBUG                                                                                                         PAGE 14

020C C3              707 +1         clr     C               ;
020D 98              708 +1         subb    A, R0           ;
                     710 +1         LCJNE   A, #2, UP2      ; |   ak nie, nezastavujeme 
020E B40203          711 +1         cjne    A, #2, $+6
0211 020217          712 +1         jmp     $+6
0214 0202B3          713 +1         ljmp    UP2
0217 00              714 +1         nop
                     716 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0218 E528            717 +1         mov     A, INPORTA
021A 541E            718 +1         anl     A, #00011110b
021C C3              719 +1         clr     C
021D 13              720 +1         rrc     A
                     721 +1 ;LL1    
021E 7802            722 +1         mov     R0, #2
0220 C3              723 +1         clr     C
0221 13              724 +1         rrc     A
0222 D8FC            725 +1         djnz    R0, $-2;LL1
0224 6003            727            jz      U1_MB1C         ; |   ak neni zastavujem         
0226 0202B3          728            ljmp    UP2             ; |   inak nezastavim        
0229 C220            729    U1_MB1C: clr     UP              ; zastav motor
022B D23A            730            setb    UPOld           ;       (a zalohuj) 
022D C23B            731            clr     DOWNOld         ;       (a zalohuj)
022F C222            732            clr     FAST            ; 
0231 120958          733            lcall   WRITEPORTS      ; 
0234 020237          734            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     735    
                     736    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     737    
0237                 738    FLOOR2:
                     739 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0237 C22F            740 +1         clr     LEDU            
0239 C22E            741 +1         clr     LEDD 
023B C224            742 +1         clr     FLED1             
023D C225            743 +1         clr     FLED2                
023F C226            744 +1         clr     FLED3           
0241 C227            745 +1         clr     FLED4           
0243 D225            746 +1         setb    FLED2
0245 120958          747 +1         lcall   WRITEPORTS
0248 1208B1          749            lcall   WAITFORTIMER    ; simulacia TIMERu
024B 1208F9          750    F2S:    lcall   READPORTS     ;-; nacitanie dat
024E C21A            751            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0250 C22A            752            clr     PO2U            ;
0252 C229            753            clr     PO2D            ;
0254 120958          754            lcall   WRITEPORTS      ;
0257 200FF1          755            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
025A 79F8            756            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
025C 7AF8            757            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
025E 203A06          758            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0261 E9              759            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0262 F4              760            cpl     A               ;       |
0263 F9              761            mov     R1, A           ;       |
0264 EA              762            mov     A, R2           ;       A znegujeme aj masku sachty
DEBUG                                                                                                         PAGE 15

0265 F4              763            cpl     A               ;       |
0266 FA              764            mov     R2, A           ;       |
0267                 765    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0267 E528            766            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0269 541A            767            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
026B 59              768            anl     A, R1           ;  | 
026C 7027            769            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     770                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
026E E528            771            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0270 541A            772            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0272 7007            773            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0274 E522            774            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0276 5439            775            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0278 5A              776            anl     A, R2           ;  |   
0279 701A            777            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     778            ; Pohyb v opacnom smere (nevieme v ktorom)
027B B23A            779    F2SW:   cpl     UPOld           ;  Znegujem stary posun
027D B23B            780            cpl     DOWNOld         ;  |
027F E9              781            mov     A, R1           ;  Znegujeme masky
0280 F4              782            cpl     A               ;  |
0281 F9              783            mov     R1, A           ;  |
0282 EA              784            mov     A, R2           ;  |
0283 F4              785            cpl     A               ;  |
0284 FA              786            mov     R2, A           ;  |               
0285 E528            787            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0287 541A            788            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0289 59              789            anl     A, R1           ;  | 
028A 7009            790            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
028C E522            791            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
028E 5439            792            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0290 5A              793            anl     A, R2           ;  | 
0291 7002            794            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0293 80B6            795            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0295 203A03          796    F2:     jb      UPOld, F2UP     ;   
0298 0202A7          797            jmp     F2DOWN          ;
029B D220            798    F2UP:   setb    UP              ; rychly pohyb hore
029D D222            799            setb    FAST            ; 
029F C223            800            clr     SLOW            ;
02A1 120958          801            lcall   WRITEPORTS      ; 
02A4 0202B3          802            jmp     UP2           ;-; prejdi do stavu UP2    
02A7 D221            803    F2DOWN: setb    DOWN            ; rychly pohyb hore
02A9 D222            804            setb    FAST            ; 
02AB C223            805            clr     SLOW            ;
02AD 120958          806            lcall   WRITEPORTS      ; 
02B0 0203C9          807            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     808            
                     809                
02B3                 810    UP2:
                     811 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02B3 C22F            812 +1         clr     LEDU            
02B5 C22E            813 +1         clr     LEDD 
02B7 C224            814 +1         clr     FLED1             
DEBUG                                                                                                         PAGE 16

02B9 C225            815 +1         clr     FLED2                
02BB C226            816 +1         clr     FLED3           
02BD C227            817 +1         clr     FLED4           
02BF D225            818 +1         setb    FLED2
02C1 120958          819 +1         lcall   WRITEPORTS
                     821 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02C4 12087C          822 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02C7 1208F9          823 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02CA 3009FA          824 +1         jnb     MB1, $-3  ; 
02CD 12087C          825 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02D0 1208F9          827    UP2A:   lcall   READPORTS       ; nacitanie dat
                     828 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02D3 200B03          829 +1         jb      SKRH, $+6
02D6 020805          830 +1         ljmp    ERR_SKRH
02D9 00              831 +1         nop
                     833 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02DA 200903          834 +1         jb      MB1, $+6
02DD 0207EA          835 +1         ljmp    ERR_2SPOM_C
02E0 00              836 +1         nop
02E1 200AEC          838            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     839 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02E4 12087C          840 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02E7 1208F9          841 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02EA 300AFA          842 +1         jnb     MB2, $-3  ; 
02ED 12087C          843 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02F0 D22E            845            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02F2 120958          846            lcall   WRITEPORTS      ;
02F5 0202F8          847            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
02F8                 848    UP2_MB2:
02F8 1208F9          849            lcall   READPORTS       ; nacitanie dat
                     850 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02FB 200B03          851 +1         jb      SKRH, $+6
02FE 020805          852 +1         ljmp    ERR_SKRH
0301 00              853 +1         nop
                     855 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0302 200903          856 +1         jb      MB1, $+6
0305 0207DB          857 +1         ljmp    ERR_1SPOM_C
0308 00              858 +1         nop
0309 200AEC          860            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
030C D22F            861            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
030E 120958          862            lcall   WRITEPORTS      ;
                     863 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0311 12087C          864 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0314 1208F9          865 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0317 300AFA          866 +1         jnb     MB2, $-3  ; 
031A 12087C          867 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     869    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     870    ;        anl     A, #00001000b ;-;
                     871    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                     872 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     873 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
DEBUG                                                                                                         PAGE 17

031D C3              874 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
031E 7400            875 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0320 7214            876 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0322 B00E            877 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0324 7243            878 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0326 720F            879 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0328 7238            880 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
032A 3400            881 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
032C 702E            883            jnz     U2_MB2C       ;-; Ak ano, zastav
                     884 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
032E E522            885 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0330 33              886 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0331 547E            887 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0333 7805            888 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     889 +1  ; LL1: 
0335 6006            890 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0337 C3              891 +1         clr     C               ; Inak shiftnem o 2
0338 13              892 +1         rrc     A               ;
0339 C3              893 +1         clr     C               ;
033A 13              894 +1         rrc     A               ;
033B D8F8            895 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     896 +1 ; LL2:
033D 7405            897 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
033F C3              898 +1         clr     C               ;
0340 98              899 +1         subb    A, R0           ;
                     901 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
0341 B40303          902 +1         cjne    A, #3, $+6
0344 02034A          903 +1         jmp     $+6
0347 020366          904 +1         ljmp    UP2_MB1
034A 00              905 +1         nop
                     907 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
034B E528            908 +1         mov     A, INPORTA
034D 541E            909 +1         anl     A, #00011110b
034F C3              910 +1         clr     C
0350 13              911 +1         rrc     A
                     912 +1 ;LL1    
0351 7803            913 +1         mov     R0, #3
0353 C3              914 +1         clr     C
0354 13              915 +1         rrc     A
0355 D8FC            916 +1         djnz    R0, $-2;LL1
0357 6003            918            jz      U2_MB2C         ; |   ak neni zastavujem  
0359 020366          919            ljmp    UP2_MB1         ; |   inak nezastavim
035C D223            920    U2_MB2C: setb    SLOW            ;       Ak ano, spomalme
035E C222            921            clr     FAST            ; 
0360 120958          922            lcall   WRITEPORTS      ;
DEBUG                                                                                                         PAGE 18

0363 020366          923            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0366                 924    UP2_MB1:
0366 1208F9          925            lcall   READPORTS       ; nacitanie dat
                     926 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0369 200B03          927 +1         jb      SKRH, $+6
036C 020805          928 +1         ljmp    ERR_SKRH
036F 00              929 +1         nop
                     931 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0370 200A03          932 +1         jb      MB2, $+6
0373 0207F9          933 +1         ljmp    ERR_ZAST_C
0376 00              934 +1         nop
0377 2009EC          936            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     937            
                     938 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     939 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
037A C3              940 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
037B 7400            941 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
037D 7214            942 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
037F B00E            943 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0381 7243            944 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0383 720F            945 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0385 7238            946 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0387 3400            947 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0389 C238            949            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
038B 702E            950            jnz     U2_MB1C       ;-; Ak ano, zastav
                     951 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
038D E522            952 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
038F 33              953 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0390 547E            954 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0392 7805            955 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     956 +1  ; LL1: 
0394 6006            957 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0396 C3              958 +1         clr     C               ; Inak shiftnem o 2
0397 13              959 +1         rrc     A               ;
0398 C3              960 +1         clr     C               ;
0399 13              961 +1         rrc     A               ;
039A D8F8            962 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     963 +1 ; LL2:
039C 7405            964 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
039E C3              965 +1         clr     C               ;
039F 98              966 +1         subb    A, R0           ;
                     968 +1         LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
03A0 B40303          969 +1         cjne    A, #3, $+6
03A3 0203A9          970 +1         jmp     $+6
DEBUG                                                                                                         PAGE 19

03A6 0204D3          971 +1         ljmp    UP3
03A9 00              972 +1         nop
                     974 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
03AA E528            975 +1         mov     A, INPORTA
03AC 541E            976 +1         anl     A, #00011110b
03AE C3              977 +1         clr     C
03AF 13              978 +1         rrc     A
                     979 +1 ;LL1    
03B0 7803            980 +1         mov     R0, #3
03B2 C3              981 +1         clr     C
03B3 13              982 +1         rrc     A
03B4 D8FC            983 +1         djnz    R0, $-2;LL1
03B6 6003            985            jz      U2_MB1C         ; |   ak neni zastavujem  
03B8 0204D3          986            ljmp    UP3             ; |   inak nezastavim
03BB C220            987    U2_MB1C: clr     UP              ; zastav motor
03BD D23A            988            setb    UPOld           ;       (a zalohuj)
03BF C23B            989            clr     DOWNOld         ;       (a zalohuj)
03C1 C222            990            clr     FAST            ; 
03C3 120958          991            lcall   WRITEPORTS      ; 
03C6 020457          992            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
03C9                 993    DOWN2:
                     994 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03C9 C22F            995 +1         clr     LEDU            
03CB C22E            996 +1         clr     LEDD 
03CD C224            997 +1         clr     FLED1             
03CF C225            998 +1         clr     FLED2                
03D1 C226            999 +1         clr     FLED3           
03D3 C227           1000 +1         clr     FLED4           
03D5 D225           1001 +1         setb    FLED2
03D7 120958         1002 +1         lcall   WRITEPORTS
                    1004 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03DA 12087C         1005 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03DD 1208F9         1006 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03E0 3009FA         1007 +1         jnb     MB1, $-3  ; 
03E3 12087C         1008 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03E6 1208F9         1010            lcall   READPORTS       ; nacitanie dat
                    1011 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03E9 200C03         1012 +1         jb      SKRD, $+6
03EC 020802         1013 +1         ljmp    ERR_SKRD
03EF 00             1014 +1         nop
                    1016 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03F0 200903         1017 +1         jb      MB1, $+6
03F3 0207EA         1018 +1         ljmp    ERR_2SPOM_C
03F6 00             1019 +1         nop
03F7 200ACF         1021            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                    1022 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
03FA 12087C         1023 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03FD 1208F9         1024 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0400 300AFA         1025 +1         jnb     MB2, $-3  ; 
0403 12087C         1026 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0406 D22F           1028            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0408 120958         1029            lcall   WRITEPORTS      ;
DEBUG                                                                                                         PAGE 20

040B 02040E         1030            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
040E                1031    DOWN2_MB2:
040E 1208F9         1032            lcall   READPORTS       ; nacitanie dat
                    1033 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0411 200C03         1034 +1         jb      SKRD, $+6
0414 020802         1035 +1         ljmp    ERR_SKRD
0417 00             1036 +1         nop
                    1038 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0418 200903         1039 +1         jb      MB1, $+6
041B 0207DB         1040 +1         ljmp    ERR_1SPOM_C
041E 00             1041 +1         nop
041F 200AEC         1043            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0422 D22E           1044            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0424 120958         1045            lcall   WRITEPORTS      ;
                    1046 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0427 12087C         1047 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
042A 1208F9         1048 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
042D 300AFA         1049 +1         jnb     MB2, $-3  ; 
0430 12087C         1050 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1052    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1053    ;        anl     A, #00000010b ;-;
                    1054    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0433 D223           1055            setb    SLOW            ;       Ak ano, spomalme
0435 C222           1056            clr     FAST            ; 
0437 120958         1057            lcall   WRITEPORTS      ;
043A 02043D         1058            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
043D                1059    DOWN2_MB1:    
043D 1208F9         1060            lcall   READPORTS       ; nacitanie dat
0440 300C05         1061            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0443 300902         1062            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0446 80F5           1063            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
0448 C238           1064    D2_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
044A C221           1065            clr     DOWN            ; zastav motor
044C D23B           1066            setb    DOWNOld         ;       (a zalohuj)
044E C23A           1067            clr     UPOld           ;       (a zalohuj)
0450 C222           1068            clr     FAST            ; 
0452 120958         1069            lcall   WRITEPORTS      ; 
0455 01E6           1070            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                    1071    
                    1072    
                    1073    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                    1074    
0457                1075    FLOOR3:
                    1076 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0457 C22F           1077 +1         clr     LEDU            
0459 C22E           1078 +1         clr     LEDD 
045B C224           1079 +1         clr     FLED1             
045D C225           1080 +1         clr     FLED2                
045F C226           1081 +1         clr     FLED3           
0461 C227           1082 +1         clr     FLED4           
0463 D226           1083 +1         setb    FLED3
0465 120958         1084 +1         lcall   WRITEPORTS
DEBUG                                                                                                         PAGE 21

0468 1208B1         1086            lcall   WAITFORTIMER    ; simulacia TIMERu
046B 1208F9         1087    F3S:    lcall   READPORTS     ;-; nacitanie dat
046E C21B           1088            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0470 C22C           1089            clr     PO3U            ;
0472 C22B           1090            clr     PO3D            ;
0474 120958         1091            lcall   WRITEPORTS      ;
0477 200FF1         1092            jb      DPK, F3S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
047A 79F0           1093            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
047C 7AE0           1094            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
047E 203A06         1095            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0481 E9             1096            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0482 F4             1097            cpl     A               ;       |
0483 F9             1098            mov     R1, A           ;       |
0484 EA             1099            mov     A, R2           ;       A znegujeme aj masku sachty
0485 F4             1100            cpl     A               ;       |
0486 FA             1101            mov     R2, A           ;       |        
0487                1102    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0487 E528           1103            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0489 5416           1104            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
048B 59             1105            anl     A, R1           ;  | 
048C 7027           1106            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1107                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
048E E528           1108            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0490 5416           1109            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0492 7007           1110            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0494 E522           1111            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0496 5427           1112            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0498 5A             1113            anl     A, R2           ;  |   
0499 701A           1114            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1115            ; Pohyb v opacnom smere (nevieme v ktorom)
049B B23A           1116    F3SW:   cpl     UPOld           ;  Znegujem stary posun
049D B23B           1117            cpl     DOWNOld         ;  |
049F E9             1118            mov     A, R1           ;  Znegujeme masky
04A0 F4             1119            cpl     A               ;  |
04A1 F9             1120            mov     R1, A           ;  |
04A2 EA             1121            mov     A, R2           ;  |
04A3 F4             1122            cpl     A               ;  |
04A4 FA             1123            mov     R2, A           ;  |               
04A5 E528           1124            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
04A7 5416           1125            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
04A9 59             1126            anl     A, R1           ;  | 
04AA 7009           1127            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
04AC E522           1128            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
04AE 5427           1129            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
04B0 5A             1130            anl     A, R2           ;  | 
04B1 7002           1131            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
04B3 80B6           1132            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
04B5 203A03         1133    F3:     jb      UPOld, F3UP     ;   
04B8 0204C7         1134            jmp     F3DOWN          ;
04BB D220           1135    F3UP:   setb    UP              ; rychly pohyb hore
04BD D222           1136            setb    FAST            ; 
DEBUG                                                                                                         PAGE 22

04BF C223           1137            clr     SLOW            ;
04C1 120958         1138            lcall   WRITEPORTS      ; 
04C4 0204D3         1139            jmp     UP3           ;-; prejdi do stavu UP2    
04C7 D221           1140    F3DOWN: setb    DOWN            ; rychly pohyb hore
04C9 D222           1141            setb    FAST            ; 
04CB C223           1142            clr     SLOW            ;
04CD 120958         1143            lcall   WRITEPORTS      ; 
04D0 020562         1144            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1145         
                    1146         
04D3                1147    UP3:
                    1148 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04D3 C22F           1149 +1         clr     LEDU            
04D5 C22E           1150 +1         clr     LEDD 
04D7 C224           1151 +1         clr     FLED1             
04D9 C225           1152 +1         clr     FLED2                
04DB C226           1153 +1         clr     FLED3           
04DD C227           1154 +1         clr     FLED4           
04DF D226           1155 +1         setb    FLED3
04E1 120958         1156 +1         lcall   WRITEPORTS
                    1158 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
04E4 12087C         1159 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04E7 1208F9         1160 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04EA 3009FA         1161 +1         jnb     MB1, $-3  ; 
04ED 12087C         1162 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04F0 1208F9         1164    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1165 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04F3 200B03         1166 +1         jb      SKRH, $+6
04F6 020805         1167 +1         ljmp    ERR_SKRH
04F9 00             1168 +1         nop
                    1170 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
04FA 200903         1171 +1         jb      MB1, $+6
04FD 0207EA         1172 +1         ljmp    ERR_2SPOM_C
0500 00             1173 +1         nop
0501 200AEC         1175            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                    1176 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0504 12087C         1177 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0507 1208F9         1178 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
050A 300AFA         1179 +1         jnb     MB2, $-3  ; 
050D 12087C         1180 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0510 D22E           1182            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0512 120958         1183            lcall   WRITEPORTS      ;
0515 020518         1184            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
0518                1185    UP3_MB2:
0518 1208F9         1186            lcall   READPORTS       ; nacitanie dat
                    1187 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
051B 200B03         1188 +1         jb      SKRH, $+6
051E 020805         1189 +1         ljmp    ERR_SKRH
0521 00             1190 +1         nop
                    1192 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0522 200903         1193 +1         jb      MB1, $+6
0525 0207DB         1194 +1         ljmp    ERR_1SPOM_C
0528 00             1195 +1         nop
DEBUG                                                                                                         PAGE 23

0529 200AEC         1197            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
052C D22F           1198            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
052E 120958         1199            lcall   WRITEPORTS      ;
                    1200 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
0531 12087C         1201 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0534 1208F9         1202 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0537 300AFA         1203 +1         jnb     MB2, $-3  ; 
053A 12087C         1204 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1206    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1207    ;        anl     A, #00010000b ;-;
                    1208    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
053D D223           1209            setb    SLOW            ;       Ak ano, spomalme
053F C222           1210            clr     FAST            ; 
0541 120958         1211            lcall   WRITEPORTS      ;
0544 020547         1212            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0547                1213    UP3_MB1:
0547 1208F9         1214            lcall   READPORTS       ; nacitanie dat
054A 300B05         1215            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
054D 300902         1216            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0550 80F5           1217            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
0552 C238           1218    U3_MB1C: clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0554 C220           1219            clr     UP              ; zastav motor
0556 D23A           1220            setb    UPOld           ;       (a zalohuj)
0558 C23B           1221            clr     DOWNOld         ;       (a zalohuj)
055A C222           1222            clr     FAST            ; 
055C 120958         1223            lcall   WRITEPORTS      ; 
055F 020681         1224            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
0562                1225    DOWN3:
                    1226 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0562 C22F           1227 +1         clr     LEDU            
0564 C22E           1228 +1         clr     LEDD 
0566 C224           1229 +1         clr     FLED1             
0568 C225           1230 +1         clr     FLED2                
056A C226           1231 +1         clr     FLED3           
056C C227           1232 +1         clr     FLED4           
056E D226           1233 +1         setb    FLED3
0570 120958         1234 +1         lcall   WRITEPORTS
                    1236 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0573 12087C         1237 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0576 1208F9         1238 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0579 3009FA         1239 +1         jnb     MB1, $-3  ; 
057C 12087C         1240 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
057F 1208F9         1242            lcall   READPORTS       ; nacitanie dat
                    1243 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0582 200C03         1244 +1         jb      SKRD, $+6
0585 020802         1245 +1         ljmp    ERR_SKRD
0588 00             1246 +1         nop
                    1248 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0589 200903         1249 +1         jb      MB1, $+6
058C 0207EA         1250 +1         ljmp    ERR_2SPOM_C
058F 00             1251 +1         nop
0590 200ACF         1253            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
DEBUG                                                                                                         PAGE 24

                    1254 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
0593 12087C         1255 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0596 1208F9         1256 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0599 300AFA         1257 +1         jnb     MB2, $-3  ; 
059C 12087C         1258 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
059F D22F           1260            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
05A1 120958         1261            lcall   WRITEPORTS      ;
05A4 0205A7         1262            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
05A7                1263    DOWN3_MB2:
05A7 1208F9         1264            lcall   READPORTS       ; nacitanie dat
                    1265 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05AA 200C03         1266 +1         jb      SKRD, $+6
05AD 020802         1267 +1         ljmp    ERR_SKRD
05B0 00             1268 +1         nop
                    1270 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
05B1 200903         1271 +1         jb      MB1, $+6
05B4 0207DB         1272 +1         ljmp    ERR_1SPOM_C
05B7 00             1273 +1         nop
05B8 200AEC         1275            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
05BB D22E           1276            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
05BD 120958         1277            lcall   WRITEPORTS      ;
                    1278 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
05C0 12087C         1279 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
05C3 1208F9         1280 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
05C6 300AFA         1281 +1         jnb     MB2, $-3  ; 
05C9 12087C         1282 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1284    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1285    ;        anl     A, #00000100b ;-;
                    1286    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1287 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1288 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
05CC C3             1289 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
05CD 7400           1290 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
05CF 7211           1291 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
05D1 B00E           1292 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
05D3 7242           1293 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
05D5 720F           1294 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
05D7 7238           1295 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
05D9 3400           1296 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
05DB 7033           1298            jnz     D3_MB2C         ; Ak ano, zastav
                    1299 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
05DD E522           1300 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
05DF 33             1301 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
05E0 547E           1302 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
05E2 7805           1303 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
DEBUG                                                                                                         PAGE 25

                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1304 +1  ; LL1: 
05E4 6006           1305 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
05E6 C3             1306 +1         clr     C               ; Inak shiftnem o 2
05E7 33             1307 +1         rlc     A               ;
05E8 C3             1308 +1         clr     C               ;
05E9 33             1309 +1         rlc     A               ;
05EA D8F8           1310 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1311 +1 ; LL2:
05EC E8             1312 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1314 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
05ED B40203         1315 +1         cjne    A, #2, $+6
05F0 0205F6         1316 +1         jmp     $+6
05F3 02061A         1317 +1         ljmp    DOWN3_MB1
05F6 00             1318 +1         nop
                    1320 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
05F7 7405           1321 +1         mov     A, #5
05F9 C3             1322 +1         clr     C
05FA 9402           1323 +1         subb    A, #2
05FC F8             1324 +1         mov     R0, A
05FD E528           1325 +1         mov     A, INPORTA
05FF 541E           1326 +1         anl     A, #00011110b
0601 C3             1327 +1         clr     C
0602 33             1328 +1         rlc     A
0603 C3             1329 +1         clr     C
0604 33             1330 +1         rlc     A
0605 C3             1331 +1         clr     C
0606 33             1332 +1         rlc     A
                    1333 +1 ;LL1   
0607 C3             1334 +1         clr     C
0608 33             1335 +1         rlc     A
0609 D8FC           1336 +1         djnz    R0, $-2;LL1
060B 6003           1338            jz      D3_MB2C         ; |   ak neni zastavujem                  
060D 02061A         1339            ljmp    DOWN3_MB1       ;-; |        
0610 D223           1340    D3_MB2C: setb    SLOW            ;       Ak ano, spomalme
0612 C222           1341            clr     FAST            ; 
0614 120958         1342            lcall   WRITEPORTS      ;
0617 02061A         1343            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
061A                1344    DOWN3_MB1:    
061A 1208F9         1345            lcall   READPORTS       ; nacitanie dat
                    1346 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
061D 200C03         1347 +1         jb      SKRD, $+6
0620 020802         1348 +1         ljmp    ERR_SKRD
0623 00             1349 +1         nop
                    1351 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0624 200A03         1352 +1         jb      MB2, $+6
0627 0207F9         1353 +1         ljmp    ERR_ZAST_C
062A 00             1354 +1         nop
062B 2009EC         1356            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1357 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1358 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
DEBUG                                                                                                         PAGE 26

062E C3             1359 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
062F 7400           1360 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0631 7211           1361 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0633 B00E           1362 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0635 7242           1363 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0637 720F           1364 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0639 7238           1365 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
063B 3400           1366 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
063D C238           1368            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
063F 7033           1369            jnz     D3_MB1C         ; Ak ano, zastav
                    1370 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0641 E522           1371 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0643 33             1372 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0644 547E           1373 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0646 7805           1374 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1375 +1  ; LL1: 
0648 6006           1376 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
064A C3             1377 +1         clr     C               ; Inak shiftnem o 2
064B 33             1378 +1         rlc     A               ;
064C C3             1379 +1         clr     C               ;
064D 33             1380 +1         rlc     A               ;
064E D8F8           1381 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1382 +1 ; LL2:
0650 E8             1383 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1385 +1         LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
0651 B40203         1386 +1         cjne    A, #2, $+6
0654 02065A         1387 +1         jmp     $+6
0657 0203C9         1388 +1         ljmp    DOWN2
065A 00             1389 +1         nop
                    1391 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
065B 7405           1392 +1         mov     A, #5
065D C3             1393 +1         clr     C
065E 9402           1394 +1         subb    A, #2
0660 F8             1395 +1         mov     R0, A
0661 E528           1396 +1         mov     A, INPORTA
0663 541E           1397 +1         anl     A, #00011110b
0665 C3             1398 +1         clr     C
0666 33             1399 +1         rlc     A
0667 C3             1400 +1         clr     C
0668 33             1401 +1         rlc     A
0669 C3             1402 +1         clr     C
066A 33             1403 +1         rlc     A
                    1404 +1 ;LL1   
066B C3             1405 +1         clr     C
066C 33             1406 +1         rlc     A
DEBUG                                                                                                         PAGE 27

066D D8FC           1407 +1         djnz    R0, $-2;LL1
066F 6003           1409            jz      D3_MB1C         ; |   ak neni zastavujem                  
0671 0203C9         1410            ljmp    DOWN2         ;-; |        
0674 C221           1411    D3_MB1C: clr     DOWN            ; zastav motor
0676 D23B           1412            setb    DOWNOld         ;       (a zalohuj)
0678 C23A           1413            clr     UPOld           ;       (a zalohuj)
067A C222           1414            clr     FAST            ; 
067C 120958         1415            lcall   WRITEPORTS      ; 
067F 4137           1416            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                    1417          
                    1418            
                    1419    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1420    
0681                1421    FLOOR4:
                    1422 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0681 C22F           1423 +1         clr     LEDU            
0683 C22E           1424 +1         clr     LEDD 
0685 C224           1425 +1         clr     FLED1             
0687 C225           1426 +1         clr     FLED2                
0689 C226           1427 +1         clr     FLED3           
068B C227           1428 +1         clr     FLED4           
068D D227           1429 +1         setb    FLED4
068F 120958         1430 +1         lcall   WRITEPORTS
0692 1208B1         1432            lcall   WAITFORTIMER    ; simulacia TIMERu
0695 1208F9         1433    F4S:    lcall   READPORTS     ;-; nacitanie dat
0698 C21C           1434            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
069A C22D           1435            clr     PO4            ;
069C 120958         1436            lcall   WRITEPORTS      ;
069F 200FF3         1437            jb      DPK, F4S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
06A2 E528           1438            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
06A4 540E           1439            anl     A, #00001110b ;-;
06A6 7008           1440            jnz     F4OK          ;-; ak ano, ideme na to
06A8 E522           1441            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
06AA 541F           1442            anl     A, #00011111b ;-;
06AC 7002           1443            jnz     F4OK          ;-; ak ano, ideme na to
06AE 80E5           1444            jmp     F4S             ; Nemam sa kde hnut, opakujem
06B0 D221           1445    F4OK:   setb    DOWN            ; rychly pohyb dole
06B2 D222           1446            setb    FAST            ;
06B4 C223           1447            clr     SLOW            ; 
06B6 120958         1448            lcall   WRITEPORTS      ; 
06B9 0206BC         1449            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
06BC                1450    DOWN4:
                    1451 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
06BC C22F           1452 +1         clr     LEDU            
06BE C22E           1453 +1         clr     LEDD 
06C0 C224           1454 +1         clr     FLED1             
06C2 C225           1455 +1         clr     FLED2                
06C4 C226           1456 +1         clr     FLED3           
06C6 C227           1457 +1         clr     FLED4           
06C8 D227           1458 +1         setb    FLED4
06CA 120958         1459 +1         lcall   WRITEPORTS
                    1461 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
06CD 12087C         1462 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
DEBUG                                                                                                         PAGE 28

06D0 1208F9         1463 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06D3 3009FA         1464 +1         jnb     MB1, $-3  ; 
06D6 12087C         1465 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06D9 1208F9         1467            lcall   READPORTS       ; nacitanie dat
                    1468 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06DC 200C03         1469 +1         jb      SKRD, $+6
06DF 020802         1470 +1         ljmp    ERR_SKRD
06E2 00             1471 +1         nop
                    1473 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
06E3 200903         1474 +1         jb      MB1, $+6
06E6 0207EA         1475 +1         ljmp    ERR_2SPOM_C
06E9 00             1476 +1         nop
06EA 200ACF         1478            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1479 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
06ED 12087C         1480 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06F0 1208F9         1481 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06F3 300AFA         1482 +1         jnb     MB2, $-3  ; 
06F6 12087C         1483 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06F9 D22F           1485            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
06FB 120958         1486            lcall   WRITEPORTS      ;
06FE 020701         1487            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
0701                1488    DOWN4_MB2:
0701 1208F9         1489            lcall   READPORTS       ; nacitanie dat
                    1490 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0704 200C03         1491 +1         jb      SKRD, $+6
0707 020802         1492 +1         ljmp    ERR_SKRD
070A 00             1493 +1         nop
                    1495 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
070B 200903         1496 +1         jb      MB1, $+6
070E 0207DB         1497 +1         ljmp    ERR_1SPOM_C
0711 00             1498 +1         nop
0712 200AEC         1500            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0715 D22E           1501            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0717 120958         1502            lcall   WRITEPORTS      ;
                    1503 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
071A 12087C         1504 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
071D 1208F9         1505 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0720 300AFA         1506 +1         jnb     MB2, $-3  ; 
0723 12087C         1507 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1509    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1510    ;        anl     A, #00001000b ;-;
                    1511    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1512 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1513 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0726 C3             1514 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0727 7400           1515 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0729 7213           1516 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
072B B00E           1517 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
072D 7243           1518 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
072F 720F           1519 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
DEBUG                                                                                                         PAGE 29

                                                                               e)
0731 7238           1520 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0733 3400           1521 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0735 7033           1523            jnz     D4_MB2C       ;-; Ak ano, zastav
                    1524 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0737 E522           1525 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0739 33             1526 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
073A 547E           1527 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
073C 7805           1528 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1529 +1  ; LL1: 
073E 6006           1530 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0740 C3             1531 +1         clr     C               ; Inak shiftnem o 2
0741 33             1532 +1         rlc     A               ;
0742 C3             1533 +1         clr     C               ;
0743 33             1534 +1         rlc     A               ;
0744 D8F8           1535 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1536 +1 ; LL2:
0746 E8             1537 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1539 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
0747 B40303         1540 +1         cjne    A, #3, $+6
074A 020750         1541 +1         jmp     $+6
074D 020774         1542 +1         ljmp    DOWN4_MB1
0750 00             1543 +1         nop
                    1545 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0751 7405           1546 +1         mov     A, #5
0753 C3             1547 +1         clr     C
0754 9403           1548 +1         subb    A, #3
0756 F8             1549 +1         mov     R0, A
0757 E528           1550 +1         mov     A, INPORTA
0759 541E           1551 +1         anl     A, #00011110b
075B C3             1552 +1         clr     C
075C 33             1553 +1         rlc     A
075D C3             1554 +1         clr     C
075E 33             1555 +1         rlc     A
075F C3             1556 +1         clr     C
0760 33             1557 +1         rlc     A
                    1558 +1 ;LL1   
0761 C3             1559 +1         clr     C
0762 33             1560 +1         rlc     A
0763 D8FC           1561 +1         djnz    R0, $-2;LL1
0765 6003           1563            jz      D4_MB2C         ; |   ak neni zastavujem          
0767 020774         1564            ljmp    DOWN4_MB1       ;-; |       
076A D223           1565    D4_MB2C: setb    SLOW            ;       Ak ano, spomalme
076C C222           1566            clr     FAST            ; 
076E 120958         1567            lcall   WRITEPORTS      ;
0771 020774         1568            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
0774                1569    DOWN4_MB1:    
DEBUG                                                                                                         PAGE 30

0774 1208F9         1570            lcall   READPORTS       ; nacitanie dat
                    1571 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0777 200C03         1572 +1         jb      SKRD, $+6
077A 020802         1573 +1         ljmp    ERR_SKRD
077D 00             1574 +1         nop
                    1576 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
077E 200A03         1577 +1         jb      MB2, $+6
0781 0207F9         1578 +1         ljmp    ERR_ZAST_C
0784 00             1579 +1         nop
0785 2009EC         1581            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1582 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1583 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0788 C3             1584 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0789 7400           1585 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
078B 7213           1586 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
078D B00E           1587 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
078F 7243           1588 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0791 720F           1589 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0793 7238           1590 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0795 3400           1591 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0797 C238           1593            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril 
0799 7033           1594            jnz     D4_MB1C       ;-; Ak ano, zastav
                    1595 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
079B E522           1596 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
079D 33             1597 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
079E 547E           1598 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
07A0 7805           1599 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1600 +1  ; LL1: 
07A2 6006           1601 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
07A4 C3             1602 +1         clr     C               ; Inak shiftnem o 2
07A5 33             1603 +1         rlc     A               ;
07A6 C3             1604 +1         clr     C               ;
07A7 33             1605 +1         rlc     A               ;
07A8 D8F8           1606 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1607 +1 ; LL2:
07AA E8             1608 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1610 +1         LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
07AB B40303         1611 +1         cjne    A, #3, $+6
07AE 0207B4         1612 +1         jmp     $+6
07B1 020562         1613 +1         ljmp    DOWN3
07B4 00             1614 +1         nop
                    1616 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
DEBUG                                                                                                         PAGE 31

07B5 7405           1617 +1         mov     A, #5
07B7 C3             1618 +1         clr     C
07B8 9403           1619 +1         subb    A, #3
07BA F8             1620 +1         mov     R0, A
07BB E528           1621 +1         mov     A, INPORTA
07BD 541E           1622 +1         anl     A, #00011110b
07BF C3             1623 +1         clr     C
07C0 33             1624 +1         rlc     A
07C1 C3             1625 +1         clr     C
07C2 33             1626 +1         rlc     A
07C3 C3             1627 +1         clr     C
07C4 33             1628 +1         rlc     A
                    1629 +1 ;LL1   
07C5 C3             1630 +1         clr     C
07C6 33             1631 +1         rlc     A
07C7 D8FC           1632 +1         djnz    R0, $-2;LL1
07C9 6003           1634            jz      D4_MB1C         ; |   ak neni zastavujem          
07CB 020562         1635            ljmp    DOWN3         ;-; |       
07CE C221           1636    D4_MB1C: clr     DOWN            ; zastav motor
07D0 D23B           1637            setb    DOWNOld         ;       (a zalohuj)
07D2 C23A           1638            clr     UPOld           ;       (a zalohuj)
07D4 C222           1639            clr     FAST            ; 
07D6 120958         1640            lcall   WRITEPORTS      ; 
07D9 8157           1641            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1642                    
                    1643      
07DB                1644    ERR_1SPOM_C: 
                    1645            ;clr     UP              ; zastav motor
                    1646            ;clr     DOWN            ; 
                    1647            ;lcall   WRITEPORTS      ; 
                    1648            ;_BP_
                    1649            ;nop
                    1650            ;nop 
                    1651 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07DB 12087C         1652 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07DE 1208F9         1653 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07E1 3009FA         1654 +1         jnb     MB1, $-3  ; 
07E4 12087C         1655 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07E7 020808         1657            ljmp    ERROR1         
                    1658            
07EA                1659    ERR_2SPOM_C: 
                    1660            ;clr     UP              ; zastav motor
                    1661            ;clr     DOWN            ; 
                    1662            ;lcall   WRITEPORTS      ; 
                    1663            ;_BP_
                    1664            ;nop
                    1665            ;nop
                    1666 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07EA 12087C         1667 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07ED 1208F9         1668 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07F0 3009FA         1669 +1         jnb     MB1, $-3  ; 
07F3 12087C         1670 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07F6 020808         1672            ljmp    ERROR1 
                    1673            
07F9                1674    ERR_ZAST_C: 
                    1675            ;clr     UP              ; zastav motor
DEBUG                                                                                                         PAGE 32

                    1676            ;clr     DOWN            ; 
                    1677            ;lcall   WRITEPORTS      ; 
                    1678            ;_BP_
                    1679            ;nop
                    1680            ;nop
                    1681            ;lcall   READPORTS
                    1682            ;clr     FAST
                    1683            ;clr     SLOW
                    1684 +1         _BP_
07F9 C2B3           1685 +1         clr     P3.3
07FB D2AA           1686 +1         setb    EX1
07FD 00             1687 +1         nop
07FE 00             1688 +1         nop
07FF 020808         1690            ljmp    ERROR1  
                    1691            
0802                1692    ERR_SKRD: 
                    1693            ;clr     UP              ; zastav motor
                    1694            ;clr     DOWN            ; 
                    1695            ;lcall   WRITEPORTS      ; 
                    1696            ;_BP_
                    1697            ;nop
                    1698            ;nop
0802 020808         1699            ljmp    ERROR1    
                    1700            
0805                1701    ERR_SKRH: 
                    1702            ;clr     UP              ; zastav motor
                    1703            ;clr     DOWN            ; 
                    1704            ;lcall   WRITEPORTS      ; 
                    1705            ;_BP_
                    1706            ;nop
                    1707            ;nop
0805 020808         1708            ljmp    ERROR1 
                    1709            
0808                1710    ERROR1:         
0808 D22F           1711            setb    LEDU
080A D22E           1712            setb    LEDD
080C C222           1713            clr     FAST
080E D223           1714            setb    SLOW
0810 120958         1715            lcall   WRITEPORTS          
0813 1208F9         1716    ERROR1S:lcall   READPORTS       ; nacitanie dat
0816 300B08         1717            jnb     SKRH, ERROR1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0819 300C05         1718            jnb     SKRD, ERROR1C   ; Sme na dolnej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
081C 300902         1719            jnb     MB1, ERROR1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
081F 80F2           1720            jmp     ERROR1S         ; Ak sme nechytili ani jednu clonku, opakujeme
0821 C220           1721    ERROR1C:clr     UP              ; zastav motor
0823 C221           1722            clr     DOWN            ; 
0825 C222           1723            clr     FAST            ; 
0827 C223           1724            clr     SLOW            ; 
0829 120958         1725            lcall   WRITEPORTS      ; 
082C 1208B1         1726            lcall   WAITFORTIMER    ; simulacia TIMERu
082F 020832         1727            jmp     ERROR2        ;-; a prejdi do stavu ERROR2 
                    1728            
0832 1208F9         1729    ERROR2: lcall   READPORTS       ; nacitanie dat
0835 200DFA         1730            jb      DP, ERROR2      ; uz vystupili vsetci ludia z kabiny?
0838 200FF7         1731            jb      DPK, ERROR2     ; uz vystupili vsetci ludia z kabiny?
DEBUG                                                                                                         PAGE 33

083B 200EF4         1732            jb      DPZK, ERROR2    ; uz vystupili vsetci ludia z kabiny?
083E 020033         1733            ljmp    START
                    1734                           
                    1735                    
0841                1736    ENDPROG:
0841 D218           1737            setb    KS
0843 120958         1738            call    WRITEPORTS                ; zapis novu informaciu
                    1739 +1         _BP_
0846 C2B3           1740 +1         clr     P3.3
0848 D2AA           1741 +1         setb    EX1
084A 00             1742 +1         nop
084B 00             1743 +1         nop
084C 22             1745            ret
                    1746            
                    1747            
                    1748            
                    1749    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1750    ; INT_TIMER0
                    1751    ; Obsluha prerusenia timera 0
                    1752    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;        
084D                1753    INT_TIMER0:
084D C0E0           1754            push    ACC
084F C080           1755            push    P0
0851 C090           1756            push    P1
0853 C0A0           1757            push    P2
0855 C0B0           1758            push    P3
                    1759            ;push    OUTPORTC
                    1760            
0857 ED             1761            mov     A, R5
0858 1D             1762            dec     R5
0859 6002           1763            jz      INT_TIMER0_MAIN    
085B 8014           1764            sjmp    INT_TIMER0_END
085D                1765    INT_TIMER0_MAIN:
085D EE             1766            mov     A, R6
085E FD             1767            mov     R5, A
085F B22F           1768            cpl     LEDU
0861 B22E           1769            cpl     LEDD
                    1770            
0863 852580         1771            mov     p0, OUTPORTC        ; a nakoniec port C
0866 75A0C2         1772            mov     p2, #i8255OUTC
0869 C2B6           1773            clr     WRNOT
086B 00             1774            nop
086C 00             1775            nop
086D 00             1776            nop
086E 00             1777            nop
086F D2B6           1778            setb    WRNOT
                    1779            
                    1780            
0871                1781    INT_TIMER0_END:
                    1782            
                    1783    
                    1784            ;pop     OUTPORTC
0871 D0B0           1785            pop     P3
0873 D0A0           1786            pop     P2
0875 D090           1787            pop     P1
0877 D080           1788            pop     P0        
0879 D0E0           1789            pop     ACC
087B 32             1790            reti 
DEBUG                                                                                                         PAGE 34

                    1791            
                    1792    ;INT_TIMER0:
                    1793    ;        push    ACC
                    1794    ;        mov     A, R7  
                    1795    ;        dec     R7               
                    1796    ;        jnz     INT_TIMER0_END     
                    1797    ;        mov     R7, #20h
                    1798    ;        jb      LEDU, INT_TIMER0_CLEAR       
                    1799    ;        setb    LEDU
                    1800    ;        setb    LEDD
                    1801    ;        jmp     INT_TIMER0_WRITE
                    1802    ;INT_TIMER0_CLEAR:        
                    1803    ;        ;clr     LEDU
                    1804    ;        ;clr     LEDD
                    1805    ;INT_TIMER0_WRITE: 
                    1806    ;        lcall   WRITEPORTS
                    1807    ;INT_TIMER0_END: 
                    1808    ;        setb    LEDU
                    1809    ;        lcall   WRITEPORTS       
                    1810    ;        pop     ACC
                    1811    ;        reti
                    1812            
                    1813            
                    1814    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1815    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1816    ; 11.0592MHz/2000 = zdrzanie 1 ms
087C                1817    TIME10MS:
087C 7963           1818            mov     R1,#063h        ; 2
                    1819                                    ; *** 100x
087E 7AFF           1820    TIME0:  mov     R2,#0FFh        ; 2 
0880 DAFE           1821    TIME1:  djnz    R2,TIME1        ; 256*2   
0882 7AFF           1822            mov     R2,#0FFh        ; 2       
0884 DAFE           1823    TIME2:  djnz    R2,TIME2        ; 256*2 
0886 7A24           1824            mov     R2,#024h        ; 2       
0888 DAFE           1825    TIME3:  djnz    R2,TIME3        ; 36*2
088A 00             1826            nop                     ; 1
088B D9F1           1827            djnz    R1,TIME0        ; 2
                    1828                                    ; ***
088D 792A           1829            mov     R1,#02Ah        ; 2 
088F D9FE           1830    TIME4:  djnz    R1,TIME4        ; 43*2  
0891 22             1831            ret                     ; koniec
                    1832            
                    1833            
                    1834    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1835    ; STOP
                    1836    ; osetri stlacenie tlacidla STOP
                    1837    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0892                1838    STOP:
0892 D238           1839            setb    STOPPED
0894 C222           1840            clr     FAST
0896 C223           1841            clr     SLOW
0898 74E1           1842            mov     A, #11100001b
089A 5223           1843            anl     OUTPORTA, A 
089C 120958         1844            lcall   WRITEPORTS
                    1845            
089F 1208B1         1846            lcall   WAITFORTIMER
08A2 1208B9         1847    STOPC:  lcall   READPORTS1
08A5 E528           1848            mov     A, INPORTA
DEBUG                                                                                                         PAGE 35

08A7 541E           1849            anl     A, #00011110b
08A9 60F7           1850            jz      STOPC     
                    1851            
08AB D223           1852            setb    SLOW
08AD 120958         1853            lcall   WRITEPORTS
08B0 22             1854            ret        
                    1855            
                    1856            
                    1857    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1858    ; DELAY
                    1859    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1860    ; bude timer)
                    1861    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08B1                1862    WAITFORTIMER:
08B1 7B10           1863            mov     R3, #10h
08B3 12087C         1864    DEL1:   lcall   TIME10MS
08B6 DBFB           1865            djnz    R3, DEL1
08B8 22             1866            ret
                    1867            
                    1868    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1869    ; READPORTS1
                    1870    ; precita nove hodnoty na portoch
                    1871    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08B9                1872    READPORTS1:
08B9 C2AF           1873            clr     EA                  ;Treba zakazat prerusenia
                    1874            
08BB 75A080         1875            mov     p2, #i8255INA       ; citaj data z portu A
08BE 75803F         1876            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
08C1 C2B7           1877            clr     RDNOT
08C3 00             1878            nop
08C4 00             1879            nop
08C5 00             1880            nop
08C6 00             1881            nop
08C7 858028         1882            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
08CA D2B7           1883            setb    RDNOT
                    1884            
08CC 75A081         1885            mov     p2, #i8255INB       ; citaj data z portu B
08CF 7580FE         1886            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
08D2 C2B7           1887            clr     RDNOT
08D4 00             1888            nop
08D5 00             1889            nop
08D6 00             1890            nop
08D7 00             1891            nop
08D8 858021         1892            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
08DB D2B7           1893            setb    RDNOT
                    1894    
08DD 75A082         1895            mov     p2, #i8255INC       ; citaj data z portu C
08E0 75803F         1896            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
08E3 C2B7           1897            clr     RDNOT
08E5 00             1898            nop
08E6 00             1899            nop
08E7 00             1900            nop
08E8 00             1901            nop
08E9 858022         1902            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
08EC D2B7           1903            setb    RDNOT
08EE 00             1904            nop
08EF 00             1905            nop
DEBUG                                                                                                         PAGE 36

08F0 00             1906            nop
08F1 00             1907            nop
08F2 00             1908            nop
08F3 00             1909            nop
08F4 00             1910            nop
08F5 00             1911            nop
08F6 D2AF           1912            setb    EA                 ;znovu spustime prerusenia
08F8 22             1913            ret
                    1914    
                    1915    
                    1916    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1917    ; READPORTS
                    1918    ; precita nove hodnoty na portoch
                    1919    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08F9                1920    READPORTS:
08F9 C2AF           1921            clr     EA                  ;Treba zakazat prerusenia
                    1922            
08FB 75A080         1923            mov     p2, #i8255INA       ; citaj data z portu A
08FE 75803F         1924            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0901 C2B7           1925            clr     RDNOT
0903 00             1926            nop
0904 00             1927            nop
0905 00             1928            nop
0906 00             1929            nop
0907 858028         1930            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
090A D2B7           1931            setb    RDNOT
                    1932            
090C 75A081         1933            mov     p2, #i8255INB       ; citaj data z portu B
090F 7580FE         1934            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0912 C2B7           1935            clr     RDNOT
0914 00             1936            nop
0915 00             1937            nop
0916 00             1938            nop
0917 00             1939            nop
0918 858021         1940            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
091B D2B7           1941            setb    RDNOT
                    1942    
091D 75A082         1943            mov     p2, #i8255INC       ; citaj data z portu C
0920 75803F         1944            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0923 C2B7           1945            clr     RDNOT
0925 00             1946            nop
0926 00             1947            nop
0927 00             1948            nop
0928 00             1949            nop
0929 858022         1950            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
092C D2B7           1951            setb    RDNOT
092E 00             1952            nop
092F 00             1953            nop
0930 00             1954            nop
0931 00             1955            nop
0932 00             1956            nop
0933 00             1957            nop
0934 00             1958            nop
0935 00             1959            nop
0936 D2AF           1960            setb    EA                 ;znovu spustime prerusenia
                    1961            
                    1962            
DEBUG                                                                                                         PAGE 37

0938 300F04         1963            jnb     DPK, READPORTS_C1
093B C222           1964            clr     FAST
093D D223           1965            setb    SLOW
093F                1966    READPORTS_C1:         
093F 204003         1967            jb      STOPNOT, READPORTS_C
0942 120892         1968            lcall   STOP
0945                1969    READPORTS_C:        
0945 E528           1970            mov     A, INPORTA
0947 541E           1971            anl     A, #00011110b
0949 4223           1972            orl     OUTPORTA, A
094B 120958         1973            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
094E E522           1974            mov     A, INPORTC
0950 543F           1975            anl     A, #00111111b
0952 4225           1976            orl     OUTPORTC, A
0954 120958         1977            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1978            
                    1979            
0957 22             1980            ret
                    1981            
                    1982    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1983    ; WRITEPORTS
                    1984    ; spravi zalohu vystupnych registrov a posle data von
                    1985    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0958                1986    WRITEPORTS:
0958 C2AF           1987            clr     EA                  ;Treba zakazat prerusenia
                    1988            
095A 852380         1989            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
095D 75A0C0         1990            mov     p2, #i8255OUTA
0960 C2B6           1991            clr     WRNOT
0962 00             1992            nop
0963 00             1993            nop
0964 00             1994            nop
0965 00             1995            nop
0966 D2B6           1996            setb    WRNOT
                    1997            
0968 852480         1998            mov     p0, OUTPORTB        ; potom port B
096B 75A0C1         1999            mov     p2, #i8255OUTB
096E C2B6           2000            clr     WRNOT
0970 00             2001            nop
0971 00             2002            nop
0972 00             2003            nop
0973 00             2004            nop
0974 D2B6           2005            setb    WRNOT
                    2006    
0976 852580         2007            mov     p0, OUTPORTC        ; a nakoniec port C
0979 75A0C2         2008            mov     p2, #i8255OUTC
097C C2B6           2009            clr     WRNOT
097E 00             2010            nop
097F 00             2011            nop
0980 00             2012            nop
0981 00             2013            nop
0982 D2B6           2014            setb    WRNOT
0984 00             2015            nop
0985 00             2016            nop
0986 00             2017            nop
0987 00             2018            nop
0988 00             2019            nop
0989 00             2020            nop
DEBUG                                                                                                         PAGE 38

098A 00             2021            nop
098B 00             2022            nop
098C D2AF           2023            setb     EA                  ;Treba zakazat prerusenia
098E 22             2024            ret
                    2025    
                    2026    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    2027    
098F 0D0A5269       2028    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0993 61646961   
0997 63692073   
099B 79737465   
099F 6D206A65   
09A3 20696E69   
09A7 6369616C   
09AB 697A6F76   
09AF 616E792E   
09B3 0D0A00     
09B6 52696164       2029    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
09BA 69616369   
09BE 20737973   
09C2 74656D20   
09C6 6A652072   
09CA 65696E69   
09CE 6369616C   
09D2 697A6F76   
09D6 616E7920   
09DA 706F2073   
09DE 746C6163   
09E2 656E6920   
09E6 746C6163   
09EA 69646C61   
09EE 2053544F   
09F2 502E0D0A   
09F6 00         
09F7 4B616C69       2030    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
09FB 62726163   
09FF 69612076   
0A03 79746168   
0A07 75206A65   
0A0B 20756B6F   
0A0F 6E63656E   
0A13 612E0D0A   
0A17 00         
                    2031    
----                2032            DSEG
0040                2033            org     40h
0040                2034    STACK:  DS      10h
                    2035    
                    2036    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
DEBUG                                                                                                         PAGE 39

ACC. . . . . . . . . . . . . . .  D ADDR  00E0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSMERPI1U . . . . . . . . . . .    NUMB  003EH  NOT USED  
BMSMERPI2D . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMSMERPI2U . . . . . . . . . . .    NUMB  0038H  NOT USED  
BMSMERPI3D . . . . . . . . . . .    NUMB  0007H  NOT USED  
BMSMERPI3U . . . . . . . . . . .    NUMB  0020H  NOT USED  
BMSMERPI4D . . . . . . . . . . .    NUMB  001FH  NOT USED  
BMSMERPKI1U. . . . . . . . . . .    NUMB  001CH  NOT USED  
BMSMERPKI2D. . . . . . . . . . .    NUMB  0002H  NOT USED  
BMSMERPKI2U. . . . . . . . . . .    NUMB  0018H  NOT USED  
BMSMERPKI3D. . . . . . . . . . .    NUMB  0006H  NOT USED  
BMSMERPKI3U. . . . . . . . . . .    NUMB  0010H  NOT USED  
BMSMERPKI4D. . . . . . . . . . .    NUMB  000EH  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  00A3H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00BAH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00C5H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00B2H  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
DEBUG                                                                                                         PAGE 40

D2_MB1C. . . . . . . . . . . . .  C ADDR  0448H  
D3_MB1C. . . . . . . . . . . . .  C ADDR  0674H  
D3_MB2C. . . . . . . . . . . . .  C ADDR  0610H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  07CEH  
D4_MB2C. . . . . . . . . . . . .  C ADDR  076AH  
DEL1 . . . . . . . . . . . . . .  C ADDR  08B3H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  03C9H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  043DH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  040EH  
DOWN3. . . . . . . . . . . . . .  C ADDR  0562H  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  061AH  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  05A7H  
DOWN4. . . . . . . . . . . . . .  C ADDR  06BCH  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  0774H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  0701H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
EA . . . . . . . . . . . . . . .  B ADDR  00AFH  PREDEFINED  
ENDPROG. . . . . . . . . . . . .  C ADDR  0841H  NOT USED  
ERROR1 . . . . . . . . . . . . .  C ADDR  0808H  
ERROR1C. . . . . . . . . . . . .  C ADDR  0821H  
ERROR1S. . . . . . . . . . . . .  C ADDR  0813H  
ERROR2 . . . . . . . . . . . . .  C ADDR  0832H  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  07DBH  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  07EAH  
ERR_SKRD . . . . . . . . . . . .  C ADDR  0802H  
ERR_SKRH . . . . . . . . . . . .  C ADDR  0805H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  07F9H  
ET0. . . . . . . . . . . . . . .  B ADDR  00A9H  PREDEFINED  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  0115H  
F1S. . . . . . . . . . . . . . .  C ADDR  00FAH  
F2 . . . . . . . . . . . . . . .  C ADDR  0295H  
F2DOWN . . . . . . . . . . . . .  C ADDR  02A7H  
F2OK . . . . . . . . . . . . . .  C ADDR  0267H  
F2S. . . . . . . . . . . . . . .  C ADDR  024BH  
F2SW . . . . . . . . . . . . . .  C ADDR  027BH  
F2UP . . . . . . . . . . . . . .  C ADDR  029BH  
F3 . . . . . . . . . . . . . . .  C ADDR  04B5H  
F3DOWN . . . . . . . . . . . . .  C ADDR  04C7H  
F3OK . . . . . . . . . . . . . .  C ADDR  0487H  
F3S. . . . . . . . . . . . . . .  C ADDR  046BH  
F3SW . . . . . . . . . . . . . .  C ADDR  049BH  
F3UP . . . . . . . . . . . . . .  C ADDR  04BBH  
F4OK . . . . . . . . . . . . . .  C ADDR  06B0H  
F4S. . . . . . . . . . . . . . .  C ADDR  0695H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00E6H  
DEBUG                                                                                                         PAGE 41

FLOOR2 . . . . . . . . . . . . .  C ADDR  0237H  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0457H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  0681H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
INT_TIMER0 . . . . . . . . . . .  C ADDR  084DH  
INT_TIMER0_END . . . . . . . . .  C ADDR  0871H  
INT_TIMER0_MAIN. . . . . . . . .  C ADDR  085DH  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00DAH  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P1 . . . . . . . . . . . . . . .  D ADDR  0090H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PCON . . . . . . . . . . . . . .  D ADDR  0087H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
DEBUG                                                                                                         PAGE 42

POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  08F9H  
READPORTS1 . . . . . . . . . . .  C ADDR  08B9H  
READPORTS_C. . . . . . . . . . .  C ADDR  0945H  
READPORTS_C1 . . . . . . . . . .  C ADDR  093FH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOP . . . . . . . . . . . . . .  C ADDR  0892H  
STOPC. . . . . . . . . . . . . .  C ADDR  08A2H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  
STOPPED. . . . . . . . . . . . .  B ADDR  0038H  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  09F7H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  098FH  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  09B6H  NOT USED  
TCON . . . . . . . . . . . . . .  D ADDR  0088H  PREDEFINED  
TH0. . . . . . . . . . . . . . .  D ADDR  008CH  PREDEFINED  
TIME0. . . . . . . . . . . . . .  C ADDR  087EH  
TIME1. . . . . . . . . . . . . .  C ADDR  0880H  
TIME10MS . . . . . . . . . . . .  C ADDR  087CH  
TIME2. . . . . . . . . . . . . .  C ADDR  0884H  
TIME3. . . . . . . . . . . . . .  C ADDR  0888H  
TIME4. . . . . . . . . . . . . .  C ADDR  088FH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
TL0. . . . . . . . . . . . . . .  D ADDR  008AH  PREDEFINED  
TMOD . . . . . . . . . . . . . .  D ADDR  0089H  PREDEFINED  
TR0. . . . . . . . . . . . . . .  B ADDR  008CH  PREDEFINED  
U1_MB1C. . . . . . . . . . . . .  C ADDR  0229H  
U1_MB2C. . . . . . . . . . . . .  C ADDR  01CAH  
U2_MB1C. . . . . . . . . . . . .  C ADDR  03BBH  
U2_MB2C. . . . . . . . . . . . .  C ADDR  035CH  
U3_MB1C. . . . . . . . . . . . .  C ADDR  0552H  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  0121H  
UP1A . . . . . . . . . . . . . .  C ADDR  013EH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  01D4H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0166H  
UP2. . . . . . . . . . . . . . .  C ADDR  02B3H  
UP2A . . . . . . . . . . . . . .  C ADDR  02D0H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0366H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  02F8H  
UP3. . . . . . . . . . . . . . .  C ADDR  04D3H  
UP3A . . . . . . . . . . . . . .  C ADDR  04F0H  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0547H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  0518H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAITFORTIMER . . . . . . . . . .  C ADDR  08B1H  
WRITEPORTS . . . . . . . . . . .  C ADDR  0958H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
