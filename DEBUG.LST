VYTAH/ORI                                                                                                     PAGE 1

                       1    $MOD51
                       2    $DEBUG
                       3    
                =1     4    $include (lift.inc)
                =1     5    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1     6    i8255INA        equ     080h
  0081          =1     7    i8255INB        equ     081h
  0082          =1     8    i8255INC        equ     082h
  0083          =1     9    i8255INCW       equ     083h
  00C0          =1    10    i8255OUTA       equ     0c0h
  00C1          =1    11    i8255OUTB       equ     0c1h
  00C2          =1    12    i8255OUTC       equ     0c2h
  00C3          =1    13    i8255OUTCW      equ     0c3h
                =1    14    
  0028          =1    15    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    16    INPORTB         data    21h
  0022          =1    17    INPORTC         data    22h
  0023          =1    18    OUTPORTA        data    23h
  0024          =1    19    OUTPORTB        data    24h
  0025          =1    20    OUTPORTC        data    25h
  0026          =1    21    INPORTBold      data    26h
  0027          =1    22    CTRLREG         data    27h
                =1    23    
  0030          =1    24    POSITION        data    30h
  0031          =1    25    LOWEST          data    31h
  0032          =1    26    HIGHEST         data    32h
  0033          =1    27    STOPTIMER       data    33h
  0034          =1    28    OUTPORTBold     data    34h
                =1    29    
  0040          =1    30    STOPNOT         bit     INPORTA.0
  0041          =1    31    PKI1            bit     INPORTA.1
  0042          =1    32    PKI2            bit     INPORTA.2
  0043          =1    33    PKI3            bit     INPORTA.3
  0044          =1    34    PKI4            bit     INPORTA.4
  0045          =1    35    DOORCLSD        bit     INPORTA.5 
                =1    36    
  0009          =1    37    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    38    MB2             bit     INPORTB.2
  000B          =1    39    SKRH            bit     INPORTB.3
  000C          =1    40    SKRD            bit     INPORTB.4
  000D          =1    41    DP              bit     INPORTB.5
  000E          =1    42    DPZK            bit     INPORTB.6
  000F          =1    43    DPK             bit     INPORTB.7
                =1    44    
  0031          =1    45    MB1old          bit     INPORTBold.1
  0032          =1    46    MB2old          bit     INPORTBold.2
  0033          =1    47    SKRHold         bit     INPORTBold.3
  0034          =1    48    SKRDold         bit     INPORTBold.4
                =1    49    
  0010          =1    50    PI1             bit     INPORTC.0
  0011          =1    51    PI2D            bit     INPORTC.1
  0012          =1    52    PI2U            bit     INPORTC.2
  0013          =1    53    PI3D            bit     INPORTC.3
  0014          =1    54    PI3U            bit     INPORTC.4
  0015          =1    55    PI4             bit     INPORTC.5
                =1    56    
  0018          =1    57    KS              bit     OUTPORTA.0
  0019          =1    58    PKO1            bit     OUTPORTA.1
VYTAH/ORI/D                                                                                                  PAGE 2

  001A          =1    59    PKO2            bit     OUTPORTA.2
  001B          =1    60    PKO3            bit     OUTPORTA.3
  001C          =1    61    PKO4            bit     OUTPORTA.4
                =1    62    
  0020          =1    63    UP              bit     OUTPORTB.0
  0021          =1    64    DOWN            bit     OUTPORTB.1
  0022          =1    65    FAST            bit     OUTPORTB.2
  0023          =1    66    SLOW            bit     OUTPORTB.3
  0024          =1    67    FLED1           bit     OUTPORTB.4
  0025          =1    68    FLED2           bit     OUTPORTB.5
  0026          =1    69    FLED3           bit     OUTPORTB.6
  0027          =1    70    FLED4           bit     OUTPORTB.7
                =1    71    
  0028          =1    72    PO1             bit     OUTPORTC.0
  0029          =1    73    PO2D            bit     OUTPORTC.1
  002A          =1    74    PO2U            bit     OUTPORTC.2
  002B          =1    75    PO3D            bit     OUTPORTC.3
  002C          =1    76    PO3U            bit     OUTPORTC.4
  002D          =1    77    PO4             bit     OUTPORTC.5
  002E          =1    78    LEDD            bit     OUTPORTC.6
  002F          =1    79    LEDU            bit     OUTPORTC.7
                =1    80    
  0038          =1    81    CANGO           bit     CTRLREG.0
  0039          =1    82    DOORCLSDold     bit     CTRLREG.1
  003A          =1    83    UPold           bit     CTRLREG.2
  003B          =1    84    DOWNold         bit     CTRLREG.3
  003C          =1    85    FASTold         bit     CTRLREG.4
  003D          =1    86    SLOWold         bit     CTRLREG.5
                =1    87    
  00B6          =1    88    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    89    RDNOT           bit     0b7h        ; p3.7
                =1    90    
                =1    91    ; bitove masky
                =1    92    ; 8255OUT 
                =1    93    ; port A
  0001          =1    94    bmKS              equ    00000001b
  0002          =1    95    bmPKO1            equ    00000010b
  0004          =1    96    bmPKO2            equ    00000100b
  0008          =1    97    bmPKO3            equ    00001000b
  0010          =1    98    bmPKO4            equ    00010000b
                =1    99    
                =1   100    ; port B
  0001          =1   101    bmUP              equ    00000001b
  0002          =1   102    bmDOWN            equ    00000010b
  0004          =1   103    bmFAST            equ    00000100b
  0008          =1   104    bmSLOW            equ    00001000b
  0010          =1   105    bmFLED1           equ    00010000b
  0020          =1   106    bmFLED2           equ    00100000b
  0040          =1   107    bmFLED3           equ    01000000b
  0080          =1   108    bmFLED4           equ    10000000b
                =1   109    
                =1   110    ; port C
  0001          =1   111    bmPO1             equ    00000001b
  0002          =1   112    bmPO2D            equ    00000010b
  0004          =1   113    bmPO2U            equ    00000100b
  0008          =1   114    bmPO3D            equ    00001000b
  0010          =1   115    bmPO3U            equ    00010000b
  0020          =1   116    bmPO4             equ    00100000b
VYTAH/ORI/D                                                                                                  PAGE 3

  0040          =1   117    bmLEDD            equ    01000000b
  0080          =1   118    bmLEDU            equ    10000000b
                =1   119    
                =1   120    ; 8255IN
                =1   121    ; port A
  0001          =1   122    bmSTOP            equ    00000001b
  0002          =1   123    bmPKI1            equ    00000010b
  0004          =1   124    bmPKI2            equ    00000100b
  0008          =1   125    bmPKI3            equ    00001000b
  0010          =1   126    bmPKI4            equ    00010000b
  0020          =1   127    bmDOORCLSD        equ    00100000b
                =1   128    
                =1   129    ; port B
  0002          =1   130    bmMB1I            equ    00000010b
  0004          =1   131    bmMB2I            equ    00000100b
  0008          =1   132    bmSKRHI           equ    00001000b
  0010          =1   133    bmSKRHD           equ    00010000b
  0020          =1   134    bmDPI             equ    00100000b
  0040          =1   135    bmDPZKI           equ    01000000b
  0080          =1   136    bmDPKI            equ    10000000b
                =1   137    
                =1   138    ; port C
  0001          =1   139    bmPI1             equ    00000001b
  0002          =1   140    bmPI2D            equ    00000010b
  0004          =1   141    bmPI2U            equ    00000100b
  0008          =1   142    bmPI3D            equ    00001000b
  0010          =1   143    bmPI3U            equ    00010000b
  0020          =1   144    bmPI4             equ    00100000b
                =1   145    
                     146    
                     147    _BP_    MACRO 
                     148            clr     P3.3
                     149            setb    EX1
                     150            nop
                     151            nop
                     152    ENDM
                     153    
                     154    LJZ     MACRO   NAVESTIE
                     155            jnz     $+5
                     156            ljmp    NAVESTIE
                     157            nop
                     158    ENDM
                     159    
                     160    LJNZ    MACRO   NAVESTIE
                     161            jz      $+5
                     162            ljmp    NAVESTIE
                     163            nop
                     164    ENDM
                     165    
                     166    LJB     MACRO   TESTBIT, NAVESTIE
                     167            jnb     TESTBIT, $+6
                     168            ljmp    NAVESTIE
                     169            nop
                     170    ENDM
                     171    
                     172    LJNB    MACRO   TESTBIT, NAVESTIE
                     173            jb      TESTBIT, $+6
                     174            ljmp    NAVESTIE
VYTAH/ORI/D                                                                                                  PAGE 4

                     175            nop
                     176    ENDM
                     177    
                     178    ZAKMITC MACRO   TYPCLONKY
                     179            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
                     180            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     181            jnb     TYPCLONKY, $-3  ; 
                     182            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     183    ENDM
                     184    
                     185    POLOHA_LED  MACRO  POLOHA
                     186            clr     LEDU            
                     187            clr     LEDD 
                     188            clr     FLED1             
                     189            clr     FLED2                
                     190            clr     FLED3           
                     191            clr     FLED4           
                     192            setb    FLED&POLOHA
                     193            lcall   WRITEPORTS
                     194    ENDM
                     195    
  0036               196    FLOORREQ        data    36h
                     197    
                     198    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               199    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     200                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     201                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     202    ;osetrenie vektorov preruseni
0000                 203            org     0000h           ; adresa odkial startuje program po resete
0000 020033          204            ljmp    START           ; skok na zaciatok kodu programu
                     205                  
0033                 206            org     0033h           ; od tejto adresy sa zacina kod programu
0033                 207    START:
0033                 208    RESET:  
                     209            ; riadiace signaly do pasivnej urovne 
0033 D2B6            210            setb    WRNOT
0035 D2B7            211            setb    RDNOT
0037 753300          212            mov     STOPTIMER, #0
003A 758140          213            mov     SP, #STACK
                     214    
                     215            ; pockame si na inicializaciu obvodov 8255  
003D 7900            216            mov     R1, #0 
003F 7AFF            217            mov     R2, #0ffh
0041 D9FE            218            djnz    R1, $
0043 DAFC            219            djnz    R2, $-2
                     220            
                     221            ; teraz ich mozeme nastavit
0045 75809B          222            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          223            mov     p2, #i8255INCW
004B C2B6            224            clr     WRNOT
004D 00              225            nop
004E 00              226            nop
004F 00              227            nop
0050 00              228            nop
0051 D2B6            229            setb    WRNOT
VYTAH/ORI$#D                                                                                                  PAGE 5

0053 758080          230            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          231            mov     p2, #i8255OUTCW
0059 C2B6            232            clr     WRNOT
005B 00              233            nop
005C 00              234            nop
005D 00              235            nop
005E 00              236            nop
005F D2B6            237            setb    WRNOT
                     238            
                     239 +1         _BP_
0061 C2B3            240 +1         clr     P3.3
0063 D2AA            241 +1         setb    EX1
0065 00              242 +1         nop
0066 00              243 +1         nop
                     245    
                     246            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0067 752800          247            mov     INPORTA, #0
006A 75211E          248            mov     INPORTB, #01eh      ; vsetky clonky pasivne
006D 752200          249            mov     INPORTC, #0
0070 75231E          250            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0073 7524F0          251            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0076 7525FF          252            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0079 D218            253            setb    KS
007B 120660          254            call    WRITEPORTS          ; zapis novu informaciu
                     255    ;;;;;;;;
                     256    
007E 752300          257            mov     OUTPORTA, #0
0081 752400          258            mov     OUTPORTB, #0
0084 752500          259            mov     OUTPORTC, #0
0087 120660          260            call    WRITEPORTS          ; zapis novu informaciu
                     261    
008A 752800          262            mov     INPORTA, #0
008D 752100          263            mov     INPORTB, #0         
0090 752200          264            mov     INPORTC, #0
0093 12061B          265            call    READPORTS           ; prvotne nacitanie udajov
                     266    
0096                 267    CALIB:
                     268            ;kalibracia vytahu podla dolnej porovnavacej clonky
0096 12061B          269            lcall   READPORTS                   ; precitaj, co je na portoch
0099 300C11          270            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
009C D221            271            setb    DOWN                        ; inak pod dole
009E D222            272            setb    FAST                        ; a rychlo
00A0 C223            273            clr     SLOW                        ;
00A2 120660          274            lcall   WRITEPORTS                  ; zapis informaciu 
00A5                 275    CALIBLOOP:
00A5 12061B          276            lcall   READPORTS                   ; 
00A8 300C02          277            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00AB 80F8            278            jmp     CALIBLOOP
00AD                 279    CALIBEND:                              
00AD C222            280            clr     FAST                        ; zastavime v tomto smere
00AF C221            281            clr     DOWN                        ;
00B1 D223            282            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00B3 D220            283            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00B5 120660          284            lcall   WRITEPORTS 
00B8                 285    CALIBEND2:
VYTAH/ORI,D                                                                                                  PAGE 6

00B8 12061B          286            lcall   READPORTS                   ; 
00BB 2009FA          287            jb      MB1, CALIBEND2              ; 
00BE C223            288            clr     SLOW                        ; A teraz sme uz naozaj spravne
00C0 C220            289            clr     UP                          ; 
00C2 D224            290            setb    FLED1
00C4 120660          291            lcall   WRITEPORTS                  ; zapis informaciu
                     292    ;        _BP_
00C7                 293    MAIN:
                     294    
                     295    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     296    ; ****************************************************************************
                     297    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     298    ; ----------------------------------------------------------------------------
                     299    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     300    ; ----------------------------------------------------------------------------
                     301    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     302    ; ****************************************************************************
                     303    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     304    ; ----------------------------------------------------------------------------
                     305    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     306    ; ----------------------------------------------------------------------------
                     307    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     308    ; ****************************************************************************
                     309    ; POSITION
                     310    ; ****************************************************************************
                     311    
                     312    
                     313    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     314    
00C7                 315    FLOOR1:
                     316 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C7 C22F            317 +1         clr     LEDU            
00C9 C22E            318 +1         clr     LEDD 
00CB C224            319 +1         clr     FLED1             
00CD C225            320 +1         clr     FLED2                
00CF C226            321 +1         clr     FLED3           
00D1 C227            322 +1         clr     FLED4           
00D3 D224            323 +1         setb    FLED1
00D5 120660          324 +1         lcall   WRITEPORTS
00D8 120602          326            lcall   WAITFORTIMER    ; simulacia TIMERu
00DB 12061B          327    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DE C219            328            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00E0 120660          329            lcall   WRITEPORTS      ;
00E3 E528            330            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
00E5 541C            331            anl     A, #00011100b ;-;
00E7 60F2            332            jz      F1S           ;-; ak nie, opakuj
00E9 D220            333            setb    UP              ; rychly pohyb hore
00EB D222            334            setb    FAST            ; 
00ED C223            335            clr     SLOW            ;
00EF 120660          336            lcall   WRITEPORTS      ; 
00F2 0200F5          337            jmp     UP1           ;-; prejdi do stavu UP1
00F5                 338    UP1:
                     339 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00F5 C22F            340 +1         clr     LEDU            
VYTAH/ORIFD–&©4                                                                                              PAGE 7

00F7 C22E            341 +1         clr     LEDD 
00F9 C224            342 +1         clr     FLED1             
00FB C225            343 +1         clr     FLED2                
00FD C226            344 +1         clr     FLED3           
00FF C227            345 +1         clr     FLED4           
0101 D224            346 +1         setb    FLED1
0103 120660          347 +1         lcall   WRITEPORTS
                     349 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0106 1205EC          350 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0109 12061B          351 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
010C 3009FA          352 +1         jnb     MB1, $-3  ; 
010F 1205EC          353 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0112 12061B          355    UP1A:   lcall   READPORTS       ; nacitanie dat
                     356 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0115 200B03          357 +1         jb      SKRH, $+6
0118 0205D1          358 +1         ljmp    ERR_SKRH
011B 00              359 +1         nop
                     361 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
011C 200903          362 +1         jb      MB1, $+6
011F 0205A4          363 +1         ljmp    ERR_2SPOM_C
0122 00              364 +1         nop
0123 200AEC          366            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     367 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0126 1205EC          368 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0129 12061B          369 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
012C 300AFA          370 +1         jnb     MB2, $-3  ; 
012F 1205EC          371 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0132 D22E            373            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0134 120660          374            lcall   WRITEPORTS      ;
0137 02013A          375            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
013A                 376    UP1_MB2:
013A 12061B          377            lcall   READPORTS       ; nacitanie dat
                     378 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
013D 200B03          379 +1         jb      SKRH, $+6
0140 0205D1          380 +1         ljmp    ERR_SKRH
0143 00              381 +1         nop
                     383 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0144 200903          384 +1         jb      MB1, $+6
0147 020595          385 +1         ljmp    ERR_1SPOM_C
014A 00              386 +1         nop
014B 200AEC          388            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
014E D22F            389            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0150 120660          390            lcall   WRITEPORTS      ;   
                     391 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0153 1205EC          392 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0156 12061B          393 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0159 300AFA          394 +1         jnb     MB2, $-3  ; 
015C 1205EC          395 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
015F E528            397            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0161 5404            398            anl     A, #00000100b ;-;
0163 600A            399            jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1
0165 D223            400            setb    SLOW            ;       Ak ano, spomalme
0167 C222            401            clr     FAST            ; 
VYTAH/ORI 9Dî(©4                                                                                              PAGE 8

0169 120660          402            lcall   WRITEPORTS      ;         
016C 02016F          403            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
016F                 404    UP1_MB1:
016F 12061B          405            lcall   READPORTS       ; nacitanie dat
                     406 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0172 200B03          407 +1         jb      SKRH, $+6
0175 0205D1          408 +1         ljmp    ERR_SKRH
0178 00              409 +1         nop
                     411 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0179 200A03          412 +1         jb      MB2, $+6
017C 0205B3          413 +1         ljmp    ERR_ZAST_C
017F 00              414 +1         nop
0180 2009EC          416            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
0183 E528            417            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0185 5404            418            anl     A, #00000100b ;-;
0187 606D            419            jz      UP2           ;-; Ak nie, chod do stavu UP2
0189 C220            420            clr     UP              ; zastav motor
018B D23A            421            setb    UPOld           ;       (a zalohuj) 
018D C23B            422            clr     DOWNOld         ;       (a zalohuj)
018F C222            423            clr     FAST            ; 
0191 120660          424            lcall   WRITEPORTS      ; 
0194 020197          425            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     426    
                     427    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     428    
0197                 429    FLOOR2:
                     430 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0197 C22F            431 +1         clr     LEDU            
0199 C22E            432 +1         clr     LEDD 
019B C224            433 +1         clr     FLED1             
019D C225            434 +1         clr     FLED2                
019F C226            435 +1         clr     FLED3           
01A1 C227            436 +1         clr     FLED4           
01A3 D225            437 +1         setb    FLED2
01A5 120660          438 +1         lcall   WRITEPORTS
01A8 120602          440            lcall   WAITFORTIMER    ; simulacia TIMERu
01AB 12061B          441    F2S:    lcall   READPORTS     ;-; nacitanie dat
01AE C21A            442            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
01B0 120660          443            lcall   WRITEPORTS      ;
                     444            
01B3 7418            445            mov     A, #00011000b ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
01B5 203A01          446            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
01B8 F4              447            cpl     A               ;       Ak nie, znegujeme
01B9 F5F0            448    F2OK:   mov     B, A            ; Masku dame do Bcka
                     449            
                     450            ; Pohyb v jednom smere (nevieme v ktorom)
01BB 53F01A          451            anl     B, #00011010b  ;-; este ju kozmeticky upravime
01BE E528            452            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
01C0 55F0            453            anl     A, B            ; tu ju pouzijeme       
01C2 7014            454            jnz     F2              ; nasli sme poschodie v tomto smere
                     455            ; Pohyb v opacnom smere (nevieme v ktorom)
01C4 B23A            456            cpl     UPOld           ;  Znegujem stary posun
01C6 B23B            457            cpl     DOWNOld         ;  |
01C8 E5F0            458            mov     A, B            ;  Znegujeme masku
VYTAH/ORI Dô)©4                                                                                              PAGE 9

01CA F4              459            cpl     A               ;  |
01CB F5F0            460            mov     B, A            ;  |
01CD 53F01A          461            anl     B, #00011010b  ;-; este ju kozmeticky upravime
01D0 E528            462            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
01D2 55F0            463            anl     A, B            ; tu ju pouzijeme       
01D4 7002            464            jnz     F2              ; nasli sme poschodie v tomto smere
                     465            
01D6 80D3            466            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
01D8 203A03          467    F2:     jb      UPOld, F2UP     ;   
01DB 0201EA          468            jmp     F2DOWN          ;
01DE D220            469    F2UP:   setb    UP              ; rychly pohyb hore
01E0 D222            470            setb    FAST            ; 
01E2 C223            471            clr     SLOW            ;
01E4 120660          472            lcall   WRITEPORTS      ; 
01E7 0201F6          473            jmp     UP2           ;-; prejdi do stavu UP2    
01EA D221            474    F2DOWN: setb    DOWN            ; rychly pohyb hore
01EC D222            475            setb    FAST            ; 
01EE C223            476            clr     SLOW            ;
01F0 120660          477            lcall   WRITEPORTS      ; 
01F3 02029B          478            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     479            
                     480                
01F6                 481    UP2:
                     482 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01F6 C22F            483 +1         clr     LEDU            
01F8 C22E            484 +1         clr     LEDD 
01FA C224            485 +1         clr     FLED1             
01FC C225            486 +1         clr     FLED2                
01FE C226            487 +1         clr     FLED3           
0200 C227            488 +1         clr     FLED4           
0202 D225            489 +1         setb    FLED2
0204 120660          490 +1         lcall   WRITEPORTS
                     492 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0207 1205EC          493 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
020A 12061B          494 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
020D 3009FA          495 +1         jnb     MB1, $-3  ; 
0210 1205EC          496 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0213 12061B          498    UP2A:   lcall   READPORTS       ; nacitanie dat
                     499 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0216 200B03          500 +1         jb      SKRH, $+6
0219 0205D1          501 +1         ljmp    ERR_SKRH
021C 00              502 +1         nop
                     504 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
021D 200903          505 +1         jb      MB1, $+6
0220 0205A4          506 +1         ljmp    ERR_2SPOM_C
0223 00              507 +1         nop
0224 200AEC          509            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     510 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0227 1205EC          511 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
022A 12061B          512 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
022D 300AFA          513 +1         jnb     MB2, $-3  ; 
0230 1205EC          514 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0233 D22E            516            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
VYTAH/ORI D’+©4                                                                                              PAGE 10

0235 120660          517            lcall   WRITEPORTS      ;
0238 02023B          518            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
023B                 519    UP2_MB2:
023B 12061B          520            lcall   READPORTS       ; nacitanie dat
                     521 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
023E 200B03          522 +1         jb      SKRH, $+6
0241 0205D1          523 +1         ljmp    ERR_SKRH
0244 00              524 +1         nop
                     526 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0245 200903          527 +1         jb      MB1, $+6
0248 020595          528 +1         ljmp    ERR_1SPOM_C
024B 00              529 +1         nop
024C 200AEC          531            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
024F D22F            532            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0251 120660          533            lcall   WRITEPORTS      ;
                     534 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0254 1205EC          535 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0257 12061B          536 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
025A 300AFA          537 +1         jnb     MB2, $-3  ; 
025D 1205EC          538 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0260 E528            540            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0262 5408            541            anl     A, #00001000b ;-;
0264 600A            542            jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
0266 D223            543            setb    SLOW            ;       Ak ano, spomalme
0268 C222            544            clr     FAST            ; 
026A 120660          545            lcall   WRITEPORTS      ;
026D 020270          546            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0270                 547    UP2_MB1:
0270 12061B          548            lcall   READPORTS       ; nacitanie dat
                     549 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0273 200B03          550 +1         jb      SKRH, $+6
0276 0205D1          551 +1         ljmp    ERR_SKRH
0279 00              552 +1         nop
                     554 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
027A 200A03          555 +1         jb      MB2, $+6
027D 0205B3          556 +1         ljmp    ERR_ZAST_C
0280 00              557 +1         nop
0281 2009EC          559            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
0284 E528            560            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0286 5408            561            anl     A, #00001000b ;-;
0288 7003            562            jnz     U2_MB1C       ;-; Ak nie, chod do stavu UP3
028A 02038C          563            ljmp    UP3             ; |
028D C220            564    U2_MB1C:clr     UP              ; zastav motor
028F D23A            565            setb    UPOld           ;       (a zalohuj)
0291 C23B            566            clr     DOWNOld         ;       (a zalohuj)
0293 C222            567            clr     FAST            ; 
0295 120660          568            lcall   WRITEPORTS      ; 
0298 02032D          569            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
029B                 570    DOWN2:
                     571 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
029B C22F            572 +1         clr     LEDU            
029D C22E            573 +1         clr     LEDD 
029F C224            574 +1         clr     FLED1             
02A1 C225            575 +1         clr     FLED2                
VYTAH/ORI rDž-©4                                                                                              PAGE 11

02A3 C226            576 +1         clr     FLED3           
02A5 C227            577 +1         clr     FLED4           
02A7 D225            578 +1         setb    FLED2
02A9 120660          579 +1         lcall   WRITEPORTS
                     581 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02AC 1205EC          582 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02AF 12061B          583 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02B2 3009FA          584 +1         jnb     MB1, $-3  ; 
02B5 1205EC          585 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02B8 12061B          587            lcall   READPORTS       ; nacitanie dat
                     588 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
02BB 200C03          589 +1         jb      SKRD, $+6
02BE 0205C2          590 +1         ljmp    ERR_SKRD
02C1 00              591 +1         nop
                     593 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02C2 200903          594 +1         jb      MB1, $+6
02C5 0205A4          595 +1         ljmp    ERR_2SPOM_C
02C8 00              596 +1         nop
02C9 200ACF          598            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     599 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
02CC 1205EC          600 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02CF 12061B          601 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02D2 300AFA          602 +1         jnb     MB2, $-3  ; 
02D5 1205EC          603 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02D8 D22F            605            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02DA 120660          606            lcall   WRITEPORTS      ;
02DD 0202E0          607            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
02E0                 608    DOWN2_MB2:
02E0 12061B          609            lcall   READPORTS       ; nacitanie dat
                     610 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
02E3 200C03          611 +1         jb      SKRD, $+6
02E6 0205C2          612 +1         ljmp    ERR_SKRD
02E9 00              613 +1         nop
                     615 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02EA 200903          616 +1         jb      MB1, $+6
02ED 020595          617 +1         ljmp    ERR_1SPOM_C
02F0 00              618 +1         nop
02F1 200AEC          620            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
02F4 D22E            621            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
02F6 120660          622            lcall   WRITEPORTS      ;
                     623 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02F9 1205EC          624 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02FC 12061B          625 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02FF 300AFA          626 +1         jnb     MB2, $-3  ; 
0302 1205EC          627 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0305 E528            629            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0307 5402            630            anl     A, #00000010b ;-;
0309 600A            631            jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
030B D223            632            setb    SLOW            ;       Ak ano, spomalme
030D C222            633            clr     FAST            ; 
030F 120660          634            lcall   WRITEPORTS      ;
0312 020315          635            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
0315                 636    DOWN2_MB1:    
VYTAH/ORI eDö/©4                                                                                              PAGE 12

0315 12061B          637            lcall   READPORTS       ; nacitanie dat
0318 300C05          638            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
031B 300902          639            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
031E 80F5            640            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
0320 C221            641    D2_MB1C:clr     DOWN            ; zastav motor
0322 D23B            642            setb    DOWNOld         ;       (a zalohuj)
0324 C23A            643            clr     UPOld           ;       (a zalohuj)
0326 C222            644            clr     FAST            ; 
0328 120660          645            lcall   WRITEPORTS      ; 
032B 01C7            646            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                     647    
                     648    
                     649    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     650    
032D                 651    FLOOR3:
                     652 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
032D C22F            653 +1         clr     LEDU            
032F C22E            654 +1         clr     LEDD 
0331 C224            655 +1         clr     FLED1             
0333 C225            656 +1         clr     FLED2                
0335 C226            657 +1         clr     FLED3           
0337 C227            658 +1         clr     FLED4           
0339 D226            659 +1         setb    FLED3
033B 120660          660 +1         lcall   WRITEPORTS
033E 120602          662            lcall   WAITFORTIMER    ; simulacia TIMERu
0341 12061B          663    F3S:    lcall   READPORTS     ;-; nacitanie dat
0344 C21B            664            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0346 120660          665            lcall   WRITEPORTS      ;
                     666    
0349 7410            667            mov     A, #00010000b ;-; Default predpokladam, ze idem hore (na 4.)
034B 203A01          668            jb      UPOld, F3OK   ;-;   Je to pravda? Naozaj idem hore?
034E F4              669            cpl     A               ;       Ak nie, znegujeme
034F F5F0            670    F3OK:   mov     B, A            ; Masku dame do Bcka
                     671            
                     672            ; Pohyb v jednom smere (nevieme v ktorom)
0351 53F016          673            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0354 E528            674            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0356 55F0            675            anl     A, B            ; tu ju pouzijeme       
0358 7014            676            jnz     F3              ; nasli sme poschodie v tomto smere
                     677            ; Pohyb v opacnom smere (nevieme v ktorom)
035A B23A            678            cpl     UPOld           ;  Znegujem stary posun
035C B23B            679            cpl     DOWNOld         ;  |
035E E5F0            680            mov     A, B            ;  Znegujeme masku
0360 F4              681            cpl     A               ;  |
0361 F5F0            682            mov     B, A            ;  |
0363 53F016          683            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0366 E528            684            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0368 55F0            685            anl     A, B            ; tu ju pouzijeme       
036A 7002            686            jnz     F3              ; nasli sme poschodie v tomto smere
                     687            
036C 80D3            688            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
036E 203A03          689    F3:     jb      UPOld, F3UP     ;   
VYTAH/ORI ADD0©4                                                                                              PAGE 13

0371 020380          690            jmp     F3DOWN          ;
0374 D220            691    F3UP:   setb    UP              ; rychly pohyb hore
0376 D222            692            setb    FAST            ; 
0378 C223            693            clr     SLOW            ;
037A 120660          694            lcall   WRITEPORTS      ; 
037D 02038C          695            jmp     UP3           ;-; prejdi do stavu UP2    
0380 D221            696    F3DOWN: setb    DOWN            ; rychly pohyb hore
0382 D222            697            setb    FAST            ; 
0384 C223            698            clr     SLOW            ;
0386 120660          699            lcall   WRITEPORTS      ; 
0389 02041F          700            jmp     DOWN3         ;-; prejdi do stavu UP2    
                     701         
                     702         
038C                 703    UP3:
                     704 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
038C C22F            705 +1         clr     LEDU            
038E C22E            706 +1         clr     LEDD 
0390 C224            707 +1         clr     FLED1             
0392 C225            708 +1         clr     FLED2                
0394 C226            709 +1         clr     FLED3           
0396 C227            710 +1         clr     FLED4           
0398 D226            711 +1         setb    FLED3
039A 120660          712 +1         lcall   WRITEPORTS
                     714 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
039D 1205EC          715 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03A0 12061B          716 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03A3 3009FA          717 +1         jnb     MB1, $-3  ; 
03A6 1205EC          718 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03A9 12061B          720    UP3A:   lcall   READPORTS       ; nacitanie dat
                     721 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03AC 200B03          722 +1         jb      SKRH, $+6
03AF 0205D1          723 +1         ljmp    ERR_SKRH
03B2 00              724 +1         nop
                     726 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03B3 200903          727 +1         jb      MB1, $+6
03B6 0205A4          728 +1         ljmp    ERR_2SPOM_C
03B9 00              729 +1         nop
03BA 200AEC          731            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                     732 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
03BD 1205EC          733 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03C0 12061B          734 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03C3 300AFA          735 +1         jnb     MB2, $-3  ; 
03C6 1205EC          736 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03C9 D22E            738            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03CB 120660          739            lcall   WRITEPORTS      ;
03CE 0203D1          740            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
03D1                 741    UP3_MB2:
03D1 12061B          742            lcall   READPORTS       ; nacitanie dat
                     743 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03D4 200B03          744 +1         jb      SKRH, $+6
03D7 0205D1          745 +1         ljmp    ERR_SKRH
03DA 00              746 +1         nop
                     748 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
VYTAH/ORI+DŒ2©4’2©4                                                                                          PAGE 14

03DB 200903          749 +1         jb      MB1, $+6
03DE 020595          750 +1         ljmp    ERR_1SPOM_C
03E1 00              751 +1         nop
03E2 200AEC          753            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
03E5 D22F            754            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
03E7 120660          755            lcall   WRITEPORTS      ;
                     756 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
03EA 1205EC          757 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03ED 12061B          758 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03F0 300AFA          759 +1         jnb     MB2, $-3  ; 
03F3 1205EC          760 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03F6 E528            762            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
03F8 5410            763            anl     A, #00010000b ;-;
03FA 600A            764            jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
03FC D223            765            setb    SLOW            ;       Ak ano, spomalme
03FE C222            766            clr     FAST            ; 
0400 120660          767            lcall   WRITEPORTS      ;
0403 020406          768            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0406                 769    UP3_MB1:
0406 12061B          770            lcall   READPORTS       ; nacitanie dat
0409 300B05          771            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
040C 300902          772            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
040F 80F5            773            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
0411 C220            774    U3_MB1C:clr     UP              ; zastav motor
0413 D23A            775            setb    UPOld           ;       (a zalohuj)
0415 C23B            776            clr     DOWNOld         ;       (a zalohuj)
0417 C222            777            clr     FAST            ; 
0419 120660          778            lcall   WRITEPORTS      ; 
041C 0204C3          779            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
041F                 780    DOWN3:
                     781 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
041F C22F            782 +1         clr     LEDU            
0421 C22E            783 +1         clr     LEDD 
0423 C224            784 +1         clr     FLED1             
0425 C225            785 +1         clr     FLED2                
0427 C226            786 +1         clr     FLED3           
0429 C227            787 +1         clr     FLED4           
042B D226            788 +1         setb    FLED3
042D 120660          789 +1         lcall   WRITEPORTS
                     791 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0430 1205EC          792 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0433 12061B          793 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0436 3009FA          794 +1         jnb     MB1, $-3  ; 
0439 1205EC          795 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
043C 12061B          797            lcall   READPORTS       ; nacitanie dat
                     798 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
043F 200C03          799 +1         jb      SKRD, $+6
0442 0205C2          800 +1         ljmp    ERR_SKRD
0445 00              801 +1         nop
                     803 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0446 200903          804 +1         jb      MB1, $+6
0449 0205A4          805 +1         ljmp    ERR_2SPOM_C
VYTAH/ORID,4©424©4                                                                                          PAGE 15

044C 00              806 +1         nop
044D 200ACF          808            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                     809 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
0450 1205EC          810 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0453 12061B          811 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0456 300AFA          812 +1         jnb     MB2, $-3  ; 
0459 1205EC          813 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
045C D22F            815            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
045E 120660          816            lcall   WRITEPORTS      ;
0461 020464          817            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0464                 818    DOWN3_MB2:
0464 12061B          819            lcall   READPORTS       ; nacitanie dat
                     820 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0467 200C03          821 +1         jb      SKRD, $+6
046A 0205C2          822 +1         ljmp    ERR_SKRD
046D 00              823 +1         nop
                     825 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
046E 200903          826 +1         jb      MB1, $+6
0471 020595          827 +1         ljmp    ERR_1SPOM_C
0474 00              828 +1         nop
0475 200AEC          830            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0478 D22E            831            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
047A 120660          832            lcall   WRITEPORTS      ;
                     833 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
047D 1205EC          834 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0480 12061B          835 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0483 300AFA          836 +1         jnb     MB2, $-3  ; 
0486 1205EC          837 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0489 E528            839            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
048B 5404            840            anl     A, #00000100b ;-;
048D 600A            841            jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
048F D223            842            setb    SLOW            ;       Ak ano, spomalme
0491 C222            843            clr     FAST            ; 
0493 120660          844            lcall   WRITEPORTS      ;
0496 020499          845            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
0499                 846    DOWN3_MB1:    
0499 12061B          847            lcall   READPORTS       ; nacitanie dat
                     848 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
049C 200C03          849 +1         jb      SKRD, $+6
049F 0205C2          850 +1         ljmp    ERR_SKRD
04A2 00              851 +1         nop
                     853 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
04A3 200A03          854 +1         jb      MB2, $+6
04A6 0205B3          855 +1         ljmp    ERR_ZAST_C
04A9 00              856 +1         nop
04AA 2009EC          858            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
04AD E528            859            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
04AF 5404            860            anl     A, #00000100b ;-;
04B1 7003            861            jnz     D3_MB1C         ; Ak nie, chod do stavu DOWN2
04B3 02029B          862            ljmp    DOWN2         ;-; |
04B6 C221            863    D3_MB1C:clr     DOWN            ; zastav motor
04B8 D23B            864            setb    DOWNOld         ;       (a zalohuj)
04BA C23A            865            clr     UPOld           ;       (a zalohuj)
04BC C222            866            clr     FAST            ; 
VYTAH/ORI D86©4>6©4                                                                                          PAGE 16

04BE 120660          867            lcall   WRITEPORTS      ; 
04C1 2197            868            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                     869          
                     870            
                     871    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                     872    
04C3                 873    FLOOR4:
                     874 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04C3 C22F            875 +1         clr     LEDU            
04C5 C22E            876 +1         clr     LEDD 
04C7 C224            877 +1         clr     FLED1             
04C9 C225            878 +1         clr     FLED2                
04CB C226            879 +1         clr     FLED3           
04CD C227            880 +1         clr     FLED4           
04CF D227            881 +1         setb    FLED4
04D1 120660          882 +1         lcall   WRITEPORTS
04D4 120602          884            lcall   WAITFORTIMER    ; simulacia TIMERu
04D7 12061B          885    F4S:    lcall   READPORTS     ;-; nacitanie dat
04DA C21C            886            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
04DC 120660          887            lcall   WRITEPORTS      ;
04DF E528            888            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco menej ako poschodie na kto
                                                                               rom stojim
04E1 540E            889            anl     A, #00001110b ;-;
04E3 60F2            890            jz      F4S           ;-; ak nie, opakuj
04E5 D221            891            setb    DOWN            ; rychly pohyb dole
04E7 D222            892            setb    FAST            ;
04E9 C223            893            clr     SLOW            ; 
04EB 120660          894            lcall   WRITEPORTS      ; 
04EE 0204F1          895            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
04F1                 896    DOWN4:
                     897 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04F1 C22F            898 +1         clr     LEDU            
04F3 C22E            899 +1         clr     LEDD 
04F5 C224            900 +1         clr     FLED1             
04F7 C225            901 +1         clr     FLED2                
04F9 C226            902 +1         clr     FLED3           
04FB C227            903 +1         clr     FLED4           
04FD D227            904 +1         setb    FLED4
04FF 120660          905 +1         lcall   WRITEPORTS
                     907 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0502 1205EC          908 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0505 12061B          909 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0508 3009FA          910 +1         jnb     MB1, $-3  ; 
050B 1205EC          911 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
050E 12061B          913            lcall   READPORTS       ; nacitanie dat
                     914 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0511 200C03          915 +1         jb      SKRD, $+6
0514 0205C2          916 +1         ljmp    ERR_SKRD
0517 00              917 +1         nop
                     919 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0518 200903          920 +1         jb      MB1, $+6
051B 0205A4          921 +1         ljmp    ERR_2SPOM_C
051E 00              922 +1         nop
VYTAH/ORIoDÖ7©4Ü7©4                                                                                          PAGE 17

051F 200ACF          924            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                     925 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0522 1205EC          926 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0525 12061B          927 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0528 300AFA          928 +1         jnb     MB2, $-3  ; 
052B 1205EC          929 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
052E D22F            931            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0530 120660          932            lcall   WRITEPORTS      ;
0533 020536          933            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
0536                 934    DOWN4_MB2:
0536 12061B          935            lcall   READPORTS       ; nacitanie dat
                     936 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0539 200C03          937 +1         jb      SKRD, $+6
053C 0205C2          938 +1         ljmp    ERR_SKRD
053F 00              939 +1         nop
                     941 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0540 200903          942 +1         jb      MB1, $+6
0543 020595          943 +1         ljmp    ERR_1SPOM_C
0546 00              944 +1         nop
0547 200AEC          946            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
054A D22E            947            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
054C 120660          948            lcall   WRITEPORTS      ;
                     949 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
054F 1205EC          950 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0552 12061B          951 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0555 300AFA          952 +1         jnb     MB2, $-3  ; 
0558 1205EC          953 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
055B E528            955            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
055D 5408            956            anl     A, #00001000b ;-;
055F 600A            957            jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
0561 D223            958            setb    SLOW            ;       Ak ano, spomalme
0563 C222            959            clr     FAST            ; 
0565 120660          960            lcall   WRITEPORTS      ;
0568 02056B          961            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
056B                 962    DOWN4_MB1:    
056B 12061B          963            lcall   READPORTS       ; nacitanie dat
                     964 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
056E 200C03          965 +1         jb      SKRD, $+6
0571 0205C2          966 +1         ljmp    ERR_SKRD
0574 00              967 +1         nop
                     969 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
0575 200A03          970 +1         jb      MB2, $+6
0578 0205B3          971 +1         ljmp    ERR_ZAST_C
057B 00              972 +1         nop
057C 2009EC          974            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
057F E528            975            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0581 5408            976            anl     A, #00001000b ;-;
0583 7003            977            jnz     D4_MB1C         ; Ak nie, chod do stavu DOWN3
0585 02041F          978            ljmp    DOWN3         ;-; |
0588 C221            979    D4_MB1C:clr     DOWN            ; zastav motor
058A D23B            980            setb    DOWNOld         ;       (a zalohuj)
058C C23A            981            clr     UPOld           ;       (a zalohuj)
058E C222            982            clr     FAST            ; 
0590 120660          983            lcall   WRITEPORTS      ; 
VYTAH/ORIbDâ9©4è9©4                                                                                          PAGE 18

0593 612D            984            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                     985                    
                     986      
0595                 987    ERR_1SPOM_C: 
0595 C220            988            clr     UP              ; zastav motor
0597 C221            989            clr     DOWN            ; 
0599 120660          990            lcall   WRITEPORTS      ; 
                     991 +1         _BP_
059C C2B3            992 +1         clr     P3.3
059E D2AA            993 +1         setb    EX1
05A0 00              994 +1         nop
05A1 00              995 +1         nop
05A2 00              997            nop
05A3 00              998            nop 
                     999            
05A4                1000    ERR_2SPOM_C: 
05A4 C220           1001            clr     UP              ; zastav motor
05A6 C221           1002            clr     DOWN            ; 
05A8 120660         1003            lcall   WRITEPORTS      ; 
                    1004 +1         _BP_
05AB C2B3           1005 +1         clr     P3.3
05AD D2AA           1006 +1         setb    EX1
05AF 00             1007 +1         nop
05B0 00             1008 +1         nop
05B1 00             1010            nop
05B2 00             1011            nop 
                    1012            
05B3                1013    ERR_ZAST_C: 
05B3 C220           1014            clr     UP              ; zastav motor
05B5 C221           1015            clr     DOWN            ; 
05B7 120660         1016            lcall   WRITEPORTS      ; 
                    1017 +1         _BP_
05BA C2B3           1018 +1         clr     P3.3
05BC D2AA           1019 +1         setb    EX1
05BE 00             1020 +1         nop
05BF 00             1021 +1         nop
05C0 00             1023            nop
05C1 00             1024            nop 
                    1025            
05C2                1026    ERR_SKRD: 
05C2 C220           1027            clr     UP              ; zastav motor
05C4 C221           1028            clr     DOWN            ; 
05C6 120660         1029            lcall   WRITEPORTS      ; 
                    1030 +1         _BP_
05C9 C2B3           1031 +1         clr     P3.3
05CB D2AA           1032 +1         setb    EX1
05CD 00             1033 +1         nop
05CE 00             1034 +1         nop
05CF 00             1036            nop
05D0 00             1037            nop    
                    1038            
05D1                1039    ERR_SKRH: 
05D1 C220           1040            clr     UP              ; zastav motor
05D3 C221           1041            clr     DOWN            ; 
05D5 120660         1042            lcall   WRITEPORTS      ; 
                    1043 +1         _BP_
05D8 C2B3           1044 +1         clr     P3.3
05DA D2AA           1045 +1         setb    EX1
VYTAH/ORI*D                                                                                                  PAGE 19

05DC 00             1046 +1         nop
05DD 00             1047 +1         nop
05DE 00             1049            nop
05DF 00             1050            nop             
                    1051                    
                    1052                    
05E0                1053    ENDPROG:
05E0 D218           1054            setb    KS
05E2 120660         1055            call    WRITEPORTS                ; zapis novu informaciu
                    1056 +1         _BP_
05E5 C2B3           1057 +1         clr     P3.3
05E7 D2AA           1058 +1         setb    EX1
05E9 00             1059 +1         nop
05EA 00             1060 +1         nop
05EB 22             1062            ret
                    1063            
                    1064    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1065    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1066    ; 11.0592MHz/2000 = zdrzanie 1 ms
05EC                1067    TIME10MS:
05EC 7963           1068            mov     R1,#063h        ; 2
                    1069                                    ; *** 100x
05EE 7AFF           1070    TIME0:  mov     R2,#0FFh        ; 2 
05F0 DAFE           1071    TIME1:  djnz    R2,TIME1        ; 256*2   
05F2 7AFF           1072            mov     R2,#0FFh        ; 2       
05F4 DAFE           1073    TIME2:  djnz    R2,TIME2        ; 256*2 
05F6 7A24           1074            mov     R2,#024h        ; 2       
05F8 DAFE           1075    TIME3:  djnz    R2,TIME3        ; 36*2
05FA 00             1076            nop                     ; 1
05FB D9F1           1077            djnz    R1,TIME0        ; 2
                    1078                                    ; ***
05FD 792A           1079            mov     R1,#02Ah        ; 2 
05FF D9FE           1080    TIME4:  djnz    R1,TIME4        ; 43*2  
0601 22             1081            ret                     ; koniec
                    1082            
                    1083            
                    1084    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1085    ; DELAY
                    1086    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1087    ; bude timer)
                    1088    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0602                1089    WAITFORTIMER:
0602 7B20           1090            mov     R3, #20h
0604 1205EC         1091    DEL1:   lcall   TIME10MS
0607 DBFB           1092            djnz    R3, DEL1
0609 22             1093            ret
                    1094    
                    1095    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1096    ; WAITFORTIMER
                    1097    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1098    ; bude timer)
                    1099    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
060A                1100    WAITFORTIMER2:
060A D22C           1101            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
060C 120660         1102            lcall   WRITEPORTS                  ;
060F 12061B         1103    WAIT:   lcall   READPORTS                   ; 
0612 3013ED         1104            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0615 C22C           1105            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
VYTAH/ORIgD                                                                                                  PAGE 20

0617 120660         1106            lcall   WRITEPORTS
061A 22             1107            ret
                    1108    
                    1109    
                    1110    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1111    ; READPORTS
                    1112    ; precita nove hodnoty na portoch
                    1113    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
061B                1114    READPORTS:
061B 75A080         1115            mov     p2, #i8255INA       ; citaj data z portu A
061E 75803F         1116            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0621 C2B7           1117            clr     RDNOT
0623 00             1118            nop
0624 00             1119            nop
0625 00             1120            nop
0626 00             1121            nop
0627 858028         1122            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
062A D2B7           1123            setb    RDNOT
                    1124            
062C 75A081         1125            mov     p2, #i8255INB       ; citaj data z portu B
062F 7580FE         1126            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0632 C2B7           1127            clr     RDNOT
0634 00             1128            nop
0635 00             1129            nop
0636 00             1130            nop
0637 00             1131            nop
0638 858021         1132            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
063B D2B7           1133            setb    RDNOT
                    1134    
063D 75A082         1135            mov     p2, #i8255INC       ; citaj data z portu C
0640 75803F         1136            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0643 C2B7           1137            clr     RDNOT
0645 00             1138            nop
0646 00             1139            nop
0647 00             1140            nop
0648 00             1141            nop
0649 858022         1142            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
064C D2B7           1143            setb    RDNOT
064E 00             1144            nop
064F 00             1145            nop
0650 00             1146            nop
0651 00             1147            nop
0652 00             1148            nop
0653 00             1149            nop
0654 00             1150            nop
0655 00             1151            nop
0656 E528           1152            mov     A, INPORTA
0658 541E           1153            anl     A, #00011110b
065A 4223           1154            orl     OUTPORTA, A
065C 120660         1155            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1156            
065F 22             1157            ret
                    1158            
                    1159    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1160    ; WRITEPORTS
                    1161    ; spravi zalohu vystupnych registrov a posle data von
                    1162    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
VYTAH/ORI-D                                                                                                  PAGE 21

0660                1163    WRITEPORTS:
0660 852380         1164            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
0663 75A0C0         1165            mov     p2, #i8255OUTA
0666 C2B6           1166            clr     WRNOT
0668 00             1167            nop
0669 00             1168            nop
066A 00             1169            nop
066B 00             1170            nop
066C D2B6           1171            setb    WRNOT
                    1172            
066E 852480         1173            mov     p0, OUTPORTB        ; potom port B
0671 75A0C1         1174            mov     p2, #i8255OUTB
0674 C2B6           1175            clr     WRNOT
0676 00             1176            nop
0677 00             1177            nop
0678 00             1178            nop
0679 00             1179            nop
067A D2B6           1180            setb    WRNOT
                    1181    
067C 852580         1182            mov     p0, OUTPORTC        ; a nakoniec port C
067F 75A0C2         1183            mov     p2, #i8255OUTC
0682 C2B6           1184            clr     WRNOT
0684 00             1185            nop
0685 00             1186            nop
0686 00             1187            nop
0687 00             1188            nop
0688 D2B6           1189            setb    WRNOT
068A 00             1190            nop
068B 00             1191            nop
068C 00             1192            nop
068D 00             1193            nop
068E 00             1194            nop
068F 00             1195            nop
0690 00             1196            nop
0691 00             1197            nop
0692 22             1198            ret
                    1199    
                    1200    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1201    
0693 0D0A5269       1202    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0697 61646961   
069B 63692073   
069F 79737465   
06A3 6D206A65   
06A7 20696E69   
06AB 6369616C   
06AF 697A6F76   
06B3 616E792E   
06B7 0D0A00     
06BA 52696164       1203    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
06BE 69616369   
06C2 20737973   
06C6 74656D20   
06CA 6A652072   
06CE 65696E69   
06D2 6369616C   
06D6 697A6F76   
VYTAH/ORIKD                                                                                                  PAGE 22

06DA 616E7920   
06DE 706F2073   
06E2 746C6163   
06E6 656E6920   
06EA 746C6163   
06EE 69646C61   
06F2 2053544F   
06F6 502E0D0A   
06FA 00         
06FB 4B616C69       1204    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
06FF 62726163   
0703 69612076   
0707 79746168   
070B 75206A65   
070F 20756B6F   
0713 6E63656E   
0717 612E0D0A   
071B 00         
                    1205    
----                1206            DSEG
0040                1207            org     40h
0040                1208    STACK:  DS      10h
                    1209    
                    1210    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 23

B. . . . . . . . . . . . . . . .  D ADDR  00F0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0096H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00ADH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00B8H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A5H  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  0320H  
D3_MB1C. . . . . . . . . . . . .  C ADDR  04B6H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  0588H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0604H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  029BH  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  0315H  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  02E0H  
DOWN3. . . . . . . . . . . . . .  C ADDR  041FH  
VYTAH/ORI                                                                                                     PAGE 24

DOWN3_MB1. . . . . . . . . . . .  C ADDR  0499H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0464H  
DOWN4. . . . . . . . . . . . . .  C ADDR  04F1H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  056BH  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  0536H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  NOT USED  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  NOT USED  
ENDPROG. . . . . . . . . . . . .  C ADDR  05E0H  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  0595H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  05A4H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  05C2H  
ERR_SKRH . . . . . . . . . . . .  C ADDR  05D1H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  05B3H  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1S. . . . . . . . . . . . . . .  C ADDR  00DBH  
F2 . . . . . . . . . . . . . . .  C ADDR  01D8H  
F2DOWN . . . . . . . . . . . . .  C ADDR  01EAH  
F2OK . . . . . . . . . . . . . .  C ADDR  01B9H  
F2S. . . . . . . . . . . . . . .  C ADDR  01ABH  
F2UP . . . . . . . . . . . . . .  C ADDR  01DEH  
F3 . . . . . . . . . . . . . . .  C ADDR  036EH  
F3DOWN . . . . . . . . . . . . .  C ADDR  0380H  
F3OK . . . . . . . . . . . . . .  C ADDR  034FH  
F3S. . . . . . . . . . . . . . .  C ADDR  0341H  
F3UP . . . . . . . . . . . . . .  C ADDR  0374H  
F4S. . . . . . . . . . . . . . .  C ADDR  04D7H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C7H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  0197H  
FLOOR3 . . . . . . . . . . . . .  C ADDR  032DH  
FLOOR4 . . . . . . . . . . . . .  C ADDR  04C3H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C7H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
VYTAH/ORI                                                                                                     PAGE 25

MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  NOT USED  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  NOT USED  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  NOT USED  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  NOT USED  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  NOT USED  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  NOT USED  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  NOT USED  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  NOT USED  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  NOT USED  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  NOT USED  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  061BH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  06FBH  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  0693H  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  06BAH  NOT USED  
TIME0. . . . . . . . . . . . . .  C ADDR  05EEH  
TIME1. . . . . . . . . . . . . .  C ADDR  05F0H  
TIME10MS . . . . . . . . . . . .  C ADDR  05ECH  
TIME2. . . . . . . . . . . . . .  C ADDR  05F4H  
TIME3. . . . . . . . . . . . . .  C ADDR  05F8H  
TIME4. . . . . . . . . . . . . .  C ADDR  05FFH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U2_MB1C. . . . . . . . . . . . .  C ADDR  028DH  
U3_MB1C. . . . . . . . . . . . .  C ADDR  0411H  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
VYTAH/ORI                                                                                                     PAGE 26

UP1. . . . . . . . . . . . . . .  C ADDR  00F5H  
UP1A . . . . . . . . . . . . . .  C ADDR  0112H  
UP1_MB1. . . . . . . . . . . . .  C ADDR  016FH  
UP1_MB2. . . . . . . . . . . . .  C ADDR  013AH  
UP2. . . . . . . . . . . . . . .  C ADDR  01F6H  
UP2A . . . . . . . . . . . . . .  C ADDR  0213H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0270H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  023BH  
UP3. . . . . . . . . . . . . . .  C ADDR  038CH  
UP3A . . . . . . . . . . . . . .  C ADDR  03A9H  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0406H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  03D1H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  060FH  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  0602H  
WAITFORTIMER2. . . . . . . . . .  C ADDR  060AH  NOT USED  
WRITEPORTS . . . . . . . . . . .  C ADDR  0660H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
