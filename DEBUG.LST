DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umozni stlacat tlacidla aj ked bezi delay
                       7    
                       8    ;Prerusenia pojdu, ale treba dat sakra pozor na zalohovanie veci!!!
                       9    
                      10    ;uvision debug: 
                      11    ;MODE COM5 4800, 0, 8, 1
                      12    ;assign COM5 < SIN > SOUT
                      13    ;
                      14    ;X:000000H
                      15    
                      16    
                      17    $MOD51
                      18    $DEBUG
                      19    
                =1    20    $include (lift.inc)
                =1    21    
                =1    22    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    23    ; ****************************************************************************
                =1    24    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    25    ; ----------------------------------------------------------------------------
                =1    26    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    27    ; ----------------------------------------------------------------------------
                =1    28    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    29    ; ****************************************************************************
                =1    30    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    31    ; ----------------------------------------------------------------------------
                =1    32    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    33    ; ----------------------------------------------------------------------------
                =1    34    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    35    ; ****************************************************************************
                =1    36    ; ERRFLOOR > |       |       |       | ErrF4 | ErrF3 | ErrF2 | ErrF1 |       |
                =1    37    ; ****************************************************************************
                =1    38    
                =1    39    
                =1    40    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    41    i8255INA        equ     080h
  0081          =1    42    i8255INB        equ     081h
  0082          =1    43    i8255INC        equ     082h
  0083          =1    44    i8255INCW       equ     083h
  00C0          =1    45    i8255OUTA       equ     0c0h
  00C1          =1    46    i8255OUTB       equ     0c1h
  00C2          =1    47    i8255OUTC       equ     0c2h
  00C3          =1    48    i8255OUTCW      equ     0c3h
                =1    49    
                =1    50    ; bitovo adresovatelne bunky
                =1    51    ;               data    20h
  0021          =1    52    INPORTB         data    21h    ; nutne kvoli emulatoru!!! 
  0022          =1    53    INPORTC         data    22h
  0023          =1    54    OUTPORTA        data    23h
  0024          =1    55    OUTPORTB        data    24h
  0025          =1    56    OUTPORTC        data    25h
  0026          =1    57    INPORTBold      data    26h
  0027          =1    58    CTRLREG         data    27h
DEBUG                                                                                                         PAGE 2

  0028          =1    59    INPORTA         data    28h
                =1    60    ;               data    29h
  002A          =1    61    ERRFLOOR_U      data    2Ah
  002B          =1    62    ERRFLOOR_D      data    2Bh
  002C          =1    63    T_F                       data    2Ch
  002D          =1    64    T2_C                    data      2Dh      ;toto tu nemusi byt, netreba mi bitovo adresovate
                                                                               lne
                =1    65    ;                           data          2Eh
                =1    66    ;               data    2Fh  
                =1    67    ; general purpose RAM (including STACK)
  0030          =1    68    POSITION        data    30h
  0031          =1    69    LOWEST          data    31h
  0032          =1    70    HIGHEST         data    32h
  0033          =1    71    STOPTIMER       data    33h
  0034          =1    72    OUTPORTBold     data    34h
  0035          =1    73    ERRF1_C         data    35h
  0036          =1    74    ERRF2_C         data    36h
  0037          =1    75    ERRF3_C         data    37h
  0038          =1    76    ERRF4_C         data    38h
  0039          =1    77    ERRF12_C        data    39h
  003A          =1    78    ERRF23_C        data    3Ah
  003B          =1    79    ERRF34_C        data    3Bh
  003C          =1    80    G                           data    3Ch
  003D          =1    81    D1                  data    3Dh
  003E          =1    82    D2              data    3Eh
  003F          =1    83    ERRSKRH_C       data    3Fh
  0040          =1    84    ERRSKRD_C       data    40h      
                =1    85    
                =1    86    ;                       50h - vyssie - stack!
                =1    87    
                =1    88    
  0062          =1    89    T2_F                    bit         T_F.2
                =1    90    
  0051          =1    91    ERRF1_U         bit     ERRFLOOR_U.1
  0052          =1    92    ERRF2_U         bit     ERRFLOOR_U.2
  0053          =1    93    ERRF3_U         bit     ERRFLOOR_U.3
  0054          =1    94    ERRF4_U         bit     ERRFLOOR_U.4  
                =1    95    
  0052          =1    96    ERRF12_U        bit     ERRFLOOR_U.2
  0053          =1    97    ERRF23_U        bit     ERRFLOOR_U.3
  0054          =1    98    ERRF34_U        bit     ERRFLOOR_U.4   
                =1    99    
  0059          =1   100    ERRF1_D         bit     ERRFLOOR_D.1
  005A          =1   101    ERRF2_D         bit     ERRFLOOR_D.2
  005B          =1   102    ERRF3_D         bit     ERRFLOOR_D.3
  005C          =1   103    ERRF4_D         bit     ERRFLOOR_D.4   
                =1   104    
  0059          =1   105    ERRF12_D        bit     ERRFLOOR_D.1
  005A          =1   106    ERRF23_D        bit     ERRFLOOR_D.2
  005B          =1   107    ERRF34_D        bit     ERRFLOOR_D.3
                =1   108    
  0040          =1   109    STOPNOT         bit     INPORTA.0
  0041          =1   110    PKI1            bit     INPORTA.1
  0042          =1   111    PKI2            bit     INPORTA.2
  0043          =1   112    PKI3            bit     INPORTA.3
  0044          =1   113    PKI4            bit     INPORTA.4
  0045          =1   114    DOORCLSD        bit     INPORTA.5 
                =1   115    
DEBUG                                                                                                         PAGE 3

  0009          =1   116    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1   117    MB2             bit     INPORTB.2
  000B          =1   118    SKRH            bit     INPORTB.3
  000C          =1   119    SKRD            bit     INPORTB.4
  000D          =1   120    DP              bit     INPORTB.5
  000E          =1   121    DPZK            bit     INPORTB.6
  000F          =1   122    DPK             bit     INPORTB.7
                =1   123    
  0031          =1   124    MB1old          bit     INPORTBold.1
  0032          =1   125    MB2old          bit     INPORTBold.2
  0033          =1   126    SKRHold         bit     INPORTBold.3
  0034          =1   127    SKRDold         bit     INPORTBold.4
                =1   128    
  0010          =1   129    PI1             bit     INPORTC.0
  0011          =1   130    PI2D            bit     INPORTC.1
  0012          =1   131    PI2U            bit     INPORTC.2
  0013          =1   132    PI3D            bit     INPORTC.3
  0014          =1   133    PI3U            bit     INPORTC.4
  0015          =1   134    PI4             bit     INPORTC.5
                =1   135    
  0018          =1   136    KS              bit     OUTPORTA.0
  0019          =1   137    PKO1            bit     OUTPORTA.1
  001A          =1   138    PKO2            bit     OUTPORTA.2
  001B          =1   139    PKO3            bit     OUTPORTA.3
  001C          =1   140    PKO4            bit     OUTPORTA.4
                =1   141    
  0020          =1   142    UP              bit     OUTPORTB.0
  0021          =1   143    DOWN            bit     OUTPORTB.1
  0022          =1   144    FAST            bit     OUTPORTB.2
  0023          =1   145    SLOW            bit     OUTPORTB.3
  0024          =1   146    FLED1           bit     OUTPORTB.4
  0025          =1   147    FLED2           bit     OUTPORTB.5
  0026          =1   148    FLED3           bit     OUTPORTB.6
  0027          =1   149    FLED4           bit     OUTPORTB.7
                =1   150    
  0028          =1   151    PO1U            bit     OUTPORTC.0
  0028          =1   152    PO1D            bit     OUTPORTC.0
  0028          =1   153    PO1             bit     OUTPORTC.0
  0029          =1   154    PO2D            bit     OUTPORTC.1
  002A          =1   155    PO2U            bit     OUTPORTC.2
  002B          =1   156    PO3D            bit     OUTPORTC.3
  002C          =1   157    PO3U            bit     OUTPORTC.4
  002D          =1   158    PO4             bit     OUTPORTC.5
  002D          =1   159    PO4U            bit     OUTPORTC.5
  002D          =1   160    PO4D            bit     OUTPORTC.5
  002E          =1   161    LEDD            bit     OUTPORTC.6
  002F          =1   162    LEDU            bit     OUTPORTC.7
                =1   163    
  0038          =1   164    STOPPED         bit     CTRLREG.0
  0039          =1   165    DOORCLSDold     bit     CTRLREG.1
  003A          =1   166    UPold           bit     CTRLREG.2
  003B          =1   167    DOWNold         bit     CTRLREG.3
  003C          =1   168    FASTold         bit     CTRLREG.4
  003D          =1   169    SLOWold         bit     CTRLREG.5
                =1   170    
  00B6          =1   171    WRNOT           bit     0B6h        ; p3.6
  00B7          =1   172    RDNOT           bit     0B7h        ; p3.7
                =1   173    
DEBUG                                                                                                         PAGE 4

                =1   174    ; bitove masky
                =1   175    ; 8255OUT 
                =1   176    ; port A
  0001          =1   177    bmKS              equ    00000001b
  0002          =1   178    bmPKO1            equ    00000010b
  0004          =1   179    bmPKO2            equ    00000100b
  0008          =1   180    bmPKO3            equ    00001000b
  0010          =1   181    bmPKO4            equ    00010000b
                =1   182    
                =1   183    ; port B
  0001          =1   184    bmUP              equ    00000001b
  0002          =1   185    bmDOWN            equ    00000010b
  0004          =1   186    bmFAST            equ    00000100b
  0008          =1   187    bmSLOW            equ    00001000b
  0010          =1   188    bmFLED1           equ    00010000b
  0020          =1   189    bmFLED2           equ    00100000b
  0040          =1   190    bmFLED3           equ    01000000b
  0080          =1   191    bmFLED4           equ    10000000b
                =1   192    
                =1   193    ; port C
  0001          =1   194    bmPO1             equ    00000001b
  0002          =1   195    bmPO2D            equ    00000010b
  0004          =1   196    bmPO2U            equ    00000100b
  0008          =1   197    bmPO3D            equ    00001000b
  0010          =1   198    bmPO3U            equ    00010000b
  0020          =1   199    bmPO4             equ    00100000b
  0040          =1   200    bmLEDD            equ    01000000b
  0080          =1   201    bmLEDU            equ    10000000b
                =1   202    
                =1   203    ; 8255IN
                =1   204    ; port A
  0001          =1   205    bmSTOP            equ    00000001b
  0002          =1   206    bmPKI1            equ    00000010b
  0004          =1   207    bmPKI2            equ    00000100b
  0008          =1   208    bmPKI3            equ    00001000b
  0010          =1   209    bmPKI4            equ    00010000b
  0020          =1   210    bmDOORCLSD        equ    00100000b
                =1   211    
                =1   212    ; port B
  0002          =1   213    bmMB1I            equ    00000010b
  0004          =1   214    bmMB2I            equ    00000100b
  0008          =1   215    bmSKRHI           equ    00001000b
  0010          =1   216    bmSKRHD           equ    00010000b
  0020          =1   217    bmDPI             equ    00100000b
  0040          =1   218    bmDPZKI           equ    01000000b
  0080          =1   219    bmDPKI            equ    10000000b
                =1   220    
                =1   221    ; port C
  0001          =1   222    bmPI1             equ    00000001b
  0002          =1   223    bmPI2D            equ    00000010b
  0004          =1   224    bmPI2U            equ    00000100b
  0008          =1   225    bmPI3D            equ    00001000b
  0010          =1   226    bmPI3U            equ    00010000b
  0020          =1   227    bmPI4             equ    00100000b
                =1   228    
                =1   229    $include (macroLib.inc)
                =1   230    ;*******************************************************************************
                =1   231    ;   Sofrverovy breakpoint
DEBUG                                                                                                         PAGE 5

                =1   232    ;-------------------------------------------------------------------------------
                =1   233    ;     Pouzitie pri debugovani pomocou emulatora T-EMU52
                =1   234    ;     Pre spravne fungovanie musi byt parameter <Single step interrupt> 
                =1   235    ;     nastaveny na hodnotu <INT1>
                =1   236    ;
                =1   237    ;     Emulator -> Configuration -> Single step interrupt
                =1   238    ;
                =1   239    _BP_    MACRO 
                =1   240            clr     P3.3
                =1   241            setb    EX1
                =1   242            nop
                =1   243    ENDM
                =1   244    
                =1   245    
                =1   246    ;*******************************************************************************
                =1   247    ;   CFCSS - kontrolne instrukcie
                =1   248    ;-------------------------------------------------------------------------------
                =1   249    ;     Obsahuje instrukcie, ktore sa pridaju na zaciatok bloku.
                =1   250    ;     <s> predstavuje priznak prideleny aktualnemu bloku
                =1   251    ;     <d> predstavuje rozdiel (XOR) medzi predchadzajucim a aktualnym blokom
                =1   252    ;         (na zaklade tejto hodnoty sa vypocita novya hodnota <G>)
                =1   253    ;     <D1> a <D2> predstavuju priznaky pre upravu <G>, ak sa 
                =1   254    ;         nachadza v mnozine nasledovnikov aktualneho bloku aj fan-in blok    
                =1   255    ;
                =1   256    CFCSS   MACRO   s, d, D1val, D2val, Dx 
                =1   257            xrl             G,  #d             ;; Vypocitanie novej hodnoty priznaku <G>
                =1   258            IF (Dx <> -1)
                =1   259                mov   A,  Dx         ;; Uprava priznaku <G> na zaklade <Dx>
                =1   260                xrl   G,  A          ;;     (iba pri fan-in vrcholoch)
                =1   261            ENDIF    
                =1   262            mov   A,  G              ;; Porovnanie aktualnej hodnoty <G> s priznakkom <s>
                =1   263            LCJNE A,  #s, CFCERR     ;;     (ak sa priznaky nerovnaju, skoci sa na osetrenie chy
                                                                               by )
                =1   264            IF (D1val <> -1)
                =1   265                mov         D1, #D1val     ;; Nastavenie priznaku <D1>
                =1   266            ELSE
                =1   267                mov         D1, #32        ;; Nastavenie priznaku <D1> na hodnotu mimo rozsahu 
                                                                               
                =1   268            ENDIF                    ;; (aby sa predislo maskovaniu pri nepovolenom skoku)
                =1   269            IF (D2val <> -1)
                =1   270                mov         D2, #D2val     ;; Nastavenie priznaku <D2>
                =1   271            ELSE
                =1   272                mov         D2, #32        ;; Nastavenie priznaku <D2> na hodnotu mimo rozsahu 
                                                                               
                =1   273            ENDIF                    ;; (aby sa predislo maskovaniu pri nepovolenom skoku)
                =1   274            SERCHAR   #s             ;; Vypis aktualneho <s> na seriovu linku
                =1   275    ENDM
                =1   276    
                =1   277    ;*******************************************************************************
                =1   278    ;   Vypis znaku na seriovu linku
                =1   279    ;-------------------------------------------------------------------------------
                =1   280    ;     Vypise jeden znak (prijaty ako parameter CHAR) na seriovu linku.   
                =1   281    ;
                =1   282    SERCHAR MACRO CHAR
                =1   283                    mov               A, CHAR
                =1   284        jnb     TI, $ 
                =1   285        clr     TI
                =1   286                    mov     SBUF, A
DEBUG                                                                                                         PAGE 6

                =1   287        
                =1   288    ENDM
                =1   289    
                =1   290    
                =1   291    ;*******************************************************************************
                =1   292    ;   Instrukcie pre casovace a pocitadla
                =1   293    ;-------------------------------------------------------------------------------
                =1   294    ;     Spustenie casovaca s hodnotou <VAL>. Po (<VAL>*50)ms sa nastavi 
                =1   295    ;     priznak <T2_F>    
                =1   296    ;
                =1   297    TIMER2  MACRO  VAL
                =1   298               mov           T2_C, #VAL                              ;; 3 sekundy
                =1   299                     clr       T2_F                                  ;; vynulovat priznak pretec
                                                                               enia
                =1   300                     setb      TR2                                             ;; spustit casova
                                                                               c
                =1   301    ENDM
                =1   302    
                =1   303    
                =1   304    
                =1   305    
                =1   306    ;*******************************************************************************
                =1   307    ;   Ekvivalenty podmienenych skokovych instrukcii s dlhym skokom
                =1   308    ;-------------------------------------------------------------------------------
                =1   309    ;     Nazov makra je tvoreny nazvom skokovej instrukcie a prefixom "L"   
                =1   310    ;
                =1   311    
                =1   312    ; Long jump if zero
                =1   313    LJZ     MACRO   NAVESTIE
                =1   314            jnz     $+5
                =1   315            ljmp    NAVESTIE
                =1   316            nop
                =1   317    ENDM
                =1   318    
                =1   319    ; Long jump if not zero
                =1   320    LJNZ    MACRO   NAVESTIE
                =1   321            jz      $+5
                =1   322            ljmp    NAVESTIE
                =1   323            nop
                =1   324    ENDM
                =1   325    
                =1   326    ; Long jump if bit set
                =1   327    LJB     MACRO   TESTBIT, NAVESTIE
                =1   328            jnb     TESTBIT, $+6
                =1   329            ljmp    NAVESTIE
                =1   330            nop
                =1   331    ENDM
                =1   332    
                =1   333    ; Long jump if bit not set
                =1   334    LJNB    MACRO   TESTBIT, NAVESTIE
                =1   335            jb      TESTBIT, $+6
                =1   336            ljmp    NAVESTIE
                =1   337            nop
                =1   338    ENDM
                =1   339    
                =1   340    ; Compare & long jump if not equal
                =1   341    LCJNE   MACRO   OP1, OP2, NAVESTIE
                =1   342            cjne    OP1, OP2, $+6
DEBUG                                                                                                         PAGE 7

                =1   343            jmp     $+6
                =1   344            ljmp    NAVESTIE
                =1   345            nop
                =1   346    ENDM
                =1   347    
                =1   348    ;*******************************************************************************
                =1   349    ;   Modifikacie instrukcii x51
                =1   350    ;-------------------------------------------------------------------------------
                =1   351    ;     Tieto makra obsahuju niektore modifikovane zakladne dostupne instrukcie x51     
                =1   352    ;
                =1   353    
                =1   354    ;Logical and (bit operands)
                =1   355    ANLB   MACRO   BIT1, BIT2
                =1   356            mov   C, BIT1
                =1   357            anl   C, /BIT2
                =1   358            mov   BIT1, C
                =1   359    ENDM
                =1   360    
                =1   361    ; Compare & long jump if equal
                =1   362    LCJE     MACRO   OP1, OP2, NAVESTIE
                =1   363            cjne    OP1, OP2, $+7
                =1   364            jmp    NAVESTIE
                =1   365            nop
                =1   366    ENDM
                =1   367    
                =1   368    
                =1   369    ;*******************************************************************************
                =1   370    ;   Privolavace, signalizácia polohy a smeru kabiny
                =1   371    ;-------------------------------------------------------------------------------
                =1   372    ;
                =1   373    ;   Signalizacia polohy kabiny
                =1   374    ;
                =1   375    ;     Signalizuje polohu kabiny na signalizacnom paneli.  
                =1   376    ;     Poloha kabiny zavisi o parametra "POLOHA" 
                =1   377    ;     Vykonane zmeny sa zapisu na porty     
                =1   378    ;
                =1   379    POLOHA_LED  MACRO  POLOHA
                =1   380            anl     OUTPORTB, #((not bmFLED1) and(not bmFLED2) and(not bmFLED3) and(not bmFLED4)
                                                                               )          
                =1   381            setb    FLED&POLOHA
                =1   382            lcall   WRITEPORTS
                =1   383    ENDM
                =1   384    
                =1   385    ;   Zrusenie volby vybraneho poschodia
                =1   386    ;
                =1   387    ;     Zrusi volbu vybraneho poschodia <POSCH>. Volba   
                =1   388    ;     sa zrusi v kabine ako aj v oboch smeroch na poschodi.
                =1   389    ;
                =1   390    ZRUS_POSCH  MACRO POSCH
                =1   391            clr     PKO&POSCH       ;; vynulovanie volby poschodia na ktorom stojim
                =1   392            clr     PO&POSCH&U      ;;
                =1   393            clr     PO&POSCH&D      ;;
                =1   394            lcall   WRITEPORTS
                =1   395    ENDM
                =1   396    
                =1   397    ;   Rozsvietenie kabinoveho svetla a smerovej signalizacie 
                =1   398    ;
                =1   399    ;     Rozsvieti kabinove svetlo a obe sibky smerovej
DEBUG                                                                                                         PAGE 8

                =1   400    ;     signalizacie ak sa v kabine nachadza obsluhyschopna
                =1   401    ;     osoba. V opacnom pripade svetlo a signalizaciu
                =1   402    ;     zhasne.
                =1   403    ;
                =1   404    KABINOVE_SVETLO MACRO
                =1   405            mov      C, DP          ;; Ak je nieko v kabine,
                =1   406            orl      C, DPZK        ;;
                =1   407            orl      C, DPK         ;;
                =1   408            mov      KS, C          ;;   - v kabine zapalime svetlo. Ak nie, bude zhasnute.
                =1   409            mov      LEDU, C        ;;   - Rozsvietime signalizaciu do oboch smerov. Ak nie, zha
                                                                               sneme.
                =1   410            mov      LEDD, C        ;;
                =1   411            lcall   WRITEPORTS      ;;
                =1   412    ENDM
                =1   413    
                =1   414    ;   Rozsvieti obe smerove LED diody (signalizacia, ze kabina stoji)
                =1   415    ;
                =1   416    ROZSVIET_SMER_LED MACRO
                =1   417            setb    LEDU            ;
                =1   418            setb    LEDD            ;
                =1   419            lcall   WRITEPORTS      ;
                =1   420    ENDM
                =1   421    
                =1   422    ;   Zistenie, ci obsluhyschopna osoba zvolila poschodie
                =1   423    ;      
                =1   424    ;     Zistenie, či obsluhyschopna osoba v kabine vytahu 
                =1   425    ;     stlacila niektoru z volieb poschodi v kabine.
                =1   426    ;     V pripade, ze v kabine sa nachadza obsluhyschopna 
                =1   427    ;     osoba a volba zatial nebola uskutocnena, skoci sa 
                =1   428    ;     na <NAVESTIE>      
                =1   429    ;        
                =1   430    JE_VYBRATE_POSCHODIE MACRO NAVESTIE
                =1   431            mov      C, DP         ;; Ak sa nachadza v kabine osoba, 
                =1   432            orl      C, DPZK        ;;
                =1   433            orl      C, DPK         ;;
                =1   434            jnc      $+8            ;;
                =1   435            mov      A, INPORTA     ;;
                =1   436            anl      A, #00011110b  ;; ...a nie je vybrata ziadna volba (v kabine)
                =1   437            jz       NAVESTIE       ;; skoc na navestie
                =1   438    ENDM
                =1   439    
                =1   440    
                =1   441    ;*******************************************************************************
                =1   442    ;   Rychlost a smer pohybu motora
                =1   443    ;-------------------------------------------------------------------------------
                =1   444    ;
                =1   445    ;   Nastavenie smeru pohybu motora - hore
                =1   446    SET_UP MACRO
                =1   447            setb     UP
                =1   448            clr      DOWN
                =1   449            setb     LEDU
                =1   450            clr      LEDD 
                =1   451    ENDM
                =1   452    
                =1   453    ;   Nastavenie smeru pohybu motora - dole
                =1   454    SET_DOWN MACRO
                =1   455            clr     UP
                =1   456            setb    DOWN
DEBUG                                                                                                         PAGE 9

                =1   457            clr     LEDU
                =1   458            setb    LEDD 
                =1   459    ENDM
                =1   460    
                =1   461    ;   Nastavenie rychlosti pohybu motora - rychlo
                =1   462    SET_FAST MACRO
                =1   463            setb     FAST
                =1   464            clr      SLOW
                =1   465            setb     KS      
                =1   466    ENDM
                =1   467    
                =1   468    ;   Nastavenie smeru pohybu motora - hore
                =1   469    SET_SLOW MACRO
                =1   470            setb     SLOW
                =1   471            clr      FAST
                =1   472            setb     KS
                =1   473    ENDM
                =1   474     
                =1   475      
                     476                       
                     477    
                     478    ; Definicie registrov pre Keil uVision
  00C8               479    T2CON  DATA  0C8H  ;TIMER 2 CONTROL
  00CA               480    RCAP2L DATA  0CAH  ;TIMER 2 CAPTURE REGISTER - LOW BYTE
  00CB               481    RCAP2H DATA  0CBH  ;TIMER 2 CAPTURE REGISTER - HIGH BYTE
  00CA               482    TR2    BIT   0CAH  ;T2CON.2 - TIMER 2 ON/OFF CONTROL
  00AD               483    ET2    BIT   0ADH  ;IE.5 - TIMER 2 INTERRUPT ENABLE
  00CF               484    TF2    BIT   0CFH  ;T2CON.7 - TIMER 2 OVERFLOW FLAG
                     485    
                     486    
  0000               487    COUNT    SET    0
                     488    
                     489    ;*******************************************************************************
                     490    ;   Oznacenie poruchoveho poschodia 
                     491    ;-------------------------------------------------------------------------------
                     492    ;     nastavi dane poschodie ako poruchove ak je TESTBIT rovny 0    
                     493    ;
                     494    SET_FLOOR_ERR   MACRO   TESTBIT, FLOORBIT, NAVESTIE, POSCH, LABEL    ;; nastavi dane poschod
                                                                               ie ako poruchove ak je TESTBIT rovny 0 
                     495                                                                                                
                                                                                                                        
                                                                                   ;;   FLOORBIT:   ERRF1, .. ERRF4, ERR
                                                                               F12, ERRF23, ERRF34
                     496                                                                                                
                                                                                                                        
                                                                                   ;;   TESTBIT:    MB1, MB2
                     497            ;INCREMENT SUFFIX  FOR  NEXT LABEL             
                     498            COUNT    SET    COUNT+1                   
                     499            
                     500            jb      TESTBIT, ENDD&LABEL
                     501            jnb     PKI&POSCH, $+7
                     502            clr     FAST
                     503            setb    SLOW
                     504            setb    STOPPED         
                     505            setb    FLOORBIT&_U
                     506            setb    FLOORBIT&_D
                     507            inc     FLOORBIT&_C
                     508                    clr     PKO&POSCH                               ;; vynulovanie volby poschod
DEBUG                                                                                                         PAGE 10

                                                                               ia na ktorom stojim
                     509            clr     PO&POSCH&U            
                     510            clr     PO&POSCH&D              
                     511                    lcall   WRITEPORTS
                     512            ljmp    NAVESTIE
                     513    ENDD&LABEL:
                     514            nop
                     515    ENDM
                     516    
                     517    ;*******************************************************************************
                     518    ;   Odstranenie oznacenia poruchoveho poschodia 
                     519    ;-------------------------------------------------------------------------------
                     520    ;     nastavi dane poschodie ako poruchove ak je TESTBIT rovny 0    
                     521    ;
                     522    CLR_FLOOR_ERR   MACRO   FLOORBIT,   ;; nastavi dane poschodie ako bezporuchove           
                     523            clr    FLOORBIT&_U
                     524            clr    FLOORBIT&_D
                     525            nop
                     526    ENDM
                     527    
                     528    ;*******************************************************************************
                     529    ;   Osetrenie zakmitov clonky
                     530    ;-------------------------------------------------------------------------------
                     531    ;        
                     532    ;
                     533    ZAKMITC MACRO   TYPCLONKY
                     534            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     535            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     536            jnb     TYPCLONKY, $-3  ; 
                     537            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     538    ENDM
                     539    
                     540    ZASTAV  MACRO  C_POSCH, SMER
                     541                                            ;; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     542            clr     C                       ;; | Idem robit cachre-machre s Carry bitom
                     543            mov     A, #0h                  ;; | Aj Acc potrebujem prazdny
                     544            orl     C, PI&C_POSCH&SMER      ;; | Mam v tomto smere stlacene tlacidlo v sachte?
                     545            anl     C, /DPZK                ;; | a mam plne zatazenu kabinu? (lebo ak ano tak an
                                                                               i za boha nestojim)
                     546            orl     C, PKI&C_POSCH          ;; | Mam v tomto smere stlacene tlacidlo v kabine? 
                                                                               
                     547            anl     C, /ERRF&C_POSCH&_&SMER ;; | a mam v tomto smere poruchu na tomto poschodi (
                                                                               Ak ano, tak nema zmysel stat)
                     548            orl     C, DPK                  ;; | a mam pretazenu kabinu? (Ak ano tak stojim urci
                                                                               te)
                     549            orl     C, STOPPED              ;; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoj
                                                                               im urcite)
                     550            addc    A, #0h                  ;; Ak mi v predchadzajucich krokoch vyslo, ze mam st
                                                                               at, tak stojim nezavisle na tlacidlach ka
                                                                               biny
                     551    ENDM
                     552    
                     553    NAJNIZSIE  MACRO
                     554            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     555            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
DEBUG                                                                                                         PAGE 11

                                                                                X | 
                     556            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     557    
                     558            ;ANLB    ACC.1, ERRF1_D  ; maskujem chybne poschodia
                     559            ANLB    ACC.2, ERRF2_D  ; |
                     560            ANLB    ACC.3, ERRF2_D  ; |
                     561            ANLB    ACC.4, ERRF3_D  ; |
                     562            ;ANLB    ACC.5, ERRF3_D  ; |
                     563    
                     564            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     565     ; LL1: 
                     566            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     567            clr     C               ; Inak shiftnem o 2
                     568            rlc     A               ;
                     569            clr     C               ;
                     570            rlc     A               ;
                     571            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     572    ; LL2:
                     573            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     574    ENDM
                     575    
                     576    NAJVYSSIE  MACRO
                     577            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     578            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     579            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     580            
                     581            ;ANLB    ACC.2, ERRF2_U  ; maskujem chybne poschodia
                     582            ANLB    ACC.3, ERRF2_U  ; |
                     583            ANLB    ACC.4, ERRF3_U  ; |
                     584            ANLB    ACC.5, ERRF3_U  ; |
                     585            ;ANLB    ACC.6, ERRF4_U  ; |
                     586            
                     587            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     588     ; LL1: 
                     589            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     590            clr     C               ; Inak shiftnem o 2
                     591            rrc     A               ;
                     592            clr     C               ;
                     593            rrc     A               ;
                     594            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     595    ; LL2:
                     596            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     597            clr     C               ;
                     598            subb    A, R0           ;
                     599    ENDM
                     600    
                     601    VYSSIE_KABINA  MACRO  POSCH
                     602            mov     A, INPORTA
                     603            anl     A, #00011110b
                     604            mov     B, ERRFLOOR_U   ; maskujem chybne poschodia
DEBUG                                                                                                         PAGE 12

                     605            anl     B, #00001100b   ; na krajne poschodia dovolim ist
                     606            xrl     B, #0FFH
                     607            anl     A, B
                     608            clr     C
                     609            rrc     A
                     610    ;LL1    
                     611            mov     R0, #&POSCH
                     612            clr     C
                     613            rrc     A
                     614            djnz    R0, $-2;LL1
                     615    ENDM
                     616    
                     617    NIZSIE_KABINA  MACRO  POSCH
                     618            mov     A, #5
                     619            clr     C
                     620            subb    A, #&POSCH
                     621            mov     R0, A
                     622            mov     A, INPORTA
                     623            anl     A, #00011110b
                     624            mov     B, ERRFLOOR_D   ; maskujem chybne poschodia
                     625            anl     B, #00001100b   ; na krajne poschodia dovolim ist
                     626            xrl     B, #0FFH
                     627            anl     A, B
                     628            clr     C
                     629            rlc     A
                     630            clr     C
                     631            rlc     A
                     632            clr     C
                     633            rlc     A
                     634    ;LL1   
                     635            clr     C
                     636            rlc     A
                     637            djnz    R0, $-2;LL1
                     638    ENDM
                     639    
                     640    
                     641    
                     642    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz (11.052900)
  00FA               643    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     644                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     645                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     646    ;osetrenie vektorov preruseni
0000                 647            org     0000h           ; adresa odkial startuje program po resete
0000 020033          648            ljmp    START           ; skok na zaciatok kodu programu
                     649            
000B                 650            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 021033          651            ljmp    INT_TIMER0      ; pre casovac T0
                     652            
002B                 653            org               002Bh           ; v tejto casti pamati je vektor prerusenia
002B 0211A2          654                        ljmp    INT_TIMER2      ; pre casovac T2   
                     655                  
0033                 656            org     0033h           ; od tejto adresy sa zacina kod programu
                     657            
0033                 658    START:
0033                 659    RESET:  
                     660            ; riadiace signaly do pasivnej urovne 
DEBUG                                                                                                         PAGE 13

0033 D2B6            661            setb    WRNOT
0035 D2B7            662            setb    RDNOT
0037 753300          663            mov     STOPTIMER, #0
003A 758150          664            mov     SP, #STACK
                     665    
                     666            ; pockame si na inicializaciu obvodov 8255  
003D 7900            667            mov     R1, #0 
003F 7AFF            668            mov     R2, #0ffh
0041 D9FE            669            djnz    R1, $
0043 DAFC            670            djnz    R2, $-2
                     671            
                     672            ; teraz ich mozeme nastavit
0045 75809B          673            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          674            mov     p2, #i8255INCW
004B C2B6            675            clr     WRNOT
004D 00              676            nop
004E 00              677            nop
004F 00              678            nop
0050 00              679            nop
0051 D2B6            680            setb    WRNOT
0053 758080          681            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          682            mov     p2, #i8255OUTCW
0059 C2B6            683            clr     WRNOT
005B 00              684            nop
005C 00              685            nop
005D 00              686            nop
005E 00              687            nop
005F D2B6            688            setb    WRNOT
                     689            
                     690            ; nastavenie preruseni 
0061 C28E            691            clr     TR1                 ; zastavi sa citac T1
0063 759852          692            mov     SCON,#01010010b     ; nastavenie registra SCON                              
                                                                                                                        
                                                                                   <<<<<<<<<   01010010b
                     693                                        ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     694                                        ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     695                                        ; RI=0 (prijimaci register - nebol prijaty znak)
0066 758801          696            mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
0069 758921          697            mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     698                                        ; T1: mod 1 - 16 bitove pocitadlo
                     699                                        ; GATE=0 (programove riadenie casovaca)
                     700                                        ; C/T#=0 interne hodiny/12
                     701                                        ; T0: mod 1 - 16 bitove pocitadlo
                     702                                        ; GATE=0 (programove riadenie casovaca)
                     703                                        ; C/T#=0 interne hodiny/12
006C 758740          704            mov     PCON,#01000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila prenos
                                                                               ova rychlost seriovej linky              
                                                                                    <<<<<<<<   00000000b
006F 758B00          705            mov     TL1, #000h          ; inicializacia casovaca T1
0072 758DFA          706            mov     TH1, #0FAh          ; 
0075 758A00          707            mov     TL0, #000h          ; inicializacia casovaca T0 - 57600 = 0e100h
0078 758C4C          708            mov     TH0, #04Ch
007B 75C800          709                        mov           T2CON,  #0                        ; Auto-reload mod
007E 75CA00          710                        mov           RCAP2L, #0h;              ; 4C00h = 19456,  Timer Clk=11,0
                                                                               592/12*1 = 0,9216 MHz
0081 75CB4C          711                        mov           RCAP2H, #4Ch;             ; (50ms)
0084 D2AD            712                        setb          ET2                                           ; Enable Tim
                                                                               er2 interrupt
DEBUG                                                                                                         PAGE 14

                     713            
                     714            
                     715            
0086 D28C            716            setb    TR0
0088 D28E            717            setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     718            
                     719            
                     720            
                     721    
                     722    
                     723            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
008A 752800          724            mov     INPORTA, #0
008D 75211E          725            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0090 752200          726            mov     INPORTC, #0
0093 75231E          727            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0096 7524F0          728            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0099 7525FF          729            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
009C D218            730            setb    KS
009E C238            731            clr     STOPPED
00A0 121158          732            call    WRITEPORTS          ; zapis novu informaciu
                     733    
00A3 752300          734            mov     OUTPORTA, #0
00A6 752400          735            mov     OUTPORTB, #0
00A9 752500          736            mov     OUTPORTC, #0
00AC 121158          737            call    WRITEPORTS          ; zapis novu informaciu
                     738    
00AF 752800          739            mov     INPORTA, #0
00B2 752100          740            mov     INPORTB, #0         
00B5 752200          741            mov     INPORTC, #0
00B8 1210F9          742            call    READPORTS           ; prvotne nacitanie udajov
                     743            
00BB 752A00          744            mov     ERRFLOOR_U, #0h     ; vynuluj chybovy register
00BE 752B00          745            mov     ERRFLOOR_D, #0h      
                     746    
                     747            
00C1 9011B9          748            mov     DPTR, #STR_INIT         ; vypis info 
00C4 12118F          749            lcall   DISPSTR                 ; o inicializacii       
                     750    
00C7                 751    CALIB:
                     752            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     753            ;setb    TR0
00C7 1210F9          754            lcall   READPORTS                   ; precitaj, co je na portoch
00CA 300C13          755            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
00CD D221            756            setb    DOWN                        ; inak pod dole
00CF D222            757            setb    FAST                        ; a rychlo
00D1 C223            758            clr     SLOW                        ;
00D3 C220            759            clr     UP                
00D5 121158          760            lcall   WRITEPORTS                  ; zapis informaciu 
00D8                 761    CALIBLOOP:
00D8 1210F9          762            lcall   READPORTS                   ; 
00DB 300C02          763            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00DE 80F8            764            jmp     CALIBLOOP
00E0                 765    CALIBEND:                              
00E0 C222            766            clr     FAST                        ; zastavime v tomto smere
00E2 C221            767            clr     DOWN                        ;
00E4 D223            768            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
DEBUG                                                                                                         PAGE 15

00E6 D220            769            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00E8 121158          770            lcall   WRITEPORTS 
00EB                 771    CALIBEND2:
00EB 1210F9          772            lcall   READPORTS                   ; 
00EE 2009FA          773            jb      MB1, CALIBEND2              ; 
00F1 C223            774            clr     SLOW                        ; A teraz sme uz naozaj spravne
00F3 C220            775            clr     UP                          ; 
00F5 D224            776            setb    FLED1
00F7 121158          777            lcall   WRITEPORTS                  ; zapis informaciu
                     778            ;clr     TR0
                     779            ;_BP_
00FA 9011B9          780            mov     DPTR, #STR_INIT             ; vypis info o kalibracii
00FD 12118F          781            lcall   DISPSTR                     ;
0100                 782    MAIN:
                     783    
                     784    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     785    ; ****************************************************************************
                     786    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     787    ; ----------------------------------------------------------------------------
                     788    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     789    ; ----------------------------------------------------------------------------
                     790    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     791    ; ****************************************************************************
                     792    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     793    ; ----------------------------------------------------------------------------
                     794    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     795    ; ----------------------------------------------------------------------------
                     796    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   | 
                     797    ; ****************************************************************************
                     798    ; POSITION
                     799    ; ****************************************************************************
                     800    
                     801    
                     802    
0100 7D00            803            mov     R5, #0
0102 7E14            804            mov     R6, #20
0104 D2A9            805            setb    ET0;
                     806            
                     807            ;Inicializacia priznakov (CFCSS)
0106 753C1E          808            mov             G, #30
0109 753D00          809                        mov         D1, #0
010C 753E00          810            mov             D2, #0
010F 90132E          811            mov   DPTR, #STR_CFC_START         ; vypis info 
0112 12118F          812            lcall DISPSTR         ;
                     813                          
                     814    
                     815    
                     816    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     817    
0115                 818    FLOOR1:
                     819            ;--------------------------
                     820 +1         CFCSS     29, 3, -1, -1, D1
0115 633C03          821 +1         xrl             G,  #3             
                     822 +1         IF (D1 <> -1)
0118 E53D            823 +1             mov   A,  D1         
011A 623C            824 +1             xrl   G,  A          
DEBUG                                                                                                         PAGE 16

                     825 +1         ENDIF    
011C E53C            826 +1         mov   A,  G              
                     827 +2         LCJNE A,  #29, CFCERR     
011E B41D03          828 +2         cjne    A, #29, $+6
0121 020127          829 +2         jmp     $+6
0124 021001          830 +2         ljmp    CFCERR
0127 00              831 +2         nop
                     832 +1         IF (-1 <> -1)
                     833 +1             mov         D1, #-1     
                     834 +1         ELSE
0128 753D20          835 +1             mov         D1, #32        
                     836 +1         ENDIF                    
                     837 +1         IF (-1 <> -1)
                     838 +1             mov         D2, #-1     
                     839 +1         ELSE
012B 753E20          840 +1             mov         D2, #32        
                     841 +1         ENDIF                    
                     842 +2         SERCHAR   #29             
012E 741D            843 +2                 mov               A, #29
0130 3099FD          844 +2     jnb     TI, $ 
0133 C299            845 +2     clr     TI
0135 F599            846 +2                 mov     SBUF, A
                     847 +2     
                     849            ;--------------------------
                     850 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0137 53240F          851 +1         anl     OUTPORTB, #((not bmFLED1) and(not bmFLED2) and(not bmFLED3) and(not bmFLED4)
                                                                               )          
013A D224            852 +1         setb    FLED1
013C 121158          853 +1         lcall   WRITEPORTS
013F C238            855            clr     STOPPED
                     856 +1         TIMER2  60              ; (Timer - 3s)
0141 752D3C          857 +1            mov           T2_C, #60                              
0144 C262            858 +1                  clr       T2_F                                  
0146 D2CA            859 +1                  setb      TR2                                             
                     861 +1         ROZSVIET_SMER_LED
0148 D22F            862 +1         setb    LEDU            ;
014A D22E            863 +1         setb    LEDD            ;
014C 121158          864 +1         lcall   WRITEPORTS      ;
014F 1210F9          866    F1S:    lcall   READPORTS       ; nacitanie dat
                     867 +1         ZRUS_POSCH 1
0152 C219            868 +1         clr     PKO1       
0154 C228            869 +1         clr     PO1U      
0156 C228            870 +1         clr     PO1D      
0158 121158          871 +1         lcall   WRITEPORTS
015B 3062F1          873            jnb                T2_F, F1S                    ; Uz presiel minimalny cas na poscho
                                                                               di? Ak nie, nejdeme dalej
                     874 +1         KABINOVE_SVETLO         ; Rozsviet kabinove svetlo a smerovu signalizaciu ak je v ka
                                                                               bine osoba
015E A20D            875 +1         mov      C, DP          
0160 720E            876 +1         orl      C, DPZK        
0162 720F            877 +1         orl      C, DPK         
0164 9218            878 +1         mov      KS, C          
0166 922F            879 +1         mov      LEDU, C        
0168 922E            880 +1         mov      LEDD, C        
016A 121158          881 +1         lcall   WRITEPORTS      
016D 200FDF          883            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0170 3045DC          884            jnb     DOORCLSD, F1S   ; Su otvorene dvere? Ak ano, tak nejdem dalej.
DEBUG                                                                                                         PAGE 17

                     885 +1         JE_VYBRATE_POSCHODIE F1S; Je v kabine osoba, ktora este nevybrala poschodie? Ak ano,
                                                                                nejdeme dalej.
0173 A20D            886 +1         mov      C, DP         
0175 720E            887 +1         orl      C, DPZK        
0177 720F            888 +1         orl      C, DPK         
0179 5006            889 +1         jnc      $+8            
017B E528            890 +1         mov      A, INPORTA     
017D 541E            891 +1         anl      A, #00011110b  
017F 60CE            892 +1         jz       F1S       
0181                 894    F1C:        
0181 E528            895            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
0183 852AF0          896            mov     B, ERRFLOOR_U   ; | maskujem chybne poschodia
0186 53F00C          897            anl     B, #00001100b   ; | na krajne poschodia dovolim ist
0189 63F0FF          898            xrl     B, #0FFH        ; | |
018C 55F0            899            anl     A, B            ; | |
018E 541C            900            anl     A, #00011100b   ; |
0190 701A            901            jnz     F1OK            ; ak ano, podme na to
0192 E522            902            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
0194 543E            903            anl     A, #00111110b   ;
                     904            ;ANLB    ACC.1, ERRF2_U  ; maskujem chybne poschodia (v smere hore)
                     905 +1         ANLB    ACC.2, ERRF2_U  ; |
0196 A2E2            906 +1         mov   C, ACC.2
0198 B052            907 +1         anl   C, /ERRF2_U
019A 92E2            908 +1         mov   ACC.2, C
                     910 +1         ANLB    ACC.3, ERRF3_U  ; |
019C A2E3            911 +1         mov   C, ACC.3
019E B053            912 +1         anl   C, /ERRF3_U
01A0 92E3            913 +1         mov   ACC.3, C
                     915 +1         ANLB    ACC.4, ERRF3_U  ; |
01A2 A2E4            916 +1         mov   C, ACC.4
01A4 B053            917 +1         anl   C, /ERRF3_U
01A6 92E4            918 +1         mov   ACC.4, C
                     920            ;ANLB    ACC.5, ERRF4_U  ; |
01A8 7002            921            jnz     F1OK            ; ak ano, podme na to
01AA 80A3            922            jmp     F1S             ; Nemam sa kde hnut, opakujem
                     923 +1 F1OK:   SET_UP                  ; rychly pohyb hore
01AC D220            924 +1         setb     UP
01AE C221            925 +1         clr      DOWN
01B0 D22F            926 +1         setb     LEDU
01B2 C22E            927 +1         clr      LEDD 
                     929 +1         SET_FAST                ; 
01B4 D222            930 +1         setb     FAST
01B6 C223            931 +1         clr      SLOW
01B8 D218            932 +1         setb     KS      
01BA 121158          934            lcall   WRITEPORTS      ; 
01BD 0201C0          935            jmp     UP1             ; prejdi do stavu UP1
                     936            
                     937            
01C0                 938    UP1:
                     939            ;--------------------------
                     940 +1         CFCSS     20, 9, 27, -1, -1
01C0 633C09          941 +1         xrl             G,  #9             
                     942 +1         IF (-1 <> -1)
                     943 +1             mov   A,  -1         
                     944 +1             xrl   G,  A          
                     945 +1         ENDIF    
DEBUG                                                                                                         PAGE 18

01C3 E53C            946 +1         mov   A,  G              
                     947 +2         LCJNE A,  #20, CFCERR     
01C5 B41403          948 +2         cjne    A, #20, $+6
01C8 0201CE          949 +2         jmp     $+6
01CB 021001          950 +2         ljmp    CFCERR
01CE 00              951 +2         nop
                     952 +1         IF (27 <> -1)
01CF 753D1B          953 +1             mov         D1, #27     
                     954 +1         ELSE
                     955 +1             mov         D1, #32        
                     956 +1         ENDIF                    
                     957 +1         IF (-1 <> -1)
                     958 +1             mov         D2, #-1     
                     959 +1         ELSE
01D2 753E20          960 +1             mov         D2, #32        
                     961 +1         ENDIF                    
                     962 +2         SERCHAR   #20             
01D5 7414            963 +2                 mov               A, #20
01D7 3099FD          964 +2     jnb     TI, $ 
01DA C299            965 +2     clr     TI
01DC F599            966 +2                 mov     SBUF, A
                     967 +2     
                     969            ;--------------------------
                     970 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01DE 53240F          971 +1         anl     OUTPORTB, #((not bmFLED1) and(not bmFLED2) and(not bmFLED3) and(not bmFLED4)
                                                                               )          
01E1 D224            972 +1         setb    FLED1
01E3 121158          973 +1         lcall   WRITEPORTS
                     975 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
01E6 12106D          976 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
01E9 1210F9          977 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
01EC 3009FA          978 +1         jnb     MB1, $-3  ; 
01EF 12106D          979 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
01F2 1210F9          981    UP1A:   lcall   READPORTS       ; nacitanie dat
                     982 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01F5 200B03          983 +1         jb      SKRH, $+6
01F8 020FEF          984 +1         ljmp    ERR_SKRH
01FB 00              985 +1         nop
                     987 +1         SET_FLOOR_ERR   MB1, ERRF12, UP2, 2, %COUNT  ; >>> CHYBA, Vypadli 2 spomalovacie clo
                                                                               nky (narazil som na zastavovaciu) <<<
                     988 +1                                                                                             
                                                                                                                 
                     989 +1                                                                                             
                                                                                                                 
                     990 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0001               991 +1         COUNT    SET    COUNT+1                   
                     992 +1         
01FC 20091B          993 +1         jb      MB1, ENDD0
01FF 304204          994 +1         jnb     PKI2, $+7
0202 C222            995 +1         clr     FAST
0204 D223            996 +1         setb    SLOW
0206 D238            997 +1         setb    STOPPED         
0208 D252            998 +1         setb    ERRF12_U
020A D259            999 +1         setb    ERRF12_D
020C 0539           1000 +1         inc     ERRF12_C
020E C21A           1001 +1                 clr     PKO2                               
DEBUG                                                                                                         PAGE 19

0210 C22A           1002 +1         clr     PO2U            
0212 C229           1003 +1         clr     PO2D              
0214 121158         1004 +1                 lcall   WRITEPORTS
0217 02050B         1005 +1         ljmp    UP2
021A                1006 +1 ENDD0:
021A 00             1007 +1         nop
021B 200AD4         1009            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                    1010 +1         CLR_FLOOR_ERR   ERRF12
021E C252           1011 +1         clr    ERRF12_U
0220 C259           1012 +1         clr    ERRF12_D
0222 00             1013 +1         nop
                    1015 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0223 12106D         1016 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0226 1210F9         1017 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0229 300AFA         1018 +1         jnb     MB2, $-3  ; 
022C 12106D         1019 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1021            ;setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
022F 121158         1022            lcall   WRITEPORTS      ;
0232 020235         1023            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
                    1024            
                    1025            
0235                1026    UP1_MB2:
                    1027            ;--------------------------
                    1028 +1         CFCSS     2, 22, 13, -1, -1
0235 633C16         1029 +1         xrl             G,  #22             
                    1030 +1         IF (-1 <> -1)
                    1031 +1             mov   A,  -1         
                    1032 +1             xrl   G,  A          
                    1033 +1         ENDIF    
0238 E53C           1034 +1         mov   A,  G              
                    1035 +2         LCJNE A,  #2, CFCERR     
023A B40203         1036 +2         cjne    A, #2, $+6
023D 020243         1037 +2         jmp     $+6
0240 021001         1038 +2         ljmp    CFCERR
0243 00             1039 +2         nop
                    1040 +1         IF (13 <> -1)
0244 753D0D         1041 +1             mov         D1, #13     
                    1042 +1         ELSE
                    1043 +1             mov         D1, #32        
                    1044 +1         ENDIF                    
                    1045 +1         IF (-1 <> -1)
                    1046 +1             mov         D2, #-1     
                    1047 +1         ELSE
0247 753E20         1048 +1             mov         D2, #32        
                    1049 +1         ENDIF                    
                    1050 +2         SERCHAR   #2             
024A 7402           1051 +2                 mov               A, #2
024C 3099FD         1052 +2     jnb     TI, $ 
024F C299           1053 +2     clr     TI
0251 F599           1054 +2                 mov     SBUF, A
                    1055 +2     
                    1057            ;--------------------------
                    1058 +1         ZAKMITC MB2             ; Pockame, kym odideme z poschodia (Clonky MB1)
0253 12106D         1059 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0256 1210F9         1060 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0259 300AFA         1061 +1         jnb     MB2, $-3  ; 
025C 12106D         1062 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
DEBUG                                                                                                         PAGE 20

                                                                               zliezli)
025F 1210F9         1064    UP1_MB2A: lcall   READPORTS       ; nacitanie dat
                    1065 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0262 200B03         1066 +1         jb      SKRH, $+6
0265 020FEF         1067 +1         ljmp    ERR_SKRH
0268 00             1068 +1         nop
                    1070            ; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zastavovaciu) <<<
                    1071 +1         SET_FLOOR_ERR   MB1, ERRF12, UP2, 2, %COUNT
                    1072 +1                                                                                             
                                                                                                                 
                    1073 +1                                                                                             
                                                                                                                 
                    1074 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0002              1075 +1         COUNT    SET    COUNT+1                   
                    1076 +1         
0269 20091B         1077 +1         jb      MB1, ENDD1
026C 304204         1078 +1         jnb     PKI2, $+7
026F C222           1079 +1         clr     FAST
0271 D223           1080 +1         setb    SLOW
0273 D238           1081 +1         setb    STOPPED         
0275 D252           1082 +1         setb    ERRF12_U
0277 D259           1083 +1         setb    ERRF12_D
0279 0539           1084 +1         inc     ERRF12_C
027B C21A           1085 +1                 clr     PKO2                               
027D C22A           1086 +1         clr     PO2U            
027F C229           1087 +1         clr     PO2D              
0281 121158         1088 +1                 lcall   WRITEPORTS
0284 02050B         1089 +1         ljmp    UP2
0287                1090 +1 ENDD1:
0287 00             1091 +1         nop
0288 200AD4         1093            jb      MB2, UP1_MB2A  ;-; mame uz aj druhu spomalovaciu clonku?  
                    1094 +1         CLR_FLOOR_ERR   ERRF12   
028B C252           1095 +1         clr    ERRF12_U
028D C259           1096 +1         clr    ERRF12_D
028F 00             1097 +1         nop
                    1099            ;setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0290 121158         1100            lcall   WRITEPORTS      ;   
                    1101 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0293 12106D         1102 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0296 1210F9         1103 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0299 300AFA         1104 +1         jnb     MB2, $-3  ; 
029C 12106D         1105 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1107    
029F                1108    UP1_MB2_CFC:     
                    1109            ;--------------------------
                    1110 +1         CFCSS     12, 14, -1, -1, -1
029F 633C0E         1111 +1         xrl             G,  #14             
                    1112 +1         IF (-1 <> -1)
                    1113 +1             mov   A,  -1         
                    1114 +1             xrl   G,  A          
                    1115 +1         ENDIF    
02A2 E53C           1116 +1         mov   A,  G              
                    1117 +2         LCJNE A,  #12, CFCERR     
02A4 B40C03         1118 +2         cjne    A, #12, $+6
02A7 0202AD         1119 +2         jmp     $+6
02AA 021001         1120 +2         ljmp    CFCERR
02AD 00             1121 +2         nop
DEBUG                                                                                                         PAGE 21

                    1122 +1         IF (-1 <> -1)
                    1123 +1             mov         D1, #-1     
                    1124 +1         ELSE
02AE 753D20         1125 +1             mov         D1, #32        
                    1126 +1         ENDIF                    
                    1127 +1         IF (-1 <> -1)
                    1128 +1             mov         D2, #-1     
                    1129 +1         ELSE
02B1 753E20         1130 +1             mov         D2, #32        
                    1131 +1         ENDIF                    
                    1132 +2         SERCHAR   #12             
02B4 740C           1133 +2                 mov               A, #12
02B6 3099FD         1134 +2     jnb     TI, $ 
02B9 C299           1135 +2     clr     TI
02BB F599           1136 +2                 mov     SBUF, A
                    1137 +2     
                    1139            ;--------------------------
                    1140 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1141 +1                                         
02BD C3             1142 +1         clr     C                       
02BE 7400           1143 +1         mov     A, #0h                  
02C0 7212           1144 +1         orl     C, PI2U      
02C2 B00E           1145 +1         anl     C, /DPZK                
02C4 7242           1146 +1         orl     C, PKI2          
02C6 B052           1147 +1         anl     C, /ERRF2_U 
02C8 720F           1148 +1         orl     C, DPK                  
02CA 7238           1149 +1         orl     C, STOPPED              
02CC 3400           1150 +1         addc    A, #0h                  
02CE 704B           1152            jnz     U1_MB2C       ;-; Ak ano, zastav
                    1153 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
02D0 E522           1154 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
02D2 33             1155 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
02D3 547E           1156 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
                    1157 +1         
                    1158 +1         ;ANLB    ACC.2, ERRF2_U  ; maskujem chybne poschodia
                    1159 +2         ANLB    ACC.3, ERRF2_U  ; |
02D5 A2E3           1160 +2         mov   C, ACC.3
02D7 B052           1161 +2         anl   C, /ERRF2_U
02D9 92E3           1162 +2         mov   ACC.3, C
                    1163 +2         ANLB    ACC.4, ERRF3_U  ; |
02DB A2E4           1164 +2         mov   C, ACC.4
02DD B053           1165 +2         anl   C, /ERRF3_U
02DF 92E4           1166 +2         mov   ACC.4, C
                    1167 +2         ANLB    ACC.5, ERRF3_U  ; |
02E1 A2E5           1168 +2         mov   C, ACC.5
02E3 B053           1169 +2         anl   C, /ERRF3_U
02E5 92E5           1170 +2         mov   ACC.5, C
                    1171 +1         ;ANLB    ACC.6, ERRF4_U  ; |
                    1172 +1         
02E7 7805           1173 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1174 +1  ; LL1: 
02E9 6006           1175 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
DEBUG                                                                                                         PAGE 22

                                                                               na LL2
02EB C3             1176 +1         clr     C               ; Inak shiftnem o 2
02EC 13             1177 +1         rrc     A               ;
02ED C3             1178 +1         clr     C               ;
02EE 13             1179 +1         rrc     A               ;
02EF D8F8           1180 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1181 +1 ; LL2:
02F1 7405           1182 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
02F3 C3             1183 +1         clr     C               ;
02F4 98             1184 +1         subb    A, R0           ;
                    1186 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
02F5 B40203         1187 +1         cjne    A, #2, $+6
02F8 0202FE         1188 +1         jmp     $+6
02FB 020325         1189 +1         ljmp    UP1_MB1
02FE 00             1190 +1         nop
                    1192 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
02FF E528           1193 +1         mov     A, INPORTA
0301 541E           1194 +1         anl     A, #00011110b
0303 852AF0         1195 +1         mov     B, ERRFLOOR_U   ; maskujem chybne poschodia
0306 53F00C         1196 +1         anl     B, #00001100b   ; na krajne poschodia dovolim ist
0309 63F0FF         1197 +1         xrl     B, #0FFH
030C 55F0           1198 +1         anl     A, B
030E C3             1199 +1         clr     C
030F 13             1200 +1         rrc     A
                    1201 +1 ;LL1    
0310 7802           1202 +1         mov     R0, #2
0312 C3             1203 +1         clr     C
0313 13             1204 +1         rrc     A
0314 D8FC           1205 +1         djnz    R0, $-2;LL1
0316 6003           1207            jz      U1_MB2C         ; |   ak neni zastavujem         
0318 020325         1208            jmp     UP1_MB1          ; |   inak nezastavim        
031B D223           1209    U1_MB2C: setb    SLOW            ;       Ak ano, spomalme
031D C222           1210            clr     FAST            ; 
031F 121158         1211            lcall   WRITEPORTS      ;         
0322 02037E         1212            jmp     UP1_STOP       ;-; a prejdi do stavu UP1_STOP 
                    1213            
                    1214            
0325                1215    UP1_MB1:
                    1216            ;--------------------------
                    1217 +1         CFCSS     6, 10, 9, 14, -1
0325 633C0A         1218 +1         xrl             G,  #10             
                    1219 +1         IF (-1 <> -1)
                    1220 +1             mov   A,  -1         
                    1221 +1             xrl   G,  A          
                    1222 +1         ENDIF    
0328 E53C           1223 +1         mov   A,  G              
                    1224 +2         LCJNE A,  #6, CFCERR     
032A B40603         1225 +2         cjne    A, #6, $+6
032D 020333         1226 +2         jmp     $+6
0330 021001         1227 +2         ljmp    CFCERR
0333 00             1228 +2         nop
                    1229 +1         IF (9 <> -1)
0334 753D09         1230 +1             mov         D1, #9     
                    1231 +1         ELSE
                    1232 +1             mov         D1, #32        
                    1233 +1         ENDIF                    
DEBUG                                                                                                         PAGE 23

                    1234 +1         IF (14 <> -1)
0337 753E0E         1235 +1             mov         D2, #14     
                    1236 +1         ELSE
                    1237 +1             mov         D2, #32        
                    1238 +1         ENDIF                    
                    1239 +2         SERCHAR   #6             
033A 7406           1240 +2                 mov               A, #6
033C 3099FD         1241 +2     jnb     TI, $ 
033F C299           1242 +2     clr     TI
0341 F599           1243 +2                 mov     SBUF, A
                    1244 +2     
                    1246            ;--------------------------
                    1247 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0343 12106D         1248 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0346 1210F9         1249 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0349 300AFA         1250 +1         jnb     MB2, $-3  ; 
034C 12106D         1251 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
034F 1210F9         1253    UP1_MB1_C:        lcall   READPORTS       ; nacitanie dat
                    1254 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0352 200B03         1255 +1         jb      SKRH, $+6
0355 020FEF         1256 +1         ljmp    ERR_SKRH
0358 00             1257 +1         nop
                    1259 +1         SET_FLOOR_ERR   MB2, ERRF2, UP2_MB2, 2, %COUNT ; >>> CHYBA, Vypadla zastavovacia clo
                                                                               nka (narazil som na spomalovaciu) <<<
                    1260 +1                                                                                             
                                                                                                                 
                    1261 +1                                                                                             
                                                                                                                 
                    1262 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0003              1263 +1         COUNT    SET    COUNT+1                   
                    1264 +1         
0359 200A1B         1265 +1         jb      MB2, ENDD2
035C 304204         1266 +1         jnb     PKI2, $+7
035F C222           1267 +1         clr     FAST
0361 D223           1268 +1         setb    SLOW
0363 D238           1269 +1         setb    STOPPED         
0365 D252           1270 +1         setb    ERRF2_U
0367 D25A           1271 +1         setb    ERRF2_D
0369 0536           1272 +1         inc     ERRF2_C
036B C21A           1273 +1                 clr     PKO2                               
036D C22A           1274 +1         clr     PO2U            
036F C229           1275 +1         clr     PO2D              
0371 121158         1276 +1                 lcall   WRITEPORTS
0374 020584         1277 +1         ljmp    UP2_MB2
0377                1278 +1 ENDD2:
0377 00             1279 +1         nop
0378 2009D4         1281            jb      MB1, UP1_MB1_C  ;-; Sme na zastavovacej clonke?
037B 02050B         1282            ljmp    UP2             ; |   inak nezastavim        
                    1283    
037E                1284    UP1_STOP:
                    1285            ;--------------------------
                    1286 +1         CFCSS     28, 16, 9, 20, -1
037E 633C10         1287 +1         xrl             G,  #16             
                    1288 +1         IF (-1 <> -1)
                    1289 +1             mov   A,  -1         
                    1290 +1             xrl   G,  A          
                    1291 +1         ENDIF    
DEBUG                                                                                                         PAGE 24

0381 E53C           1292 +1         mov   A,  G              
                    1293 +2         LCJNE A,  #28, CFCERR     
0383 B41C03         1294 +2         cjne    A, #28, $+6
0386 02038C         1295 +2         jmp     $+6
0389 021001         1296 +2         ljmp    CFCERR
038C 00             1297 +2         nop
                    1298 +1         IF (9 <> -1)
038D 753D09         1299 +1             mov         D1, #9     
                    1300 +1         ELSE
                    1301 +1             mov         D1, #32        
                    1302 +1         ENDIF                    
                    1303 +1         IF (20 <> -1)
0390 753E14         1304 +1             mov         D2, #20     
                    1305 +1         ELSE
                    1306 +1             mov         D2, #32        
                    1307 +1         ENDIF                    
                    1308 +2         SERCHAR   #28             
0393 741C           1309 +2                 mov               A, #28
0395 3099FD         1310 +2     jnb     TI, $ 
0398 C299           1311 +2     clr     TI
039A F599           1312 +2                 mov     SBUF, A
                    1313 +2     
                    1315            ;--------------------------
039C 1210F9         1316    UP1_STOP_C: lcall   READPORTS       ; nacitanie dat
                    1317 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
039F 200B03         1318 +1         jb      SKRH, $+6
03A2 020FEF         1319 +1         ljmp    ERR_SKRH
03A5 00             1320 +1         nop
                    1322 +1         SET_FLOOR_ERR   MB2, ERRF2, UP2_MB2, 2, %COUNT ; >>> CHYBA, Vypadla zastavovacia clo
                                                                               nka (narazil som na spomalovaciu) <<<
                    1323 +1                                                                                             
                                                                                                                 
                    1324 +1                                                                                             
                                                                                                                 
                    1325 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0004              1326 +1         COUNT    SET    COUNT+1                   
                    1327 +1         
03A6 200A1B         1328 +1         jb      MB2, ENDD3
03A9 304204         1329 +1         jnb     PKI2, $+7
03AC C222           1330 +1         clr     FAST
03AE D223           1331 +1         setb    SLOW
03B0 D238           1332 +1         setb    STOPPED         
03B2 D252           1333 +1         setb    ERRF2_U
03B4 D25A           1334 +1         setb    ERRF2_D
03B6 0536           1335 +1         inc     ERRF2_C
03B8 C21A           1336 +1                 clr     PKO2                               
03BA C22A           1337 +1         clr     PO2U            
03BC C229           1338 +1         clr     PO2D              
03BE 121158         1339 +1                 lcall   WRITEPORTS
03C1 020584         1340 +1         ljmp    UP2_MB2
03C4                1341 +1 ENDD3:
03C4 00             1342 +1         nop
03C5 2009D4         1344            jb      MB1, UP1_STOP_C  ;-; Sme na zastavovacej clonke?      
03C8 C220           1345            clr     UP              ; zastav motor
03CA D23A           1346            setb    UPOld           ;       (a zalohuj) 
03CC C23B           1347            clr     DOWNOld         ;       (a zalohuj)
03CE C222           1348            clr     FAST            ; 
03D0 121158         1349            lcall   WRITEPORTS      ; 
DEBUG                                                                                                         PAGE 25

03D3 0203D6         1350            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2   
                    1351    
                    1352    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                    1353    
03D6                1354    FLOOR2:
                    1355            ;--------------------------
                    1356 +1         CFCSS     15, 26, 0, 30, D1
03D6 633C1A         1357 +1         xrl             G,  #26             
                    1358 +1         IF (D1 <> -1)
03D9 E53D           1359 +1             mov   A,  D1         
03DB 623C           1360 +1             xrl   G,  A          
                    1361 +1         ENDIF    
03DD E53C           1362 +1         mov   A,  G              
                    1363 +2         LCJNE A,  #15, CFCERR     
03DF B40F03         1364 +2         cjne    A, #15, $+6
03E2 0203E8         1365 +2         jmp     $+6
03E5 021001         1366 +2         ljmp    CFCERR
03E8 00             1367 +2         nop
                    1368 +1         IF (0 <> -1)
03E9 753D00         1369 +1             mov         D1, #0     
                    1370 +1         ELSE
                    1371 +1             mov         D1, #32        
                    1372 +1         ENDIF                    
                    1373 +1         IF (30 <> -1)
03EC 753E1E         1374 +1             mov         D2, #30     
                    1375 +1         ELSE
                    1376 +1             mov         D2, #32        
                    1377 +1         ENDIF                    
                    1378 +2         SERCHAR   #15             
03EF 740F           1379 +2                 mov               A, #15
03F1 3099FD         1380 +2     jnb     TI, $ 
03F4 C299           1381 +2     clr     TI
03F6 F599           1382 +2                 mov     SBUF, A
                    1383 +2     
                    1385            ;--------------------------
                    1386 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03F8 53240F         1387 +1         anl     OUTPORTB, #((not bmFLED1) and(not bmFLED2) and(not bmFLED3) and(not bmFLED4)
                                                                               )          
03FB D225           1388 +1         setb    FLED2
03FD 121158         1389 +1         lcall   WRITEPORTS
0400 C238           1391            clr     STOPPED
                    1392 +1         TIMER2  60              ; (Timer - 3s)
0402 752D3C         1393 +1            mov           T2_C, #60                              
0405 C262           1394 +1                  clr       T2_F                                  
0407 D2CA           1395 +1                  setb      TR2                                             
                    1397 +1         ROZSVIET_SMER_LED
0409 D22F           1398 +1         setb    LEDU            ;
040B D22E           1399 +1         setb    LEDD            ;
040D 121158         1400 +1         lcall   WRITEPORTS      ;
0410 1210F9         1402    F2S:    lcall   READPORTS     ;-; nacitanie dat
                    1403 +1         ZRUS_POSCH 2
0413 C21A           1404 +1         clr     PKO2       
0415 C22A           1405 +1         clr     PO2U      
0417 C229           1406 +1         clr     PO2D      
0419 121158         1407 +1         lcall   WRITEPORTS
041C 3062F1         1409            jnb                T2_F, F2S                    ; Uz presiel minimalny cas na poscho
DEBUG                                                                                                         PAGE 26

                                                                               di? Ak nie, nejdeme dalej
                    1410 +1         KABINOVE_SVETLO         ; Rozsviet kabinove svetlo a smerovu signalizaciu ak je v ka
                                                                               bine osoba
041F A20D           1411 +1         mov      C, DP          
0421 720E           1412 +1         orl      C, DPZK        
0423 720F           1413 +1         orl      C, DPK         
0425 9218           1414 +1         mov      KS, C          
0427 922F           1415 +1         mov      LEDU, C        
0429 922E           1416 +1         mov      LEDD, C        
042B 121158         1417 +1         lcall   WRITEPORTS      
042E 200FDF         1419            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0431 3045DC         1420            jnb     DOORCLSD, F2S   ; Su otvorene dvere? Ak ano, tak nejdem dalej.
                    1421 +1         JE_VYBRATE_POSCHODIE F2S; Je v kabine osoba, ktora este nevybrala poschodie? Ak ano,
                                                                                nejdeme dalej.
0434 A20D           1422 +1         mov      C, DP         
0436 720E           1423 +1         orl      C, DPZK        
0438 720F           1424 +1         orl      C, DPK         
043A 5006           1425 +1         jnc      $+8            
043C E528           1426 +1         mov      A, INPORTA     
043E 541E           1427 +1         anl      A, #00011110b  
0440 60CE           1428 +1         jz       F2S       
                    1430            ;clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
                    1431            ;clr     PO2U            ;
                    1432            ;clr     PO2D            ;
                    1433            ;lcall   WRITEPORTS      ;
                    1434            ;jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
                    1435            ;_BP_
0442 782A           1436            mov     R0, #ERRFLOOR_U ;   Default predpokladam, ze mam namierene hore (pozeram por
                                                                               uchy poschodia smerom hore)
0444 79F8           1437            mov     R1, #11111000b  ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
                                                                                kabina
0446 7AF8           1438            mov     R2, #11111000b  ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
                                                                                sachta
0448 203A0A         1439            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
044B E9             1440            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
044C F4             1441            cpl     A               ;       |
044D F9             1442            mov     R1, A           ;       |
044E EA             1443            mov     A, R2           ;       A znegujeme aj masku sachty
044F F4             1444            cpl     A               ;       |
0450 FA             1445            mov     R2, A           ;       |  
0451 E8             1446            mov     A, R0           ;       A budeme pozerat poruchy poschodi smerom DOLE (ERRFL
                                                                               OOR_U+1 = ERRFLOOR_D)
0452 6401           1447            xrl     A, #01h         ;       | Znegujem posledny bit adresy registra s poruchovym
                                                                               i poschodiami (ERRFLOOR_U na ERRFLOOR_D a
                                                                                naopak)
0454 F8             1448            mov     R0, A           ;       |  
0455                1449    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0455 E528           1450            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0457 86F0           1451            mov     B, @R0          ;  | Maskujem chybne poschodia
0459 53F00C         1452            anl     B, #00001100b   ;  | na krajne poschodia dovolim ist
045C 63F0FF         1453            xrl     B, #0FFH        ;  |
045F 55F0           1454            anl     A, B            ;  |
0461 541A           1455            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0463 59             1456            anl     A, R1           ;  | 
                    1457 +1         ljnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0464 6003           1458 +1         jz      $+5
0466 0204DD         1459 +1         ljmp    F2
DEBUG                                                                                                         PAGE 27

0469 00             1460 +1         nop
                    1462                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
046A E528           1463            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
046C 86F0           1464            mov     B, @R0          ;  | Maskujem chybne poschodia
046E 53F00C         1465            anl     B, #00001100b   ;  | na krajne poschodia dovolim ist
0471 63F0FF         1466            xrl     B, #0FFH        ;  | |
0474 55F0           1467            anl     A, B            ;  | |
0476 541A           1468            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               ) 
0478 7021           1469            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
047A E522           1470            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
047C 5439           1471            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
047E 5A             1472            anl     A, R2           ;  |   
047F 86F0           1473            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)   ???   
                    1474            ;ANLB    ACC.0, B.1      ;  | 
                    1475 +1         ANLB    ACC.1, B.2      ;  | 
0481 A2E1           1476 +1         mov   C, ACC.1
0483 B0F2           1477 +1         anl   C, /B.2
0485 92E1           1478 +1         mov   ACC.1, C
                    1480 +1         ANLB    ACC.2, B.2      ;  |
0487 A2E2           1481 +1         mov   C, ACC.2
0489 B0F2           1482 +1         anl   C, /B.2
048B 92E2           1483 +1         mov   ACC.2, C
                    1485 +1         ANLB    ACC.3, B.3      ;  |
048D A2E3           1486 +1         mov   C, ACC.3
048F B0F3           1487 +1         anl   C, /B.3
0491 92E3           1488 +1         mov   ACC.3, C
                    1490 +1         ANLB    ACC.4, B.3      ;  |
0493 A2E4           1491 +1         mov   C, ACC.4
0495 B0F3           1492 +1         anl   C, /B.3
0497 92E4           1493 +1         mov   ACC.4, C
                    1495            ;ANLB    ACC.5, B.4      ;  |
0499 7042           1496            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                    1497            ; Pohyb v opacnom smere (nevieme v ktorom)
049B E8             1498    F2SW:   mov     A, R0           ;  Znegujem posledny bit adresy registra s poruchovymi posch
                                                                               odiami (ERRFLOOR_U na ERRFLOOR_D a naopak
                                                                               )
049C 6401           1499            xrl     A, #01h         ;  |
049E F8             1500            mov     R0, A           ;  |
049F B23A           1501            cpl     UPOld           ;  Znegujem stary posun
04A1 B23B           1502            cpl     DOWNOld         ;  |
04A3 E9             1503            mov     A, R1           ;  Znegujeme masky
04A4 F4             1504            cpl     A               ;  |
04A5 F9             1505            mov     R1, A           ;  |
04A6 EA             1506            mov     A, R2           ;  |
04A7 F4             1507            cpl     A               ;  |
04A8 FA             1508            mov     R2, A           ;  |               
04A9 E528           1509            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
04AB 86F0           1510            mov     B, @R0          ;  | Maskujem chybne poschodia
04AD 53F00C         1511            anl     B, #00001100b   ;  | na krajne poschodia dovolim ist
04B0 63F0FF         1512            xrl     B, #0FFH        ;  | |
04B3 55F0           1513            anl     A, B            ;  | |
04B5 541A           1514            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi   
04B7 59             1515            anl     A, R1           ;  | 
04B8 7023           1516            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
04BA E522           1517            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
DEBUG                                                                                                         PAGE 28

                                                                               om stojim (Sachta)
04BC 5439           1518            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
04BE 5A             1519            anl     A, R2           ;  | 
04BF 86F0           1520            mov     B, @R0          ;  | Maskujem chybne poschodia (v smere hore)   ???   
                    1521            ;ANLB    ACC.0, B.1      ;  | 
                    1522 +1         ANLB    ACC.1, B.2      ;  | 
04C1 A2E1           1523 +1         mov   C, ACC.1
04C3 B0F2           1524 +1         anl   C, /B.2
04C5 92E1           1525 +1         mov   ACC.1, C
                    1527 +1         ANLB    ACC.2, B.2      ;  |
04C7 A2E2           1528 +1         mov   C, ACC.2
04C9 B0F2           1529 +1         anl   C, /B.2
04CB 92E2           1530 +1         mov   ACC.2, C
                    1532 +1         ANLB    ACC.3, B.3      ;  |
04CD A2E3           1533 +1         mov   C, ACC.3
04CF B0F3           1534 +1         anl   C, /B.3
04D1 92E3           1535 +1         mov   ACC.3, C
                    1537 +1         ANLB    ACC.4, B.3      ;  |
04D3 A2E4           1538 +1         mov   C, ACC.4
04D5 B0F3           1539 +1         anl   C, /B.3
04D7 92E4           1540 +1         mov   ACC.4, C
                    1542            ;ANLB    ACC.5, B.4      ;  |
04D9 7002           1543            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
04DB 8110           1544            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
04DD 203A03         1545    F2:     jb      UPOld, F2UP     ;   
04E0 0204F7         1546            jmp     F2DOWN          ;
                    1547 +1 F2UP:   SET_UP                  ; rychly pohyb hore
04E3 D220           1548 +1         setb     UP
04E5 C221           1549 +1         clr      DOWN
04E7 D22F           1550 +1         setb     LEDU
04E9 C22E           1551 +1         clr      LEDD 
                    1553 +1         SET_FAST                ; 
04EB D222           1554 +1         setb     FAST
04ED C223           1555 +1         clr      SLOW
04EF D218           1556 +1         setb     KS      
04F1 121158         1558            lcall   WRITEPORTS      ;   
04F4 02050B         1559            jmp     UP2           ;-; prejdi do stavu UP2    
                    1560 +1 F2DOWN: SET_DOWN                  ; rychly pohyb dole
04F7 C220           1561 +1         clr     UP
04F9 D221           1562 +1         setb    DOWN
04FB C22F           1563 +1         clr     LEDU
04FD D22E           1564 +1         setb    LEDD 
                    1566 +1         SET_FAST                ; 
04FF D222           1567 +1         setb     FAST
0501 C223           1568 +1         clr      SLOW
0503 D218           1569 +1         setb     KS      
0505 121158         1571            lcall   WRITEPORTS      ; 
0508 020729         1572            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                    1573            
                    1574                
050B                1575    UP2:
                    1576            ;--------------------------
                    1577 +1         CFCSS     8, 7, 18, 0, D1
050B 633C07         1578 +1         xrl             G,  #7             
                    1579 +1         IF (D1 <> -1)
050E E53D           1580 +1             mov   A,  D1         
0510 623C           1581 +1             xrl   G,  A          
                    1582 +1         ENDIF    
DEBUG                                                                                                         PAGE 29

0512 E53C           1583 +1         mov   A,  G              
                    1584 +2         LCJNE A,  #8, CFCERR     
0514 B40803         1585 +2         cjne    A, #8, $+6
0517 02051D         1586 +2         jmp     $+6
051A 021001         1587 +2         ljmp    CFCERR
051D 00             1588 +2         nop
                    1589 +1         IF (18 <> -1)
051E 753D12         1590 +1             mov         D1, #18     
                    1591 +1         ELSE
                    1592 +1             mov         D1, #32        
                    1593 +1         ENDIF                    
                    1594 +1         IF (0 <> -1)
0521 753E00         1595 +1             mov         D2, #0     
                    1596 +1         ELSE
                    1597 +1             mov         D2, #32        
                    1598 +1         ENDIF                    
                    1599 +2         SERCHAR   #8             
0524 7408           1600 +2                 mov               A, #8
0526 3099FD         1601 +2     jnb     TI, $ 
0529 C299           1602 +2     clr     TI
052B F599           1603 +2                 mov     SBUF, A
                    1604 +2     
                    1606            ;--------------------------
                    1607 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
052D 53240F         1608 +1         anl     OUTPORTB, #((not bmFLED1) and(not bmFLED2) and(not bmFLED3) and(not bmFLED4)
                                                                               )          
0530 D225           1609 +1         setb    FLED2
0532 121158         1610 +1         lcall   WRITEPORTS
                    1612 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0535 12106D         1613 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0538 1210F9         1614 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
053B 3009FA         1615 +1         jnb     MB1, $-3  ; 
053E 12106D         1616 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0541 1210F9         1618    UP2A:   lcall   READPORTS       ; nacitanie dat
                    1619 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0544 200B03         1620 +1         jb      SKRH, $+6
0547 020FEF         1621 +1         ljmp    ERR_SKRH
054A 00             1622 +1         nop
                    1624 +1         SET_FLOOR_ERR   MB1, ERRF23, UP3, 3, %COUNT  ; >>> CHYBA, Vypadli 2 spomalovacie clo
                                                                               nky (narazil som na zastavovaciu) <<<
                    1625 +1                                                                                             
                                                                                                                 
                    1626 +1                                                                                             
                                                                                                                 
                    1627 +1         ;INCREMENT SUFFIX  FOR  NEXT LABEL             
  0005              1628 +1         COUNT    SET    COUNT+1                   
                    1629 +1         
054B 20091B         1630 +1         jb      MB1, ENDD4
054E 304304         1631 +1         jnb     PKI3, $+7
0551 C222           1632 +1         clr     FAST
0553 D223           1633 +1         setb    SLOW
0555 D238           1634 +1         setb    STOPPED         
0557 D253           1635 +1         setb    ERRF23_U
0559 D25A           1636 +1         setb    ERRF23_D
055B 053A           1637 +1         inc     ERRF23_C
055D C21B           1638 +1                 clr     PKO3                               
DEBUG                                                                                                         PAGE 30

055F C22C           1639 +1         clr     PO3U            
0561 C22B           1640 +1         clr     PO3D              
0563 121158         1641 +1                 lcall   WRITEPORTS
0566 0209AF         1642 +1         ljmp    UP3
0569                1643 +1 ENDD4:
0569 00             1644 +1         nop
056A 200AD4         1646            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                    1647 +1         CLR_FLOOR_ERR   ERRF23
056D C253           1648 +1         clr    ERRF23_U
056F C25A           1649 +1         clr    ERRF23_D
0571 00             1650 +1         nop
                    1652 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0572 12106D         1653 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0575 1210F9         1654 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0578 300AFA         1655 +1         jnb     MB2, $-3  ; 
057B 12106D         1656 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        