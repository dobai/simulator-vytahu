VYTAH/ORI                                                                                                     PAGE 1

                       1    ; TODO: 
                       2    ; Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    
                       7    
                       8    $MOD51
                       9    $DEBUG
                      10    
                =1    11    $include (lift.inc)
                =1    12    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    13    i8255INA        equ     080h
  0081          =1    14    i8255INB        equ     081h
  0082          =1    15    i8255INC        equ     082h
  0083          =1    16    i8255INCW       equ     083h
  00C0          =1    17    i8255OUTA       equ     0c0h
  00C1          =1    18    i8255OUTB       equ     0c1h
  00C2          =1    19    i8255OUTC       equ     0c2h
  00C3          =1    20    i8255OUTCW      equ     0c3h
                =1    21    
  0028          =1    22    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    23    INPORTB         data    21h
  0022          =1    24    INPORTC         data    22h
  0023          =1    25    OUTPORTA        data    23h
  0024          =1    26    OUTPORTB        data    24h
  0025          =1    27    OUTPORTC        data    25h
  0026          =1    28    INPORTBold      data    26h
  0027          =1    29    CTRLREG         data    27h
                =1    30    
  0030          =1    31    POSITION        data    30h
  0031          =1    32    LOWEST          data    31h
  0032          =1    33    HIGHEST         data    32h
  0033          =1    34    STOPTIMER       data    33h
  0034          =1    35    OUTPORTBold     data    34h
                =1    36    
  0040          =1    37    STOPNOT         bit     INPORTA.0
  0041          =1    38    PKI1            bit     INPORTA.1
  0042          =1    39    PKI2            bit     INPORTA.2
  0043          =1    40    PKI3            bit     INPORTA.3
  0044          =1    41    PKI4            bit     INPORTA.4
  0045          =1    42    DOORCLSD        bit     INPORTA.5 
                =1    43    
  0009          =1    44    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    45    MB2             bit     INPORTB.2
  000B          =1    46    SKRH            bit     INPORTB.3
  000C          =1    47    SKRD            bit     INPORTB.4
  000D          =1    48    DP              bit     INPORTB.5
  000E          =1    49    DPZK            bit     INPORTB.6
  000F          =1    50    DPK             bit     INPORTB.7
                =1    51    
  0031          =1    52    MB1old          bit     INPORTBold.1
  0032          =1    53    MB2old          bit     INPORTBold.2
  0033          =1    54    SKRHold         bit     INPORTBold.3
  0034          =1    55    SKRDold         bit     INPORTBold.4
                =1    56    
  0010          =1    57    PI1             bit     INPORTC.0
  0011          =1    58    PI2D            bit     INPORTC.1
VYTAH/ORI/D                                                                                                  PAGE 2

  0012          =1    59    PI2U            bit     INPORTC.2
  0013          =1    60    PI3D            bit     INPORTC.3
  0014          =1    61    PI3U            bit     INPORTC.4
  0015          =1    62    PI4             bit     INPORTC.5
                =1    63    
  0018          =1    64    KS              bit     OUTPORTA.0
  0019          =1    65    PKO1            bit     OUTPORTA.1
  001A          =1    66    PKO2            bit     OUTPORTA.2
  001B          =1    67    PKO3            bit     OUTPORTA.3
  001C          =1    68    PKO4            bit     OUTPORTA.4
                =1    69    
  0020          =1    70    UP              bit     OUTPORTB.0
  0021          =1    71    DOWN            bit     OUTPORTB.1
  0022          =1    72    FAST            bit     OUTPORTB.2
  0023          =1    73    SLOW            bit     OUTPORTB.3
  0024          =1    74    FLED1           bit     OUTPORTB.4
  0025          =1    75    FLED2           bit     OUTPORTB.5
  0026          =1    76    FLED3           bit     OUTPORTB.6
  0027          =1    77    FLED4           bit     OUTPORTB.7
                =1    78    
  0028          =1    79    PO1             bit     OUTPORTC.0
  0029          =1    80    PO2D            bit     OUTPORTC.1
  002A          =1    81    PO2U            bit     OUTPORTC.2
  002B          =1    82    PO3D            bit     OUTPORTC.3
  002C          =1    83    PO3U            bit     OUTPORTC.4
  002D          =1    84    PO4             bit     OUTPORTC.5
  002E          =1    85    LEDD            bit     OUTPORTC.6
  002F          =1    86    LEDU            bit     OUTPORTC.7
                =1    87    
  0038          =1    88    CANGO           bit     CTRLREG.0
  0039          =1    89    DOORCLSDold     bit     CTRLREG.1
  003A          =1    90    UPold           bit     CTRLREG.2
  003B          =1    91    DOWNold         bit     CTRLREG.3
  003C          =1    92    FASTold         bit     CTRLREG.4
  003D          =1    93    SLOWold         bit     CTRLREG.5
                =1    94    
  00B6          =1    95    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    96    RDNOT           bit     0b7h        ; p3.7
                =1    97    
                =1    98    ; bitove masky
                =1    99    ; 8255OUT 
                =1   100    ; port A
  0001          =1   101    bmKS              equ    00000001b
  0002          =1   102    bmPKO1            equ    00000010b
  0004          =1   103    bmPKO2            equ    00000100b
  0008          =1   104    bmPKO3            equ    00001000b
  0010          =1   105    bmPKO4            equ    00010000b
                =1   106    
                =1   107    ; port B
  0001          =1   108    bmUP              equ    00000001b
  0002          =1   109    bmDOWN            equ    00000010b
  0004          =1   110    bmFAST            equ    00000100b
  0008          =1   111    bmSLOW            equ    00001000b
  0010          =1   112    bmFLED1           equ    00010000b
  0020          =1   113    bmFLED2           equ    00100000b
  0040          =1   114    bmFLED3           equ    01000000b
  0080          =1   115    bmFLED4           equ    10000000b
                =1   116    
VYTAH/ORI                                                                                                     PAGE 3

                =1   117    ; port C
  0001          =1   118    bmPO1             equ    00000001b
  0002          =1   119    bmPO2D            equ    00000010b
  0004          =1   120    bmPO2U            equ    00000100b
  0008          =1   121    bmPO3D            equ    00001000b
  0010          =1   122    bmPO3U            equ    00010000b
  0020          =1   123    bmPO4             equ    00100000b
  0040          =1   124    bmLEDD            equ    01000000b
  0080          =1   125    bmLEDU            equ    10000000b
                =1   126    
                =1   127    ; 8255IN
                =1   128    ; port A
  0001          =1   129    bmSTOP            equ    00000001b
  0002          =1   130    bmPKI1            equ    00000010b
  0004          =1   131    bmPKI2            equ    00000100b
  0008          =1   132    bmPKI3            equ    00001000b
  0010          =1   133    bmPKI4            equ    00010000b
  0020          =1   134    bmDOORCLSD        equ    00100000b
                =1   135    
                =1   136    ; port B
  0002          =1   137    bmMB1I            equ    00000010b
  0004          =1   138    bmMB2I            equ    00000100b
  0008          =1   139    bmSKRHI           equ    00001000b
  0010          =1   140    bmSKRHD           equ    00010000b
  0020          =1   141    bmDPI             equ    00100000b
  0040          =1   142    bmDPZKI           equ    01000000b
  0080          =1   143    bmDPKI            equ    10000000b
                =1   144    
                =1   145    ; port C
  0001          =1   146    bmPI1             equ    00000001b
  0002          =1   147    bmPI2D            equ    00000010b
  0004          =1   148    bmPI2U            equ    00000100b
  0008          =1   149    bmPI3D            equ    00001000b
  0010          =1   150    bmPI3U            equ    00010000b
  0020          =1   151    bmPI4             equ    00100000b
                =1   152    
                     153    
                     154    _BP_    MACRO 
                     155            clr     P3.3
                     156            setb    EX1
                     157            nop
                     158            nop
                     159    ENDM
                     160    
                     161    LJZ     MACRO   NAVESTIE
                     162            jnz     $+5
                     163            ljmp    NAVESTIE
                     164            nop
                     165    ENDM
                     166    
                     167    LJNZ    MACRO   NAVESTIE
                     168            jz      $+5
                     169            ljmp    NAVESTIE
                     170            nop
                     171    ENDM
                     172    
                     173    LJB     MACRO   TESTBIT, NAVESTIE
                     174            jnb     TESTBIT, $+6
VYTAH/ORI/D                                                                                                  PAGE 4

                     175            ljmp    NAVESTIE
                     176            nop
                     177    ENDM
                     178    
                     179    LJNB    MACRO   TESTBIT, NAVESTIE
                     180            jb      TESTBIT, $+6
                     181            ljmp    NAVESTIE
                     182            nop
                     183    ENDM
                     184    
                     185    ZAKMITC MACRO   TYPCLONKY
                     186            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
                     187            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     188            jnb     TYPCLONKY, $-3  ; 
                     189            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     190    ENDM
                     191    
                     192    ZASTAV  MACRO  C_POSCH, SMER
                     193                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     194            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     195            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine?
                     196            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     197            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
                     198            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     199            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     200    ENDM
                     201    
                     202    POLOHA_LED  MACRO  POLOHA
                     203            clr     LEDU            
                     204            clr     LEDD 
                     205            clr     FLED1             
                     206            clr     FLED2                
                     207            clr     FLED3           
                     208            clr     FLED4           
                     209            setb    FLED&POLOHA
                     210            lcall   WRITEPORTS
                     211    ENDM
                     212    
  0036               213    FLOORREQ        data    36h
                     214    
                     215    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               216    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     217                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     218                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     219    ;osetrenie vektorov preruseni
0000                 220            org     0000h           ; adresa odkial startuje program po resete
0000 020033          221            ljmp    START           ; skok na zaciatok kodu programu
                     222                  
0033                 223            org     0033h           ; od tejto adresy sa zacina kod programu
0033                 224    START:
VYTAH/ORI                                                                                                    PAGE 5

0033                 225    RESET:  
                     226            ; riadiace signaly do pasivnej urovne 
0033 D2B6            227            setb    WRNOT
0035 D2B7            228            setb    RDNOT
0037 753300          229            mov     STOPTIMER, #0
003A 758140          230            mov     SP, #STACK
                     231    
                     232            ; pockame si na inicializaciu obvodov 8255  
003D 7900            233            mov     R1, #0 
003F 7AFF            234            mov     R2, #0ffh
0041 D9FE            235            djnz    R1, $
0043 DAFC            236            djnz    R2, $-2
                     237            
                     238            ; teraz ich mozeme nastavit
0045 75809B          239            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          240            mov     p2, #i8255INCW
004B C2B6            241            clr     WRNOT
004D 00              242            nop
004E 00              243            nop
004F 00              244            nop
0050 00              245            nop
0051 D2B6            246            setb    WRNOT
0053 758080          247            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          248            mov     p2, #i8255OUTCW
0059 C2B6            249            clr     WRNOT
005B 00              250            nop
005C 00              251            nop
005D 00              252            nop
005E 00              253            nop
005F D2B6            254            setb    WRNOT
                     255            
                     256 +1         _BP_
0061 C2B3            257 +1         clr     P3.3
0063 D2AA            258 +1         setb    EX1
0065 00              259 +1         nop
0066 00              260 +1         nop
                     262    
                     263            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0067 752800          264            mov     INPORTA, #0
006A 75211E          265            mov     INPORTB, #01eh      ; vsetky clonky pasivne
006D 752200          266            mov     INPORTC, #0
0070 75231E          267            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0073 7524F0          268            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0076 7525FF          269            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0079 D218            270            setb    KS
007B 120685          271            call    WRITEPORTS          ; zapis novu informaciu
                     272    ;;;;;;;;
                     273    
007E 752300          274            mov     OUTPORTA, #0
0081 752400          275            mov     OUTPORTB, #0
0084 752500          276            mov     OUTPORTC, #0
0087 120685          277            call    WRITEPORTS          ; zapis novu informaciu
                     278    
008A 752800          279            mov     INPORTA, #0
008D 752100          280            mov     INPORTB, #0         
0090 752200          281            mov     INPORTC, #0
0093 120637          282            call    READPORTS           ; prvotne nacitanie udajov
VYTAH/ORI                                                                                                     PAGE 6

                     283    
0096                 284    CALIB:
                     285            ;kalibracia vytahu podla dolnej porovnavacej clonky
0096 120637          286            lcall   READPORTS                   ; precitaj, co je na portoch
0099 300C11          287            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
009C D221            288            setb    DOWN                        ; inak pod dole
009E D222            289            setb    FAST                        ; a rychlo
00A0 C223            290            clr     SLOW                        ;
00A2 120685          291            lcall   WRITEPORTS                  ; zapis informaciu 
00A5                 292    CALIBLOOP:
00A5 120637          293            lcall   READPORTS                   ; 
00A8 300C02          294            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00AB 80F8            295            jmp     CALIBLOOP
00AD                 296    CALIBEND:                              
00AD C222            297            clr     FAST                        ; zastavime v tomto smere
00AF C221            298            clr     DOWN                        ;
00B1 D223            299            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00B3 D220            300            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00B5 120685          301            lcall   WRITEPORTS 
00B8                 302    CALIBEND2:
00B8 120637          303            lcall   READPORTS                   ; 
00BB 2009FA          304            jb      MB1, CALIBEND2              ; 
00BE C223            305            clr     SLOW                        ; A teraz sme uz naozaj spravne
00C0 C220            306            clr     UP                          ; 
00C2 D224            307            setb    FLED1
00C4 120685          308            lcall   WRITEPORTS                  ; zapis informaciu
                     309    ;        _BP_
00C7                 310    MAIN:
                     311    
                     312    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     313    ; ****************************************************************************
                     314    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     315    ; ----------------------------------------------------------------------------
                     316    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     317    ; ----------------------------------------------------------------------------
                     318    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     319    ; ****************************************************************************
                     320    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     321    ; ----------------------------------------------------------------------------
                     322    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     323    ; ----------------------------------------------------------------------------
                     324    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     325    ; ****************************************************************************
                     326    ; POSITION
                     327    ; ****************************************************************************
                     328    
                     329    
                     330    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     331    
00C7                 332    FLOOR1:
                     333 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C7 C22F            334 +1         clr     LEDU            
00C9 C22E            335 +1         clr     LEDD 
00CB C224            336 +1         clr     FLED1             
VYTAH/ORI%D-©4                                                                                              PAGE 7

00CD C225            337 +1         clr     FLED2                
00CF C226            338 +1         clr     FLED3           
00D1 C227            339 +1         clr     FLED4           
00D3 D224            340 +1         setb    FLED1
00D5 120685          341 +1         lcall   WRITEPORTS
00D8 12061E          343            lcall   WAITFORTIMER    ; simulacia TIMERu
00DB 120637          344    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DE C219            345            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00E0 120685          346            lcall   WRITEPORTS      ;
00E3 E528            347            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
00E5 541C            348            anl     A, #00011100b ;-;
00E7 60F2            349            jz      F1S           ;-; ak nie, opakuj
00E9 D220            350            setb    UP              ; rychly pohyb hore
00EB D222            351            setb    FAST            ; 
00ED C223            352            clr     SLOW            ;
00EF 120685          353            lcall   WRITEPORTS      ; 
00F2 0200F5          354            jmp     UP1           ;-; prejdi do stavu UP1
00F5                 355    UP1:
                     356 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00F5 C22F            357 +1         clr     LEDU            
00F7 C22E            358 +1         clr     LEDD 
00F9 C224            359 +1         clr     FLED1             
00FB C225            360 +1         clr     FLED2                
00FD C226            361 +1         clr     FLED3           
00FF C227            362 +1         clr     FLED4           
0101 D224            363 +1         setb    FLED1
0103 120685          364 +1         lcall   WRITEPORTS
                     366 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0106 120608          367 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0109 120637          368 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
010C 3009FA          369 +1         jnb     MB1, $-3  ; 
010F 120608          370 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0112 120637          372    UP1A:   lcall   READPORTS       ; nacitanie dat
                     373 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0115 200B03          374 +1         jb      SKRH, $+6
0118 0205ED          375 +1         ljmp    ERR_SKRH
011B 00              376 +1         nop
                     378 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
011C 200903          379 +1         jb      MB1, $+6
011F 0205C0          380 +1         ljmp    ERR_2SPOM_C
0122 00              381 +1         nop
0123 200AEC          383            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     384 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0126 120608          385 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0129 120637          386 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
012C 300AFA          387 +1         jnb     MB2, $-3  ; 
012F 120608          388 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0132 D22E            390            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0134 120685          391            lcall   WRITEPORTS      ;
0137 02013A          392            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
013A                 393    UP1_MB2:
013A 120637          394            lcall   READPORTS       ; nacitanie dat
                     395 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
VYTAH/ORIDò.©4ú.©4                                                                                          PAGE 8

013D 200B03          396 +1         jb      SKRH, $+6
0140 0205ED          397 +1         ljmp    ERR_SKRH
0143 00              398 +1         nop
                     400 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0144 200903          401 +1         jb      MB1, $+6
0147 0205B1          402 +1         ljmp    ERR_1SPOM_C
014A 00              403 +1         nop
014B 200AEC          405            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
014E D22F            406            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0150 120685          407            lcall   WRITEPORTS      ;   
                     408 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0153 120608          409 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0156 120637          410 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0159 300AFA          411 +1         jnb     MB2, $-3  ; 
015C 120608          412 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
015F E528            414            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0161 5404            415            anl     A, #00000100b ;-;
0163 600A            416            jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1
0165 D223            417            setb    SLOW            ;       Ak ano, spomalme
0167 C222            418            clr     FAST            ; 
0169 120685          419            lcall   WRITEPORTS      ;         
016C 02016F          420            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
016F                 421    UP1_MB1:
016F 120637          422            lcall   READPORTS       ; nacitanie dat
                     423 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0172 200B03          424 +1         jb      SKRH, $+6
0175 0205ED          425 +1         ljmp    ERR_SKRH
0178 00              426 +1         nop
                     428 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0179 200A03          429 +1         jb      MB2, $+6
017C 0205CF          430 +1         ljmp    ERR_ZAST_C
017F 00              431 +1         nop
0180 2009EC          433            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     434 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     435 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0183 C3              436 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0184 7242            437 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0186 7212            438 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0188 B00E            439 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
018A 720F            440 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
018C 3400            441 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
018E 606D            443            jz      UP2           ;-; Ak nie, chod do stavu UP2
0190 C220            444            clr     UP              ; zastav motor
0192 D23A            445            setb    UPOld           ;       (a zalohuj) 
0194 C23B            446            clr     DOWNOld         ;       (a zalohuj)
0196 C222            447            clr     FAST            ; 
0198 120685          448            lcall   WRITEPORTS      ; 
019B 02019E          449            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     450    
VYTAH/ORI                                                                                                     PAGE 9

                     451    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     452    
019E                 453    FLOOR2:
                     454 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
019E C22F            455 +1         clr     LEDU            
01A0 C22E            456 +1         clr     LEDD 
01A2 C224            457 +1         clr     FLED1             
01A4 C225            458 +1         clr     FLED2                
01A6 C226            459 +1         clr     FLED3           
01A8 C227            460 +1         clr     FLED4           
01AA D225            461 +1         setb    FLED2
01AC 120685          462 +1         lcall   WRITEPORTS
01AF 12061E          464            lcall   WAITFORTIMER    ; simulacia TIMERu
01B2 120637          465    F2S:    lcall   READPORTS     ;-; nacitanie dat
01B5 C21A            466            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
01B7 120685          467            lcall   WRITEPORTS      ;
                     468            
01BA 7418            469            mov     A, #00011000b ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
01BC 203A01          470            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
01BF F4              471            cpl     A               ;       Ak nie, znegujeme
01C0 F5F0            472    F2OK:   mov     B, A            ; Masku dame do Bcka
                     473            
                     474            ; Pohyb v jednom smere (nevieme v ktorom)
01C2 53F01A          475            anl     B, #00011010b  ;-; este ju kozmeticky upravime
01C5 E528            476            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
01C7 55F0            477            anl     A, B            ; tu ju pouzijeme       
01C9 7014            478            jnz     F2              ; nasli sme poschodie v tomto smere
                     479            ; Pohyb v opacnom smere (nevieme v ktorom)
01CB B23A            480            cpl     UPOld           ;  Znegujem stary posun
01CD B23B            481            cpl     DOWNOld         ;  |
01CF E5F0            482            mov     A, B            ;  Znegujeme masku
01D1 F4              483            cpl     A               ;  |
01D2 F5F0            484            mov     B, A            ;  |
01D4 53F01A          485            anl     B, #00011010b  ;-; este ju kozmeticky upravime
01D7 E528            486            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
01D9 55F0            487            anl     A, B            ; tu ju pouzijeme       
01DB 7002            488            jnz     F2              ; nasli sme poschodie v tomto smere
                     489            
01DD 80D3            490            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
01DF 203A03          491    F2:     jb      UPOld, F2UP     ;   
01E2 0201F1          492            jmp     F2DOWN          ;
01E5 D220            493    F2UP:   setb    UP              ; rychly pohyb hore
01E7 D222            494            setb    FAST            ; 
01E9 C223            495            clr     SLOW            ;
01EB 120685          496            lcall   WRITEPORTS      ; 
01EE 0201FD          497            jmp     UP2           ;-; prejdi do stavu UP2    
01F1 D221            498    F2DOWN: setb    DOWN            ; rychly pohyb hore
01F3 D222            499            setb    FAST            ; 
01F5 C223            500            clr     SLOW            ;
01F7 120685          501            lcall   WRITEPORTS      ; 
01FA 0202A9          502            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     503            
                     504                
01FD                 505    UP2:
VYTAH/ORIJDL1©4                                                                                              PAGE 10

                     506 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01FD C22F            507 +1         clr     LEDU            
01FF C22E            508 +1         clr     LEDD 
0201 C224            509 +1         clr     FLED1             
0203 C225            510 +1         clr     FLED2                
0205 C226            511 +1         clr     FLED3           
0207 C227            512 +1         clr     FLED4           
0209 D225            513 +1         setb    FLED2
020B 120685          514 +1         lcall   WRITEPORTS
                     516 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
020E 120608          517 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0211 120637          518 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0214 3009FA          519 +1         jnb     MB1, $-3  ; 
0217 120608          520 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
021A 120637          522    UP2A:   lcall   READPORTS       ; nacitanie dat
                     523 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
021D 200B03          524 +1         jb      SKRH, $+6
0220 0205ED          525 +1         ljmp    ERR_SKRH
0223 00              526 +1         nop
                     528 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0224 200903          529 +1         jb      MB1, $+6
0227 0205C0          530 +1         ljmp    ERR_2SPOM_C
022A 00              531 +1         nop
022B 200AEC          533            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     534 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
022E 120608          535 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0231 120637          536 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0234 300AFA          537 +1         jnb     MB2, $-3  ; 
0237 120608          538 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
023A D22E            540            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
023C 120685          541            lcall   WRITEPORTS      ;
023F 020242          542            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
0242                 543    UP2_MB2:
0242 120637          544            lcall   READPORTS       ; nacitanie dat
                     545 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0245 200B03          546 +1         jb      SKRH, $+6
0248 0205ED          547 +1         ljmp    ERR_SKRH
024B 00              548 +1         nop
                     550 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
024C 200903          551 +1         jb      MB1, $+6
024F 0205B1          552 +1         ljmp    ERR_1SPOM_C
0252 00              553 +1         nop
0253 200AEC          555            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0256 D22F            556            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0258 120685          557            lcall   WRITEPORTS      ;
                     558 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
025B 120608          559 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
025E 120637          560 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0261 300AFA          561 +1         jnb     MB2, $-3  ; 
0264 120608          562 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0267 E528            564            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0269 5408            565            anl     A, #00001000b ;-;
VYTAH/ORI:D¤3©4                                                                                              PAGE 11

026B 600A            566            jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
026D D223            567            setb    SLOW            ;       Ak ano, spomalme
026F C222            568            clr     FAST            ; 
0271 120685          569            lcall   WRITEPORTS      ;
0274 020277          570            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0277                 571    UP2_MB1:
0277 120637          572            lcall   READPORTS       ; nacitanie dat
                     573 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
027A 200B03          574 +1         jb      SKRH, $+6
027D 0205ED          575 +1         ljmp    ERR_SKRH
0280 00              576 +1         nop
                     578 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0281 200A03          579 +1         jb      MB2, $+6
0284 0205CF          580 +1         ljmp    ERR_ZAST_C
0287 00              581 +1         nop
0288 2009EC          583            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     584 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     585 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
028B C3              586 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
028C 7243            587 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
028E 7214            588 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0290 B00E            589 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
0292 720F            590 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0294 3400            591 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0296 7003            593            jnz     U2_MB1C       ;-; Ak nie, chod do stavu UP3
0298 02039A          594            ljmp    UP3             ; |
029B C220            595    U2_MB1C:clr     UP              ; zastav motor
029D D23A            596            setb    UPOld           ;       (a zalohuj)
029F C23B            597            clr     DOWNOld         ;       (a zalohuj)
02A1 C222            598            clr     FAST            ; 
02A3 120685          599            lcall   WRITEPORTS      ; 
02A6 02033B          600            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
02A9                 601    DOWN2:
                     602 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02A9 C22F            603 +1         clr     LEDU            
02AB C22E            604 +1         clr     LEDD 
02AD C224            605 +1         clr     FLED1             
02AF C225            606 +1         clr     FLED2                
02B1 C226            607 +1         clr     FLED3           
02B3 C227            608 +1         clr     FLED4           
02B5 D225            609 +1         setb    FLED2
02B7 120685          610 +1         lcall   WRITEPORTS
                     612 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02BA 120608          613 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02BD 120637          614 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02C0 3009FA          615 +1         jnb     MB1, $-3  ; 
02C3 120608          616 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02C6 120637          618            lcall   READPORTS       ; nacitanie dat
                     619 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
VYTAH/ORID”5©4œ5©4                                                                                          PAGE 12

02C9 200C03          620 +1         jb      SKRD, $+6
02CC 0205DE          621 +1         ljmp    ERR_SKRD
02CF 00              622 +1         nop
                     624 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02D0 200903          625 +1         jb      MB1, $+6
02D3 0205C0          626 +1         ljmp    ERR_2SPOM_C
02D6 00              627 +1         nop
02D7 200ACF          629            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     630 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
02DA 120608          631 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02DD 120637          632 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02E0 300AFA          633 +1         jnb     MB2, $-3  ; 
02E3 120608          634 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02E6 D22F            636            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02E8 120685          637            lcall   WRITEPORTS      ;
02EB 0202EE          638            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
02EE                 639    DOWN2_MB2:
02EE 120637          640            lcall   READPORTS       ; nacitanie dat
                     641 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
02F1 200C03          642 +1         jb      SKRD, $+6
02F4 0205DE          643 +1         ljmp    ERR_SKRD
02F7 00              644 +1         nop
                     646 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02F8 200903          647 +1         jb      MB1, $+6
02FB 0205B1          648 +1         ljmp    ERR_1SPOM_C
02FE 00              649 +1         nop
02FF 200AEC          651            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0302 D22E            652            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0304 120685          653            lcall   WRITEPORTS      ;
                     654 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0307 120608          655 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
030A 120637          656 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
030D 300AFA          657 +1         jnb     MB2, $-3  ; 
0310 120608          658 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0313 E528            660            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0315 5402            661            anl     A, #00000010b ;-;
0317 600A            662            jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0319 D223            663            setb    SLOW            ;       Ak ano, spomalme
031B C222            664            clr     FAST            ; 
031D 120685          665            lcall   WRITEPORTS      ;
0320 020323          666            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
0323                 667    DOWN2_MB1:    
0323 120637          668            lcall   READPORTS       ; nacitanie dat
0326 300C05          669            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0329 300902          670            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
032C 80F5            671            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
032E C221            672    D2_MB1C:clr     DOWN            ; zastav motor
0330 D23B            673            setb    DOWNOld         ;       (a zalohuj)
0332 C23A            674            clr     UPOld           ;       (a zalohuj)
0334 C222            675            clr     FAST            ; 
0336 120685          676            lcall   WRITEPORTS      ; 
0339 01C7            677            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
VYTAH/ORI                                                                                                     PAGE 13

                     678    
                     679    
                     680    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     681    
033B                 682    FLOOR3:
                     683 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
033B C22F            684 +1         clr     LEDU            
033D C22E            685 +1         clr     LEDD 
033F C224            686 +1         clr     FLED1             
0341 C225            687 +1         clr     FLED2                
0343 C226            688 +1         clr     FLED3           
0345 C227            689 +1         clr     FLED4           
0347 D226            690 +1         setb    FLED3
0349 120685          691 +1         lcall   WRITEPORTS
034C 12061E          693            lcall   WAITFORTIMER    ; simulacia TIMERu
034F 120637          694    F3S:    lcall   READPORTS     ;-; nacitanie dat
0352 C21B            695            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0354 120685          696            lcall   WRITEPORTS      ;
                     697    
0357 7410            698            mov     A, #00010000b ;-; Default predpokladam, ze idem hore (na 4.)
0359 203A01          699            jb      UPOld, F3OK   ;-;   Je to pravda? Naozaj idem hore?
035C F4              700            cpl     A               ;       Ak nie, znegujeme
035D F5F0            701    F3OK:   mov     B, A            ; Masku dame do Bcka
                     702            
                     703            ; Pohyb v jednom smere (nevieme v ktorom)
035F 53F016          704            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0362 E528            705            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0364 55F0            706            anl     A, B            ; tu ju pouzijeme       
0366 7014            707            jnz     F3              ; nasli sme poschodie v tomto smere
                     708            ; Pohyb v opacnom smere (nevieme v ktorom)
0368 B23A            709            cpl     UPOld           ;  Znegujem stary posun
036A B23B            710            cpl     DOWNOld         ;  |
036C E5F0            711            mov     A, B            ;  Znegujeme masku
036E F4              712            cpl     A               ;  |
036F F5F0            713            mov     B, A            ;  |
0371 53F016          714            anl     B, #00010110b  ;-; este ju kozmeticky upravime
0374 E528            715            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0376 55F0            716            anl     A, B            ; tu ju pouzijeme       
0378 7002            717            jnz     F3              ; nasli sme poschodie v tomto smere
                     718            
037A 80D3            719            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
037C 203A03          720    F3:     jb      UPOld, F3UP     ;   
037F 02038E          721            jmp     F3DOWN          ;
0382 D220            722    F3UP:   setb    UP              ; rychly pohyb hore
0384 D222            723            setb    FAST            ; 
0386 C223            724            clr     SLOW            ;
0388 120685          725            lcall   WRITEPORTS      ; 
038B 02039A          726            jmp     UP3           ;-; prejdi do stavu UP2    
038E D221            727    F3DOWN: setb    DOWN            ; rychly pohyb hore
0390 D222            728            setb    FAST            ; 
0392 C223            729            clr     SLOW            ;
0394 120685          730            lcall   WRITEPORTS      ; 
0397 02042D          731            jmp     DOWN3         ;-; prejdi do stavu UP2    
                     732         
VYTAH/ORIgD 7©4                                                                                              PAGE 14

                     733         
039A                 734    UP3:
                     735 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
039A C22F            736 +1         clr     LEDU            
039C C22E            737 +1         clr     LEDD 
039E C224            738 +1         clr     FLED1             
03A0 C225            739 +1         clr     FLED2                
03A2 C226            740 +1         clr     FLED3           
03A4 C227            741 +1         clr     FLED4           
03A6 D226            742 +1         setb    FLED3
03A8 120685          743 +1         lcall   WRITEPORTS
                     745 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03AB 120608          746 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03AE 120637          747 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03B1 3009FA          748 +1         jnb     MB1, $-3  ; 
03B4 120608          749 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03B7 120637          751    UP3A:   lcall   READPORTS       ; nacitanie dat
                     752 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03BA 200B03          753 +1         jb      SKRH, $+6
03BD 0205ED          754 +1         ljmp    ERR_SKRH
03C0 00              755 +1         nop
                     757 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03C1 200903          758 +1         jb      MB1, $+6
03C4 0205C0          759 +1         ljmp    ERR_2SPOM_C
03C7 00              760 +1         nop
03C8 200AEC          762            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                     763 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
03CB 120608          764 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03CE 120637          765 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03D1 300AFA          766 +1         jnb     MB2, $-3  ; 
03D4 120608          767 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03D7 D22E            769            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03D9 120685          770            lcall   WRITEPORTS      ;
03DC 0203DF          771            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
03DF                 772    UP3_MB2:
03DF 120637          773            lcall   READPORTS       ; nacitanie dat
                     774 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
03E2 200B03          775 +1         jb      SKRH, $+6
03E5 0205ED          776 +1         ljmp    ERR_SKRH
03E8 00              777 +1         nop
                     779 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
03E9 200903          780 +1         jb      MB1, $+6
03EC 0205B1          781 +1         ljmp    ERR_1SPOM_C
03EF 00              782 +1         nop
03F0 200AEC          784            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
03F3 D22F            785            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
03F5 120685          786            lcall   WRITEPORTS      ;
                     787 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
03F8 120608          788 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03FB 120637          789 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03FE 300AFA          790 +1         jnb     MB2, $-3  ; 
0401 120608          791 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
VYTAH/ORI SDD:©4                                                                                              PAGE 15

0404 E528            793            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0406 5410            794            anl     A, #00010000b ;-;
0408 600A            795            jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
040A D223            796            setb    SLOW            ;       Ak ano, spomalme
040C C222            797            clr     FAST            ; 
040E 120685          798            lcall   WRITEPORTS      ;
0411 020414          799            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0414                 800    UP3_MB1:
0414 120637          801            lcall   READPORTS       ; nacitanie dat
0417 300B05          802            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
041A 300902          803            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
041D 80F5            804            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
041F C220            805    U3_MB1C:clr     UP              ; zastav motor
0421 D23A            806            setb    UPOld           ;       (a zalohuj)
0423 C23B            807            clr     DOWNOld         ;       (a zalohuj)
0425 C222            808            clr     FAST            ; 
0427 120685          809            lcall   WRITEPORTS      ; 
042A 0204D8          810            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
042D                 811    DOWN3:
                     812 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
042D C22F            813 +1         clr     LEDU            
042F C22E            814 +1         clr     LEDD 
0431 C224            815 +1         clr     FLED1             
0433 C225            816 +1         clr     FLED2                
0435 C226            817 +1         clr     FLED3           
0437 C227            818 +1         clr     FLED4           
0439 D226            819 +1         setb    FLED3
043B 120685          820 +1         lcall   WRITEPORTS
                     822 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
043E 120608          823 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0441 120637          824 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0444 3009FA          825 +1         jnb     MB1, $-3  ; 
0447 120608          826 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
044A 120637          828            lcall   READPORTS       ; nacitanie dat
                     829 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
044D 200C03          830 +1         jb      SKRD, $+6
0450 0205DE          831 +1         ljmp    ERR_SKRD
0453 00              832 +1         nop
                     834 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0454 200903          835 +1         jb      MB1, $+6
0457 0205C0          836 +1         ljmp    ERR_2SPOM_C
045A 00              837 +1         nop
045B 200ACF          839            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                     840 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
045E 120608          841 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0461 120637          842 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0464 300AFA          843 +1         jnb     MB2, $-3  ; 
0467 120608          844 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
046A D22F            846            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
046C 120685          847            lcall   WRITEPORTS      ;
046F 020472          848            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0472                 849    DOWN3_MB2:
VYTAH/ORI BDä;©4                                                                                              PAGE 16

0472 120637          850            lcall   READPORTS       ; nacitanie dat
                     851 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0475 200C03          852 +1         jb      SKRD, $+6
0478 0205DE          853 +1         ljmp    ERR_SKRD
047B 00              854 +1         nop
                     856 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
047C 200903          857 +1         jb      MB1, $+6
047F 0205B1          858 +1         ljmp    ERR_1SPOM_C
0482 00              859 +1         nop
0483 200AEC          861            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0486 D22E            862            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0488 120685          863            lcall   WRITEPORTS      ;
                     864 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
048B 120608          865 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
048E 120637          866 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0491 300AFA          867 +1         jnb     MB2, $-3  ; 
0494 120608          868 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0497 E528            870            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0499 5404            871            anl     A, #00000100b ;-;
049B 600A            872            jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
049D D223            873            setb    SLOW            ;       Ak ano, spomalme
049F C222            874            clr     FAST            ; 
04A1 120685          875            lcall   WRITEPORTS      ;
04A4 0204A7          876            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
04A7                 877    DOWN3_MB1:    
04A7 120637          878            lcall   READPORTS       ; nacitanie dat
                     879 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
04AA 200C03          880 +1         jb      SKRD, $+6
04AD 0205DE          881 +1         ljmp    ERR_SKRD
04B0 00              882 +1         nop
                     884 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
04B1 200A03          885 +1         jb      MB2, $+6
04B4 0205CF          886 +1         ljmp    ERR_ZAST_C
04B7 00              887 +1         nop
04B8 2009EC          889            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                     890 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     891 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
04BB C3              892 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
04BC 7242            893 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
04BE 7211            894 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
04C0 B00E            895 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
04C2 720F            896 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
04C4 3400            897 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
04C6 7003            899            jnz     D3_MB1C         ; Ak nie, chod do stavu DOWN2
04C8 0202A9          900            ljmp    DOWN2         ;-; |
04CB C221            901    D3_MB1C:clr     DOWN            ; zastav motor
04CD D23B            902            setb    DOWNOld         ;       (a zalohuj)
04CF C23A            903            clr     UPOld           ;       (a zalohuj)
04D1 C222            904            clr     FAST            ; 
VYTAH/ORI #Dð=©4ô=©4                                                                                          PAGE 17

04D3 120685          905            lcall   WRITEPORTS      ; 
04D6 219E            906            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                     907          
                     908            
                     909    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                     910    
04D8                 911    FLOOR4:
                     912 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04D8 C22F            913 +1         clr     LEDU            
04DA C22E            914 +1         clr     LEDD 
04DC C224            915 +1         clr     FLED1             
04DE C225            916 +1         clr     FLED2                
04E0 C226            917 +1         clr     FLED3           
04E2 C227            918 +1         clr     FLED4           
04E4 D227            919 +1         setb    FLED4
04E6 120685          920 +1         lcall   WRITEPORTS
04E9 12061E          922            lcall   WAITFORTIMER    ; simulacia TIMERu
04EC 120637          923    F4S:    lcall   READPORTS     ;-; nacitanie dat
04EF C21C            924            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
04F1 120685          925            lcall   WRITEPORTS      ;
04F4 E528            926            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco menej ako poschodie na kto
                                                                               rom stojim
04F6 540E            927            anl     A, #00001110b ;-;
04F8 60F2            928            jz      F4S           ;-; ak nie, opakuj
04FA D221            929            setb    DOWN            ; rychly pohyb dole
04FC D222            930            setb    FAST            ;
04FE C223            931            clr     SLOW            ; 
0500 120685          932            lcall   WRITEPORTS      ; 
0503 020506          933            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
0506                 934    DOWN4:
                     935 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0506 C22F            936 +1         clr     LEDU            
0508 C22E            937 +1         clr     LEDD 
050A C224            938 +1         clr     FLED1             
050C C225            939 +1         clr     FLED2                
050E C226            940 +1         clr     FLED3           
0510 C227            941 +1         clr     FLED4           
0512 D227            942 +1         setb    FLED4
0514 120685          943 +1         lcall   WRITEPORTS
                     945 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0517 120608          946 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
051A 120637          947 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
051D 3009FA          948 +1         jnb     MB1, $-3  ; 
0520 120608          949 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0523 120637          951            lcall   READPORTS       ; nacitanie dat
                     952 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0526 200C03          953 +1         jb      SKRD, $+6
0529 0205DE          954 +1         ljmp    ERR_SKRD
052C 00              955 +1         nop
                     957 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
052D 200903          958 +1         jb      MB1, $+6
0530 0205C0          959 +1         ljmp    ERR_2SPOM_C
0533 00              960 +1         nop
VYTAH/ORID‚?©4ˆ?©4                                                                                          PAGE 18

0534 200ACF          962            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                     963 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0537 120608          964 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
053A 120637          965 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
053D 300AFA          966 +1         jnb     MB2, $-3  ; 
0540 120608          967 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0543 D22F            969            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0545 120685          970            lcall   WRITEPORTS      ;
0548 02054B          971            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
054B                 972    DOWN4_MB2:
054B 120637          973            lcall   READPORTS       ; nacitanie dat
                     974 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
054E 200C03          975 +1         jb      SKRD, $+6
0551 0205DE          976 +1         ljmp    ERR_SKRD
0554 00              977 +1         nop
                     979 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0555 200903          980 +1         jb      MB1, $+6
0558 0205B1          981 +1         ljmp    ERR_1SPOM_C
055B 00              982 +1         nop
055C 200AEC          984            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
055F D22E            985            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0561 120685          986            lcall   WRITEPORTS      ;
                     987 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0564 120608          988 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0567 120637          989 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
056A 300AFA          990 +1         jnb     MB2, $-3  ; 
056D 120608          991 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0570 E528            993            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0572 5408            994            anl     A, #00001000b ;-;
0574 600A            995            jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
0576 D223            996            setb    SLOW            ;       Ak ano, spomalme
0578 C222            997            clr     FAST            ; 
057A 120685          998            lcall   WRITEPORTS      ;
057D 020580          999            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
0580                1000    DOWN4_MB1:    
0580 120637         1001            lcall   READPORTS       ; nacitanie dat
                    1002 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0583 200C03         1003 +1         jb      SKRD, $+6
0586 0205DE         1004 +1         ljmp    ERR_SKRD
0589 00             1005 +1         nop
                    1007 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
058A 200A03         1008 +1         jb      MB2, $+6
058D 0205CF         1009 +1         ljmp    ERR_ZAST_C
0590 00             1010 +1         nop
0591 2009EC         1012            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1013 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1014 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0594 C3             1015 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0595 7243           1016 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0597 7213           1017 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0599 B00E           1018 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
VYTAH/ORI(jDN"©4R"©4                                                                                          PAGE 19

059B 720F           1019 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
059D 3400           1020 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
059F 7003           1022            jnz     D4_MB1C         ; Ak nie, chod do stavu DOWN3
05A1 02042D         1023            ljmp    DOWN3         ;-; |
05A4 C221           1024    D4_MB1C:clr     DOWN            ; zastav motor
05A6 D23B           1025            setb    DOWNOld         ;       (a zalohuj)
05A8 C23A           1026            clr     UPOld           ;       (a zalohuj)
05AA C222           1027            clr     FAST            ; 
05AC 120685         1028            lcall   WRITEPORTS      ; 
05AF 613B           1029            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1030                    
                    1031      
05B1                1032    ERR_1SPOM_C: 
05B1 C220           1033            clr     UP              ; zastav motor
05B3 C221           1034            clr     DOWN            ; 
05B5 120685         1035            lcall   WRITEPORTS      ; 
                    1036 +1         _BP_
05B8 C2B3           1037 +1         clr     P3.3
05BA D2AA           1038 +1         setb    EX1
05BC 00             1039 +1         nop
05BD 00             1040 +1         nop
05BE 00             1042            nop
05BF 00             1043            nop 
                    1044            
05C0                1045    ERR_2SPOM_C: 
05C0 C220           1046            clr     UP              ; zastav motor
05C2 C221           1047            clr     DOWN            ; 
05C4 120685         1048            lcall   WRITEPORTS      ; 
                    1049 +1         _BP_
05C7 C2B3           1050 +1         clr     P3.3
05C9 D2AA           1051 +1         setb    EX1
05CB 00             1052 +1         nop
05CC 00             1053 +1         nop
05CD 00             1055            nop
05CE 00             1056            nop 
                    1057            
05CF                1058    ERR_ZAST_C: 
05CF C220           1059            clr     UP              ; zastav motor
05D1 C221           1060            clr     DOWN            ; 
05D3 120685         1061            lcall   WRITEPORTS      ; 
                    1062 +1         _BP_
05D6 C2B3           1063 +1         clr     P3.3
05D8 D2AA           1064 +1         setb    EX1
05DA 00             1065 +1         nop
05DB 00             1066 +1         nop
05DC 00             1068            nop
05DD 00             1069            nop 
                    1070            
05DE                1071    ERR_SKRD: 
05DE C220           1072            clr     UP              ; zastav motor
05E0 C221           1073            clr     DOWN            ; 
05E2 120685         1074            lcall   WRITEPORTS      ; 
                    1075 +1         _BP_
05E5 C2B3           1076 +1         clr     P3.3
05E7 D2AA           1077 +1         setb    EX1
VYTAH/ORI7D                                                                                                  PAGE 20

05E9 00             1078 +1         nop
05EA 00             1079 +1         nop
05EB 00             1081            nop
05EC 00             1082            nop    
                    1083            
05ED                1084    ERR_SKRH: 
05ED C220           1085            clr     UP              ; zastav motor
05EF C221           1086            clr     DOWN            ; 
05F1 120685         1087            lcall   WRITEPORTS      ; 
                    1088 +1         _BP_
05F4 C2B3           1089 +1         clr     P3.3
05F6 D2AA           1090 +1         setb    EX1
05F8 00             1091 +1         nop
05F9 00             1092 +1         nop
05FA 00             1094            nop
05FB 00             1095            nop             
                    1096                    
                    1097                    
05FC                1098    ENDPROG:
05FC D218           1099            setb    KS
05FE 120685         1100            call    WRITEPORTS                ; zapis novu informaciu
                    1101 +1         _BP_
0601 C2B3           1102 +1         clr     P3.3
0603 D2AA           1103 +1         setb    EX1
0605 00             1104 +1         nop
0606 00             1105 +1         nop
0607 22             1107            ret
                    1108            
                    1109    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1110    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1111    ; 11.0592MHz/2000 = zdrzanie 1 ms
0608                1112    TIME10MS:
0608 7963           1113            mov     R1,#063h        ; 2
                    1114                                    ; *** 100x
060A 7AFF           1115    TIME0:  mov     R2,#0FFh        ; 2 
060C DAFE           1116    TIME1:  djnz    R2,TIME1        ; 256*2   
060E 7AFF           1117            mov     R2,#0FFh        ; 2       
0610 DAFE           1118    TIME2:  djnz    R2,TIME2        ; 256*2 
0612 7A24           1119            mov     R2,#024h        ; 2       
0614 DAFE           1120    TIME3:  djnz    R2,TIME3        ; 36*2
0616 00             1121            nop                     ; 1
0617 D9F1           1122            djnz    R1,TIME0        ; 2
                    1123                                    ; ***
0619 792A           1124            mov     R1,#02Ah        ; 2 
061B D9FE           1125    TIME4:  djnz    R1,TIME4        ; 43*2  
061D 22             1126            ret                     ; koniec
                    1127            
                    1128            
                    1129    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1130    ; DELAY
                    1131    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1132    ; bude timer)
                    1133    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
061E                1134    WAITFORTIMER:
061E 7B20           1135            mov     R3, #20h
0620 120608         1136    DEL1:   lcall   TIME10MS
0623 DBFB           1137            djnz    R3, DEL1
0625 22             1138            ret
VYTAH/ORI                                                                                                     PAGE 21

                    1139    
                    1140    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1141    ; WAITFORTIMER
                    1142    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1143    ; bude timer)
                    1144    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0626                1145    WAITFORTIMER2:
0626 D22C           1146            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
0628 120685         1147            lcall   WRITEPORTS                  ;
062B 120637         1148    WAIT:   lcall   READPORTS                   ; 
062E 3013ED         1149            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0631 C22C           1150            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
0633 120685         1151            lcall   WRITEPORTS
0636 22             1152            ret
                    1153    
                    1154    
                    1155    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1156    ; READPORTS
                    1157    ; precita nove hodnoty na portoch
                    1158    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0637                1159    READPORTS:
0637 75A080         1160            mov     p2, #i8255INA       ; citaj data z portu A
063A 75803F         1161            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
063D C2B7           1162            clr     RDNOT
063F 00             1163            nop
0640 00             1164            nop
0641 00             1165            nop
0642 00             1166            nop
0643 858028         1167            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
0646 D2B7           1168            setb    RDNOT
                    1169            
0648 75A081         1170            mov     p2, #i8255INB       ; citaj data z portu B
064B 7580FE         1171            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
064E C2B7           1172            clr     RDNOT
0650 00             1173            nop
0651 00             1174            nop
0652 00             1175            nop
0653 00             1176            nop
0654 858021         1177            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0657 D2B7           1178            setb    RDNOT
                    1179    
0659 75A082         1180            mov     p2, #i8255INC       ; citaj data z portu C
065C 75803F         1181            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
065F C2B7           1182            clr     RDNOT
0661 00             1183            nop
0662 00             1184            nop
0663 00             1185            nop
0664 00             1186            nop
0665 858022         1187            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0668 D2B7           1188            setb    RDNOT
066A 00             1189            nop
066B 00             1190            nop
066C 00             1191            nop
066D 00             1192            nop
066E 00             1193            nop
066F 00             1194            nop
0670 00             1195            nop
VYTAH/ORI?D                                                                                                  PAGE 22

0671 00             1196            nop
0672 E528           1197            mov     A, INPORTA
0674 541E           1198            anl     A, #00011110b
0676 4223           1199            orl     OUTPORTA, A
0678 120685         1200            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
067B E522           1201            mov     A, INPORTC
067D 543F           1202            anl     A, #00111111b
067F 4225           1203            orl     OUTPORTC, A
0681 120685         1204            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1205            
0684 22             1206            ret
                    1207            
                    1208    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1209    ; WRITEPORTS
                    1210    ; spravi zalohu vystupnych registrov a posle data von
                    1211    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0685                1212    WRITEPORTS:
0685 852380         1213            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
0688 75A0C0         1214            mov     p2, #i8255OUTA
068B C2B6           1215            clr     WRNOT
068D 00             1216            nop
068E 00             1217            nop
068F 00             1218            nop
0690 00             1219            nop
0691 D2B6           1220            setb    WRNOT
                    1221            
0693 852480         1222            mov     p0, OUTPORTB        ; potom port B
0696 75A0C1         1223            mov     p2, #i8255OUTB
0699 C2B6           1224            clr     WRNOT
069B 00             1225            nop
069C 00             1226            nop
069D 00             1227            nop
069E 00             1228            nop
069F D2B6           1229            setb    WRNOT
                    1230    
06A1 852580         1231            mov     p0, OUTPORTC        ; a nakoniec port C
06A4 75A0C2         1232            mov     p2, #i8255OUTC
06A7 C2B6           1233            clr     WRNOT
06A9 00             1234            nop
06AA 00             1235            nop
06AB 00             1236            nop
06AC 00             1237            nop
06AD D2B6           1238            setb    WRNOT
06AF 00             1239            nop
06B0 00             1240            nop
06B1 00             1241            nop
06B2 00             1242            nop
06B3 00             1243            nop
06B4 00             1244            nop
06B5 00             1245            nop
06B6 00             1246            nop
06B7 22             1247            ret
                    1248    
                    1249    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1250    
06B8 0D0A5269       1251    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
06BC 61646961   
06C0 63692073   
VYTAH/ORID                                                                                                  PAGE 23

06C4 79737465   
06C8 6D206A65   
06CC 20696E69   
06D0 6369616C   
06D4 697A6F76   
06D8 616E792E   
06DC 0D0A00     
06DF 52696164       1252    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
06E3 69616369   
06E7 20737973   
06EB 74656D20   
06EF 6A652072   
06F3 65696E69   
06F7 6369616C   
06FB 697A6F76   
06FF 616E7920   
0703 706F2073   
0707 746C6163   
070B 656E6920   
070F 746C6163   
0713 69646C61   
0717 2053544F   
071B 502E0D0A   
071F 00         
0720 4B616C69       1253    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0724 62726163   
0728 69612076   
072C 79746168   
0730 75206A65   
0734 20756B6F   
0738 6E63656E   
073C 612E0D0A   
0740 00         
                    1254    
----                1255            DSEG
0040                1256            org     40h
0040                1257    STACK:  DS      10h
                    1258    
                    1259    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 24

B. . . . . . . . . . . . . . . .  D ADDR  00F0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0096H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00ADH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00B8H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A5H  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  032EH  
D3_MB1C. . . . . . . . . . . . .  C ADDR  04CBH  
D4_MB1C. . . . . . . . . . . . .  C ADDR  05A4H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0620H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  02A9H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  0323H  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  02EEH  
DOWN3. . . . . . . . . . . . . .  C ADDR  042DH  
VYTAH/ORI                                                                                                     PAGE 25

DOWN3_MB1. . . . . . . . . . . .  C ADDR  04A7H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0472H  
DOWN4. . . . . . . . . . . . . .  C ADDR  0506H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  0580H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  054BH  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
ENDPROG. . . . . . . . . . . . .  C ADDR  05FCH  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  05B1H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  05C0H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  05DEH  
ERR_SKRH . . . . . . . . . . . .  C ADDR  05EDH  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  05CFH  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1S. . . . . . . . . . . . . . .  C ADDR  00DBH  
F2 . . . . . . . . . . . . . . .  C ADDR  01DFH  
F2DOWN . . . . . . . . . . . . .  C ADDR  01F1H  
F2OK . . . . . . . . . . . . . .  C ADDR  01C0H  
F2S. . . . . . . . . . . . . . .  C ADDR  01B2H  
F2UP . . . . . . . . . . . . . .  C ADDR  01E5H  
F3 . . . . . . . . . . . . . . .  C ADDR  037CH  
F3DOWN . . . . . . . . . . . . .  C ADDR  038EH  
F3OK . . . . . . . . . . . . . .  C ADDR  035DH  
F3S. . . . . . . . . . . . . . .  C ADDR  034FH  
F3UP . . . . . . . . . . . . . .  C ADDR  0382H  
F4S. . . . . . . . . . . . . . .  C ADDR  04ECH  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C7H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  019EH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  033BH  
FLOOR4 . . . . . . . . . . . . .  C ADDR  04D8H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C7H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
VYTAH/ORI                                                                                                     PAGE 26

MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  NOT USED  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  NOT USED  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  NOT USED  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  NOT USED  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  NOT USED  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  0637H  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0720H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  06B8H  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  06DFH  NOT USED  
TIME0. . . . . . . . . . . . . .  C ADDR  060AH  
TIME1. . . . . . . . . . . . . .  C ADDR  060CH  
TIME10MS . . . . . . . . . . . .  C ADDR  0608H  
TIME2. . . . . . . . . . . . . .  C ADDR  0610H  
TIME3. . . . . . . . . . . . . .  C ADDR  0614H  
TIME4. . . . . . . . . . . . . .  C ADDR  061BH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U2_MB1C. . . . . . . . . . . . .  C ADDR  029BH  
U3_MB1C. . . . . . . . . . . . .  C ADDR  041FH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
VYTAH/ORI                                                                                                     PAGE 27

UP1. . . . . . . . . . . . . . .  C ADDR  00F5H  
UP1A . . . . . . . . . . . . . .  C ADDR  0112H  
UP1_MB1. . . . . . . . . . . . .  C ADDR  016FH  
UP1_MB2. . . . . . . . . . . . .  C ADDR  013AH  
UP2. . . . . . . . . . . . . . .  C ADDR  01FDH  
UP2A . . . . . . . . . . . . . .  C ADDR  021AH  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0277H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  0242H  
UP3. . . . . . . . . . . . . . .  C ADDR  039AH  
UP3A . . . . . . . . . . . . . .  C ADDR  03B7H  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0414H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  03DFH  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  062BH  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  061EH  
WAITFORTIMER2. . . . . . . . . .  C ADDR  0626H  NOT USED  
WRITEPORTS . . . . . . . . . . .  C ADDR  0685H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
