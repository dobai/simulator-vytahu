VYTAH/ORI                                                                                                     PAGE 1

                       1    $MOD51
                       2    $DEBUG
                       3    
                =1     4    $include (lift.inc)
                =1     5    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1     6    i8255INA        equ     080h
  0081          =1     7    i8255INB        equ     081h
  0082          =1     8    i8255INC        equ     082h
  0083          =1     9    i8255INCW       equ     083h
  00C0          =1    10    i8255OUTA       equ     0c0h
  00C1          =1    11    i8255OUTB       equ     0c1h
  00C2          =1    12    i8255OUTC       equ     0c2h
  00C3          =1    13    i8255OUTCW      equ     0c3h
                =1    14    
  0028          =1    15    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    16    INPORTB         data    21h
  0022          =1    17    INPORTC         data    22h
  0023          =1    18    OUTPORTA        data    23h
  0024          =1    19    OUTPORTB        data    24h
  0025          =1    20    OUTPORTC        data    25h
  0026          =1    21    INPORTBold      data    26h
  0027          =1    22    CTRLREG         data    27h
                =1    23    
  0030          =1    24    POSITION        data    30h
  0031          =1    25    LOWEST          data    31h
  0032          =1    26    HIGHEST         data    32h
  0033          =1    27    STOPTIMER       data    33h
  0034          =1    28    OUTPORTBold     data    34h
                =1    29    
  0040          =1    30    STOPNOT         bit     INPORTA.0
  0041          =1    31    PKI1            bit     INPORTA.1
  0042          =1    32    PKI2            bit     INPORTA.2
  0043          =1    33    PKI3            bit     INPORTA.3
  0044          =1    34    PKI4            bit     INPORTA.4
  0045          =1    35    DOORCLSD        bit     INPORTA.5 
                =1    36    
  0009          =1    37    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    38    MB2             bit     INPORTB.2
  000B          =1    39    SKRH            bit     INPORTB.3
  000C          =1    40    SKRD            bit     INPORTB.4
  000D          =1    41    DP              bit     INPORTB.5
  000E          =1    42    DPZK            bit     INPORTB.6
  000F          =1    43    DPK             bit     INPORTB.7
                =1    44    
  0031          =1    45    MB1old          bit     INPORTBold.1
  0032          =1    46    MB2old          bit     INPORTBold.2
  0033          =1    47    SKRHold         bit     INPORTBold.3
  0034          =1    48    SKRDold         bit     INPORTBold.4
                =1    49    
  0010          =1    50    PI1             bit     INPORTC.0
  0011          =1    51    PI2D            bit     INPORTC.1
  0012          =1    52    PI2U            bit     INPORTC.2
  0013          =1    53    PI3D            bit     INPORTC.3
  0014          =1    54    PI3U            bit     INPORTC.4
  0015          =1    55    PI4             bit     INPORTC.5
                =1    56    
  0018          =1    57    KS              bit     OUTPORTA.0
  0019          =1    58    PKO1            bit     OUTPORTA.1
VYTAH/ORI/D                                                                                                  PAGE 2

  001A          =1    59    PKO2            bit     OUTPORTA.2
  001B          =1    60    PKO3            bit     OUTPORTA.3
  001C          =1    61    PKO4            bit     OUTPORTA.4
                =1    62    
  0020          =1    63    UP              bit     OUTPORTB.0
  0021          =1    64    DOWN            bit     OUTPORTB.1
  0022          =1    65    FAST            bit     OUTPORTB.2
  0023          =1    66    SLOW            bit     OUTPORTB.3
  0024          =1    67    FLED1           bit     OUTPORTB.4
  0025          =1    68    FLED2           bit     OUTPORTB.5
  0026          =1    69    FLED3           bit     OUTPORTB.6
  0027          =1    70    FLED4           bit     OUTPORTB.7
                =1    71    
  0028          =1    72    PO1             bit     OUTPORTC.0
  0029          =1    73    PO2D            bit     OUTPORTC.1
  002A          =1    74    PO2U            bit     OUTPORTC.2
  002B          =1    75    PO3D            bit     OUTPORTC.3
  002C          =1    76    PO3U            bit     OUTPORTC.4
  002D          =1    77    PO4             bit     OUTPORTC.5
  002E          =1    78    LEDD            bit     OUTPORTC.6
  002F          =1    79    LEDU            bit     OUTPORTC.7
                =1    80    
  0038          =1    81    CANGO           bit     CTRLREG.0
  0039          =1    82    DOORCLSDold     bit     CTRLREG.1
  003A          =1    83    UPold           bit     CTRLREG.2
  003B          =1    84    DOWNold         bit     CTRLREG.3
  003C          =1    85    FASTold         bit     CTRLREG.4
  003D          =1    86    SLOWold         bit     CTRLREG.5
                =1    87    
  00B6          =1    88    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    89    RDNOT           bit     0b7h        ; p3.7
                =1    90    
                =1    91    ; bitove masky
                =1    92    ; 8255OUT 
                =1    93    ; port A
  0001          =1    94    bmKS              equ    00000001b
  0002          =1    95    bmPKO1            equ    00000010b
  0004          =1    96    bmPKO2            equ    00000100b
  0008          =1    97    bmPKO3            equ    00001000b
  0010          =1    98    bmPKO4            equ    00010000b
                =1    99    
                =1   100    ; port B
  0001          =1   101    bmUP              equ    00000001b
  0002          =1   102    bmDOWN            equ    00000010b
  0004          =1   103    bmFAST            equ    00000100b
  0008          =1   104    bmSLOW            equ    00001000b
  0010          =1   105    bmFLED1           equ    00010000b
  0020          =1   106    bmFLED2           equ    00100000b
  0040          =1   107    bmFLED3           equ    01000000b
  0080          =1   108    bmFLED4           equ    10000000b
                =1   109    
                =1   110    ; port C
  0001          =1   111    bmPO1             equ    00000001b
  0002          =1   112    bmPO2D            equ    00000010b
  0004          =1   113    bmPO2U            equ    00000100b
  0008          =1   114    bmPO3D            equ    00001000b
  0010          =1   115    bmPO3U            equ    00010000b
  0020          =1   116    bmPO4             equ    00100000b
VYTAH/ORI/D                                                                                                  PAGE 3

  0040          =1   117    bmLEDD            equ    01000000b
  0080          =1   118    bmLEDU            equ    10000000b
                =1   119    
                =1   120    ; 8255IN
                =1   121    ; port A
  0001          =1   122    bmSTOP            equ    00000001b
  0002          =1   123    bmPKI1            equ    00000010b
  0004          =1   124    bmPKI2            equ    00000100b
  0008          =1   125    bmPKI3            equ    00001000b
  0010          =1   126    bmPKI4            equ    00010000b
  0020          =1   127    bmDOORCLSD        equ    00100000b
                =1   128    
                =1   129    ; port B
  0002          =1   130    bmMB1I            equ    00000010b
  0004          =1   131    bmMB2I            equ    00000100b
  0008          =1   132    bmSKRHI           equ    00001000b
  0010          =1   133    bmSKRHD           equ    00010000b
  0020          =1   134    bmDPI             equ    00100000b
  0040          =1   135    bmDPZKI           equ    01000000b
  0080          =1   136    bmDPKI            equ    10000000b
                =1   137    
                =1   138    ; port C
  0001          =1   139    bmPI1             equ    00000001b
  0002          =1   140    bmPI2D            equ    00000010b
  0004          =1   141    bmPI2U            equ    00000100b
  0008          =1   142    bmPI3D            equ    00001000b
  0010          =1   143    bmPI3U            equ    00010000b
  0020          =1   144    bmPI4             equ    00100000b
                =1   145    
                     146    
                     147    _BP_    MACRO 
                     148            clr     P3.3
                     149            setb    EX1
                     150            nop
                     151            nop
                     152    ENDM
                     153    
                     154    LJZ     MACRO   NAVESTIE
                     155            jnz     $+5
                     156            ljmp    NAVESTIE
                     157            nop
                     158    ENDM
                     159    
                     160    LJNZ    MACRO   NAVESTIE
                     161            jz      $+5
                     162            ljmp    NAVESTIE
                     163            nop
                     164    ENDM
                     165    
                     166    LJB     MACRO   TESTBIT, NAVESTIE
                     167            jnb     TESTBIT, $+5
                     168            ljmp    NAVESTIE
                     169            nop
                     170    ENDM
                     171    
                     172    LJNB    MACRO   TESTBIT, NAVESTIE
                     173            jb      TESTBIT, $+5
                     174            ljmp    NAVESTIE
VYTAH/ORI/D                                                                                                  PAGE 4

                     175            nop
                     176    ENDM
                     177    
                     178    POLOHA_LED  MACRO  POLOHA
                     179            clr     LEDU            
                     180            clr     LEDD 
                     181            clr     FLED1             
                     182            clr     FLED2                
                     183            clr     FLED3           
                     184            clr     FLED4           
                     185            setb    FLED&POLOHA
                     186            lcall   WRITEPORTS
                     187    ENDM
                     188    
  0036               189    FLOORREQ        data    36h
                     190    
                     191    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               192    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     193                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     194                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     195    ;osetrenie vektorov preruseni
0000                 196            org     0000h           ; adresa odkial startuje program po resete
0000 020033          197            ljmp    START           ; skok na zaciatok kodu programu
                     198                  
0033                 199            org     0033h           ; od tejto adresy sa zacina kod programu
0033                 200    START:
0033                 201    RESET:  
                     202            ; riadiace signaly do pasivnej urovne 
0033 D2B6            203            setb    WRNOT
0035 D2B7            204            setb    RDNOT
0037 753300          205            mov     STOPTIMER, #0
003A 758140          206            mov     SP, #STACK
                     207    
                     208            ; pockame si na inicializaciu obvodov 8255  
003D 7900            209            mov     R1, #0 
003F 7AFF            210            mov     R2, #0ffh
0041 D9FE            211            djnz    R1, $
0043 DAFC            212            djnz    R2, $-2
                     213            
                     214            ; teraz ich mozeme nastavit
0045 75809B          215            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          216            mov     p2, #i8255INCW
004B C2B6            217            clr     WRNOT
004D 00              218            nop
004E 00              219            nop
004F 00              220            nop
0050 00              221            nop
0051 D2B6            222            setb    WRNOT
0053 758080          223            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          224            mov     p2, #i8255OUTCW
0059 C2B6            225            clr     WRNOT
005B 00              226            nop
005C 00              227            nop
005D 00              228            nop
005E 00              229            nop
005F D2B6            230            setb    WRNOT
VYTAH/ORI.D                                                                                                  PAGE 5

                     231            
                     232 +1         _BP_
0061 C2B3            233 +1         clr     P3.3
0063 D2AA            234 +1         setb    EX1
0065 00              235 +1         nop
0066 00              236 +1         nop
                     238    
                     239            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0067 752800          240            mov     INPORTA, #0
006A 75211E          241            mov     INPORTB, #01eh      ; vsetky clonky pasivne
006D 752200          242            mov     INPORTC, #0
0070 75231E          243            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0073 7524F0          244            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0076 7525FF          245            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0079 D218            246            setb    KS
007B 1204DB          247            call    WRITEPORTS          ; zapis novu informaciu
                     248    ;;;;;;;;
                     249    
007E 752300          250            mov     OUTPORTA, #0
0081 752400          251            mov     OUTPORTB, #0
0084 752500          252            mov     OUTPORTC, #0
0087 1204DB          253            call    WRITEPORTS          ; zapis novu informaciu
                     254    
008A 752800          255            mov     INPORTA, #0
008D 752100          256            mov     INPORTB, #0         
0090 752200          257            mov     INPORTC, #0
0093 120496          258            call    READPORTS           ; prvotne nacitanie udajov
                     259    
0096                 260    CALIB:
                     261            ;kalibracia vytahu podla dolnej porovnavacej clonky
0096 120496          262            lcall   READPORTS                   ; precitaj, co je na portoch
0099 300C11          263            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
009C D221            264            setb    DOWN                        ; inak pod dole
009E D222            265            setb    FAST                        ; a rychlo
00A0 C223            266            clr     SLOW                        ;
00A2 1204DB          267            lcall   WRITEPORTS                  ; zapis informaciu 
00A5                 268    CALIBLOOP:
00A5 120496          269            lcall   READPORTS                   ; 
00A8 300C02          270            jnb     SKRD, CALIBEND              ; ak sme dole, konci
                     271            ;jnb     MB2, CALIBEND               ; ak sme na poschodi, konci
00AB 80F8            272            jmp     CALIBLOOP
00AD                 273    CALIBEND:
00AD 753600          274            mov     FLOORREQ, #0                                
00B0 C222            275            clr     FAST                        ; stojime
00B2 C221            276            clr     DOWN                        ;
00B4 D224            277            setb    FLED1
00B6 1204DB          278            lcall   WRITEPORTS                  ; zapis informaciu
                     279 +1         _BP_
00B9 C2B3            280 +1         clr     P3.3
00BB D2AA            281 +1         setb    EX1
00BD 00              282 +1         nop
00BE 00              283 +1         nop
00BF                 285    MAIN:
                     286    
                     287    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     288    ; ****************************************************************************
VYTAH/ORI                                                                                                     PAGE 6

                     289    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     290    ; ----------------------------------------------------------------------------
                     291    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     292    ; ----------------------------------------------------------------------------
                     293    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     294    ; ****************************************************************************
                     295    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     296    ; ----------------------------------------------------------------------------
                     297    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     298    ; ----------------------------------------------------------------------------
                     299    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     300    ; ****************************************************************************
                     301    ; POSITION
                     302    ; ****************************************************************************
                     303    
                     304    
                     305    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     306    
00BF                 307    FLOOR1:
                     308 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00BF C22F            309 +1         clr     LEDU            
00C1 C22E            310 +1         clr     LEDD 
00C3 C224            311 +1         clr     FLED1             
00C5 C225            312 +1         clr     FLED2                
00C7 C226            313 +1         clr     FLED3           
00C9 C227            314 +1         clr     FLED4           
00CB D224            315 +1         setb    FLED1
00CD 1204DB          316 +1         lcall   WRITEPORTS
00D0 120485          318            lcall   WAITFORTIMER    ; simulacia TIMERu
00D3 120496          319    F1S:    lcall   READPORTS     ;-; nacitanie dat
00D6 C219            320            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00D8 1204DB          321            lcall   WRITEPORTS      ;
00DB E528            322            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
00DD 541C            323            anl     A, #00011100b ;-;
00DF 60F2            324            jz      F1S           ;-; ak nie, opakuj
00E1 D220            325            setb    UP              ; rychly pohyb hore
00E3 D222            326            setb    FAST            ; 
00E5 C223            327            clr     SLOW            ;
00E7 1204DB          328            lcall   WRITEPORTS      ; 
00EA 0200ED          329            jmp     UP1           ;-; prejdi do stavu UP1
00ED                 330    UP1:
                     331 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00ED C22F            332 +1         clr     LEDU            
00EF C22E            333 +1         clr     LEDD 
00F1 C224            334 +1         clr     FLED1             
00F3 C225            335 +1         clr     FLED2                
00F5 C226            336 +1         clr     FLED3           
00F7 C227            337 +1         clr     FLED4           
00F9 D224            338 +1         setb    FLED1
00FB 1204DB          339 +1         lcall   WRITEPORTS
00FE 120496          341    UP1A:   lcall   READPORTS       ; nacitanie dat
                     342 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0101 200B02          343 +1         jb      SKRH, $+5
0104 02046A          344 +1         ljmp    ERR_SKRH
VYTAH/ORIUD*'©42'©4                                                                                          PAGE 7

0107 00              345 +1         nop
0108 200AF3          347            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
010B 120496          348            lcall   READPORTS       ; ak ano, sme z nej uz prec?
010E 300AFA          349            jnb     MB2, $-3        ;       
0111 D22E            350            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0113 1204DB          351            lcall   WRITEPORTS      ;
0116 020119          352            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0119                 353    UP1_MB2:
0119 120496          354            lcall   READPORTS       ; nacitanie dat
                     355 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
011C 200B02          356 +1         jb      SKRH, $+5
011F 02046A          357 +1         ljmp    ERR_SKRH
0122 00              358 +1         nop
0123 200AF3          360            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0126 D22F            361            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0128 1204DB          362            lcall   WRITEPORTS      ;   
012B E528            363            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
012D 5404            364            anl     A, #00000100b ;-;
012F 600A            365            jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1
0131 D223            366            setb    SLOW            ;       Ak ano, spomalme
0133 C222            367            clr     FAST            ; 
0135 1204DB          368            lcall   WRITEPORTS      ;         
0138 02013B          369            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
013B                 370    UP1_MB1:
013B 120496          371            lcall   READPORTS       ; nacitanie dat
                     372 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
013E 200B02          373 +1         jb      SKRH, $+5
0141 02046A          374 +1         ljmp    ERR_SKRH
0144 00              375 +1         nop
0145 2009F3          377            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
0148 E528            378            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
014A 5404            379            anl     A, #00000100b ;-;
014C 606D            380            jz      UP2           ;-; Ak nie, chod do stavu UP2
014E C220            381            clr     UP              ; zastav motor
0150 D23A            382            setb    UPOld           ;       (a zalohuj) 
0152 C23B            383            clr     DOWNOld         ;       (a zalohuj)
0154 C222            384            clr     FAST            ; 
0156 1204DB          385            lcall   WRITEPORTS      ; 
0159 02015C          386            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     387    
                     388    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     389    
015C                 390    FLOOR2:
                     391 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
015C C22F            392 +1         clr     LEDU            
015E C22E            393 +1         clr     LEDD 
0160 C224            394 +1         clr     FLED1             
0162 C225            395 +1         clr     FLED2                
0164 C226            396 +1         clr     FLED3           
0166 C227            397 +1         clr     FLED4           
0168 D225            398 +1         setb    FLED2
016A 1204DB          399 +1         lcall   WRITEPORTS
016D 120485          401            lcall   WAITFORTIMER    ; simulacia TIMERu
0170 120496          402    F2S:    lcall   READPORTS     ;-; nacitanie dat
0173 C21A            403            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0175 1204DB          404            lcall   WRITEPORTS      ;
VYTAH/ORIED>(©4                                                                                              PAGE 8

                     405            
0178 7418            406            mov     A, #00011000b ;-; Default predpokladam, ze mam namierene hore (na 3. a 4.)
017A 203A01          407            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
017D F4              408            cpl     A               ;       Ak nie, znegujeme
017E F5F0            409    F2OK:   mov     B, A            ; Masku dame do Bcka
                     410            
                     411            ; Pohyb v jednom smere (nevieme v ktorom)
0180 53F01A          412            anl     B, #00011010b  ;-; este ju kozmeticky upravime
0183 E528            413            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0185 55F0            414            anl     A, B            ; tu ju pouzijeme       
0187 7014            415            jnz     F2              ; nasli sme poschodie v tomto smere
                     416            ; Pohyb v opacnom smere (nevieme v ktorom)
0189 B23A            417            cpl     UPOld           ;  Znegujem stary posun
018B B23B            418            cpl     DOWNOld         ;  |
018D E5F0            419            mov     A, B            ;  Znegujeme masku
018F F4              420            cpl     A               ;  |
0190 F5F0            421            mov     B, A            ;  |
0192 53F01A          422            anl     B, #00011010b  ;-; este ju kozmeticky upravime
0195 E528            423            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
0197 55F0            424            anl     A, B            ; tu ju pouzijeme       
0199 7002            425            jnz     F2              ; nasli sme poschodie v tomto smere
                     426            
019B 80D3            427            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
019D 203A03          428    F2:     jb      UPOld, F2UP     ;   
01A0 0201AF          429            jmp     F2DOWN          ;
01A3 D220            430    F2UP:   setb    UP              ; rychly pohyb hore
01A5 D222            431            setb    FAST            ; 
01A7 C223            432            clr     SLOW            ;
01A9 1204DB          433            lcall   WRITEPORTS      ; 
01AC 0201BB          434            jmp     UP2           ;-; prejdi do stavu UP2    
01AF D221            435    F2DOWN: setb    DOWN            ; rychly pohyb hore
01B1 D222            436            setb    FAST            ; 
01B3 C223            437            clr     SLOW            ;
01B5 1204DB          438            lcall   WRITEPORTS      ; 
01B8 02022D          439            jmp     DOWN2         ;-; prejdi do stavu UP2    
                     440            
                     441                
01BB                 442    UP2:
                     443 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01BB C22F            444 +1         clr     LEDU            
01BD C22E            445 +1         clr     LEDD 
01BF C224            446 +1         clr     FLED1             
01C1 C225            447 +1         clr     FLED2                
01C3 C226            448 +1         clr     FLED3           
01C5 C227            449 +1         clr     FLED4           
01C7 D225            450 +1         setb    FLED2
01C9 1204DB          451 +1         lcall   WRITEPORTS
01CC 120496          453    UP2A:   lcall   READPORTS       ; nacitanie dat
                     454 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01CF 200B02          455 +1         jb      SKRH, $+5
01D2 02046A          456 +1         ljmp    ERR_SKRH
01D5 00              457 +1         nop
01D6 200AF3          459            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
01D9 120496          460            lcall   READPORTS       ; ak ano, sme z nej uz prec?
01DC 300AFA          461            jnb     MB2, $-3        ;       
VYTAH/ORI .DÖ(©4Þ(©4                                                                                          PAGE 9

01DF D22E            462            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
01E1 1204DB          463            lcall   WRITEPORTS      ;
01E4 0201E7          464            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
01E7                 465    UP2_MB2:
01E7 120496          466            lcall   READPORTS       ; nacitanie dat
                     467 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01EA 200B02          468 +1         jb      SKRH, $+5
01ED 02046A          469 +1         ljmp    ERR_SKRH
01F0 00              470 +1         nop
01F1 200AF3          472            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
01F4 D22F            473            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
01F6 1204DB          474            lcall   WRITEPORTS      ;
01F9 E528            475            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
01FB 5408            476            anl     A, #00001000b ;-;
01FD 600A            477            jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
01FF D223            478            setb    SLOW            ;       Ak ano, spomalme
0201 C222            479            clr     FAST            ; 
0203 1204DB          480            lcall   WRITEPORTS      ;
0206 020209          481            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0209                 482    UP2_MB1:
0209 120496          483            lcall   READPORTS       ; nacitanie dat
                     484 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
020C 200B02          485 +1         jb      SKRH, $+5
020F 02046A          486 +1         ljmp    ERR_SKRH
0212 00              487 +1         nop
0213 2009F3          489            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
0216 E528            490            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0218 5408            491            anl     A, #00001000b ;-;
021A 7003            492            jnz     U2_MB1C       ;-; Ak nie, chod do stavu UP3
021C 0202DF          493            ljmp    UP3             ; |
021F C220            494    U2_MB1C:clr     UP              ; zastav motor
0221 D23A            495            setb    UPOld           ;       (a zalohuj)
0223 C23B            496            clr     DOWNOld         ;       (a zalohuj)
0225 C222            497            clr     FAST            ; 
0227 1204DB          498            lcall   WRITEPORTS      ; 
022A 020280          499            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
022D                 500    DOWN2:
                     501 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
022D C22F            502 +1         clr     LEDU            
022F C22E            503 +1         clr     LEDD 
0231 C224            504 +1         clr     FLED1             
0233 C225            505 +1         clr     FLED2                
0235 C226            506 +1         clr     FLED3           
0237 C227            507 +1         clr     FLED4           
0239 D225            508 +1         setb    FLED2
023B 1204DB          509 +1         lcall   WRITEPORTS
023E 120496          511            lcall   READPORTS       ; nacitanie dat
0241 200AE9          512            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
0244 120496          513            lcall   READPORTS       ; ak ano, sme z nej uz prec?
0247 300AFA          514            jnb     MB2, $-3        ;       
024A D22F            515            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
024C 1204DB          516            lcall   WRITEPORTS      ;
024F 020252          517            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
0252                 518    DOWN2_MB2:
0252 120496          519            lcall   READPORTS       ; nacitanie dat
0255 200AFA          520            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0258 D22E            521            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
VYTAH/ORI *Dê)©4                                                                                              PAGE 10

025A 1204DB          522            lcall   WRITEPORTS      ;
025D E528            523            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
025F 5402            524            anl     A, #00000010b ;-;
0261 600A            525            jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0263 D223            526            setb    SLOW            ;       Ak ano, spomalme
0265 C222            527            clr     FAST            ; 
0267 1204DB          528            lcall   WRITEPORTS      ;
026A 02026D          529            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
026D                 530    DOWN2_MB1:    
026D 120496          531            lcall   READPORTS       ; nacitanie dat
0270 2009FA          532            jb      MB1, DOWN2_MB1;-; Sme na zastavovacej clonke?
0273 C221            533            clr     DOWN            ; zastav motor
0275 D23B            534            setb    DOWNOld         ;       (a zalohuj)
0277 C23A            535            clr     UPOld           ;       (a zalohuj)
0279 C222            536            clr     FAST            ; 
027B 1204DB          537            lcall   WRITEPORTS      ; 
027E 01BF            538            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                     539    
                     540    
                     541    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     542    
0280                 543    FLOOR3:
                     544 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0280 C22F            545 +1         clr     LEDU            
0282 C22E            546 +1         clr     LEDD 
0284 C224            547 +1         clr     FLED1             
0286 C225            548 +1         clr     FLED2                
0288 C226            549 +1         clr     FLED3           
028A C227            550 +1         clr     FLED4           
028C D226            551 +1         setb    FLED3
028E 1204DB          552 +1         lcall   WRITEPORTS
0291 120485          554            lcall   WAITFORTIMER    ; simulacia TIMERu
0294 120496          555    F3S:    lcall   READPORTS     ;-; nacitanie dat
0297 C21B            556            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0299 1204DB          557            lcall   WRITEPORTS      ;
                     558    
029C 7410            559            mov     A, #00010000b ;-; Default predpokladam, ze idem hore (na 4.)
029E 203A01          560            jb      UPOld, F3OK   ;-;   Je to pravda? Naozaj idem hore?
02A1 F4              561            cpl     A               ;       Ak nie, znegujeme
02A2 F5F0            562    F3OK:   mov     B, A            ; Masku dame do Bcka
                     563            
                     564            ; Pohyb v jednom smere (nevieme v ktorom)
02A4 53F016          565            anl     B, #00010110b  ;-; este ju kozmeticky upravime
02A7 E528            566            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
02A9 55F0            567            anl     A, B            ; tu ju pouzijeme       
02AB 7014            568            jnz     F3              ; nasli sme poschodie v tomto smere
                     569            ; Pohyb v opacnom smere (nevieme v ktorom)
02AD B23A            570            cpl     UPOld           ;  Znegujem stary posun
02AF B23B            571            cpl     DOWNOld         ;  |
02B1 E5F0            572            mov     A, B            ;  Znegujeme masku
02B3 F4              573            cpl     A               ;  |
02B4 F5F0            574            mov     B, A            ;  |
02B6 53F016          575            anl     B, #00010110b  ;-; este ju kozmeticky upravime
02B9 E528            576            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim
VYTAH/ORI 
D6*©4                                                                                              PAGE 11

02BB 55F0            577            anl     A, B            ; tu ju pouzijeme       
02BD 7002            578            jnz     F3              ; nasli sme poschodie v tomto smere
                     579            
02BF 80D3            580            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
02C1 203A03          581    F3:     jb      UPOld, F3UP     ;   
02C4 0202D3          582            jmp     F3DOWN          ;
02C7 D220            583    F3UP:   setb    UP              ; rychly pohyb hore
02C9 D222            584            setb    FAST            ; 
02CB C223            585            clr     SLOW            ;
02CD 1204DB          586            lcall   WRITEPORTS      ; 
02D0 0202DF          587            jmp     UP3           ;-; prejdi do stavu UP2    
02D3 D221            588    F3DOWN: setb    DOWN            ; rychly pohyb hore
02D5 D222            589            setb    FAST            ; 
02D7 C223            590            clr     SLOW            ;
02D9 1204DB          591            lcall   WRITEPORTS      ; 
02DC 020348          592            jmp     DOWN3         ;-; prejdi do stavu UP2    
                     593    
                     594            
                     595            
                     596            
                     597    ;        mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim
                     598    ;        anl     A, #00010000b ;-;
                     599    ;        jz      F3S           ;-; ak nie, opakuj
                     600    ;        setb    UP              ; rychly pohyb hore
                     601    ;        setb    FAST            ; 
                     602    ;        lcall   WRITEPORTS      ; 
                     603    ;        jmp     UP3           ;-; prejdi do stavu UP3        
02DF                 604    UP3:
                     605 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02DF C22F            606 +1         clr     LEDU            
02E1 C22E            607 +1         clr     LEDD 
02E3 C224            608 +1         clr     FLED1             
02E5 C225            609 +1         clr     FLED2                
02E7 C226            610 +1         clr     FLED3           
02E9 C227            611 +1         clr     FLED4           
02EB D226            612 +1         setb    FLED3
02ED 1204DB          613 +1         lcall   WRITEPORTS
02F0 120496          615    UP3A:   lcall   READPORTS       ; nacitanie dat
                     616 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02F3 200B02          617 +1         jb      SKRH, $+5
02F6 02046A          618 +1         ljmp    ERR_SKRH
02F9 00              619 +1         nop
02FA 200AF3          621            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
02FD 120496          622            lcall   READPORTS       ; ak ano, sme z nej uz prec?
0300 300AFA          623            jnb     MB2, $-3        ;       
0303 D22E            624            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0305 1204DB          625            lcall   WRITEPORTS      ;
0308 02030B          626            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
030B                 627    UP3_MB2:
030B 120496          628            lcall   READPORTS       ; nacitanie dat
                     629 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
030E 200B02          630 +1         jb      SKRH, $+5
0311 02046A          631 +1         ljmp    ERR_SKRH
0314 00              632 +1         nop
0315 200AF3          634            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0318 D22F            635            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
VYTAH/ORI jD*+©42+©4                                                                                          PAGE 12

031A 1204DB          636            lcall   WRITEPORTS      ;
031D E528            637            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
031F 5410            638            anl     A, #00010000b ;-;
0321 600A            639            jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
0323 D223            640            setb    SLOW            ;       Ak ano, spomalme
0325 C222            641            clr     FAST            ; 
0327 1204DB          642            lcall   WRITEPORTS      ;
032A 02032D          643            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
032D                 644    UP3_MB1:
032D 120496          645            lcall   READPORTS       ; nacitanie dat
                     646 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0330 200B02          647 +1         jb      SKRH, $+5
0333 02046A          648 +1         ljmp    ERR_SKRH
0336 00              649 +1         nop
0337 2009F3          651            jb      MB1, UP3_MB1  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
033A C220            652            clr     UP              ; zastav motor
033C D23A            653            setb    UPOld           ;       (a zalohuj)
033E C23B            654            clr     DOWNOld         ;       (a zalohuj)
0340 C222            655            clr     FAST            ; 
0342 1204DB          656            lcall   WRITEPORTS      ; 
0345 0203A4          657            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
0348                 658    DOWN3:
                     659 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0348 C22F            660 +1         clr     LEDU            
034A C22E            661 +1         clr     LEDD 
034C C224            662 +1         clr     FLED1             
034E C225            663 +1         clr     FLED2                
0350 C226            664 +1         clr     FLED3           
0352 C227            665 +1         clr     FLED4           
0354 D226            666 +1         setb    FLED3
0356 1204DB          667 +1         lcall   WRITEPORTS
0359 120496          669            lcall   READPORTS       ; nacitanie dat
035C 200AE9          670            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
035F 120496          671            lcall   READPORTS       ; ak ano, sme z nej uz prec?
0362 300AFA          672            jnb     MB2, $-3        ;       
0365 D22F            673            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0367 1204DB          674            lcall   WRITEPORTS      ;
036A 02036D          675            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
036D                 676    DOWN3_MB2:
036D 120496          677            lcall   READPORTS       ; nacitanie dat
0370 200AFA          678            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0373 D22E            679            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0375 1204DB          680            lcall   WRITEPORTS      ;
0378 E528            681            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
037A 5404            682            anl     A, #00000100b ;-;
037C 600A            683            jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
037E D223            684            setb    SLOW            ;       Ak ano, spomalme
0380 C222            685            clr     FAST            ; 
0382 1204DB          686            lcall   WRITEPORTS      ;
0385 020388          687            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
0388                 688    DOWN3_MB1:    
0388 120496          689            lcall   READPORTS       ; nacitanie dat
038B 2009FA          690            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
038E E528            691            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
0390 5404            692            anl     A, #00000100b ;-;
0392 7003            693            jnz     D3_MB1C         ; Ak nie, chod do stavu DOWN2
VYTAH/ORIdDâ+©4                                                                                              PAGE 13

0394 02022D          694            ljmp    DOWN2         ;-; |
0397 C221            695    D3_MB1C:clr     DOWN            ; zastav motor
0399 D23B            696            setb    DOWNOld         ;       (a zalohuj)
039B C23A            697            clr     UPOld           ;       (a zalohuj)
039D C222            698            clr     FAST            ; 
039F 1204DB          699            lcall   WRITEPORTS      ; 
03A2 215C            700            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                     701          
                     702            
                     703    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                     704    
03A4                 705    FLOOR4:
                     706 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03A4 C22F            707 +1         clr     LEDU            
03A6 C22E            708 +1         clr     LEDD 
03A8 C224            709 +1         clr     FLED1             
03AA C225            710 +1         clr     FLED2                
03AC C226            711 +1         clr     FLED3           
03AE C227            712 +1         clr     FLED4           
03B0 D227            713 +1         setb    FLED4
03B2 1204DB          714 +1         lcall   WRITEPORTS
03B5 120485          716            lcall   WAITFORTIMER    ; simulacia TIMERu
03B8 120496          717    F4S:    lcall   READPORTS     ;-; nacitanie dat
03BB C21C            718            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
03BD 1204DB          719            lcall   WRITEPORTS      ;
03C0 E528            720            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco menej ako poschodie na kto
                                                                               rom stojim
03C2 540E            721            anl     A, #00001110b ;-;
03C4 60F2            722            jz      F4S           ;-; ak nie, opakuj
03C6 D221            723            setb    DOWN            ; rychly pohyb dole
03C8 D222            724            setb    FAST            ;
03CA C223            725            clr     SLOW            ; 
03CC 1204DB          726            lcall   WRITEPORTS      ; 
03CF 0203D2          727            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
03D2                 728    DOWN4:
                     729 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03D2 C22F            730 +1         clr     LEDU            
03D4 C22E            731 +1         clr     LEDD 
03D6 C224            732 +1         clr     FLED1             
03D8 C225            733 +1         clr     FLED2                
03DA C226            734 +1         clr     FLED3           
03DC C227            735 +1         clr     FLED4           
03DE D227            736 +1         setb    FLED4
03E0 1204DB          737 +1         lcall   WRITEPORTS
03E3 120496          739            lcall   READPORTS       ; nacitanie dat
03E6 200AE9          740            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
03E9 120496          741            lcall   READPORTS       ; ak ano, sme z nej uz prec?
03EC 300AFA          742            jnb     MB2, $-3        ;       
03EF D22F            743            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03F1 1204DB          744            lcall   WRITEPORTS      ;
03F4 0203F7          745            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
03F7                 746    DOWN4_MB2:
03F7 120496          747            lcall   READPORTS       ; nacitanie dat
03FA 200AFA          748            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
03FD D22E            749            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
VYTAH/ORI ODz,©4                                                                                              PAGE 14

03FF 1204DB          750            lcall   WRITEPORTS      ;
0402 E528            751            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0404 5408            752            anl     A, #00001000b ;-;
0406 600A            753            jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
0408 D223            754            setb    SLOW            ;       Ak ano, spomalme
040A C222            755            clr     FAST            ; 
040C 1204DB          756            lcall   WRITEPORTS      ;
040F 020412          757            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
0412                 758    DOWN4_MB1:    
0412 120496          759            lcall   READPORTS       ; nacitanie dat
0415 2009FA          760            jb      MB1, DOWN4_MB1;-; Sme na zastavovacej clonke?
0418 E528            761            mov     A, INPORTA      ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene?
041A 5408            762            anl     A, #00001000b ;-;
041C 7003            763            jnz     D4_MB1C         ; Ak nie, chod do stavu DOWN3
041E 020348          764            ljmp    DOWN3         ;-; |
0421 C221            765    D4_MB1C:clr     DOWN            ; zastav motor
0423 D23B            766            setb    DOWNOld         ;       (a zalohuj)
0425 C23A            767            clr     UPOld           ;       (a zalohuj)
0427 C222            768            clr     FAST            ; 
0429 1204DB          769            lcall   WRITEPORTS      ; 
042C 4180            770            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                     771                    
                     772      
042E                 773    ERR_1SPOM_C: 
042E C220            774            clr     UP              ; zastav motor
0430 C221            775            clr     DOWN            ; 
0432 1204DB          776            lcall   WRITEPORTS      ; 
                     777 +1         _BP_
0435 C2B3            778 +1         clr     P3.3
0437 D2AA            779 +1         setb    EX1
0439 00              780 +1         nop
043A 00              781 +1         nop
043B 00              783            nop
043C 00              784            nop 
                     785            
043D                 786    ERR_2SPOM_C: 
043D C220            787            clr     UP              ; zastav motor
043F C221            788            clr     DOWN            ; 
0441 1204DB          789            lcall   WRITEPORTS      ; 
                     790 +1         _BP_
0444 C2B3            791 +1         clr     P3.3
0446 D2AA            792 +1         setb    EX1
0448 00              793 +1         nop
0449 00              794 +1         nop
044A 00              796            nop
044B 00              797            nop 
                     798            
044C                 799    ERR_ZAST_C: 
044C C220            800            clr     UP              ; zastav motor
044E C221            801            clr     DOWN            ; 
0450 1204DB          802            lcall   WRITEPORTS      ; 
                     803 +1         _BP_
0453 C2B3            804 +1         clr     P3.3
0455 D2AA            805 +1         setb    EX1
0457 00              806 +1         nop
0458 00              807 +1         nop
0459 00              809            nop
045A 00              810            nop 
VYTAH/ORI(D                                                                                                  PAGE 15

                     811            
045B                 812    ERR_SKRD: 
045B C220            813            clr     UP              ; zastav motor
045D C221            814            clr     DOWN            ; 
045F 1204DB          815            lcall   WRITEPORTS      ; 
                     816 +1         _BP_
0462 C2B3            817 +1         clr     P3.3
0464 D2AA            818 +1         setb    EX1
0466 00              819 +1         nop
0467 00              820 +1         nop
0468 00              822            nop
0469 00              823            nop    
                     824            
046A                 825    ERR_SKRH: 
046A C220            826            clr     UP              ; zastav motor
046C C221            827            clr     DOWN            ; 
046E 1204DB          828            lcall   WRITEPORTS      ; 
                     829 +1         _BP_
0471 C2B3            830 +1         clr     P3.3
0473 D2AA            831 +1         setb    EX1
0475 00              832 +1         nop
0476 00              833 +1         nop
0477 00              835            nop
0478 00              836            nop             
                     837                    
                     838                    
0479                 839    ENDPROG:
0479 D218            840            setb    KS
047B 1204DB          841            call    WRITEPORTS                ; zapis novu informaciu
                     842 +1         _BP_
047E C2B3            843 +1         clr     P3.3
0480 D2AA            844 +1         setb    EX1
0482 00              845 +1         nop
0483 00              846 +1         nop
0484 22              848            ret
                     849    
                     850    
                     851    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     852    ; WAITFORTIMER
                     853    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                     854    ; bude timer)
                     855    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0485                 856    WAITFORTIMER:
0485 D22C            857            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
0487 1204DB          858            lcall   WRITEPORTS                  ;
048A 120496          859    WAIT:   lcall   READPORTS                   ; 
048D 3013F5          860            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0490 C22C            861            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
0492 1204DB          862            lcall   WRITEPORTS
0495 22              863            ret
                     864    
                     865    
                     866    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     867    ; READPORTS
                     868    ; precita nove hodnoty na portoch
                     869    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0496                 870    READPORTS:
0496 75A080          871            mov     p2, #i8255INA       ; citaj data z portu A
VYTAH/ORISiD                                                                                                  PAGE 16

0499 75803F          872            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
049C C2B7            873            clr     RDNOT
049E 00              874            nop
049F 00              875            nop
04A0 00              876            nop
04A1 00              877            nop
04A2 858028          878            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
04A5 D2B7            879            setb    RDNOT
                     880            
04A7 75A081          881            mov     p2, #i8255INB       ; citaj data z portu B
04AA 7580FE          882            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
04AD C2B7            883            clr     RDNOT
04AF 00              884            nop
04B0 00              885            nop
04B1 00              886            nop
04B2 00              887            nop
04B3 858021          888            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
04B6 D2B7            889            setb    RDNOT
                     890    
04B8 75A082          891            mov     p2, #i8255INC       ; citaj data z portu C
04BB 75803F          892            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
04BE C2B7            893            clr     RDNOT
04C0 00              894            nop
04C1 00              895            nop
04C2 00              896            nop
04C3 00              897            nop
04C4 858022          898            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
04C7 D2B7            899            setb    RDNOT
04C9 00              900            nop
04CA 00              901            nop
04CB 00              902            nop
04CC 00              903            nop
04CD 00              904            nop
04CE 00              905            nop
04CF 00              906            nop
04D0 00              907            nop
04D1 E528            908            mov     A, INPORTA
04D3 541E            909            anl     A, #00011110b
04D5 4223            910            orl     OUTPORTA, A
04D7 1204DB          911            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                     912            
04DA 22              913            ret
                     914            
                     915    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     916    ; WRITEPORTS
                     917    ; spravi zalohu vystupnych registrov a posle data von
                     918    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
04DB                 919    WRITEPORTS:
04DB 852380          920            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
04DE 75A0C0          921            mov     p2, #i8255OUTA
04E1 C2B6            922            clr     WRNOT
04E3 00              923            nop
04E4 00              924            nop
04E5 00              925            nop
04E6 00              926            nop
04E7 D2B6            927            setb    WRNOT
                     928            
VYTAH/ORI$9D                                                                                                  PAGE 17

04E9 852480          929            mov     p0, OUTPORTB        ; potom port B
04EC 75A0C1          930            mov     p2, #i8255OUTB
04EF C2B6            931            clr     WRNOT
04F1 00              932            nop
04F2 00              933            nop
04F3 00              934            nop
04F4 00              935            nop
04F5 D2B6            936            setb    WRNOT
                     937    
04F7 852580          938            mov     p0, OUTPORTC        ; a nakoniec port C
04FA 75A0C2          939            mov     p2, #i8255OUTC
04FD C2B6            940            clr     WRNOT
04FF 00              941            nop
0500 00              942            nop
0501 00              943            nop
0502 00              944            nop
0503 D2B6            945            setb    WRNOT
0505 00              946            nop
0506 00              947            nop
0507 00              948            nop
0508 00              949            nop
0509 00              950            nop
050A 00              951            nop
050B 00              952            nop
050C 00              953            nop
050D 22              954            ret
                     955    
                     956    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                     957    
050E 0D0A5269        958    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0512 61646961   
0516 63692073   
051A 79737465   
051E 6D206A65   
0522 20696E69   
0526 6369616C   
052A 697A6F76   
052E 616E792E   
0532 0D0A00     
0535 52696164        959    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
0539 69616369   
053D 20737973   
0541 74656D20   
0545 6A652072   
0549 65696E69   
054D 6369616C   
0551 697A6F76   
0555 616E7920   
0559 706F2073   
055D 746C6163   
0561 656E6920   
0565 746C6163   
0569 69646C61   
056D 2053544F   
0571 502E0D0A   
0575 00         
0576 4B616C69        960    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
VYTAH/ORIpD                                                                                                  PAGE 18

057A 62726163   
057E 69612076   
0582 79746168   
0586 75206A65   
058A 20756B6F   
058E 6E63656E   
0592 612E0D0A   
0596 00         
                     961    
----                 962            DSEG
0040                 963            org     40h
0040                 964    STACK:  DS      10h
                     965    
                     966    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 19

B. . . . . . . . . . . . . . . .  D ADDR  00F0H  PREDEFINED  
BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0096H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00ADH  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A5H  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D3_MB1C. . . . . . . . . . . . .  C ADDR  0397H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  0421H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  022DH  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  026DH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  0252H  
DOWN3. . . . . . . . . . . . . .  C ADDR  0348H  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  0388H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  036DH  
DOWN4. . . . . . . . . . . . . .  C ADDR  03D2H  
VYTAH/ORI                                                                                                     PAGE 20

DOWN4_MB1. . . . . . . . . . . .  C ADDR  0412H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  03F7H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  NOT USED  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  NOT USED  
ENDPROG. . . . . . . . . . . . .  C ADDR  0479H  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  042EH  NOT USED  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  043DH  NOT USED  
ERR_SKRD . . . . . . . . . . . .  C ADDR  045BH  NOT USED  
ERR_SKRH . . . . . . . . . . . .  C ADDR  046AH  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  044CH  NOT USED  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1S. . . . . . . . . . . . . . .  C ADDR  00D3H  
F2 . . . . . . . . . . . . . . .  C ADDR  019DH  
F2DOWN . . . . . . . . . . . . .  C ADDR  01AFH  
F2OK . . . . . . . . . . . . . .  C ADDR  017EH  
F2S. . . . . . . . . . . . . . .  C ADDR  0170H  
F2UP . . . . . . . . . . . . . .  C ADDR  01A3H  
F3 . . . . . . . . . . . . . . .  C ADDR  02C1H  
F3DOWN . . . . . . . . . . . . .  C ADDR  02D3H  
F3OK . . . . . . . . . . . . . .  C ADDR  02A2H  
F3S. . . . . . . . . . . . . . .  C ADDR  0294H  
F3UP . . . . . . . . . . . . . .  C ADDR  02C7H  
F4S. . . . . . . . . . . . . . .  C ADDR  03B8H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00BFH  
FLOOR2 . . . . . . . . . . . . .  C ADDR  015CH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0280H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  03A4H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00BFH  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
VYTAH/ORI                                                                                                     PAGE 21

OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  NOT USED  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  NOT USED  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  NOT USED  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  NOT USED  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  NOT USED  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  NOT USED  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  NOT USED  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  NOT USED  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  NOT USED  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  NOT USED  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  0496H  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0576H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  050EH  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  0535H  NOT USED  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U2_MB1C. . . . . . . . . . . . .  C ADDR  021FH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  00EDH  
UP1A . . . . . . . . . . . . . .  C ADDR  00FEH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  013BH  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0119H  
UP2. . . . . . . . . . . . . . .  C ADDR  01BBH  
UP2A . . . . . . . . . . . . . .  C ADDR  01CCH  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0209H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  01E7H  
UP3. . . . . . . . . . . . . . .  C ADDR  02DFH  
UP3A . . . . . . . . . . . . . .  C ADDR  02F0H  
VYTAH/ORI                                                                                                     PAGE 22

UP3_MB1. . . . . . . . . . . . .  C ADDR  032DH  
UP3_MB2. . . . . . . . . . . . .  C ADDR  030BH  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  048AH  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  0485H  
WRITEPORTS . . . . . . . . . . .  C ADDR  04DBH  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
