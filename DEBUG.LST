VYTAH/ORI                                                                                                     PAGE 1

                       1    ; TODO: 
                       2    ; Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    
                       7    
                       8    $MOD51
                       9    $DEBUG
                      10    
                =1    11    $include (lift.inc)
                =1    12    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    13    i8255INA        equ     080h
  0081          =1    14    i8255INB        equ     081h
  0082          =1    15    i8255INC        equ     082h
  0083          =1    16    i8255INCW       equ     083h
  00C0          =1    17    i8255OUTA       equ     0c0h
  00C1          =1    18    i8255OUTB       equ     0c1h
  00C2          =1    19    i8255OUTC       equ     0c2h
  00C3          =1    20    i8255OUTCW      equ     0c3h
                =1    21    
  0028          =1    22    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    23    INPORTB         data    21h
  0022          =1    24    INPORTC         data    22h
  0023          =1    25    OUTPORTA        data    23h
  0024          =1    26    OUTPORTB        data    24h
  0025          =1    27    OUTPORTC        data    25h
  0026          =1    28    INPORTBold      data    26h
  0027          =1    29    CTRLREG         data    27h
                =1    30    
  0030          =1    31    POSITION        data    30h
  0031          =1    32    LOWEST          data    31h
  0032          =1    33    HIGHEST         data    32h
  0033          =1    34    STOPTIMER       data    33h
  0034          =1    35    OUTPORTBold     data    34h
                =1    36    
  0040          =1    37    STOPNOT         bit     INPORTA.0
  0041          =1    38    PKI1            bit     INPORTA.1
  0042          =1    39    PKI2            bit     INPORTA.2
  0043          =1    40    PKI3            bit     INPORTA.3
  0044          =1    41    PKI4            bit     INPORTA.4
  0045          =1    42    DOORCLSD        bit     INPORTA.5 
                =1    43    
  0009          =1    44    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    45    MB2             bit     INPORTB.2
  000B          =1    46    SKRH            bit     INPORTB.3
  000C          =1    47    SKRD            bit     INPORTB.4
  000D          =1    48    DP              bit     INPORTB.5
  000E          =1    49    DPZK            bit     INPORTB.6
  000F          =1    50    DPK             bit     INPORTB.7
                =1    51    
  0031          =1    52    MB1old          bit     INPORTBold.1
  0032          =1    53    MB2old          bit     INPORTBold.2
  0033          =1    54    SKRHold         bit     INPORTBold.3
  0034          =1    55    SKRDold         bit     INPORTBold.4
                =1    56    
  0010          =1    57    PI1             bit     INPORTC.0
  0011          =1    58    PI2D            bit     INPORTC.1
VYTAH/ORI/D                                                                                                  PAGE 2

  0012          =1    59    PI2U            bit     INPORTC.2
  0013          =1    60    PI3D            bit     INPORTC.3
  0014          =1    61    PI3U            bit     INPORTC.4
  0015          =1    62    PI4             bit     INPORTC.5
                =1    63    
  0018          =1    64    KS              bit     OUTPORTA.0
  0019          =1    65    PKO1            bit     OUTPORTA.1
  001A          =1    66    PKO2            bit     OUTPORTA.2
  001B          =1    67    PKO3            bit     OUTPORTA.3
  001C          =1    68    PKO4            bit     OUTPORTA.4
                =1    69    
  0020          =1    70    UP              bit     OUTPORTB.0
  0021          =1    71    DOWN            bit     OUTPORTB.1
  0022          =1    72    FAST            bit     OUTPORTB.2
  0023          =1    73    SLOW            bit     OUTPORTB.3
  0024          =1    74    FLED1           bit     OUTPORTB.4
  0025          =1    75    FLED2           bit     OUTPORTB.5
  0026          =1    76    FLED3           bit     OUTPORTB.6
  0027          =1    77    FLED4           bit     OUTPORTB.7
                =1    78    
  0028          =1    79    PO1             bit     OUTPORTC.0
  0029          =1    80    PO2D            bit     OUTPORTC.1
  002A          =1    81    PO2U            bit     OUTPORTC.2
  002B          =1    82    PO3D            bit     OUTPORTC.3
  002C          =1    83    PO3U            bit     OUTPORTC.4
  002D          =1    84    PO4             bit     OUTPORTC.5
  002E          =1    85    LEDD            bit     OUTPORTC.6
  002F          =1    86    LEDU            bit     OUTPORTC.7
                =1    87    
  0038          =1    88    CANGO           bit     CTRLREG.0
  0039          =1    89    DOORCLSDold     bit     CTRLREG.1
  003A          =1    90    UPold           bit     CTRLREG.2
  003B          =1    91    DOWNold         bit     CTRLREG.3
  003C          =1    92    FASTold         bit     CTRLREG.4
  003D          =1    93    SLOWold         bit     CTRLREG.5
                =1    94    
  00B6          =1    95    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    96    RDNOT           bit     0b7h        ; p3.7
                =1    97    
                =1    98    ; bitove masky
                =1    99    ; 8255OUT 
                =1   100    ; port A
  0001          =1   101    bmKS              equ    00000001b
  0002          =1   102    bmPKO1            equ    00000010b
  0004          =1   103    bmPKO2            equ    00000100b
  0008          =1   104    bmPKO3            equ    00001000b
  0010          =1   105    bmPKO4            equ    00010000b
                =1   106    
                =1   107    ; port B
  0001          =1   108    bmUP              equ    00000001b
  0002          =1   109    bmDOWN            equ    00000010b
  0004          =1   110    bmFAST            equ    00000100b
  0008          =1   111    bmSLOW            equ    00001000b
  0010          =1   112    bmFLED1           equ    00010000b
  0020          =1   113    bmFLED2           equ    00100000b
  0040          =1   114    bmFLED3           equ    01000000b
  0080          =1   115    bmFLED4           equ    10000000b
                =1   116    
VYTAH/ORI                                                                                                     PAGE 3

                =1   117    ; port C
  0001          =1   118    bmPO1             equ    00000001b
  0002          =1   119    bmPO2D            equ    00000010b
  0004          =1   120    bmPO2U            equ    00000100b
  0008          =1   121    bmPO3D            equ    00001000b
  0010          =1   122    bmPO3U            equ    00010000b
  0020          =1   123    bmPO4             equ    00100000b
  0040          =1   124    bmLEDD            equ    01000000b
  0080          =1   125    bmLEDU            equ    10000000b
                =1   126    
                =1   127    ; 8255IN
                =1   128    ; port A
  0001          =1   129    bmSTOP            equ    00000001b
  0002          =1   130    bmPKI1            equ    00000010b
  0004          =1   131    bmPKI2            equ    00000100b
  0008          =1   132    bmPKI3            equ    00001000b
  0010          =1   133    bmPKI4            equ    00010000b
  0020          =1   134    bmDOORCLSD        equ    00100000b
                =1   135    
                =1   136    ; port B
  0002          =1   137    bmMB1I            equ    00000010b
  0004          =1   138    bmMB2I            equ    00000100b
  0008          =1   139    bmSKRHI           equ    00001000b
  0010          =1   140    bmSKRHD           equ    00010000b
  0020          =1   141    bmDPI             equ    00100000b
  0040          =1   142    bmDPZKI           equ    01000000b
  0080          =1   143    bmDPKI            equ    10000000b
                =1   144    
                =1   145    ; port C
  0001          =1   146    bmPI1             equ    00000001b
  0002          =1   147    bmPI2D            equ    00000010b
  0004          =1   148    bmPI2U            equ    00000100b
  0008          =1   149    bmPI3D            equ    00001000b
  0010          =1   150    bmPI3U            equ    00010000b
  0020          =1   151    bmPI4             equ    00100000b
                =1   152    
                     153    
                     154    _BP_    MACRO 
                     155            clr     P3.3
                     156            setb    EX1
                     157            nop
                     158            nop
                     159    ENDM
                     160    
                     161    LJZ     MACRO   NAVESTIE
                     162            jnz     $+5
                     163            ljmp    NAVESTIE
                     164            nop
                     165    ENDM
                     166    
                     167    LJNZ    MACRO   NAVESTIE
                     168            jz      $+5
                     169            ljmp    NAVESTIE
                     170            nop
                     171    ENDM
                     172    
                     173    LJB     MACRO   TESTBIT, NAVESTIE
                     174            jnb     TESTBIT, $+6
VYTAH/ORI/D                                                                                                  PAGE 4

                     175            ljmp    NAVESTIE
                     176            nop
                     177    ENDM
                     178    
                     179    LJNB    MACRO   TESTBIT, NAVESTIE
                     180            jb      TESTBIT, $+6
                     181            ljmp    NAVESTIE
                     182            nop
                     183    ENDM
                     184    
                     185    ZAKMITC MACRO   TYPCLONKY
                     186            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
                     187            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     188            jnb     TYPCLONKY, $-3  ; 
                     189            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     190    ENDM
                     191    
                     192    ZASTAV  MACRO  C_POSCH, SMER
                     193                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     194            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     195            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     196            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine?
                     197            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     198            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
                     199            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     200            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     201    ENDM
                     202    
                     203    POLOHA_LED  MACRO  POLOHA
                     204            clr     LEDU            
                     205            clr     LEDD 
                     206            clr     FLED1             
                     207            clr     FLED2                
                     208            clr     FLED3           
                     209            clr     FLED4           
                     210            setb    FLED&POLOHA
                     211            lcall   WRITEPORTS
                     212    ENDM
                     213    
  0036               214    FLOORREQ        data    36h
                     215    
                     216    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               217    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     218                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     219                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     220    ;osetrenie vektorov preruseni
0000                 221            org     0000h           ; adresa odkial startuje program po resete
0000 020033          222            ljmp    START           ; skok na zaciatok kodu programu
                     223                  
0033                 224            org     0033h           ; od tejto adresy sa zacina kod programu
VYTAH/ORI                                                                                                    PAGE 5

0033                 225    START:
0033                 226    RESET:  
                     227            ; riadiace signaly do pasivnej urovne 
0033 D2B6            228            setb    WRNOT
0035 D2B7            229            setb    RDNOT
0037 753300          230            mov     STOPTIMER, #0
003A 758140          231            mov     SP, #STACK
                     232    
                     233            ; pockame si na inicializaciu obvodov 8255  
003D 7900            234            mov     R1, #0 
003F 7AFF            235            mov     R2, #0ffh
0041 D9FE            236            djnz    R1, $
0043 DAFC            237            djnz    R2, $-2
                     238            
                     239            ; teraz ich mozeme nastavit
0045 75809B          240            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          241            mov     p2, #i8255INCW
004B C2B6            242            clr     WRNOT
004D 00              243            nop
004E 00              244            nop
004F 00              245            nop
0050 00              246            nop
0051 D2B6            247            setb    WRNOT
0053 758080          248            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          249            mov     p2, #i8255OUTCW
0059 C2B6            250            clr     WRNOT
005B 00              251            nop
005C 00              252            nop
005D 00              253            nop
005E 00              254            nop
005F D2B6            255            setb    WRNOT
                     256            
                     257 +1         _BP_
0061 C2B3            258 +1         clr     P3.3
0063 D2AA            259 +1         setb    EX1
0065 00              260 +1         nop
0066 00              261 +1         nop
                     263    
                     264            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0067 752800          265            mov     INPORTA, #0
006A 75211E          266            mov     INPORTB, #01eh      ; vsetky clonky pasivne
006D 752200          267            mov     INPORTC, #0
0070 75231E          268            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0073 7524F0          269            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0076 7525FF          270            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0079 D218            271            setb    KS
007B 1206D9          272            call    WRITEPORTS          ; zapis novu informaciu
                     273    ;;;;;;;;
                     274    
007E 752300          275            mov     OUTPORTA, #0
0081 752400          276            mov     OUTPORTB, #0
0084 752500          277            mov     OUTPORTC, #0
0087 1206D9          278            call    WRITEPORTS          ; zapis novu informaciu
                     279    
008A 752800          280            mov     INPORTA, #0
008D 752100          281            mov     INPORTB, #0         
0090 752200          282            mov     INPORTC, #0
VYTAH/ORI$cD                                                                                                  PAGE 6

0093 12068B          283            call    READPORTS           ; prvotne nacitanie udajov
                     284    
0096                 285    CALIB:
                     286            ;kalibracia vytahu podla dolnej porovnavacej clonky
0096 12068B          287            lcall   READPORTS                   ; precitaj, co je na portoch
0099 300C11          288            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
009C D221            289            setb    DOWN                        ; inak pod dole
009E D222            290            setb    FAST                        ; a rychlo
00A0 C223            291            clr     SLOW                        ;
00A2 1206D9          292            lcall   WRITEPORTS                  ; zapis informaciu 
00A5                 293    CALIBLOOP:
00A5 12068B          294            lcall   READPORTS                   ; 
00A8 300C02          295            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00AB 80F8            296            jmp     CALIBLOOP
00AD                 297    CALIBEND:                              
00AD C222            298            clr     FAST                        ; zastavime v tomto smere
00AF C221            299            clr     DOWN                        ;
00B1 D223            300            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00B3 D220            301            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00B5 1206D9          302            lcall   WRITEPORTS 
00B8                 303    CALIBEND2:
00B8 12068B          304            lcall   READPORTS                   ; 
00BB 2009FA          305            jb      MB1, CALIBEND2              ; 
00BE C223            306            clr     SLOW                        ; A teraz sme uz naozaj spravne
00C0 C220            307            clr     UP                          ; 
00C2 D224            308            setb    FLED1
00C4 1206D9          309            lcall   WRITEPORTS                  ; zapis informaciu
                     310    ;        _BP_
00C7                 311    MAIN:
                     312    
                     313    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     314    ; ****************************************************************************
                     315    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     316    ; ----------------------------------------------------------------------------
                     317    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     318    ; ----------------------------------------------------------------------------
                     319    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     320    ; ****************************************************************************
                     321    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     322    ; ----------------------------------------------------------------------------
                     323    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     324    ; ----------------------------------------------------------------------------
                     325    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     326    ; ****************************************************************************
                     327    ; POSITION
                     328    ; ****************************************************************************
                     329    
                     330    
                     331    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     332    
00C7                 333    FLOOR1:
                     334 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C7 C22F            335 +1         clr     LEDU            
00C9 C22E            336 +1         clr     LEDD 
VYTAH/ORI"D14                                                                                              PAGE 7

00CB C224            337 +1         clr     FLED1             
00CD C225            338 +1         clr     FLED2                
00CF C226            339 +1         clr     FLED3           
00D1 C227            340 +1         clr     FLED4           
00D3 D224            341 +1         setb    FLED1
00D5 1206D9          342 +1         lcall   WRITEPORTS
00D8 120672          344            lcall   WAITFORTIMER    ; simulacia TIMERu
00DB 12068B          345    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DE C219            346            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00E0 C228            347            clr     PO1             ;
00E2 1206D9          348            lcall   WRITEPORTS      ;
00E5 E528            349            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
00E7 541C            350            anl     A, #00011100b ;-;
00E9 7008            351            jnz     F1OK          ;-; ak ano, podme na to
00EB E522            352            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
00ED 543E            353            anl     A, #00111110b ;-;
00EF 7002            354            jnz     F1OK          ;-; ak ano, podme na to
00F1 80E8            355            jmp     F1S             ; Nemam sa kde hnut, opakujem
00F3 D220            356    F1OK:   setb    UP              ; rychly pohyb hore
00F5 D222            357            setb    FAST            ; 
00F7 C223            358            clr     SLOW            ;
00F9 1206D9          359            lcall   WRITEPORTS      ; 
00FC 0200FF          360            jmp     UP1           ;-; prejdi do stavu UP1
00FF                 361    UP1:
                     362 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00FF C22F            363 +1         clr     LEDU            
0101 C22E            364 +1         clr     LEDD 
0103 C224            365 +1         clr     FLED1             
0105 C225            366 +1         clr     FLED2                
0107 C226            367 +1         clr     FLED3           
0109 C227            368 +1         clr     FLED4           
010B D224            369 +1         setb    FLED1
010D 1206D9          370 +1         lcall   WRITEPORTS
                     372 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0110 12065C          373 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0113 12068B          374 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0116 3009FA          375 +1         jnb     MB1, $-3  ; 
0119 12065C          376 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
011C 12068B          378    UP1A:   lcall   READPORTS       ; nacitanie dat
                     379 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
011F 200B03          380 +1         jb      SKRH, $+6
0122 020641          381 +1         ljmp    ERR_SKRH
0125 00              382 +1         nop
                     384 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0126 200903          385 +1         jb      MB1, $+6
0129 020614          386 +1         ljmp    ERR_2SPOM_C
012C 00              387 +1         nop
012D 200AEC          389            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     390 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0130 12065C          391 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0133 12068B          392 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0136 300AFA          393 +1         jnb     MB2, $-3  ; 
0139 12065C          394 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
VYTAH/ORI 	D234                                                                                              PAGE 8

                                                                               zliezli)
013C D22E            396            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
013E 1206D9          397            lcall   WRITEPORTS      ;
0141 020144          398            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0144                 399    UP1_MB2:
0144 12068B          400            lcall   READPORTS       ; nacitanie dat
                     401 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0147 200B03          402 +1         jb      SKRH, $+6
014A 020641          403 +1         ljmp    ERR_SKRH
014D 00              404 +1         nop
                     406 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
014E 200903          407 +1         jb      MB1, $+6
0151 020605          408 +1         ljmp    ERR_1SPOM_C
0154 00              409 +1         nop
0155 200AEC          411            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0158 D22F            412            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
015A 1206D9          413            lcall   WRITEPORTS      ;   
                     414 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
015D 12065C          415 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0160 12068B          416 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0163 300AFA          417 +1         jnb     MB2, $-3  ; 
0166 12065C          418 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0169 E528            420            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
016B 5404            421            anl     A, #00000100b ;-;
016D 600A            422            jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1
016F D223            423            setb    SLOW            ;       Ak ano, spomalme
0171 C222            424            clr     FAST            ; 
0173 1206D9          425            lcall   WRITEPORTS      ;         
0176 020179          426            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
0179                 427    UP1_MB1:
0179 12068B          428            lcall   READPORTS       ; nacitanie dat
                     429 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
017C 200B03          430 +1         jb      SKRH, $+6
017F 020641          431 +1         ljmp    ERR_SKRH
0182 00              432 +1         nop
                     434 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0183 200A03          435 +1         jb      MB2, $+6
0186 020623          436 +1         ljmp    ERR_ZAST_C
0189 00              437 +1         nop
018A 2009EC          439            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     440 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     441 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
018D C3              442 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
018E 7400            443 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0190 7242            444 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0192 7212            445 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0194 B00E            446 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
0196 720F            447 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0198 3400            448 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
VYTAH/ORIgD54                                                                                              PAGE 9

                     450 +1         ljz     UP2           ;-; Ak nie, chod do stavu UP2
019A 7003            451 +1         jnz     $+5
019C 020227          452 +1         ljmp    UP2
019F 00              453 +1         nop
01A0 C220            455            clr     UP              ; zastav motor
01A2 D23A            456            setb    UPOld           ;       (a zalohuj) 
01A4 C23B            457            clr     DOWNOld         ;       (a zalohuj)
01A6 C222            458            clr     FAST            ; 
01A8 1206D9          459            lcall   WRITEPORTS      ; 
01AB 0201AE          460            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     461    
                     462    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     463    
01AE                 464    FLOOR2:
                     465 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
01AE C22F            466 +1         clr     LEDU            
01B0 C22E            467 +1         clr     LEDD 
01B2 C224            468 +1         clr     FLED1             
01B4 C225            469 +1         clr     FLED2                
01B6 C226            470 +1         clr     FLED3           
01B8 C227            471 +1         clr     FLED4           
01BA D225            472 +1         setb    FLED2
01BC 1206D9          473 +1         lcall   WRITEPORTS
01BF 120672          475            lcall   WAITFORTIMER    ; simulacia TIMERu
01C2 12068B          476    F2S:    lcall   READPORTS     ;-; nacitanie dat
01C5 C21A            477            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
01C7 C22A            478            clr     PO2U            ;
01C9 C229            479            clr     PO2D            ;
01CB 1206D9          480            lcall   WRITEPORTS      ;
                     481            ;_BP_
01CE 79F8            482            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
01D0 7AF8            483            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
01D2 203A06          484            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
01D5 E9              485            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
01D6 F4              486            cpl     A               ;       |
01D7 F9              487            mov     R1, A           ;       |
01D8 EA              488            mov     A, R2           ;       A znegujeme aj masku sachty
01D9 F4              489            cpl     A               ;       |
01DA FA              490            mov     R2, A           ;       |
01DB                 491    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
01DB E528            492            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
01DD 541A            493            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
01DF 59              494            anl     A, R1           ;  | 
01E0 7027            495            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     496                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
01E2 E528            497            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
01E4 541A            498            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
01E6 7007            499            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
01E8 E522            500            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
01EA 5439            501            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
01EC 5A              502            anl     A, R2           ;  |   
VYTAH/ORI <D54                                                                                              PAGE 10

01ED 701A            503            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     504            ; Pohyb v opacnom smere (nevieme v ktorom)
01EF B23A            505    F2SW:   cpl     UPOld           ;  Znegujem stary posun
01F1 B23B            506            cpl     DOWNOld         ;  |
01F3 E9              507            mov     A, R1           ;  Znegujeme masky
01F4 F4              508            cpl     A               ;  |
01F5 F9              509            mov     R1, A           ;  |
01F6 EA              510            mov     A, R2           ;  |
01F7 F4              511            cpl     A               ;  |
01F8 FA              512            mov     R2, A           ;  |               
01F9 E528            513            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
01FB 541A            514            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
01FD 59              515            anl     A, R1           ;  | 
01FE 7009            516            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0200 E522            517            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0202 5439            518            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0204 5A              519            anl     A, R2           ;  | 
0205 7002            520            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0207 80B9            521            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0209 203A03          522    F2:     jb      UPOld, F2UP     ;   
020C 02021B          523            jmp     F2DOWN          ;
020F D220            524    F2UP:   setb    UP              ; rychly pohyb hore
0211 D222            525            setb    FAST            ; 
0213 C223            526            clr     SLOW            ;
0215 1206D9          527            lcall   WRITEPORTS      ; 
0218 020227          528            jmp     UP2           ;-; prejdi do stavu UP2    
021B D221            529    F2DOWN: setb    DOWN            ; rychly pohyb hore
021D D222            530            setb    FAST            ; 
021F C223            531            clr     SLOW            ;
0221 1206D9          532            lcall   WRITEPORTS      ; 
0224 0202D5          533            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     534            
                     535                
0227                 536    UP2:
                     537 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0227 C22F            538 +1         clr     LEDU            
0229 C22E            539 +1         clr     LEDD 
022B C224            540 +1         clr     FLED1             
022D C225            541 +1         clr     FLED2                
022F C226            542 +1         clr     FLED3           
0231 C227            543 +1         clr     FLED4           
0233 D225            544 +1         setb    FLED2
0235 1206D9          545 +1         lcall   WRITEPORTS
                     547 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0238 12065C          548 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
023B 12068B          549 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
023E 3009FA          550 +1         jnb     MB1, $-3  ; 
0241 12065C          551 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0244 12068B          553    UP2A:   lcall   READPORTS       ; nacitanie dat
                     554 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0247 200B03          555 +1         jb      SKRH, $+6
024A 020641          556 +1         ljmp    ERR_SKRH
024D 00              557 +1         nop
                     559 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
VYTAH/ORID74$74                                                                                          PAGE 11

                                                                               astavovaciu) <<<
024E 200903          560 +1         jb      MB1, $+6
0251 020614          561 +1         ljmp    ERR_2SPOM_C
0254 00              562 +1         nop
0255 200AEC          564            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     565 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0258 12065C          566 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
025B 12068B          567 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
025E 300AFA          568 +1         jnb     MB2, $-3  ; 
0261 12065C          569 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0264 D22E            571            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0266 1206D9          572            lcall   WRITEPORTS      ;
0269 02026C          573            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
026C                 574    UP2_MB2:
026C 12068B          575            lcall   READPORTS       ; nacitanie dat
                     576 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
026F 200B03          577 +1         jb      SKRH, $+6
0272 020641          578 +1         ljmp    ERR_SKRH
0275 00              579 +1         nop
                     581 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0276 200903          582 +1         jb      MB1, $+6
0279 020605          583 +1         ljmp    ERR_1SPOM_C
027C 00              584 +1         nop
027D 200AEC          586            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0280 D22F            587            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0282 1206D9          588            lcall   WRITEPORTS      ;
                     589 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0285 12065C          590 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0288 12068B          591 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
028B 300AFA          592 +1         jnb     MB2, $-3  ; 
028E 12065C          593 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0291 E528            595            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0293 5408            596            anl     A, #00001000b ;-;
0295 600A            597            jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
0297 D223            598            setb    SLOW            ;       Ak ano, spomalme
0299 C222            599            clr     FAST            ; 
029B 1206D9          600            lcall   WRITEPORTS      ;
029E 0202A1          601            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
02A1                 602    UP2_MB1:
02A1 12068B          603            lcall   READPORTS       ; nacitanie dat
                     604 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02A4 200B03          605 +1         jb      SKRH, $+6
02A7 020641          606 +1         ljmp    ERR_SKRH
02AA 00              607 +1         nop
                     609 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
02AB 200A03          610 +1         jb      MB2, $+6
02AE 020623          611 +1         ljmp    ERR_ZAST_C
02B1 00              612 +1         nop
02B2 2009EC          614            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     615 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     616 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
02B5 C3              617 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
VYTAH/ORI(D9494                                                                                          PAGE 12

02B6 7400            618 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
02B8 7243            619 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
02BA 7214            620 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
02BC B00E            621 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
02BE 720F            622 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
02C0 3400            623 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
02C2 7003            625            jnz     U2_MB1C       ;-; Ak nie, chod do stavu UP3
02C4 0203E0          626            ljmp    UP3             ; |
02C7 C220            627    U2_MB1C:clr     UP              ; zastav motor
02C9 D23A            628            setb    UPOld           ;       (a zalohuj)
02CB C23B            629            clr     DOWNOld         ;       (a zalohuj)
02CD C222            630            clr     FAST            ; 
02CF 1206D9          631            lcall   WRITEPORTS      ; 
02D2 020367          632            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
02D5                 633    DOWN2:
                     634 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
02D5 C22F            635 +1         clr     LEDU            
02D7 C22E            636 +1         clr     LEDD 
02D9 C224            637 +1         clr     FLED1             
02DB C225            638 +1         clr     FLED2                
02DD C226            639 +1         clr     FLED3           
02DF C227            640 +1         clr     FLED4           
02E1 D225            641 +1         setb    FLED2
02E3 1206D9          642 +1         lcall   WRITEPORTS
                     644 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02E6 12065C          645 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02E9 12068B          646 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02EC 3009FA          647 +1         jnb     MB1, $-3  ; 
02EF 12065C          648 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02F2 12068B          650            lcall   READPORTS       ; nacitanie dat
                     651 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
02F5 200C03          652 +1         jb      SKRD, $+6
02F8 020632          653 +1         ljmp    ERR_SKRD
02FB 00              654 +1         nop
                     656 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02FC 200903          657 +1         jb      MB1, $+6
02FF 020614          658 +1         ljmp    ERR_2SPOM_C
0302 00              659 +1         nop
0303 200ACF          661            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     662 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0306 12065C          663 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0309 12068B          664 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
030C 300AFA          665 +1         jnb     MB2, $-3  ; 
030F 12065C          666 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0312 D22F            668            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0314 1206D9          669            lcall   WRITEPORTS      ;
0317 02031A          670            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
031A                 671    DOWN2_MB2:
031A 12068B          672            lcall   READPORTS       ; nacitanie dat
                     673 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
VYTAH/ORImDv;4~;4                                                                                          PAGE 13

031D 200C03          674 +1         jb      SKRD, $+6
0320 020632          675 +1         ljmp    ERR_SKRD
0323 00              676 +1         nop
                     678 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0324 200903          679 +1         jb      MB1, $+6
0327 020605          680 +1         ljmp    ERR_1SPOM_C
032A 00              681 +1         nop
032B 200AEC          683            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
032E D22E            684            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0330 1206D9          685            lcall   WRITEPORTS      ;
                     686 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0333 12065C          687 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0336 12068B          688 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0339 300AFA          689 +1         jnb     MB2, $-3  ; 
033C 12065C          690 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
033F E528            692            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
0341 5402            693            anl     A, #00000010b ;-;
0343 600A            694            jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0345 D223            695            setb    SLOW            ;       Ak ano, spomalme
0347 C222            696            clr     FAST            ; 
0349 1206D9          697            lcall   WRITEPORTS      ;
034C 02034F          698            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
034F                 699    DOWN2_MB1:    
034F 12068B          700            lcall   READPORTS       ; nacitanie dat
0352 300C05          701            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0355 300902          702            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0358 80F5            703            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
035A C221            704    D2_MB1C:clr     DOWN            ; zastav motor
035C D23B            705            setb    DOWNOld         ;       (a zalohuj)
035E C23A            706            clr     UPOld           ;       (a zalohuj)
0360 C222            707            clr     FAST            ; 
0362 1206D9          708            lcall   WRITEPORTS      ; 
0365 01C7            709            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                     710    
                     711    
                     712    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     713    
0367                 714    FLOOR3:
                     715 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0367 C22F            716 +1         clr     LEDU            
0369 C22E            717 +1         clr     LEDD 
036B C224            718 +1         clr     FLED1             
036D C225            719 +1         clr     FLED2                
036F C226            720 +1         clr     FLED3           
0371 C227            721 +1         clr     FLED4           
0373 D226            722 +1         setb    FLED3
0375 1206D9          723 +1         lcall   WRITEPORTS
0378 120672          725            lcall   WAITFORTIMER    ; simulacia TIMERu
037B 12068B          726    F3S:    lcall   READPORTS     ;-; nacitanie dat
037E C21B            727            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
0380 C22C            728            clr     PO3U            ;
0382 C22B            729            clr     PO3D            ;
VYTAH/ORI TD|<4                                                                                              PAGE 14

0384 1206D9          730            lcall   WRITEPORTS      ;
                     731           ;_BP_
0387 79F0            732            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0389 7AE0            733            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
038B 203A06          734            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
038E E9              735            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
038F F4              736            cpl     A               ;       |
0390 F9              737            mov     R1, A           ;       |
0391 EA              738            mov     A, R2           ;       A znegujeme aj masku sachty
0392 F4              739            cpl     A               ;       |
0393 FA              740            mov     R2, A           ;       |        
0394                 741    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0394 E528            742            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0396 5416            743            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0398 59              744            anl     A, R1           ;  | 
0399 7027            745            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                     746                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
039B E528            747            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
039D 5416            748            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
039F 7007            749            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
03A1 E522            750            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
03A3 5427            751            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
03A5 5A              752            anl     A, R2           ;  |   
03A6 701A            753            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                     754            ; Pohyb v opacnom smere (nevieme v ktorom)
03A8 B23A            755    F3SW:   cpl     UPOld           ;  Znegujem stary posun
03AA B23B            756            cpl     DOWNOld         ;  |
03AC E9              757            mov     A, R1           ;  Znegujeme masky
03AD F4              758            cpl     A               ;  |
03AE F9              759            mov     R1, A           ;  |
03AF EA              760            mov     A, R2           ;  |
03B0 F4              761            cpl     A               ;  |
03B1 FA              762            mov     R2, A           ;  |               
03B2 E528            763            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
03B4 5416            764            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
03B6 59              765            anl     A, R1           ;  | 
03B7 7009            766            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
03B9 E522            767            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
03BB 5427            768            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
03BD 5A              769            anl     A, R2           ;  | 
03BE 7002            770            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
03C0 80B9            771            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
03C2 203A03          772    F3:     jb      UPOld, F3UP     ;   
03C5 0203D4          773            jmp     F3DOWN          ;
03C8 D220            774    F3UP:   setb    UP              ; rychly pohyb hore
03CA D222            775            setb    FAST            ; 
03CC C223            776            clr     SLOW            ;
03CE 1206D9          777            lcall   WRITEPORTS      ; 
03D1 0203E0          778            jmp     UP3           ;-; prejdi do stavu UP2    
03D4 D221            779    F3DOWN: setb    DOWN            ; rychly pohyb hore
03D6 D222            780            setb    FAST            ; 
VYTAH/ORI 'D|<4                                                                                              PAGE 15

03D8 C223            781            clr     SLOW            ;
03DA 1206D9          782            lcall   WRITEPORTS      ; 
03DD 020473          783            jmp     DOWN3         ;-; prejdi do stavu UP2    
                     784         
                     785         
03E0                 786    UP3:
                     787 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03E0 C22F            788 +1         clr     LEDU            
03E2 C22E            789 +1         clr     LEDD 
03E4 C224            790 +1         clr     FLED1             
03E6 C225            791 +1         clr     FLED2                
03E8 C226            792 +1         clr     FLED3           
03EA C227            793 +1         clr     FLED4           
03EC D226            794 +1         setb    FLED3
03EE 1206D9          795 +1         lcall   WRITEPORTS
                     797 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03F1 12065C          798 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03F4 12068B          799 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03F7 3009FA          800 +1         jnb     MB1, $-3  ; 
03FA 12065C          801 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03FD 12068B          803    UP3A:   lcall   READPORTS       ; nacitanie dat
                     804 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0400 200B03          805 +1         jb      SKRH, $+6
0403 020641          806 +1         ljmp    ERR_SKRH
0406 00              807 +1         nop
                     809 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0407 200903          810 +1         jb      MB1, $+6
040A 020614          811 +1         ljmp    ERR_2SPOM_C
040D 00              812 +1         nop
040E 200AEC          814            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                     815 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0411 12065C          816 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0414 12068B          817 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0417 300AFA          818 +1         jnb     MB2, $-3  ; 
041A 12065C          819 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
041D D22E            821            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
041F 1206D9          822            lcall   WRITEPORTS      ;
0422 020425          823            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
0425                 824    UP3_MB2:
0425 12068B          825            lcall   READPORTS       ; nacitanie dat
                     826 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0428 200B03          827 +1         jb      SKRH, $+6
042B 020641          828 +1         ljmp    ERR_SKRH
042E 00              829 +1         nop
                     831 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
042F 200903          832 +1         jb      MB1, $+6
0432 020605          833 +1         ljmp    ERR_1SPOM_C
0435 00              834 +1         nop
0436 200AEC          836            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0439 D22F            837            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
043B 1206D9          838            lcall   WRITEPORTS      ;
                     839 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
043E 12065C          840 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
VYTAH/ORI D ?4                                                                                              PAGE 16

0441 12068B          841 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0444 300AFA          842 +1         jnb     MB2, $-3  ; 
0447 12065C          843 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
044A E528            845            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
044C 5410            846            anl     A, #00010000b ;-;
044E 600A            847            jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
0450 D223            848            setb    SLOW            ;       Ak ano, spomalme
0452 C222            849            clr     FAST            ; 
0454 1206D9          850            lcall   WRITEPORTS      ;
0457 02045A          851            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
045A                 852    UP3_MB1:
045A 12068B          853            lcall   READPORTS       ; nacitanie dat
045D 300B05          854            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0460 300902          855            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0463 80F5            856            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
0465 C220            857    U3_MB1C:clr     UP              ; zastav motor
0467 D23A            858            setb    UPOld           ;       (a zalohuj)
0469 C23B            859            clr     DOWNOld         ;       (a zalohuj)
046B C222            860            clr     FAST            ; 
046D 1206D9          861            lcall   WRITEPORTS      ; 
0470 020520          862            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
0473                 863    DOWN3:
                     864 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0473 C22F            865 +1         clr     LEDU            
0475 C22E            866 +1         clr     LEDD 
0477 C224            867 +1         clr     FLED1             
0479 C225            868 +1         clr     FLED2                
047B C226            869 +1         clr     FLED3           
047D C227            870 +1         clr     FLED4           
047F D226            871 +1         setb    FLED3
0481 1206D9          872 +1         lcall   WRITEPORTS
                     874 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0484 12065C          875 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0487 12068B          876 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
048A 3009FA          877 +1         jnb     MB1, $-3  ; 
048D 12065C          878 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0490 12068B          880            lcall   READPORTS       ; nacitanie dat
                     881 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0493 200C03          882 +1         jb      SKRD, $+6
0496 020632          883 +1         ljmp    ERR_SKRD
0499 00              884 +1         nop
                     886 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
049A 200903          887 +1         jb      MB1, $+6
049D 020614          888 +1         ljmp    ERR_2SPOM_C
04A0 00              889 +1         nop
04A1 200ACF          891            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                     892 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
04A4 12065C          893 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
04A7 12068B          894 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04AA 300AFA          895 +1         jnb     MB2, $-3  ; 
04AD 12065C          896 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
VYTAH/ORI D 4                                                                                              PAGE 17

04B0 D22F            898            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
04B2 1206D9          899            lcall   WRITEPORTS      ;
04B5 0204B8          900            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
04B8                 901    DOWN3_MB2:
04B8 12068B          902            lcall   READPORTS       ; nacitanie dat
                     903 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
04BB 200C03          904 +1         jb      SKRD, $+6
04BE 020632          905 +1         ljmp    ERR_SKRD
04C1 00              906 +1         nop
                     908 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
04C2 200903          909 +1         jb      MB1, $+6
04C5 020605          910 +1         ljmp    ERR_1SPOM_C
04C8 00              911 +1         nop
04C9 200AEC          913            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
04CC D22E            914            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
04CE 1206D9          915            lcall   WRITEPORTS      ;
                     916 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
04D1 12065C          917 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
04D4 12068B          918 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04D7 300AFA          919 +1         jnb     MB2, $-3  ; 
04DA 12065C          920 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04DD E528            922            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
04DF 5404            923            anl     A, #00000100b ;-;
04E1 600A            924            jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
04E3 D223            925            setb    SLOW            ;       Ak ano, spomalme
04E5 C222            926            clr     FAST            ; 
04E7 1206D9          927            lcall   WRITEPORTS      ;
04EA 0204ED          928            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
04ED                 929    DOWN3_MB1:    
04ED 12068B          930            lcall   READPORTS       ; nacitanie dat
                     931 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
04F0 200C03          932 +1         jb      SKRD, $+6
04F3 020632          933 +1         ljmp    ERR_SKRD
04F6 00              934 +1         nop
                     936 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
04F7 200A03          937 +1         jb      MB2, $+6
04FA 020623          938 +1         ljmp    ERR_ZAST_C
04FD 00              939 +1         nop
04FE 2009EC          941            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                     942 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     943 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0501 C3              944 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0502 7400            945 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0504 7242            946 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0506 7211            947 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0508 B00E            948 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
050A 720F            949 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
050C 3400            950 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
050E 7003            952            jnz     D3_MB1C         ; Ak nie, chod do stavu DOWN2
VYTAH/ORI`Dv#4z#4                                                                                          PAGE 18

0510 0202D5          953            ljmp    DOWN2         ;-; |
0513 C221            954    D3_MB1C:clr     DOWN            ; zastav motor
0515 D23B            955            setb    DOWNOld         ;       (a zalohuj)
0517 C23A            956            clr     UPOld           ;       (a zalohuj)
0519 C222            957            clr     FAST            ; 
051B 1206D9          958            lcall   WRITEPORTS      ; 
051E 21AE            959            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                     960          
                     961            
                     962    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                     963    
0520                 964    FLOOR4:
                     965 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0520 C22F            966 +1         clr     LEDU            
0522 C22E            967 +1         clr     LEDD 
0524 C224            968 +1         clr     FLED1             
0526 C225            969 +1         clr     FLED2                
0528 C226            970 +1         clr     FLED3           
052A C227            971 +1         clr     FLED4           
052C D227            972 +1         setb    FLED4
052E 1206D9          973 +1         lcall   WRITEPORTS
0531 120672          975            lcall   WAITFORTIMER    ; simulacia TIMERu
0534 12068B          976    F4S:    lcall   READPORTS     ;-; nacitanie dat
0537 C21C            977            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0539 C22D            978            clr     PO4            ;
053B 1206D9          979            lcall   WRITEPORTS      ;
053E E528            980            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
0540 540E            981            anl     A, #00001110b ;-;
0542 7008            982            jnz     F4OK          ;-; ak ano, ideme na to
0544 E522            983            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
0546 541F            984            anl     A, #00011111b ;-;
0548 7002            985            jnz     F4OK          ;-; ak ano, ideme na to
054A 80E8            986            jmp     F4S             ; Nemam sa kde hnut, opakujem
054C D221            987    F4OK:   setb    DOWN            ; rychly pohyb dole
054E D222            988            setb    FAST            ;
0550 C223            989            clr     SLOW            ; 
0552 1206D9          990            lcall   WRITEPORTS      ; 
0555 020558          991            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
0558                 992    DOWN4:
                     993 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0558 C22F            994 +1         clr     LEDU            
055A C22E            995 +1         clr     LEDD 
055C C224            996 +1         clr     FLED1             
055E C225            997 +1         clr     FLED2                
0560 C226            998 +1         clr     FLED3           
0562 C227            999 +1         clr     FLED4           
0564 D227           1000 +1         setb    FLED4
0566 1206D9         1001 +1         lcall   WRITEPORTS
                    1003 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0569 12065C         1004 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
056C 12068B         1005 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
056F 3009FA         1006 +1         jnb     MB1, $-3  ; 
0572 12065C         1007 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
VYTAH/ORI BD$4                                                                                              PAGE 19

                                                                               zliezli)
0575 12068B         1009            lcall   READPORTS       ; nacitanie dat
                    1010 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0578 200C03         1011 +1         jb      SKRD, $+6
057B 020632         1012 +1         ljmp    ERR_SKRD
057E 00             1013 +1         nop
                    1015 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
057F 200903         1016 +1         jb      MB1, $+6
0582 020614         1017 +1         ljmp    ERR_2SPOM_C
0585 00             1018 +1         nop
0586 200ACF         1020            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1021 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0589 12065C         1022 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
058C 12068B         1023 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
058F 300AFA         1024 +1         jnb     MB2, $-3  ; 
0592 12065C         1025 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0595 D22F           1027            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0597 1206D9         1028            lcall   WRITEPORTS      ;
059A 02059D         1029            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
059D                1030    DOWN4_MB2:
059D 12068B         1031            lcall   READPORTS       ; nacitanie dat
                    1032 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05A0 200C03         1033 +1         jb      SKRD, $+6
05A3 020632         1034 +1         ljmp    ERR_SKRD
05A6 00             1035 +1         nop
                    1037 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
05A7 200903         1038 +1         jb      MB1, $+6
05AA 020605         1039 +1         ljmp    ERR_1SPOM_C
05AD 00             1040 +1         nop
05AE 200AEC         1042            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
05B1 D22E           1043            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
05B3 1206D9         1044            lcall   WRITEPORTS      ;
                    1045 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
05B6 12065C         1046 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
05B9 12068B         1047 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
05BC 300AFA         1048 +1         jnb     MB2, $-3  ; 
05BF 12065C         1049 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
05C2 E528           1051            mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
05C4 5408           1052            anl     A, #00001000b ;-;
05C6 600A           1053            jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
05C8 D223           1054            setb    SLOW            ;       Ak ano, spomalme
05CA C222           1055            clr     FAST            ; 
05CC 1206D9         1056            lcall   WRITEPORTS      ;
05CF 0205D2         1057            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
05D2                1058    DOWN4_MB1:    
05D2 12068B         1059            lcall   READPORTS       ; nacitanie dat
                    1060 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05D5 200C03         1061 +1         jb      SKRD, $+6
05D8 020632         1062 +1         ljmp    ERR_SKRD
05DB 00             1063 +1         nop
                    1065 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
05DC 200A03         1066 +1         jb      MB2, $+6
05DF 020623         1067 +1         ljmp    ERR_ZAST_C
VYTAH/ORI0D'4'4                                                                                          PAGE 20

05E2 00             1068 +1         nop
05E3 2009EC         1070            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1071 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1072 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
05E6 C3             1073 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
05E7 7400           1074 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
05E9 7243           1075 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
05EB 7213           1076 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
05ED B00E           1077 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
05EF 720F           1078 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
05F1 3400           1079 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
05F3 7003           1081            jnz     D4_MB1C         ; Ak nie, chod do stavu DOWN3
05F5 020473         1082            ljmp    DOWN3         ;-; |
05F8 C221           1083    D4_MB1C:clr     DOWN            ; zastav motor
05FA D23B           1084            setb    DOWNOld         ;       (a zalohuj)
05FC C23A           1085            clr     UPOld           ;       (a zalohuj)
05FE C222           1086            clr     FAST            ; 
0600 1206D9         1087            lcall   WRITEPORTS      ; 
0603 6167           1088            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1089                    
                    1090      
0605                1091    ERR_1SPOM_C: 
0605 C220           1092            clr     UP              ; zastav motor
0607 C221           1093            clr     DOWN            ; 
0609 1206D9         1094            lcall   WRITEPORTS      ; 
                    1095 +1         _BP_
060C C2B3           1096 +1         clr     P3.3
060E D2AA           1097 +1         setb    EX1
0610 00             1098 +1         nop
0611 00             1099 +1         nop
0612 00             1101            nop
0613 00             1102            nop 
                    1103            
0614                1104    ERR_2SPOM_C: 
0614 C220           1105            clr     UP              ; zastav motor
0616 C221           1106            clr     DOWN            ; 
0618 1206D9         1107            lcall   WRITEPORTS      ; 
                    1108 +1         _BP_
061B C2B3           1109 +1         clr     P3.3
061D D2AA           1110 +1         setb    EX1
061F 00             1111 +1         nop
0620 00             1112 +1         nop
0621 00             1114            nop
0622 00             1115            nop 
                    1116            
0623                1117    ERR_ZAST_C: 
0623 C220           1118            clr     UP              ; zastav motor
0625 C221           1119            clr     DOWN            ; 
0627 1206D9         1120            lcall   WRITEPORTS      ; 
                    1121 +1         _BP_
062A C2B3           1122 +1         clr     P3.3
062C D2AA           1123 +1         setb    EX1
VYTAH/ORI|D                                                                                                  PAGE 21

062E 00             1124 +1         nop
062F 00             1125 +1         nop
0630 00             1127            nop
0631 00             1128            nop 
                    1129            
0632                1130    ERR_SKRD: 
0632 C220           1131            clr     UP              ; zastav motor
0634 C221           1132            clr     DOWN            ; 
0636 1206D9         1133            lcall   WRITEPORTS      ; 
                    1134 +1         _BP_
0639 C2B3           1135 +1         clr     P3.3
063B D2AA           1136 +1         setb    EX1
063D 00             1137 +1         nop
063E 00             1138 +1         nop
063F 00             1140            nop
0640 00             1141            nop    
                    1142            
0641                1143    ERR_SKRH: 
0641 C220           1144            clr     UP              ; zastav motor
0643 C221           1145            clr     DOWN            ; 
0645 1206D9         1146            lcall   WRITEPORTS      ; 
                    1147 +1         _BP_
0648 C2B3           1148 +1         clr     P3.3
064A D2AA           1149 +1         setb    EX1
064C 00             1150 +1         nop
064D 00             1151 +1         nop
064E 00             1153            nop
064F 00             1154            nop             
                    1155                    
                    1156                    
0650                1157    ENDPROG:
0650 D218           1158            setb    KS
0652 1206D9         1159            call    WRITEPORTS                ; zapis novu informaciu
                    1160 +1         _BP_
0655 C2B3           1161 +1         clr     P3.3
0657 D2AA           1162 +1         setb    EX1
0659 00             1163 +1         nop
065A 00             1164 +1         nop
065B 22             1166            ret
                    1167            
                    1168    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1169    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1170    ; 11.0592MHz/2000 = zdrzanie 1 ms
065C                1171    TIME10MS:
065C 7963           1172            mov     R1,#063h        ; 2
                    1173                                    ; *** 100x
065E 7AFF           1174    TIME0:  mov     R2,#0FFh        ; 2 
0660 DAFE           1175    TIME1:  djnz    R2,TIME1        ; 256*2   
0662 7AFF           1176            mov     R2,#0FFh        ; 2       
0664 DAFE           1177    TIME2:  djnz    R2,TIME2        ; 256*2 
0666 7A24           1178            mov     R2,#024h        ; 2       
0668 DAFE           1179    TIME3:  djnz    R2,TIME3        ; 36*2
066A 00             1180            nop                     ; 1
066B D9F1           1181            djnz    R1,TIME0        ; 2
                    1182                                    ; ***
066D 792A           1183            mov     R1,#02Ah        ; 2 
066F D9FE           1184    TIME4:  djnz    R1,TIME4        ; 43*2  
0671 22             1185            ret                     ; koniec
VYTAH/ORI?D                                                                                                  PAGE 22

                    1186            
                    1187            
                    1188    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1189    ; DELAY
                    1190    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1191    ; bude timer)
                    1192    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0672                1193    WAITFORTIMER:
0672 7B10           1194            mov     R3, #10h
0674 12065C         1195    DEL1:   lcall   TIME10MS
0677 DBFB           1196            djnz    R3, DEL1
0679 22             1197            ret
                    1198    
                    1199    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1200    ; WAITFORTIMER
                    1201    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1202    ; bude timer)
                    1203    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
067A                1204    WAITFORTIMER2:
067A D22C           1205            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
067C 1206D9         1206            lcall   WRITEPORTS                  ;
067F 12068B         1207    WAIT:   lcall   READPORTS                   ; 
0682 3013ED         1208            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0685 C22C           1209            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
0687 1206D9         1210            lcall   WRITEPORTS
068A 22             1211            ret
                    1212    
                    1213    
                    1214    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1215    ; READPORTS
                    1216    ; precita nove hodnoty na portoch
                    1217    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
068B                1218    READPORTS:
068B 75A080         1219            mov     p2, #i8255INA       ; citaj data z portu A
068E 75803F         1220            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0691 C2B7           1221            clr     RDNOT
0693 00             1222            nop
0694 00             1223            nop
0695 00             1224            nop
0696 00             1225            nop
0697 858028         1226            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
069A D2B7           1227            setb    RDNOT
                    1228            
069C 75A081         1229            mov     p2, #i8255INB       ; citaj data z portu B
069F 7580FE         1230            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
06A2 C2B7           1231            clr     RDNOT
06A4 00             1232            nop
06A5 00             1233            nop
06A6 00             1234            nop
06A7 00             1235            nop
06A8 858021         1236            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
06AB D2B7           1237            setb    RDNOT
                    1238    
06AD 75A082         1239            mov     p2, #i8255INC       ; citaj data z portu C
06B0 75803F         1240            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
06B3 C2B7           1241            clr     RDNOT
06B5 00             1242            nop
VYTAH/ORID                                                                                                  PAGE 23

06B6 00             1243            nop
06B7 00             1244            nop
06B8 00             1245            nop
06B9 858022         1246            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
06BC D2B7           1247            setb    RDNOT
06BE 00             1248            nop
06BF 00             1249            nop
06C0 00             1250            nop
06C1 00             1251            nop
06C2 00             1252            nop
06C3 00             1253            nop
06C4 00             1254            nop
06C5 00             1255            nop
06C6 E528           1256            mov     A, INPORTA
06C8 541E           1257            anl     A, #00011110b
06CA 4223           1258            orl     OUTPORTA, A
06CC 1206D9         1259            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
06CF E522           1260            mov     A, INPORTC
06D1 543F           1261            anl     A, #00111111b
06D3 4225           1262            orl     OUTPORTC, A
06D5 1206D9         1263            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1264            
06D8 22             1265            ret
                    1266            
                    1267    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1268    ; WRITEPORTS
                    1269    ; spravi zalohu vystupnych registrov a posle data von
                    1270    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
06D9                1271    WRITEPORTS:
06D9 852380         1272            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
06DC 75A0C0         1273            mov     p2, #i8255OUTA
06DF C2B6           1274            clr     WRNOT
06E1 00             1275            nop
06E2 00             1276            nop
06E3 00             1277            nop
06E4 00             1278            nop
06E5 D2B6           1279            setb    WRNOT
                    1280            
06E7 852480         1281            mov     p0, OUTPORTB        ; potom port B
06EA 75A0C1         1282            mov     p2, #i8255OUTB
06ED C2B6           1283            clr     WRNOT
06EF 00             1284            nop
06F0 00             1285            nop
06F1 00             1286            nop
06F2 00             1287            nop
06F3 D2B6           1288            setb    WRNOT
                    1289    
06F5 852580         1290            mov     p0, OUTPORTC        ; a nakoniec port C
06F8 75A0C2         1291            mov     p2, #i8255OUTC
06FB C2B6           1292            clr     WRNOT
06FD 00             1293            nop
06FE 00             1294            nop
06FF 00             1295            nop
0700 00             1296            nop
0701 D2B6           1297            setb    WRNOT
0703 00             1298            nop
0704 00             1299            nop
0705 00             1300            nop
VYTAH/ORITD                                                                                                  PAGE 24

0706 00             1301            nop
0707 00             1302            nop
0708 00             1303            nop
0709 00             1304            nop
070A 00             1305            nop
070B 22             1306            ret
                    1307    
                    1308    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1309    
070C 0D0A5269       1310    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0710 61646961   
0714 63692073   
0718 79737465   
071C 6D206A65   
0720 20696E69   
0724 6369616C   
0728 697A6F76   
072C 616E792E   
0730 0D0A00     
0733 52696164       1311    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
0737 69616369   
073B 20737973   
073F 74656D20   
0743 6A652072   
0747 65696E69   
074B 6369616C   
074F 697A6F76   
0753 616E7920   
0757 706F2073   
075B 746C6163   
075F 656E6920   
0763 746C6163   
0767 69646C61   
076B 2053544F   
076F 502E0D0A   
0773 00         
0774 4B616C69       1312    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0778 62726163   
077C 69612076   
0780 79746168   
0784 75206A65   
0788 20756B6F   
078C 6E63656E   
0790 612E0D0A   
0794 00         
                    1313    
----                1314            DSEG
0040                1315            org     40h
0040                1316    STACK:  DS      10h
                    1317    
                    1318    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 25

BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0096H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00ADH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00B8H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A5H  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  035AH  
D3_MB1C. . . . . . . . . . . . .  C ADDR  0513H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  05F8H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0674H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  02D5H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  034FH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  031AH  
DOWN3. . . . . . . . . . . . . .  C ADDR  0473H  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  04EDH  
VYTAH/ORI                                                                                                     PAGE 26

DOWN3_MB2. . . . . . . . . . . .  C ADDR  04B8H  
DOWN4. . . . . . . . . . . . . .  C ADDR  0558H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  05D2H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  059DH  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
ENDPROG. . . . . . . . . . . . .  C ADDR  0650H  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  0605H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  0614H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  0632H  
ERR_SKRH . . . . . . . . . . . .  C ADDR  0641H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  0623H  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  00F3H  
F1S. . . . . . . . . . . . . . .  C ADDR  00DBH  
F2 . . . . . . . . . . . . . . .  C ADDR  0209H  
F2DOWN . . . . . . . . . . . . .  C ADDR  021BH  
F2OK . . . . . . . . . . . . . .  C ADDR  01DBH  
F2S. . . . . . . . . . . . . . .  C ADDR  01C2H  
F2SW . . . . . . . . . . . . . .  C ADDR  01EFH  
F2UP . . . . . . . . . . . . . .  C ADDR  020FH  
F3 . . . . . . . . . . . . . . .  C ADDR  03C2H  
F3DOWN . . . . . . . . . . . . .  C ADDR  03D4H  
F3OK . . . . . . . . . . . . . .  C ADDR  0394H  
F3S. . . . . . . . . . . . . . .  C ADDR  037BH  
F3SW . . . . . . . . . . . . . .  C ADDR  03A8H  
F3UP . . . . . . . . . . . . . .  C ADDR  03C8H  
F4OK . . . . . . . . . . . . . .  C ADDR  054CH  
F4S. . . . . . . . . . . . . . .  C ADDR  0534H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C7H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  01AEH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0367H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  0520H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
VYTAH/ORI                                                                                                     PAGE 27

LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C7H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  068BH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0774H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  070CH  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  0733H  NOT USED  
TIME0. . . . . . . . . . . . . .  C ADDR  065EH  
TIME1. . . . . . . . . . . . . .  C ADDR  0660H  
TIME10MS . . . . . . . . . . . .  C ADDR  065CH  
TIME2. . . . . . . . . . . . . .  C ADDR  0664H  
TIME3. . . . . . . . . . . . . .  C ADDR  0668H  
TIME4. . . . . . . . . . . . . .  C ADDR  066FH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
VYTAH/ORI                                                                                                     PAGE 28

U2_MB1C. . . . . . . . . . . . .  C ADDR  02C7H  
U3_MB1C. . . . . . . . . . . . .  C ADDR  0465H  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  00FFH  
UP1A . . . . . . . . . . . . . .  C ADDR  011CH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  0179H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0144H  
UP2. . . . . . . . . . . . . . .  C ADDR  0227H  
UP2A . . . . . . . . . . . . . .  C ADDR  0244H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  02A1H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  026CH  
UP3. . . . . . . . . . . . . . .  C ADDR  03E0H  
UP3A . . . . . . . . . . . . . .  C ADDR  03FDH  
UP3_MB1. . . . . . . . . . . . .  C ADDR  045AH  
UP3_MB2. . . . . . . . . . . . .  C ADDR  0425H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  067FH  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  0672H  
WAITFORTIMER2. . . . . . . . . .  C ADDR  067AH  NOT USED  
WRITEPORTS . . . . . . . . . . .  C ADDR  06D9H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
