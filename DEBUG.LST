VYTAH/ORI                                                                                                     PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umo+zni stlacat tlacidla aj ked bezi delay
                       7    
                       8    
                       9    $MOD51
                      10    $DEBUG
                      11    
                =1    12    $include (lift.inc)
                =1    13    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    14    i8255INA        equ     080h
  0081          =1    15    i8255INB        equ     081h
  0082          =1    16    i8255INC        equ     082h
  0083          =1    17    i8255INCW       equ     083h
  00C0          =1    18    i8255OUTA       equ     0c0h
  00C1          =1    19    i8255OUTB       equ     0c1h
  00C2          =1    20    i8255OUTC       equ     0c2h
  00C3          =1    21    i8255OUTCW      equ     0c3h
                =1    22    
  0028          =1    23    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    24    INPORTB         data    21h
  0022          =1    25    INPORTC         data    22h
  0023          =1    26    OUTPORTA        data    23h
  0024          =1    27    OUTPORTB        data    24h
  0025          =1    28    OUTPORTC        data    25h
  0026          =1    29    INPORTBold      data    26h
  0027          =1    30    CTRLREG         data    27h
                =1    31    
  0030          =1    32    POSITION        data    30h
  0031          =1    33    LOWEST          data    31h
  0032          =1    34    HIGHEST         data    32h
  0033          =1    35    STOPTIMER       data    33h
  0034          =1    36    OUTPORTBold     data    34h
                =1    37    
  0040          =1    38    STOPNOT         bit     INPORTA.0
  0041          =1    39    PKI1            bit     INPORTA.1
  0042          =1    40    PKI2            bit     INPORTA.2
  0043          =1    41    PKI3            bit     INPORTA.3
  0044          =1    42    PKI4            bit     INPORTA.4
  0045          =1    43    DOORCLSD        bit     INPORTA.5 
                =1    44    
  0009          =1    45    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    46    MB2             bit     INPORTB.2
  000B          =1    47    SKRH            bit     INPORTB.3
  000C          =1    48    SKRD            bit     INPORTB.4
  000D          =1    49    DP              bit     INPORTB.5
  000E          =1    50    DPZK            bit     INPORTB.6
  000F          =1    51    DPK             bit     INPORTB.7
                =1    52    
  0031          =1    53    MB1old          bit     INPORTBold.1
  0032          =1    54    MB2old          bit     INPORTBold.2
  0033          =1    55    SKRHold         bit     INPORTBold.3
  0034          =1    56    SKRDold         bit     INPORTBold.4
                =1    57    
  0010          =1    58    PI1             bit     INPORTC.0
VYTAH/ORI/D                                                                                                  PAGE 2

  0011          =1    59    PI2D            bit     INPORTC.1
  0012          =1    60    PI2U            bit     INPORTC.2
  0013          =1    61    PI3D            bit     INPORTC.3
  0014          =1    62    PI3U            bit     INPORTC.4
  0015          =1    63    PI4             bit     INPORTC.5
                =1    64    
  0018          =1    65    KS              bit     OUTPORTA.0
  0019          =1    66    PKO1            bit     OUTPORTA.1
  001A          =1    67    PKO2            bit     OUTPORTA.2
  001B          =1    68    PKO3            bit     OUTPORTA.3
  001C          =1    69    PKO4            bit     OUTPORTA.4
                =1    70    
  0020          =1    71    UP              bit     OUTPORTB.0
  0021          =1    72    DOWN            bit     OUTPORTB.1
  0022          =1    73    FAST            bit     OUTPORTB.2
  0023          =1    74    SLOW            bit     OUTPORTB.3
  0024          =1    75    FLED1           bit     OUTPORTB.4
  0025          =1    76    FLED2           bit     OUTPORTB.5
  0026          =1    77    FLED3           bit     OUTPORTB.6
  0027          =1    78    FLED4           bit     OUTPORTB.7
                =1    79    
  0028          =1    80    PO1             bit     OUTPORTC.0
  0029          =1    81    PO2D            bit     OUTPORTC.1
  002A          =1    82    PO2U            bit     OUTPORTC.2
  002B          =1    83    PO3D            bit     OUTPORTC.3
  002C          =1    84    PO3U            bit     OUTPORTC.4
  002D          =1    85    PO4             bit     OUTPORTC.5
  002E          =1    86    LEDD            bit     OUTPORTC.6
  002F          =1    87    LEDU            bit     OUTPORTC.7
                =1    88    
  0038          =1    89    CANGO           bit     CTRLREG.0
  0039          =1    90    DOORCLSDold     bit     CTRLREG.1
  003A          =1    91    UPold           bit     CTRLREG.2
  003B          =1    92    DOWNold         bit     CTRLREG.3
  003C          =1    93    FASTold         bit     CTRLREG.4
  003D          =1    94    SLOWold         bit     CTRLREG.5
                =1    95    
  00B6          =1    96    WRNOT           bit     0b6h        ; p3.6
  00B7          =1    97    RDNOT           bit     0b7h        ; p3.7
                =1    98    
                =1    99    ; bitove masky
                =1   100    ; 8255OUT 
                =1   101    ; port A
  0001          =1   102    bmKS              equ    00000001b
  0002          =1   103    bmPKO1            equ    00000010b
  0004          =1   104    bmPKO2            equ    00000100b
  0008          =1   105    bmPKO3            equ    00001000b
  0010          =1   106    bmPKO4            equ    00010000b
                =1   107    
                =1   108    ; port B
  0001          =1   109    bmUP              equ    00000001b
  0002          =1   110    bmDOWN            equ    00000010b
  0004          =1   111    bmFAST            equ    00000100b
  0008          =1   112    bmSLOW            equ    00001000b
  0010          =1   113    bmFLED1           equ    00010000b
  0020          =1   114    bmFLED2           equ    00100000b
  0040          =1   115    bmFLED3           equ    01000000b
  0080          =1   116    bmFLED4           equ    10000000b
VYTAH/ORI                                                                                                     PAGE 3

                =1   117    
                =1   118    ; port C
  0001          =1   119    bmPO1             equ    00000001b
  0002          =1   120    bmPO2D            equ    00000010b
  0004          =1   121    bmPO2U            equ    00000100b
  0008          =1   122    bmPO3D            equ    00001000b
  0010          =1   123    bmPO3U            equ    00010000b
  0020          =1   124    bmPO4             equ    00100000b
  0040          =1   125    bmLEDD            equ    01000000b
  0080          =1   126    bmLEDU            equ    10000000b
                =1   127    
                =1   128    ; 8255IN
                =1   129    ; port A
  0001          =1   130    bmSTOP            equ    00000001b
  0002          =1   131    bmPKI1            equ    00000010b
  0004          =1   132    bmPKI2            equ    00000100b
  0008          =1   133    bmPKI3            equ    00001000b
  0010          =1   134    bmPKI4            equ    00010000b
  0020          =1   135    bmDOORCLSD        equ    00100000b
                =1   136    
                =1   137    ; port B
  0002          =1   138    bmMB1I            equ    00000010b
  0004          =1   139    bmMB2I            equ    00000100b
  0008          =1   140    bmSKRHI           equ    00001000b
  0010          =1   141    bmSKRHD           equ    00010000b
  0020          =1   142    bmDPI             equ    00100000b
  0040          =1   143    bmDPZKI           equ    01000000b
  0080          =1   144    bmDPKI            equ    10000000b
                =1   145    
                =1   146    ; port C
  0001          =1   147    bmPI1             equ    00000001b
  0002          =1   148    bmPI2D            equ    00000010b
  0004          =1   149    bmPI2U            equ    00000100b
  0008          =1   150    bmPI3D            equ    00001000b
  0010          =1   151    bmPI3U            equ    00010000b
  0020          =1   152    bmPI4             equ    00100000b
                =1   153    
                     154    
                     155    _BP_    MACRO 
                     156            clr     P3.3
                     157            setb    EX1
                     158            nop
                     159            nop
                     160    ENDM
                     161    
                     162    LJZ     MACRO   NAVESTIE
                     163            jnz     $+5
                     164            ljmp    NAVESTIE
                     165            nop
                     166    ENDM
                     167    
                     168    LJNZ    MACRO   NAVESTIE
                     169            jz      $+5
                     170            ljmp    NAVESTIE
                     171            nop
                     172    ENDM
                     173    
                     174    LJB     MACRO   TESTBIT, NAVESTIE
VYTAH/ORI/D                                                                                                  PAGE 4

                     175            jnb     TESTBIT, $+6
                     176            ljmp    NAVESTIE
                     177            nop
                     178    ENDM
                     179    
                     180    LJNB    MACRO   TESTBIT, NAVESTIE
                     181            jb      TESTBIT, $+6
                     182            ljmp    NAVESTIE
                     183            nop
                     184    ENDM
                     185    
                     186    CJE     MACRO   OP1, OP2, NAVESTIE
                     187            cjne    OP1, OP2, $+7
                     188            jmp    NAVESTIE
                     189            nop
                     190    ENDM
                     191    
                     192    LCJNE   MACRO   OP1, OP2, NAVESTIE
                     193            cjne    OP1, OP2, $+6
                     194            jmp     $+6
                     195            ljmp    NAVESTIE
                     196            nop
                     197    ENDM
                     198    
                     199    ZAKMITC MACRO   TYPCLONKY
                     200            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
                     201            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     202            jnb     TYPCLONKY, $-3  ; 
                     203            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     204    ENDM
                     205    
                     206    ZASTAV  MACRO  C_POSCH, SMER
                     207                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     208            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     209            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     210            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine?
                     211            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     212            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
                     213            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     214            ;mov     A, bmSmerPI1U
                     215            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     216    ENDM
                     217    
                     218    NAJNIZSIE  MACRO
                     219            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     220            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     221            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     222            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
VYTAH/ORI/D                                                                                                  PAGE 5

                     223     ; LL1: 
                     224            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     225            clr     C               ; Inak shiftnem o 2
                     226            rlc     A               ;
                     227            clr     C               ;
                     228            rlc     A               ;
                     229            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     230    ; LL2:
                     231            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     232    ENDM
                     233    
                     234    NAJVYSSIE  MACRO
                     235            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     236            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     237            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     238            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     239     ; LL1: 
                     240            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     241            clr     C               ; Inak shiftnem o 2
                     242            rrc     A               ;
                     243            clr     C               ;
                     244            rrc     A               ;
                     245            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     246    ; LL2:
                     247            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     248            clr     C               ;
                     249            subb    A, R0           ;
                     250    ENDM
                     251    
                     252    VYSSIE_KABINA  MACRO  POSCH
                     253            mov     A, INPORTA
                     254            anl     A, #00011110b
                     255            clr     C
                     256            rrc     A
                     257    ;LL1    
                     258            mov     R0, #&POSCH
                     259            clr     C
                     260            rrc     A
                     261            djnz    R0, $-2;LL1
                     262    ENDM
                     263    
                     264    NIZSIE_KABINA  MACRO  POSCH
                     265            mov     A, #5
                     266            clr     C
                     267            subb    A, #&POSCH
                     268            mov     R0, A
                     269            mov     A, INPORTA
                     270            anl     A, #00011110b
                     271            clr     C
                     272            rlc     A
                     273            clr     C
                     274            rlc     A
VYTAH/ORI/D                                                                                                  PAGE 6

                     275            clr     C
                     276            rlc     A
                     277    ;LL1   
                     278            clr     C
                     279            rlc     A
                     280            djnz    R0, $-2;LL1
                     281    ENDM
                     282    
                     283    POLOHA_LED  MACRO  POLOHA
                     284            clr     LEDU            
                     285            clr     LEDD 
                     286            clr     FLED1             
                     287            clr     FLED2                
                     288            clr     FLED3           
                     289            clr     FLED4           
                     290            setb    FLED&POLOHA
                     291            lcall   WRITEPORTS
                     292    ENDM
                     293    
  0036               294    FLOORREQ        data    36h
                     295    
                     296    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               297    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     298                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     299                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     300    ;osetrenie vektorov preruseni
0000                 301            org     0000h           ; adresa odkial startuje program po resete
0000 020033          302            ljmp    START           ; skok na zaciatok kodu programu
                     303                  
0033                 304            org     0033h           ; od tejto adresy sa zacina kod programu
0033                 305    START:
0033                 306    RESET:  
                     307            ; riadiace signaly do pasivnej urovne 
0033 D2B6            308            setb    WRNOT
0035 D2B7            309            setb    RDNOT
0037 753300          310            mov     STOPTIMER, #0
003A 758140          311            mov     SP, #STACK
                     312    
                     313            ; pockame si na inicializaciu obvodov 8255  
003D 7900            314            mov     R1, #0 
003F 7AFF            315            mov     R2, #0ffh
0041 D9FE            316            djnz    R1, $
0043 DAFC            317            djnz    R2, $-2
                     318            
                     319            ; teraz ich mozeme nastavit
0045 75809B          320            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          321            mov     p2, #i8255INCW
004B C2B6            322            clr     WRNOT
004D 00              323            nop
004E 00              324            nop
004F 00              325            nop
0050 00              326            nop
0051 D2B6            327            setb    WRNOT
0053 758080          328            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          329            mov     p2, #i8255OUTCW
0059 C2B6            330            clr     WRNOT
VYTAH/ORI)D                                                                                                  PAGE 7

005B 00              331            nop
005C 00              332            nop
005D 00              333            nop
005E 00              334            nop
005F D2B6            335            setb    WRNOT
                     336            
                     337 +1         _BP_
0061 C2B3            338 +1         clr     P3.3
0063 D2AA            339 +1         setb    EX1
0065 00              340 +1         nop
0066 00              341 +1         nop
                     343    
                     344            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0067 752800          345            mov     INPORTA, #0
006A 75211E          346            mov     INPORTB, #01eh      ; vsetky clonky pasivne
006D 752200          347            mov     INPORTC, #0
0070 75231E          348            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
0073 7524F0          349            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0076 7525FF          350            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0079 D218            351            setb    KS
007B 120868          352            call    WRITEPORTS          ; zapis novu informaciu
                     353    ;;;;;;;;
                     354    
007E 752300          355            mov     OUTPORTA, #0
0081 752400          356            mov     OUTPORTB, #0
0084 752500          357            mov     OUTPORTC, #0
0087 120868          358            call    WRITEPORTS          ; zapis novu informaciu
                     359    
008A 752800          360            mov     INPORTA, #0
008D 752100          361            mov     INPORTB, #0         
0090 752200          362            mov     INPORTC, #0
0093 12081A          363            call    READPORTS           ; prvotne nacitanie udajov
                     364    
0096                 365    CALIB:
                     366            ;kalibracia vytahu podla dolnej porovnavacej clonky
0096 12081A          367            lcall   READPORTS                   ; precitaj, co je na portoch
0099 300C11          368            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
009C D221            369            setb    DOWN                        ; inak pod dole
009E D222            370            setb    FAST                        ; a rychlo
00A0 C223            371            clr     SLOW                        ;
00A2 120868          372            lcall   WRITEPORTS                  ; zapis informaciu 
00A5                 373    CALIBLOOP:
00A5 12081A          374            lcall   READPORTS                   ; 
00A8 300C02          375            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00AB 80F8            376            jmp     CALIBLOOP
00AD                 377    CALIBEND:                              
00AD C222            378            clr     FAST                        ; zastavime v tomto smere
00AF C221            379            clr     DOWN                        ;
00B1 D223            380            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00B3 D220            381            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00B5 120868          382            lcall   WRITEPORTS 
00B8                 383    CALIBEND2:
00B8 12081A          384            lcall   READPORTS                   ; 
00BB 2009FA          385            jb      MB1, CALIBEND2              ; 
00BE C223            386            clr     SLOW                        ; A teraz sme uz naozaj spravne
VYTAH/ORI,D                                                                                                  PAGE 8

00C0 C220            387            clr     UP                          ; 
00C2 D224            388            setb    FLED1
00C4 120868          389            lcall   WRITEPORTS                  ; zapis informaciu
                     390    ;        _BP_
00C7                 391    MAIN:
                     392    
                     393    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     394    ; ****************************************************************************
                     395    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     396    ; ----------------------------------------------------------------------------
                     397    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     398    ; ----------------------------------------------------------------------------
                     399    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     400    ; ****************************************************************************
                     401    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     402    ; ----------------------------------------------------------------------------
                     403    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     404    ; ----------------------------------------------------------------------------
                     405    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     406    ; ****************************************************************************
                     407    ; POSITION
                     408    ; ****************************************************************************
                     409    
                     410    
                     411    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     412    
00C7                 413    FLOOR1:
                     414 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C7 C22F            415 +1         clr     LEDU            
00C9 C22E            416 +1         clr     LEDD 
00CB C224            417 +1         clr     FLED1             
00CD C225            418 +1         clr     FLED2                
00CF C226            419 +1         clr     FLED3           
00D1 C227            420 +1         clr     FLED4           
00D3 D224            421 +1         setb    FLED1
00D5 120868          422 +1         lcall   WRITEPORTS
00D8 120801          424            lcall   WAITFORTIMER    ; simulacia TIMERu
00DB 12081A          425    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DE C219            426            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00E0 C228            427            clr     PO1             ;
00E2 120868          428            lcall   WRITEPORTS      ;
00E5 E528            429            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
00E7 541C            430            anl     A, #00011100b ;-;
00E9 7008            431            jnz     F1OK          ;-; ak ano, podme na to
00EB E522            432            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
00ED 543E            433            anl     A, #00111110b ;-;
00EF 7002            434            jnz     F1OK          ;-; ak ano, podme na to
00F1 80E8            435            jmp     F1S             ; Nemam sa kde hnut, opakujem
00F3 D220            436    F1OK:   setb    UP              ; rychly pohyb hore
00F5 D222            437            setb    FAST            ; 
00F7 C223            438            clr     SLOW            ;
00F9 120868          439            lcall   WRITEPORTS      ; 
00FC 0200FF          440            jmp     UP1           ;-; prejdi do stavu UP1
00FF                 441    UP1:
VYTAH/ORILDF©4                                                                                              PAGE 9

                     442 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00FF C22F            443 +1         clr     LEDU            
0101 C22E            444 +1         clr     LEDD 
0103 C224            445 +1         clr     FLED1             
0105 C225            446 +1         clr     FLED2                
0107 C226            447 +1         clr     FLED3           
0109 C227            448 +1         clr     FLED4           
010B D224            449 +1         setb    FLED1
010D 120868          450 +1         lcall   WRITEPORTS
                     452 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0110 1207EB          453 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0113 12081A          454 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0116 3009FA          455 +1         jnb     MB1, $-3  ; 
0119 1207EB          456 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
011C 12081A          458    UP1A:   lcall   READPORTS       ; nacitanie dat
                     459 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
011F 200B03          460 +1         jb      SKRH, $+6
0122 0207D0          461 +1         ljmp    ERR_SKRH
0125 00              462 +1         nop
                     464 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0126 200903          465 +1         jb      MB1, $+6
0129 0207A3          466 +1         ljmp    ERR_2SPOM_C
012C 00              467 +1         nop
012D 200AEC          469            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     470 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
0130 1207EB          471 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0133 12081A          472 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0136 300AFA          473 +1         jnb     MB2, $-3  ; 
0139 1207EB          474 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
013C D22E            476            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
013E 120868          477            lcall   WRITEPORTS      ;
0141 020144          478            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0144                 479    UP1_MB2:
0144 12081A          480            lcall   READPORTS       ; nacitanie dat
                     481 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0147 200B03          482 +1         jb      SKRH, $+6
014A 0207D0          483 +1         ljmp    ERR_SKRH
014D 00              484 +1         nop
                     486 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
014E 200903          487 +1         jb      MB1, $+6
0151 020794          488 +1         ljmp    ERR_1SPOM_C
0154 00              489 +1         nop
0155 200AEC          491            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0158 D22F            492            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
015A 120868          493            lcall   WRITEPORTS      ;   
                     494 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
015D 1207EB          495 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
0160 12081A          496 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0163 300AFA          497 +1         jnb     MB2, $-3  ; 
0166 1207EB          498 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     500    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     501    ;        anl     A, #00000100b ;-;
VYTAH/ORI                                                                                                     PAGE 10

                     502    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     503 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     504 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0169 C3              505 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
016A 7400            506 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
016C 7242            507 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
016E 7212            508 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0170 B00E            509 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
0172 720F            510 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     511 +1         ;mov     A, bmSmerPI1U
0174 3400            512 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0176 702E            514            jnz     U1_MB2C       ;-; Ak ano, zastav
                     515 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
0178 E522            516 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
017A 33              517 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
017B 547E            518 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
017D 7805            519 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     520 +1  ; LL1: 
017F 6006            521 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0181 C3              522 +1         clr     C               ; Inak shiftnem o 2
0182 13              523 +1         rrc     A               ;
0183 C3              524 +1         clr     C               ;
0184 13              525 +1         rrc     A               ;
0185 D8F8            526 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     527 +1 ; LL2:
0187 7405            528 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0189 C3              529 +1         clr     C               ;
018A 98              530 +1         subb    A, R0           ;
                     532 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
018B B40203          533 +1         cjne    A, #2, $+6
018E 020194          534 +1         jmp     $+6
0191 0201B0          535 +1         ljmp    UP1_MB1
0194 00              536 +1         nop
                     538 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0195 E528            539 +1         mov     A, INPORTA
0197 541E            540 +1         anl     A, #00011110b
0199 C3              541 +1         clr     C
019A 13              542 +1         rrc     A
                     543 +1 ;LL1    
019B 7802            544 +1         mov     R0, #2
019D C3              545 +1         clr     C
019E 13              546 +1         rrc     A
019F D8FC            547 +1         djnz    R0, $-2;LL1
01A1 6003            549            jz      U1_MB2C         ; |   ak neni zastavujem         
VYTAH/ORI!sD²I©4                                                                                              PAGE 11

01A3 0201B0          550            jmp     UP1_MB1          ; |   inak nezastavim        
01A6 D223            551    U1_MB2C:setb    SLOW            ;       Ak ano, spomalme
01A8 C222            552            clr     FAST            ; 
01AA 120868          553            lcall   WRITEPORTS      ;         
01AD 0201B0          554            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
01B0                 555    UP1_MB1:
01B0 12081A          556            lcall   READPORTS       ; nacitanie dat
                     557 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01B3 200B03          558 +1         jb      SKRH, $+6
01B6 0207D0          559 +1         ljmp    ERR_SKRH
01B9 00              560 +1         nop
                     562 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
01BA 200A03          563 +1         jb      MB2, $+6
01BD 0207B2          564 +1         ljmp    ERR_ZAST_C
01C0 00              565 +1         nop
01C1 2009EC          567            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     568            
                     569 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     570 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
01C4 C3              571 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
01C5 7400            572 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
01C7 7242            573 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
01C9 7212            574 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
01CB B00E            575 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
01CD 720F            576 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     577 +1         ;mov     A, bmSmerPI1U
01CF 3400            578 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01D1 702E            580            jnz     U1_MB1C       ;-; Ak ano, zastav
                     581 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01D3 E522            582 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01D5 33              583 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01D6 547E            584 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
01D8 7805            585 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     586 +1  ; LL1: 
01DA 6006            587 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
01DC C3              588 +1         clr     C               ; Inak shiftnem o 2
01DD 13              589 +1         rrc     A               ;
01DE C3              590 +1         clr     C               ;
01DF 13              591 +1         rrc     A               ;
01E0 D8F8            592 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     593 +1 ; LL2:
01E2 7405            594 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
01E4 C3              595 +1         clr     C               ;
01E5 98              596 +1         subb    A, R0           ;
                     598 +1         LCJNE   A, #2, UP2      ; |   ak nie, nezastavujeme 
VYTAH/ORI6DNK©4RK©4XK©4                                                                                      PAGE 12

01E6 B40203          599 +1         cjne    A, #2, $+6
01E9 0201EF          600 +1         jmp     $+6
01EC 020288          601 +1         ljmp    UP2
01EF 00              602 +1         nop
                     604 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
01F0 E528            605 +1         mov     A, INPORTA
01F2 541E            606 +1         anl     A, #00011110b
01F4 C3              607 +1         clr     C
01F5 13              608 +1         rrc     A
                     609 +1 ;LL1    
01F6 7802            610 +1         mov     R0, #2
01F8 C3              611 +1         clr     C
01F9 13              612 +1         rrc     A
01FA D8FC            613 +1         djnz    R0, $-2;LL1
01FC 6003            615            jz      U1_MB1C         ; |   ak neni zastavujem         
01FE 020288          616            ljmp    UP2             ; |   inak nezastavim        
0201 C220            617    U1_MB1C:clr     UP              ; zastav motor
0203 D23A            618            setb    UPOld           ;       (a zalohuj) 
0205 C23B            619            clr     DOWNOld         ;       (a zalohuj)
0207 C222            620            clr     FAST            ; 
0209 120868          621            lcall   WRITEPORTS      ; 
020C 02020F          622            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     623    
                     624    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     625    
020F                 626    FLOOR2:
                     627 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
020F C22F            628 +1         clr     LEDU            
0211 C22E            629 +1         clr     LEDD 
0213 C224            630 +1         clr     FLED1             
0215 C225            631 +1         clr     FLED2                
0217 C226            632 +1         clr     FLED3           
0219 C227            633 +1         clr     FLED4           
021B D225            634 +1         setb    FLED2
021D 120868          635 +1         lcall   WRITEPORTS
0220 120801          637            lcall   WAITFORTIMER    ; simulacia TIMERu
0223 12081A          638    F2S:    lcall   READPORTS     ;-; nacitanie dat
0226 C21A            639            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
0228 C22A            640            clr     PO2U            ;
022A C229            641            clr     PO2D            ;
022C 120868          642            lcall   WRITEPORTS      ;
                     643            ;_BP_
022F 79F8            644            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0231 7AF8            645            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
0233 203A06          646            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
0236 E9              647            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
0237 F4              648            cpl     A               ;       |
0238 F9              649            mov     R1, A           ;       |
0239 EA              650            mov     A, R2           ;       A znegujeme aj masku sachty
023A F4              651            cpl     A               ;       |
023B FA              652            mov     R2, A           ;       |
023C                 653    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
VYTAH/ORI DòK©4                                                                                              PAGE 13

023C E528            654            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
023E 541A            655            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0240 59              656            anl     A, R1           ;  | 
0241 7027            657            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     658                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0243 E528            659            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
0245 541A            660            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
0247 7007            661            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0249 E522            662            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
024B 5439            663            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
024D 5A              664            anl     A, R2           ;  |   
024E 701A            665            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     666            ; Pohyb v opacnom smere (nevieme v ktorom)
0250 B23A            667    F2SW:   cpl     UPOld           ;  Znegujem stary posun
0252 B23B            668            cpl     DOWNOld         ;  |
0254 E9              669            mov     A, R1           ;  Znegujeme masky
0255 F4              670            cpl     A               ;  |
0256 F9              671            mov     R1, A           ;  |
0257 EA              672            mov     A, R2           ;  |
0258 F4              673            cpl     A               ;  |
0259 FA              674            mov     R2, A           ;  |               
025A E528            675            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
025C 541A            676            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
025E 59              677            anl     A, R1           ;  | 
025F 7009            678            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0261 E522            679            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0263 5439            680            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0265 5A              681            anl     A, R2           ;  | 
0266 7002            682            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0268 80B9            683            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
026A 203A03          684    F2:     jb      UPOld, F2UP     ;   
026D 02027C          685            jmp     F2DOWN          ;
0270 D220            686    F2UP:   setb    UP              ; rychly pohyb hore
0272 D222            687            setb    FAST            ; 
0274 C223            688            clr     SLOW            ;
0276 120868          689            lcall   WRITEPORTS      ; 
0279 020288          690            jmp     UP2           ;-; prejdi do stavu UP2    
027C D221            691    F2DOWN: setb    DOWN            ; rychly pohyb hore
027E D222            692            setb    FAST            ; 
0280 C223            693            clr     SLOW            ;
0282 120868          694            lcall   WRITEPORTS      ; 
0285 020398          695            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     696            
                     697                
0288                 698    UP2:
                     699 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0288 C22F            700 +1         clr     LEDU            
028A C22E            701 +1         clr     LEDD 
028C C224            702 +1         clr     FLED1             
028E C225            703 +1         clr     FLED2                
0290 C226            704 +1         clr     FLED3           
0292 C227            705 +1         clr     FLED4           
VYTAH/ORIcD>L©4                                                                                              PAGE 14

0294 D225            706 +1         setb    FLED2
0296 120868          707 +1         lcall   WRITEPORTS
                     709 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0299 1207EB          710 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
029C 12081A          711 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
029F 3009FA          712 +1         jnb     MB1, $-3  ; 
02A2 1207EB          713 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02A5 12081A          715    UP2A:   lcall   READPORTS       ; nacitanie dat
                     716 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02A8 200B03          717 +1         jb      SKRH, $+6
02AB 0207D0          718 +1         ljmp    ERR_SKRH
02AE 00              719 +1         nop
                     721 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02AF 200903          722 +1         jb      MB1, $+6
02B2 0207A3          723 +1         ljmp    ERR_2SPOM_C
02B5 00              724 +1         nop
02B6 200AEC          726            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     727 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02B9 1207EB          728 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02BC 12081A          729 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02BF 300AFA          730 +1         jnb     MB2, $-3  ; 
02C2 1207EB          731 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02C5 D22E            733            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02C7 120868          734            lcall   WRITEPORTS      ;
02CA 0202CD          735            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
02CD                 736    UP2_MB2:
02CD 12081A          737            lcall   READPORTS       ; nacitanie dat
                     738 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02D0 200B03          739 +1         jb      SKRH, $+6
02D3 0207D0          740 +1         ljmp    ERR_SKRH
02D6 00              741 +1         nop
                     743 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02D7 200903          744 +1         jb      MB1, $+6
02DA 020794          745 +1         ljmp    ERR_1SPOM_C
02DD 00              746 +1         nop
02DE 200AEC          748            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
02E1 D22F            749            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
02E3 120868          750            lcall   WRITEPORTS      ;
                     751 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02E6 1207EB          752 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
02E9 12081A          753 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02EC 300AFA          754 +1         jnb     MB2, $-3  ; 
02EF 1207EB          755 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     757    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     758    ;        anl     A, #00001000b ;-;
                     759    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                     760 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     761 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
02F2 C3              762 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
02F3 7400            763 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
02F5 7243            764 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
VYTAH/ORIFDäN©4èN©4                                                                                          PAGE 15

02F7 7214            765 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
02F9 B00E            766 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
02FB 720F            767 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     768 +1         ;mov     A, bmSmerPI1U
02FD 3400            769 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
02FF 702E            771            jnz     U2_MB2C       ;-; Ak ano, zastav
                     772 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0301 E522            773 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0303 33              774 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0304 547E            775 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0306 7805            776 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     777 +1  ; LL1: 
0308 6006            778 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
030A C3              779 +1         clr     C               ; Inak shiftnem o 2
030B 13              780 +1         rrc     A               ;
030C C3              781 +1         clr     C               ;
030D 13              782 +1         rrc     A               ;
030E D8F8            783 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     784 +1 ; LL2:
0310 7405            785 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
0312 C3              786 +1         clr     C               ;
0313 98              787 +1         subb    A, R0           ;
                     789 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
0314 B40303          790 +1         cjne    A, #3, $+6
0317 02031D          791 +1         jmp     $+6
031A 020339          792 +1         ljmp    UP2_MB1
031D 00              793 +1         nop
                     795 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
031E E528            796 +1         mov     A, INPORTA
0320 541E            797 +1         anl     A, #00011110b
0322 C3              798 +1         clr     C
0323 13              799 +1         rrc     A
                     800 +1 ;LL1    
0324 7803            801 +1         mov     R0, #3
0326 C3              802 +1         clr     C
0327 13              803 +1         rrc     A
0328 D8FC            804 +1         djnz    R0, $-2;LL1
032A 6003            806            jz      U2_MB2C         ; |   ak neni zastavujem  
032C 020339          807            ljmp    UP2_MB1         ; |   inak nezastavim
032F D223            808    U2_MB2C:setb    SLOW            ;       Ak ano, spomalme
0331 C222            809            clr     FAST            ; 
0333 120868          810            lcall   WRITEPORTS      ;
0336 020339          811            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0339                 812    UP2_MB1:
0339 12081A          813            lcall   READPORTS       ; nacitanie dat
                     814 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
VYTAH/ORID$P©4,P©4                                                                                          PAGE 16

033C 200B03          815 +1         jb      SKRH, $+6
033F 0207D0          816 +1         ljmp    ERR_SKRH
0342 00              817 +1         nop
                     819 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0343 200A03          820 +1         jb      MB2, $+6
0346 0207B2          821 +1         ljmp    ERR_ZAST_C
0349 00              822 +1         nop
034A 2009EC          824            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     825            
                     826 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     827 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
034D C3              828 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
034E 7400            829 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0350 7243            830 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0352 7214            831 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0354 B00E            832 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
0356 720F            833 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     834 +1         ;mov     A, bmSmerPI1U
0358 3400            835 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
035A 702E            837            jnz     U2_MB1C       ;-; Ak ano, zastav
                     838 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
035C E522            839 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
035E 33              840 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
035F 547E            841 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0361 7805            842 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     843 +1  ; LL1: 
0363 6006            844 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0365 C3              845 +1         clr     C               ; Inak shiftnem o 2
0366 13              846 +1         rrc     A               ;
0367 C3              847 +1         clr     C               ;
0368 13              848 +1         rrc     A               ;
0369 D8F8            849 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     850 +1 ; LL2:
036B 7405            851 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
036D C3              852 +1         clr     C               ;
036E 98              853 +1         subb    A, R0           ;
                     855 +1         LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
036F B40303          856 +1         cjne    A, #3, $+6
0372 020378          857 +1         jmp     $+6
0375 02049D          858 +1         ljmp    UP3
0378 00              859 +1         nop
                     861 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0379 E528            862 +1         mov     A, INPORTA
VYTAH/ORIJDÌQ©4                                                                                              PAGE 17

037B 541E            863 +1         anl     A, #00011110b
037D C3              864 +1         clr     C
037E 13              865 +1         rrc     A
                     866 +1 ;LL1    
037F 7803            867 +1         mov     R0, #3
0381 C3              868 +1         clr     C
0382 13              869 +1         rrc     A
0383 D8FC            870 +1         djnz    R0, $-2;LL1
0385 6003            872            jz      U2_MB1C         ; |   ak neni zastavujem  
0387 02049D          873            ljmp    UP3             ; |   inak nezastavim
038A C220            874    U2_MB1C:clr     UP              ; zastav motor
038C D23A            875            setb    UPOld           ;       (a zalohuj)
038E C23B            876            clr     DOWNOld         ;       (a zalohuj)
0390 C222            877            clr     FAST            ; 
0392 120868          878            lcall   WRITEPORTS      ; 
0395 020424          879            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
0398                 880    DOWN2:
                     881 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0398 C22F            882 +1         clr     LEDU            
039A C22E            883 +1         clr     LEDD 
039C C224            884 +1         clr     FLED1             
039E C225            885 +1         clr     FLED2                
03A0 C226            886 +1         clr     FLED3           
03A2 C227            887 +1         clr     FLED4           
03A4 D225            888 +1         setb    FLED2
03A6 120868          889 +1         lcall   WRITEPORTS
                     891 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03A9 1207EB          892 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03AC 12081A          893 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03AF 3009FA          894 +1         jnb     MB1, $-3  ; 
03B2 1207EB          895 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03B5 12081A          897            lcall   READPORTS       ; nacitanie dat
                     898 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03B8 200C03          899 +1         jb      SKRD, $+6
03BB 0207C1          900 +1         ljmp    ERR_SKRD
03BE 00              901 +1         nop
                     903 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03BF 200903          904 +1         jb      MB1, $+6
03C2 0207A3          905 +1         ljmp    ERR_2SPOM_C
03C5 00              906 +1         nop
03C6 200ACF          908            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     909 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
03C9 1207EB          910 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03CC 12081A          911 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03CF 300AFA          912 +1         jnb     MB2, $-3  ; 
03D2 1207EB          913 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03D5 D22F            915            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03D7 120868          916            lcall   WRITEPORTS      ;
03DA 0203DD          917            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
03DD                 918    DOWN2_MB2:
03DD 12081A          919            lcall   READPORTS       ; nacitanie dat
                     920 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03E0 200C03          921 +1         jb      SKRD, $+6
03E3 0207C1          922 +1         ljmp    ERR_SKRD
VYTAH/ORI4D¸S©4ÀS©4                                                                                          PAGE 18

03E6 00              923 +1         nop
                     925 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
03E7 200903          926 +1         jb      MB1, $+6
03EA 020794          927 +1         ljmp    ERR_1SPOM_C
03ED 00              928 +1         nop
03EE 200AEC          930            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
03F1 D22E            931            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
03F3 120868          932            lcall   WRITEPORTS      ;
                     933 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
03F6 1207EB          934 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
03F9 12081A          935 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03FC 300AFA          936 +1         jnb     MB2, $-3  ; 
03FF 1207EB          937 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     939    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     940    ;        anl     A, #00000010b ;-;
                     941    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0402 D223            942            setb    SLOW            ;       Ak ano, spomalme
0404 C222            943            clr     FAST            ; 
0406 120868          944            lcall   WRITEPORTS      ;
0409 02040C          945            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
040C                 946    DOWN2_MB1:    
040C 12081A          947            lcall   READPORTS       ; nacitanie dat
040F 300C05          948            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0412 300902          949            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0415 80F5            950            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
0417 C221            951    D2_MB1C:clr     DOWN            ; zastav motor
0419 D23B            952            setb    DOWNOld         ;       (a zalohuj)
041B C23A            953            clr     UPOld           ;       (a zalohuj)
041D C222            954            clr     FAST            ; 
041F 120868          955            lcall   WRITEPORTS      ; 
0422 01C7            956            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                     957    
                     958    
                     959    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                     960    
0424                 961    FLOOR3:
                     962 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0424 C22F            963 +1         clr     LEDU            
0426 C22E            964 +1         clr     LEDD 
0428 C224            965 +1         clr     FLED1             
042A C225            966 +1         clr     FLED2                
042C C226            967 +1         clr     FLED3           
042E C227            968 +1         clr     FLED4           
0430 D226            969 +1         setb    FLED3
0432 120868          970 +1         lcall   WRITEPORTS
0435 120801          972            lcall   WAITFORTIMER    ; simulacia TIMERu
0438 12081A          973    F3S:    lcall   READPORTS     ;-; nacitanie dat
043B C21B            974            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
043D C22C            975            clr     PO3U            ;
043F C22B            976            clr     PO3D            ;
0441 120868          977            lcall   WRITEPORTS      ;
                     978           ;_BP_
VYTAH/ORID¾T©4                                                                                              PAGE 19

0444 79F0            979            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0446 7AE0            980            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
0448 203A06          981            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
044B E9              982            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
044C F4              983            cpl     A               ;       |
044D F9              984            mov     R1, A           ;       |
044E EA              985            mov     A, R2           ;       A znegujeme aj masku sachty
044F F4              986            cpl     A               ;       |
0450 FA              987            mov     R2, A           ;       |        
0451                 988    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0451 E528            989            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0453 5416            990            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0455 59              991            anl     A, R1           ;  | 
0456 7027            992            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                     993                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
0458 E528            994            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
045A 5416            995            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
045C 7007            996            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
045E E522            997            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0460 5427            998            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0462 5A              999            anl     A, R2           ;  |   
0463 701A           1000            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1001            ; Pohyb v opacnom smere (nevieme v ktorom)
0465 B23A           1002    F3SW:   cpl     UPOld           ;  Znegujem stary posun
0467 B23B           1003            cpl     DOWNOld         ;  |
0469 E9             1004            mov     A, R1           ;  Znegujeme masky
046A F4             1005            cpl     A               ;  |
046B F9             1006            mov     R1, A           ;  |
046C EA             1007            mov     A, R2           ;  |
046D F4             1008            cpl     A               ;  |
046E FA             1009            mov     R2, A           ;  |               
046F E528           1010            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0471 5416           1011            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0473 59             1012            anl     A, R1           ;  | 
0474 7009           1013            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0476 E522           1014            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
0478 5427           1015            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
047A 5A             1016            anl     A, R2           ;  | 
047B 7002           1017            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
047D 80B9           1018            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
047F 203A03         1019    F3:     jb      UPOld, F3UP     ;   
0482 020491         1020            jmp     F3DOWN          ;
0485 D220           1021    F3UP:   setb    UP              ; rychly pohyb hore
0487 D222           1022            setb    FAST            ; 
0489 C223           1023            clr     SLOW            ;
048B 120868         1024            lcall   WRITEPORTS      ; 
048E 02049D         1025            jmp     UP3           ;-; prejdi do stavu UP2    
0491 D221           1026    F3DOWN: setb    DOWN            ; rychly pohyb hore
0493 D222           1027            setb    FAST            ; 
0495 C223           1028            clr     SLOW            ;
0497 120868         1029            lcall   WRITEPORTS      ; 
VYTAH/ORIjD¾T©4                                                                                              PAGE 20

049A 02052A         1030            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1031         
                    1032         
049D                1033    UP3:
                    1034 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
049D C22F           1035 +1         clr     LEDU            
049F C22E           1036 +1         clr     LEDD 
04A1 C224           1037 +1         clr     FLED1             
04A3 C225           1038 +1         clr     FLED2                
04A5 C226           1039 +1         clr     FLED3           
04A7 C227           1040 +1         clr     FLED4           
04A9 D226           1041 +1         setb    FLED3
04AB 120868         1042 +1         lcall   WRITEPORTS
                    1044 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
04AE 1207EB         1045 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
04B1 12081A         1046 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04B4 3009FA         1047 +1         jnb     MB1, $-3  ; 
04B7 1207EB         1048 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04BA 12081A         1050    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1051 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04BD 200B03         1052 +1         jb      SKRH, $+6
04C0 0207D0         1053 +1         ljmp    ERR_SKRH
04C3 00             1054 +1         nop
                    1056 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
04C4 200903         1057 +1         jb      MB1, $+6
04C7 0207A3         1058 +1         ljmp    ERR_2SPOM_C
04CA 00             1059 +1         nop
04CB 200AEC         1061            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                    1062 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
04CE 1207EB         1063 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
04D1 12081A         1064 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04D4 300AFA         1065 +1         jnb     MB2, $-3  ; 
04D7 1207EB         1066 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04DA D22E           1068            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
04DC 120868         1069            lcall   WRITEPORTS      ;
04DF 0204E2         1070            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
04E2                1071    UP3_MB2:
04E2 12081A         1072            lcall   READPORTS       ; nacitanie dat
                    1073 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04E5 200B03         1074 +1         jb      SKRH, $+6
04E8 0207D0         1075 +1         ljmp    ERR_SKRH
04EB 00             1076 +1         nop
                    1078 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
04EC 200903         1079 +1         jb      MB1, $+6
04EF 020794         1080 +1         ljmp    ERR_1SPOM_C
04F2 00             1081 +1         nop
04F3 200AEC         1083            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
04F6 D22F           1084            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
04F8 120868         1085            lcall   WRITEPORTS      ;
                    1086 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
04FB 1207EB         1087 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
04FE 12081A         1088 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0501 300AFA         1089 +1         jnb     MB2, $-3  ; 
VYTAH/ORI TDbW©4                                                                                              PAGE 21

0504 1207EB         1090 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1092    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1093    ;        anl     A, #00010000b ;-;
                    1094    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
0507 D223           1095            setb    SLOW            ;       Ak ano, spomalme
0509 C222           1096            clr     FAST            ; 
050B 120868         1097            lcall   WRITEPORTS      ;
050E 020511         1098            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0511                1099    UP3_MB1:
0511 12081A         1100            lcall   READPORTS       ; nacitanie dat
0514 300B05         1101            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
0517 300902         1102            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
051A 80F5           1103            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
051C C220           1104    U3_MB1C:clr     UP              ; zastav motor
051E D23A           1105            setb    UPOld           ;       (a zalohuj)
0520 C23B           1106            clr     DOWNOld         ;       (a zalohuj)
0522 C222           1107            clr     FAST            ; 
0524 120868         1108            lcall   WRITEPORTS      ; 
0527 020643         1109            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
052A                1110    DOWN3:
                    1111 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
052A C22F           1112 +1         clr     LEDU            
052C C22E           1113 +1         clr     LEDD 
052E C224           1114 +1         clr     FLED1             
0530 C225           1115 +1         clr     FLED2                
0532 C226           1116 +1         clr     FLED3           
0534 C227           1117 +1         clr     FLED4           
0536 D226           1118 +1         setb    FLED3
0538 120868         1119 +1         lcall   WRITEPORTS
                    1121 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
053B 1207EB         1122 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
053E 12081A         1123 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0541 3009FA         1124 +1         jnb     MB1, $-3  ; 
0544 1207EB         1125 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0547 12081A         1127            lcall   READPORTS       ; nacitanie dat
                    1128 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
054A 200C03         1129 +1         jb      SKRD, $+6
054D 0207C1         1130 +1         ljmp    ERR_SKRD
0550 00             1131 +1         nop
                    1133 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0551 200903         1134 +1         jb      MB1, $+6
0554 0207A3         1135 +1         ljmp    ERR_2SPOM_C
0557 00             1136 +1         nop
0558 200ACF         1138            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                    1139 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
055B 1207EB         1140 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
055E 12081A         1141 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0561 300AFA         1142 +1         jnb     MB2, $-3  ; 
0564 1207EB         1143 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0567 D22F           1145            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
0569 120868         1146            lcall   WRITEPORTS      ;
VYTAH/ORI<DY©4                                                                                              PAGE 22

056C 02056F         1147            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
056F                1148    DOWN3_MB2:
056F 12081A         1149            lcall   READPORTS       ; nacitanie dat
                    1150 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0572 200C03         1151 +1         jb      SKRD, $+6
0575 0207C1         1152 +1         ljmp    ERR_SKRD
0578 00             1153 +1         nop
                    1155 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
0579 200903         1156 +1         jb      MB1, $+6
057C 020794         1157 +1         ljmp    ERR_1SPOM_C
057F 00             1158 +1         nop
0580 200AEC         1160            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0583 D22E           1161            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0585 120868         1162            lcall   WRITEPORTS      ;
                    1163 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0588 1207EB         1164 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
058B 12081A         1165 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
058E 300AFA         1166 +1         jnb     MB2, $-3  ; 
0591 1207EB         1167 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1169    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1170    ;        anl     A, #00000100b ;-;
                    1171    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1172 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1173 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0594 C3             1174 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0595 7400           1175 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0597 7242           1176 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
0599 7211           1177 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
059B B00E           1178 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
059D 720F           1179 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                    1180 +1         ;mov     A, bmSmerPI1U
059F 3400           1181 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
05A1 7033           1183            jnz     D3_MB2C         ; Ak ano, zastav
                    1184 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
05A3 E522           1185 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
05A5 33             1186 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
05A6 547E           1187 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
05A8 7805           1188 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1189 +1  ; LL1: 
05AA 6006           1190 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
05AC C3             1191 +1         clr     C               ; Inak shiftnem o 2
05AD 33             1192 +1         rlc     A               ;
05AE C3             1193 +1         clr     C               ;
05AF 33             1194 +1         rlc     A               ;
VYTAH/ORI D                                                                                                  PAGE 23

05B0 D8F8           1195 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1196 +1 ; LL2:
05B2 E8             1197 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1199 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
05B3 B40203         1200 +1         cjne    A, #2, $+6
05B6 0205BC         1201 +1         jmp     $+6
05B9 0205E0         1202 +1         ljmp    DOWN3_MB1
05BC 00             1203 +1         nop
                    1205 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
05BD 7405           1206 +1         mov     A, #5
05BF C3             1207 +1         clr     C
05C0 9402           1208 +1         subb    A, #2
05C2 F8             1209 +1         mov     R0, A
05C3 E528           1210 +1         mov     A, INPORTA
05C5 541E           1211 +1         anl     A, #00011110b
05C7 C3             1212 +1         clr     C
05C8 33             1213 +1         rlc     A
05C9 C3             1214 +1         clr     C
05CA 33             1215 +1         rlc     A
05CB C3             1216 +1         clr     C
05CC 33             1217 +1         rlc     A
                    1218 +1 ;LL1   
05CD C3             1219 +1         clr     C
05CE 33             1220 +1         rlc     A
05CF D8FC           1221 +1         djnz    R0, $-2;LL1
05D1 6003           1223            jz      D3_MB2C         ; |   ak neni zastavujem                  
05D3 0205E0         1224            ljmp    DOWN3_MB1       ;-; |        
05D6 D223           1225    D3_MB2C:setb    SLOW            ;       Ak ano, spomalme
05D8 C222           1226            clr     FAST            ; 
05DA 120868         1227            lcall   WRITEPORTS      ;
05DD 0205E0         1228            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
05E0                1229    DOWN3_MB1:    
05E0 12081A         1230            lcall   READPORTS       ; nacitanie dat
                    1231 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05E3 200C03         1232 +1         jb      SKRD, $+6
05E6 0207C1         1233 +1         ljmp    ERR_SKRD
05E9 00             1234 +1         nop
                    1236 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
05EA 200A03         1237 +1         jb      MB2, $+6
05ED 0207B2         1238 +1         ljmp    ERR_ZAST_C
05F0 00             1239 +1         nop
05F1 2009EC         1241            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1242 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1243 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
05F4 C3             1244 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
05F5 7400           1245 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
05F7 7242           1246 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine?
05F9 7211           1247 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
05FB B00E           1248 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
05FD 720F           1249 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                    1250 +1         ;mov     A, bmSmerPI1U
VYTAH/ORI(NDP\©4T\©4                                                                                          PAGE 24

05FF 3400           1251 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0601 7033           1253            jnz     D3_MB1C         ; Ak ano, zastav
                    1254 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0603 E522           1255 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0605 33             1256 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0606 547E           1257 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0608 7805           1258 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1259 +1  ; LL1: 
060A 6006           1260 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
060C C3             1261 +1         clr     C               ; Inak shiftnem o 2
060D 33             1262 +1         rlc     A               ;
060E C3             1263 +1         clr     C               ;
060F 33             1264 +1         rlc     A               ;
0610 D8F8           1265 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1266 +1 ; LL2:
0612 E8             1267 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1269 +1         LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
0613 B40203         1270 +1         cjne    A, #2, $+6
0616 02061C         1271 +1         jmp     $+6
0619 020398         1272 +1         ljmp    DOWN2
061C 00             1273 +1         nop
                    1275 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
061D 7405           1276 +1         mov     A, #5
061F C3             1277 +1         clr     C
0620 9402           1278 +1         subb    A, #2
0622 F8             1279 +1         mov     R0, A
0623 E528           1280 +1         mov     A, INPORTA
0625 541E           1281 +1         anl     A, #00011110b
0627 C3             1282 +1         clr     C
0628 33             1283 +1         rlc     A
0629 C3             1284 +1         clr     C
062A 33             1285 +1         rlc     A
062B C3             1286 +1         clr     C
062C 33             1287 +1         rlc     A
                    1288 +1 ;LL1   
062D C3             1289 +1         clr     C
062E 33             1290 +1         rlc     A
062F D8FC           1291 +1         djnz    R0, $-2;LL1
0631 6003           1293            jz      D3_MB1C         ; |   ak neni zastavujem                  
0633 020398         1294            ljmp    DOWN2         ;-; |        
0636 C221           1295    D3_MB1C:clr     DOWN            ; zastav motor
0638 D23B           1296            setb    DOWNOld         ;       (a zalohuj)
063A C23A           1297            clr     UPOld           ;       (a zalohuj)
063C C222           1298            clr     FAST            ; 
063E 120868         1299            lcall   WRITEPORTS      ; 
0641 410F           1300            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                    1301          
                    1302            
VYTAH/ORI                                                                                                     PAGE 25

                    1303    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1304    
0643                1305    FLOOR4:
                    1306 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0643 C22F           1307 +1         clr     LEDU            
0645 C22E           1308 +1         clr     LEDD 
0647 C224           1309 +1         clr     FLED1             
0649 C225           1310 +1         clr     FLED2                
064B C226           1311 +1         clr     FLED3           
064D C227           1312 +1         clr     FLED4           
064F D227           1313 +1         setb    FLED4
0651 120868         1314 +1         lcall   WRITEPORTS
0654 120801         1316            lcall   WAITFORTIMER    ; simulacia TIMERu
0657 12081A         1317    F4S:    lcall   READPORTS     ;-; nacitanie dat
065A C21C           1318            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
065C C22D           1319            clr     PO4            ;
065E 120868         1320            lcall   WRITEPORTS      ;
0661 E528           1321            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
0663 540E           1322            anl     A, #00001110b ;-;
0665 7008           1323            jnz     F4OK          ;-; ak ano, ideme na to
0667 E522           1324            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
0669 541F           1325            anl     A, #00011111b ;-;
066B 7002           1326            jnz     F4OK          ;-; ak ano, ideme na to
066D 80E8           1327            jmp     F4S             ; Nemam sa kde hnut, opakujem
066F D221           1328    F4OK:   setb    DOWN            ; rychly pohyb dole
0671 D222           1329            setb    FAST            ;
0673 C223           1330            clr     SLOW            ; 
0675 120868         1331            lcall   WRITEPORTS      ; 
0678 02067B         1332            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
067B                1333    DOWN4:
                    1334 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
067B C22F           1335 +1         clr     LEDU            
067D C22E           1336 +1         clr     LEDD 
067F C224           1337 +1         clr     FLED1             
0681 C225           1338 +1         clr     FLED2                
0683 C226           1339 +1         clr     FLED3           
0685 C227           1340 +1         clr     FLED4           
0687 D227           1341 +1         setb    FLED4
0689 120868         1342 +1         lcall   WRITEPORTS
                    1344 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
068C 1207EB         1345 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
068F 12081A         1346 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0692 3009FA         1347 +1         jnb     MB1, $-3  ; 
0695 1207EB         1348 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
0698 12081A         1350            lcall   READPORTS       ; nacitanie dat
                    1351 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
069B 200C03         1352 +1         jb      SKRD, $+6
069E 0207C1         1353 +1         ljmp    ERR_SKRD
06A1 00             1354 +1         nop
                    1356 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
06A2 200903         1357 +1         jb      MB1, $+6
VYTAH/ORIuDÐ^©4Ö^©4                                                                                          PAGE 26

06A5 0207A3         1358 +1         ljmp    ERR_2SPOM_C
06A8 00             1359 +1         nop
06A9 200ACF         1361            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1362 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
06AC 1207EB         1363 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
06AF 12081A         1364 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06B2 300AFA         1365 +1         jnb     MB2, $-3  ; 
06B5 1207EB         1366 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06B8 D22F           1368            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
06BA 120868         1369            lcall   WRITEPORTS      ;
06BD 0206C0         1370            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
06C0                1371    DOWN4_MB2:
06C0 12081A         1372            lcall   READPORTS       ; nacitanie dat
                    1373 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06C3 200C03         1374 +1         jb      SKRD, $+6
06C6 0207C1         1375 +1         ljmp    ERR_SKRD
06C9 00             1376 +1         nop
                    1378 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
06CA 200903         1379 +1         jb      MB1, $+6
06CD 020794         1380 +1         ljmp    ERR_1SPOM_C
06D0 00             1381 +1         nop
06D1 200AEC         1383            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
06D4 D22E           1384            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
06D6 120868         1385            lcall   WRITEPORTS      ;
                    1386 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
06D9 1207EB         1387 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (xe som na clonke)
06DC 12081A         1388 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06DF 300AFA         1389 +1         jnb     MB2, $-3  ; 
06E2 1207EB         1390 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1392    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1393    ;        anl     A, #00001000b ;-;
                    1394    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1395 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1396 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
06E5 C3             1397 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
06E6 7400           1398 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
06E8 7243           1399 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
06EA 7213           1400 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
06EC B00E           1401 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
06EE 720F           1402 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                    1403 +1         ;mov     A, bmSmerPI1U
06F0 3400           1404 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
06F2 7033           1406            jnz     D4_MB2C       ;-; Ak ano, zastav
                    1407 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
06F4 E522           1408 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
06F6 33             1409 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
VYTAH/ORI FD                                                                                                  PAGE 27

06F7 547E           1410 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
06F9 7805           1411 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1412 +1  ; LL1: 
06FB 6006           1413 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
06FD C3             1414 +1         clr     C               ; Inak shiftnem o 2
06FE 33             1415 +1         rlc     A               ;
06FF C3             1416 +1         clr     C               ;
0700 33             1417 +1         rlc     A               ;
0701 D8F8           1418 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1419 +1 ; LL2:
0703 E8             1420 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1422 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
0704 B40303         1423 +1         cjne    A, #3, $+6
0707 02070D         1424 +1         jmp     $+6
070A 020731         1425 +1         ljmp    DOWN4_MB1
070D 00             1426 +1         nop
                    1428 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
070E 7405           1429 +1         mov     A, #5
0710 C3             1430 +1         clr     C
0711 9403           1431 +1         subb    A, #3
0713 F8             1432 +1         mov     R0, A
0714 E528           1433 +1         mov     A, INPORTA
0716 541E           1434 +1         anl     A, #00011110b
0718 C3             1435 +1         clr     C
0719 33             1436 +1         rlc     A
071A C3             1437 +1         clr     C
071B 33             1438 +1         rlc     A
071C C3             1439 +1         clr     C
071D 33             1440 +1         rlc     A
                    1441 +1 ;LL1   
071E C3             1442 +1         clr     C
071F 33             1443 +1         rlc     A
0720 D8FC           1444 +1         djnz    R0, $-2;LL1
0722 6003           1446            jz      D4_MB2C         ; |   ak neni zastavujem          
0724 020731         1447            ljmp    DOWN4_MB1       ;-; |       
0727 D223           1448    D4_MB2C:setb    SLOW            ;       Ak ano, spomalme
0729 C222           1449            clr     FAST            ; 
072B 120868         1450            lcall   WRITEPORTS      ;
072E 020731         1451            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
0731                1452    DOWN4_MB1:    
0731 12081A         1453            lcall   READPORTS       ; nacitanie dat
                    1454 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0734 200C03         1455 +1         jb      SKRD, $+6
0737 0207C1         1456 +1         ljmp    ERR_SKRD
073A 00             1457 +1         nop
                    1459 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
073B 200A03         1460 +1         jb      MB2, $+6
073E 0207B2         1461 +1         ljmp    ERR_ZAST_C
0741 00             1462 +1         nop
0742 2009EC         1464            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1465 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
VYTAH/ORI(D*©4*©4                                                                                          PAGE 28

                    1466 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0745 C3             1467 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0746 7400           1468 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0748 7243           1469 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine?
074A 7213           1470 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
074C B00E           1471 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim) 
074E 720F           1472 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                    1473 +1         ;mov     A, bmSmerPI1U
0750 3400           1474 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0752 7033           1476            jnz     D4_MB1C       ;-; Ak ano, zastav
                    1477 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0754 E522           1478 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0756 33             1479 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0757 547E           1480 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0759 7805           1481 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1482 +1  ; LL1: 
075B 6006           1483 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
075D C3             1484 +1         clr     C               ; Inak shiftnem o 2
075E 33             1485 +1         rlc     A               ;
075F C3             1486 +1         clr     C               ;
0760 33             1487 +1         rlc     A               ;
0761 D8F8           1488 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1489 +1 ; LL2:
0763 E8             1490 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1492 +1         LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
0764 B40303         1493 +1         cjne    A, #3, $+6
0767 02076D         1494 +1         jmp     $+6
076A 02052A         1495 +1         ljmp    DOWN3
076D 00             1496 +1         nop
                    1498 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
076E 7405           1499 +1         mov     A, #5
0770 C3             1500 +1         clr     C
0771 9403           1501 +1         subb    A, #3
0773 F8             1502 +1         mov     R0, A
0774 E528           1503 +1         mov     A, INPORTA
0776 541E           1504 +1         anl     A, #00011110b
0778 C3             1505 +1         clr     C
0779 33             1506 +1         rlc     A
077A C3             1507 +1         clr     C
077B 33             1508 +1         rlc     A
077C C3             1509 +1         clr     C
077D 33             1510 +1         rlc     A
                    1511 +1 ;LL1   
077E C3             1512 +1         clr     C
077F 33             1513 +1         rlc     A
VYTAH/ORIOD,+©4                                                                                              PAGE 29

0780 D8FC           1514 +1         djnz    R0, $-2;LL1
0782 6003           1516            jz      D4_MB1C         ; |   ak neni zastavujem          
0784 02052A         1517            ljmp    DOWN3         ;-; |       
0787 C221           1518    D4_MB1C:clr     DOWN            ; zastav motor
0789 D23B           1519            setb    DOWNOld         ;       (a zalohuj)
078B C23A           1520            clr     UPOld           ;       (a zalohuj)
078D C222           1521            clr     FAST            ; 
078F 120868         1522            lcall   WRITEPORTS      ; 
0792 8124           1523            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1524                    
                    1525      
0794                1526    ERR_1SPOM_C: 
0794 C220           1527            clr     UP              ; zastav motor
0796 C221           1528            clr     DOWN            ; 
0798 120868         1529            lcall   WRITEPORTS      ; 
                    1530 +1         _BP_
079B C2B3           1531 +1         clr     P3.3
079D D2AA           1532 +1         setb    EX1
079F 00             1533 +1         nop
07A0 00             1534 +1         nop
07A1 00             1536            nop
07A2 00             1537            nop 
                    1538            
07A3                1539    ERR_2SPOM_C: 
07A3 C220           1540            clr     UP              ; zastav motor
07A5 C221           1541            clr     DOWN            ; 
07A7 120868         1542            lcall   WRITEPORTS      ; 
                    1543 +1         _BP_
07AA C2B3           1544 +1         clr     P3.3
07AC D2AA           1545 +1         setb    EX1
07AE 00             1546 +1         nop
07AF 00             1547 +1         nop
07B0 00             1549            nop
07B1 00             1550            nop 
                    1551            
07B2                1552    ERR_ZAST_C: 
07B2 C220           1553            clr     UP              ; zastav motor
07B4 C221           1554            clr     DOWN            ; 
07B6 120868         1555            lcall   WRITEPORTS      ; 
                    1556 +1         _BP_
07B9 C2B3           1557 +1         clr     P3.3
07BB D2AA           1558 +1         setb    EX1
07BD 00             1559 +1         nop
07BE 00             1560 +1         nop
07BF 00             1562            nop
07C0 00             1563            nop 
                    1564            
07C1                1565    ERR_SKRD: 
07C1 C220           1566            clr     UP              ; zastav motor
07C3 C221           1567            clr     DOWN            ; 
07C5 120868         1568            lcall   WRITEPORTS      ; 
                    1569 +1         _BP_
07C8 C2B3           1570 +1         clr     P3.3
07CA D2AA           1571 +1         setb    EX1
07CC 00             1572 +1         nop
07CD 00             1573 +1         nop
07CE 00             1575            nop
07CF 00             1576            nop    
VYTAH/ORID                                                                                                  PAGE 30

                    1577            
07D0                1578    ERR_SKRH: 
07D0 C220           1579            clr     UP              ; zastav motor
07D2 C221           1580            clr     DOWN            ; 
07D4 120868         1581            lcall   WRITEPORTS      ; 
                    1582 +1         _BP_
07D7 C2B3           1583 +1         clr     P3.3
07D9 D2AA           1584 +1         setb    EX1
07DB 00             1585 +1         nop
07DC 00             1586 +1         nop
07DD 00             1588            nop
07DE 00             1589            nop             
                    1590                    
                    1591                    
07DF                1592    ENDPROG:
07DF D218           1593            setb    KS
07E1 120868         1594            call    WRITEPORTS                ; zapis novu informaciu
                    1595 +1         _BP_
07E4 C2B3           1596 +1         clr     P3.3
07E6 D2AA           1597 +1         setb    EX1
07E8 00             1598 +1         nop
07E9 00             1599 +1         nop
07EA 22             1601            ret
                    1602            
                    1603    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1604    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1605    ; 11.0592MHz/2000 = zdrzanie 1 ms
07EB                1606    TIME10MS:
07EB 7963           1607            mov     R1,#063h        ; 2
                    1608                                    ; *** 100x
07ED 7AFF           1609    TIME0:  mov     R2,#0FFh        ; 2 
07EF DAFE           1610    TIME1:  djnz    R2,TIME1        ; 256*2   
07F1 7AFF           1611            mov     R2,#0FFh        ; 2       
07F3 DAFE           1612    TIME2:  djnz    R2,TIME2        ; 256*2 
07F5 7A24           1613            mov     R2,#024h        ; 2       
07F7 DAFE           1614    TIME3:  djnz    R2,TIME3        ; 36*2
07F9 00             1615            nop                     ; 1
07FA D9F1           1616            djnz    R1,TIME0        ; 2
                    1617                                    ; ***
07FC 792A           1618            mov     R1,#02Ah        ; 2 
07FE D9FE           1619    TIME4:  djnz    R1,TIME4        ; 43*2  
0800 22             1620            ret                     ; koniec
                    1621            
                    1622            
                    1623    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1624    ; DELAY
                    1625    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1626    ; bude timer)
                    1627    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0801                1628    WAITFORTIMER:
0801 7B10           1629            mov     R3, #10h
0803 1207EB         1630    DEL1:   lcall   TIME10MS
0806 DBFB           1631            djnz    R3, DEL1
0808 22             1632            ret
                    1633    
                    1634    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1635    ; WAITFORTIMER
                    1636    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
VYTAH/ORI                                                                                                     PAGE 31

                    1637    ; bude timer)
                    1638    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0809                1639    WAITFORTIMER2:
0809 D22C           1640            setb    PO3U                        ; rozsvieti indikator cakania (poschodie 4)
080B 120868         1641            lcall   WRITEPORTS                  ;
080E 12081A         1642    WAIT:   lcall   READPORTS                   ; 
0811 3013ED         1643            jnb     PI3D, WAITFORTIMER          ; ak nebolo stlacene tlacidlo PO1, cakaj 
0814 C22C           1644            clr     PO3U                         ; zhasne indikator cakania (poschodie 4)
0816 120868         1645            lcall   WRITEPORTS
0819 22             1646            ret
                    1647    
                    1648    
                    1649    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1650    ; READPORTS
                    1651    ; precita nove hodnoty na portoch
                    1652    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
081A                1653    READPORTS:
081A 75A080         1654            mov     p2, #i8255INA       ; citaj data z portu A
081D 75803F         1655            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
0820 C2B7           1656            clr     RDNOT
0822 00             1657            nop
0823 00             1658            nop
0824 00             1659            nop
0825 00             1660            nop
0826 858028         1661            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
0829 D2B7           1662            setb    RDNOT
                    1663            
082B 75A081         1664            mov     p2, #i8255INB       ; citaj data z portu B
082E 7580FE         1665            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
0831 C2B7           1666            clr     RDNOT
0833 00             1667            nop
0834 00             1668            nop
0835 00             1669            nop
0836 00             1670            nop
0837 858021         1671            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
083A D2B7           1672            setb    RDNOT
                    1673    
083C 75A082         1674            mov     p2, #i8255INC       ; citaj data z portu C
083F 75803F         1675            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
0842 C2B7           1676            clr     RDNOT
0844 00             1677            nop
0845 00             1678            nop
0846 00             1679            nop
0847 00             1680            nop
0848 858022         1681            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
084B D2B7           1682            setb    RDNOT
084D 00             1683            nop
084E 00             1684            nop
084F 00             1685            nop
0850 00             1686            nop
0851 00             1687            nop
0852 00             1688            nop
0853 00             1689            nop
0854 00             1690            nop
0855 E528           1691            mov     A, INPORTA
0857 541E           1692            anl     A, #00011110b
0859 4223           1693            orl     OUTPORTA, A
VYTAH/ORI(+D                                                                                                  PAGE 32

085B 120868         1694            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
085E E522           1695            mov     A, INPORTC
0860 543F           1696            anl     A, #00111111b
0862 4225           1697            orl     OUTPORTC, A
0864 120868         1698            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1699            
0867 22             1700            ret
                    1701            
                    1702    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1703    ; WRITEPORTS
                    1704    ; spravi zalohu vystupnych registrov a posle data von
                    1705    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0868                1706    WRITEPORTS:
0868 852380         1707            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
086B 75A0C0         1708            mov     p2, #i8255OUTA
086E C2B6           1709            clr     WRNOT
0870 00             1710            nop
0871 00             1711            nop
0872 00             1712            nop
0873 00             1713            nop
0874 D2B6           1714            setb    WRNOT
                    1715            
0876 852480         1716            mov     p0, OUTPORTB        ; potom port B
0879 75A0C1         1717            mov     p2, #i8255OUTB
087C C2B6           1718            clr     WRNOT
087E 00             1719            nop
087F 00             1720            nop
0880 00             1721            nop
0881 00             1722            nop
0882 D2B6           1723            setb    WRNOT
                    1724    
0884 852580         1725            mov     p0, OUTPORTC        ; a nakoniec port C
0887 75A0C2         1726            mov     p2, #i8255OUTC
088A C2B6           1727            clr     WRNOT
088C 00             1728            nop
088D 00             1729            nop
088E 00             1730            nop
088F 00             1731            nop
0890 D2B6           1732            setb    WRNOT
0892 00             1733            nop
0893 00             1734            nop
0894 00             1735            nop
0895 00             1736            nop
0896 00             1737            nop
0897 00             1738            nop
0898 00             1739            nop
0899 00             1740            nop
089A 22             1741            ret
                    1742    
                    1743    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1744    
089B 0D0A5269       1745    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
089F 61646961   
08A3 63692073   
08A7 79737465   
08AB 6D206A65   
08AF 20696E69   
08B3 6369616C   
VYTAH/ORI D                                                                                                  PAGE 33

08B7 697A6F76   
08BB 616E792E   
08BF 0D0A00     
08C2 52696164       1746    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
08C6 69616369   
08CA 20737973   
08CE 74656D20   
08D2 6A652072   
08D6 65696E69   
08DA 6369616C   
08DE 697A6F76   
08E2 616E7920   
08E6 706F2073   
08EA 746C6163   
08EE 656E6920   
08F2 746C6163   
08F6 69646C61   
08FA 2053544F   
08FE 502E0D0A   
0902 00         
0903 4B616C69       1747    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
0907 62726163   
090B 69612076   
090F 79746168   
0913 75206A65   
0917 20756B6F   
091B 6E63656E   
091F 612E0D0A   
0923 00         
                    1748    
----                1749            DSEG
0040                1750            org     40h
0040                1751    STACK:  DS      10h
                    1752    
                    1753    end

VERSION 1.2h ASSEMBLY COMPLETE, 0 ERRORS FOUND
VYTAH/ORI                                                                                                     PAGE 34

BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0096H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00ADH  
CALIBEND2. . . . . . . . . . . .  C ADDR  00B8H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A5H  
CANGO. . . . . . . . . . . . . .  B ADDR  0038H  NOT USED  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  0417H  
D3_MB1C. . . . . . . . . . . . .  C ADDR  0636H  
D3_MB2C. . . . . . . . . . . . .  C ADDR  05D6H  
D4_MB1C. . . . . . . . . . . . .  C ADDR  0787H  
D4_MB2C. . . . . . . . . . . . .  C ADDR  0727H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0803H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  0398H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  040CH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  03DDH  
VYTAH/ORI                                                                                                     PAGE 35

DOWN3. . . . . . . . . . . . . .  C ADDR  052AH  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  05E0H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  056FH  
DOWN4. . . . . . . . . . . . . .  C ADDR  067BH  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  0731H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  06C0H  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  NOT USED  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
ENDPROG. . . . . . . . . . . . .  C ADDR  07DFH  NOT USED  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  0794H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  07A3H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  07C1H  
ERR_SKRH . . . . . . . . . . . .  C ADDR  07D0H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  07B2H  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  00F3H  
F1S. . . . . . . . . . . . . . .  C ADDR  00DBH  
F2 . . . . . . . . . . . . . . .  C ADDR  026AH  
F2DOWN . . . . . . . . . . . . .  C ADDR  027CH  
F2OK . . . . . . . . . . . . . .  C ADDR  023CH  
F2S. . . . . . . . . . . . . . .  C ADDR  0223H  
F2SW . . . . . . . . . . . . . .  C ADDR  0250H  
F2UP . . . . . . . . . . . . . .  C ADDR  0270H  
F3 . . . . . . . . . . . . . . .  C ADDR  047FH  
F3DOWN . . . . . . . . . . . . .  C ADDR  0491H  
F3OK . . . . . . . . . . . . . .  C ADDR  0451H  
F3S. . . . . . . . . . . . . . .  C ADDR  0438H  
F3SW . . . . . . . . . . . . . .  C ADDR  0465H  
F3UP . . . . . . . . . . . . . .  C ADDR  0485H  
F4OK . . . . . . . . . . . . . .  C ADDR  066FH  
F4S. . . . . . . . . . . . . . .  C ADDR  0657H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C7H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  020FH  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0424H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  0643H  
FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
VYTAH/ORI                                                                                                     PAGE 36

LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C7H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  081AH  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  NOT USED  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0903H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  089BH  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  08C2H  NOT USED  
TIME0. . . . . . . . . . . . . .  C ADDR  07EDH  
TIME1. . . . . . . . . . . . . .  C ADDR  07EFH  
TIME10MS . . . . . . . . . . . .  C ADDR  07EBH  
TIME2. . . . . . . . . . . . . .  C ADDR  07F3H  
TIME3. . . . . . . . . . . . . .  C ADDR  07F7H  
VYTAH/ORI                                                                                                     PAGE 37

TIME4. . . . . . . . . . . . . .  C ADDR  07FEH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U1_MB1C. . . . . . . . . . . . .  C ADDR  0201H  
U1_MB2C. . . . . . . . . . . . .  C ADDR  01A6H  
U2_MB1C. . . . . . . . . . . . .  C ADDR  038AH  
U2_MB2C. . . . . . . . . . . . .  C ADDR  032FH  
U3_MB1C. . . . . . . . . . . . .  C ADDR  051CH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  00FFH  
UP1A . . . . . . . . . . . . . .  C ADDR  011CH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  01B0H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0144H  
UP2. . . . . . . . . . . . . . .  C ADDR  0288H  
UP2A . . . . . . . . . . . . . .  C ADDR  02A5H  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0339H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  02CDH  
UP3. . . . . . . . . . . . . . .  C ADDR  049DH  
UP3A . . . . . . . . . . . . . .  C ADDR  04BAH  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0511H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  04E2H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAIT . . . . . . . . . . . . . .  C ADDR  080EH  NOT USED  
WAITFORTIMER . . . . . . . . . .  C ADDR  0801H  
WAITFORTIMER2. . . . . . . . . .  C ADDR  0809H  NOT USED  
WRITEPORTS . . . . . . . . . . .  C ADDR  0868H  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
