DEBUG                                                                                                         PAGE 1

                       1    ; TODO: 
                       2    ; OK - Dorob nulovanie volieb v sachte 
                       3    ; Dorob 3UP a 2 DOWN (tam kde stojis vzdy)
                       4    ; Asi by bolo dobre premenovat PI1, PO1 a PI4 PO4 na alternativy s koncovkami U a D
                       5    ; Poriadne otestuj !!! 
                       6    ; Umo+zni stlacat tlacidla aj ked bezi delay
                       7    
                       8    
                       9    $MOD51
                      10    $DEBUG
                      11    
                =1    12    $include (lift.inc)
                =1    13    ; adresy I/O portov, ktore pridu na port P2 89C52-ky
  0080          =1    14    i8255INA        equ     080h
  0081          =1    15    i8255INB        equ     081h
  0082          =1    16    i8255INC        equ     082h
  0083          =1    17    i8255INCW       equ     083h
  00C0          =1    18    i8255OUTA       equ     0c0h
  00C1          =1    19    i8255OUTB       equ     0c1h
  00C2          =1    20    i8255OUTC       equ     0c2h
  00C3          =1    21    i8255OUTCW      equ     0c3h
                =1    22    
  0028          =1    23    INPORTA         data    28h         ; nutne kvoli emulatoru!!!
  0021          =1    24    INPORTB         data    21h
  0022          =1    25    INPORTC         data    22h
  0023          =1    26    OUTPORTA        data    23h
  0024          =1    27    OUTPORTB        data    24h
  0025          =1    28    OUTPORTC        data    25h
  0026          =1    29    INPORTBold      data    26h
  0027          =1    30    CTRLREG         data    27h
                =1    31    
  0030          =1    32    POSITION        data    30h
  0031          =1    33    LOWEST          data    31h
  0032          =1    34    HIGHEST         data    32h
  0033          =1    35    STOPTIMER       data    33h
  0034          =1    36    OUTPORTBold     data    34h
                =1    37    
                =1    38    ;----------------
  0036          =1    39    FLOORREQ        data    36h
                =1    40    ;----------------
                =1    41    
  0040          =1    42    STOPNOT         bit     INPORTA.0
  0041          =1    43    PKI1            bit     INPORTA.1
  0042          =1    44    PKI2            bit     INPORTA.2
  0043          =1    45    PKI3            bit     INPORTA.3
  0044          =1    46    PKI4            bit     INPORTA.4
  0045          =1    47    DOORCLSD        bit     INPORTA.5 
                =1    48    
  0009          =1    49    MB1             bit     INPORTB.1       ; clonky maju invertovanu logiku
  000A          =1    50    MB2             bit     INPORTB.2
  000B          =1    51    SKRH            bit     INPORTB.3
  000C          =1    52    SKRD            bit     INPORTB.4
  000D          =1    53    DP              bit     INPORTB.5
  000E          =1    54    DPZK            bit     INPORTB.6
  000F          =1    55    DPK             bit     INPORTB.7
                =1    56    
  0031          =1    57    MB1old          bit     INPORTBold.1
  0032          =1    58    MB2old          bit     INPORTBold.2
DEBUG                                                                                                         PAGE 2

  0033          =1    59    SKRHold         bit     INPORTBold.3
  0034          =1    60    SKRDold         bit     INPORTBold.4
                =1    61    
                =1    62    
                =1    63    
                =1    64    
                =1    65    
  0010          =1    66    PI1             bit     INPORTC.0       
  0011          =1    67    PI2D            bit     INPORTC.1
  0012          =1    68    PI2U            bit     INPORTC.2
  0013          =1    69    PI3D            bit     INPORTC.3
  0014          =1    70    PI3U            bit     INPORTC.4
  0015          =1    71    PI4             bit     INPORTC.5
                =1    72    
                =1    73    
                =1    74    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                =1    75    ; ****************************************************************************
                =1    76    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                =1    77    ; ----------------------------------------------------------------------------
                =1    78    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                =1    79    ; ----------------------------------------------------------------------------
                =1    80    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                =1    81    ; ****************************************************************************
                =1    82    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                =1    83    ; ----------------------------------------------------------------------------
                =1    84    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                =1    85    ; ----------------------------------------------------------------------------
                =1    86    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                =1    87    ; ----------------------------------------------------------------------------
                =1    88    
                =1    89    
  0018          =1    90    KS              bit     OUTPORTA.0
  0019          =1    91    PKO1            bit     OUTPORTA.1
  001A          =1    92    PKO2            bit     OUTPORTA.2
  001B          =1    93    PKO3            bit     OUTPORTA.3
  001C          =1    94    PKO4            bit     OUTPORTA.4
                =1    95    
  0020          =1    96    UP              bit     OUTPORTB.0
  0021          =1    97    DOWN            bit     OUTPORTB.1
  0022          =1    98    FAST            bit     OUTPORTB.2
  0023          =1    99    SLOW            bit     OUTPORTB.3
  0024          =1   100    FLED1           bit     OUTPORTB.4
  0025          =1   101    FLED2           bit     OUTPORTB.5
  0026          =1   102    FLED3           bit     OUTPORTB.6
  0027          =1   103    FLED4           bit     OUTPORTB.7
                =1   104    
  0028          =1   105    PO1             bit     OUTPORTC.0
  0029          =1   106    PO2D            bit     OUTPORTC.1
  002A          =1   107    PO2U            bit     OUTPORTC.2
  002B          =1   108    PO3D            bit     OUTPORTC.3
  002C          =1   109    PO3U            bit     OUTPORTC.4
  002D          =1   110    PO4             bit     OUTPORTC.5
  002E          =1   111    LEDD            bit     OUTPORTC.6
  002F          =1   112    LEDU            bit     OUTPORTC.7
                =1   113    
  0038          =1   114    STOPPED         bit     CTRLREG.0
  0039          =1   115    DOORCLSDold     bit     CTRLREG.1
  003A          =1   116    UPold           bit     CTRLREG.2
DEBUG                                                                                                         PAGE 3

  003B          =1   117    DOWNold         bit     CTRLREG.3
  003C          =1   118    FASTold         bit     CTRLREG.4
  003D          =1   119    SLOWold         bit     CTRLREG.5
                =1   120    
  00B6          =1   121    WRNOT           bit     0b6h        ; p3.6
  00B7          =1   122    RDNOT           bit     0b7h        ; p3.7
                =1   123    
                =1   124    ; bitove masky
                =1   125    ; 8255OUT 
                =1   126    ; port A
  0001          =1   127    bmKS              equ    00000001b
  0002          =1   128    bmPKO1            equ    00000010b
  0004          =1   129    bmPKO2            equ    00000100b
  0008          =1   130    bmPKO3            equ    00001000b
  0010          =1   131    bmPKO4            equ    00010000b
                =1   132    
                =1   133    ; port B
  0001          =1   134    bmUP              equ    00000001b
  0002          =1   135    bmDOWN            equ    00000010b
  0004          =1   136    bmFAST            equ    00000100b
  0008          =1   137    bmSLOW            equ    00001000b
  0010          =1   138    bmFLED1           equ    00010000b
  0020          =1   139    bmFLED2           equ    00100000b
  0040          =1   140    bmFLED3           equ    01000000b
  0080          =1   141    bmFLED4           equ    10000000b
                =1   142    
                =1   143    ; port C
  0001          =1   144    bmPO1             equ    00000001b
  0002          =1   145    bmPO2D            equ    00000010b
  0004          =1   146    bmPO2U            equ    00000100b
  0008          =1   147    bmPO3D            equ    00001000b
  0010          =1   148    bmPO3U            equ    00010000b
  0020          =1   149    bmPO4             equ    00100000b
  0040          =1   150    bmLEDD            equ    01000000b
  0080          =1   151    bmLEDU            equ    10000000b
                =1   152    
                =1   153    ; 8255IN
                =1   154    ; port A
  0001          =1   155    bmSTOP            equ    00000001b
  0002          =1   156    bmPKI1            equ    00000010b
  0004          =1   157    bmPKI2            equ    00000100b
  0008          =1   158    bmPKI3            equ    00001000b
  0010          =1   159    bmPKI4            equ    00010000b
  0020          =1   160    bmDOORCLSD        equ    00100000b
                =1   161    
                =1   162    ; port B
  0002          =1   163    bmMB1I            equ    00000010b
  0004          =1   164    bmMB2I            equ    00000100b
  0008          =1   165    bmSKRHI           equ    00001000b
  0010          =1   166    bmSKRHD           equ    00010000b
  0020          =1   167    bmDPI             equ    00100000b
  0040          =1   168    bmDPZKI           equ    01000000b
  0080          =1   169    bmDPKI            equ    10000000b
                =1   170    
                =1   171    ; port C
  0001          =1   172    bmPI1             equ    00000001b
  0002          =1   173    bmPI2D            equ    00000010b
  0004          =1   174    bmPI2U            equ    00000100b
DEBUG                                                                                                         PAGE 4

  0008          =1   175    bmPI3D            equ    00001000b
  0010          =1   176    bmPI3U            equ    00010000b
  0020          =1   177    bmPI4             equ    00100000b
                =1   178    
                =1   179    ; Sachta - masky
  003E          =1   180    bmSmerPI1U            equ    00111110b
  0001          =1   181    bmSmerPI2D            equ    00000001b
  0038          =1   182    bmSmerPI2U            equ    00111000b
  0007          =1   183    bmSmerPI3D            equ    00000111b
  0020          =1   184    bmSmerPI3U            equ    00100000b
  001F          =1   185    bmSmerPI4D            equ    00011111b
                =1   186    
                =1   187    ; Kabina - masky
  001C          =1   188    bmSmerPKI1U           equ    00011100b
  0002          =1   189    bmSmerPKI2D           equ    00000010b
  0018          =1   190    bmSmerPKI2U           equ    00011000b
  0006          =1   191    bmSmerPKI3D           equ    00000110b
  0010          =1   192    bmSmerPKI3U           equ    00010000b
  000E          =1   193    bmSmerPKI4D           equ    00001110b
                     194    
                     195    _BP_    MACRO 
                     196            clr     P3.3
                     197            setb    EX1
                     198            nop
                     199            nop
                     200    ENDM
                     201    
                     202    LJZ     MACRO   NAVESTIE
                     203            jnz     $+5
                     204            ljmp    NAVESTIE
                     205            nop
                     206    ENDM
                     207    
                     208    LJNZ    MACRO   NAVESTIE
                     209            jz      $+5
                     210            ljmp    NAVESTIE
                     211            nop
                     212    ENDM
                     213    
                     214    LJB     MACRO   TESTBIT, NAVESTIE
                     215            jnb     TESTBIT, $+6
                     216            ljmp    NAVESTIE
                     217            nop
                     218    ENDM
                     219    
                     220    LJNB    MACRO   TESTBIT, NAVESTIE
                     221            jb      TESTBIT, $+6
                     222            ljmp    NAVESTIE
                     223            nop
                     224    ENDM
                     225    
                     226    CJE     MACRO   OP1, OP2, NAVESTIE
                     227            cjne    OP1, OP2, $+7
                     228            jmp    NAVESTIE
                     229            nop
                     230    ENDM
                     231    
                     232    LCJNE   MACRO   OP1, OP2, NAVESTIE
DEBUG                                                                                                         PAGE 5

                     233            cjne    OP1, OP2, $+6
                     234            jmp     $+6
                     235            ljmp    NAVESTIE
                     236            nop
                     237    ENDM
                     238    
                     239    ZAKMITC MACRO   TYPCLONKY
                     240            lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
                     241            lcall   READPORTS       ; Uz sme z tej clonky prec?
                     242            jnb     TYPCLONKY, $-3  ; 
                     243            lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     244    ENDM
                     245    
                     246    ZASTAV  MACRO  C_POSCH, SMER
                     247                                            ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
                     248            clr     C                       ; | Idem robit cachre-machre s Carry bitom
                     249            mov     A, #0h                  ; | Aj Acc potrebujem prazdny
                     250            orl     C, PI&C_POSCH&SMER      ; | Mam v tomto smere stlacene tlacidlo v sachte?
                     251            anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
                     252            orl     C, PKI&C_POSCH          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
                     253            orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
                     254            orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
                     255            addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
                     256    ENDM
                     257    
                     258    NAJNIZSIE  MACRO
                     259            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     260            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
                     261            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     262            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     263     ; LL1: 
                     264            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     265            clr     C               ; Inak shiftnem o 2
                     266            rlc     A               ;
                     267            clr     C               ;
                     268            rlc     A               ;
                     269            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     270    ; LL2:
                     271            mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     272    ENDM
                     273    
                     274    NAJVYSSIE  MACRO
                     275            mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
                     276            rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
DEBUG                                                                                                         PAGE 6

                     277            anl     A, #01111110b   ; Vynulujem nedefinovane bity
                     278            mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     279     ; LL1: 
                     280            jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
                     281            clr     C               ; Inak shiftnem o 2
                     282            rrc     A               ;
                     283            clr     C               ;
                     284            rrc     A               ;
                     285            djnz    R0, $-6         ; ...a pokracujem v zistovani
                     286    ; LL2:
                     287            mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
                     288            clr     C               ;
                     289            subb    A, R0           ;
                     290    ENDM
                     291    
                     292    VYSSIE_KABINA  MACRO  POSCH
                     293            mov     A, INPORTA
                     294            anl     A, #00011110b
                     295            clr     C
                     296            rrc     A
                     297    ;LL1    
                     298            mov     R0, #&POSCH
                     299            clr     C
                     300            rrc     A
                     301            djnz    R0, $-2;LL1
                     302    ENDM
                     303    
                     304    NIZSIE_KABINA  MACRO  POSCH
                     305            mov     A, #5
                     306            clr     C
                     307            subb    A, #&POSCH
                     308            mov     R0, A
                     309            mov     A, INPORTA
                     310            anl     A, #00011110b
                     311            clr     C
                     312            rlc     A
                     313            clr     C
                     314            rlc     A
                     315            clr     C
                     316            rlc     A
                     317    ;LL1   
                     318            clr     C
                     319            rlc     A
                     320            djnz    R0, $-2;LL1
                     321    ENDM
                     322    
                     323    POLOHA_LED  MACRO  POLOHA
                     324            clr     LEDU            
                     325            clr     LEDD 
                     326            clr     FLED1             
                     327            clr     FLED2                
                     328            clr     FLED3           
                     329            clr     FLED4           
                     330            setb    FLED&POLOHA
                     331            lcall   WRITEPORTS
DEBUG                                                                                                         PAGE 7

                     332    ENDM
                     333    
                     334    ; hodiny oscilatora v emulatore treba dat na ext a nastavit 11.0592MHz
  00FA               335    TIMERCONST      equ     250     ; udaj pre nastavenie casovaca pre potreby seriovej komunika
                                                                               cie
                     336                                    ; hodnota 250 znamena prenosovu rychlost 4800 baud pri oscil
                                                                               atore 11.0592MHz
                     337                                    ; nastavenie terminalu je 4800 8-N-1, no flow control
                     338    ;osetrenie vektorov preruseni
0000                 339            org     0000h           ; adresa odkial startuje program po resete
0000 020033          340            ljmp    START           ; skok na zaciatok kodu programu
                     341            
000B                 342            org     000Bh           ; v tejto casti pamati je vektor prerusenia
000B 020000          343            ljmp    INT_TIMER0      ; pre citac T0
****----------------------------------------^
****ERROR #2: Undefined symbol
                     344                  
0033                 345            org     0033h           ; od tejto adresy sa zacina kod programu
                     346            
0033                 347    START:
0033                 348    RESET:  
                     349            ; riadiace signaly do pasivnej urovne 
0033 D2B6            350            setb    WRNOT
0035 D2B7            351            setb    RDNOT
0037 753300          352            mov     STOPTIMER, #0
003A 758140          353            mov     SP, #STACK
                     354    
                     355            ; pockame si na inicializaciu obvodov 8255  
003D 7900            356            mov     R1, #0 
003F 7AFF            357            mov     R2, #0ffh
0041 D9FE            358            djnz    R1, $
0043 DAFC            359            djnz    R2, $-2
                     360            
                     361            ; teraz ich mozeme nastavit
0045 75809B          362            mov     p0, #10011011b      ; nastavenie i8255IN - vsetky porty dnu
0048 75A083          363            mov     p2, #i8255INCW
004B C2B6            364            clr     WRNOT
004D 00              365            nop
004E 00              366            nop
004F 00              367            nop
0050 00              368            nop
0051 D2B6            369            setb    WRNOT
0053 758080          370            mov     p0, #10000000b      ; nastavenie i8255OUT - vsetky porty von
0056 75A0C3          371            mov     p2, #i8255OUTCW
0059 C2B6            372            clr     WRNOT
005B 00              373            nop
005C 00              374            nop
005D 00              375            nop
005E 00              376            nop
005F D2B6            377            setb    WRNOT
                     378            
                     379            ;_BP_
                     380            
                     381            ;-----------------------
                     382            ; Prerusenia
                     383            ;----------------------- 
                     384            ;clr     TR1                 ; zastavi sa citac T1
                     385            ;clr     TR0                 ; a tiez citac T0
DEBUG                                                                                                         PAGE 8

                     386            ;mov     SCON,#01010010b     ; nastavenie registra SCON
                     387            ;                            ; mod 1 (8b UART), SM2=0 (jednoprocesorovy system)
                     388            ;                            ; REN=1, 0, 0, TI=1 (vysielaci register je prazdny)
                     389            ;                            ; RI=0 (prijimaci register - nebol prijaty znak)
                     390            ;mov     TCON,#00000001b     ; INT0 je citlive na zostupnu hranu
                     391            ;mov     TMOD,#00100001b     ; nastavenie TMOD registra
                     392            ;                            ; T1: mod 2 - po preteceni sa TL nastavi na hodnotu TH
                                                                               
                     393            ;                            ; GATE=0 (programove riadenie casovaca)
                     394            ;                            ; C/T#=0 interne hodiny/12
                     395            ;                            ; T0: mod 1 - 16 bitove pocitadlo
                     396            ;                            ; GATE=0 (programove riadenie casovaca)
                     397            ;                            ; C/T#=0 interne hodiny/12
                     398            ;mov     PCON,#00000000b     ; najvyssi bit musi byt 0, aby sa nezdvojnasobila preno
                                                                               sova rychlost seriovej linky
                     399            ;mov     TL1,#TIMERCONST     ; inicializacia casovaca T1
                     400            ;mov     TH1,#TIMERCONST     ; 
                     401            ;mov     TL0, #0D2h           ; inicializacia casovaca T0 65409,92(- 57600 = 0e100h 
                                                                               - to bolo)
                     402            ;mov     TH0, #0FFh
                     403    
                     404            ;setb    TR1                 ; aktivacia T1 => spustenie seriovej linky
                     405            ;_BP_
                     406    
                     407    ;       ;setb    EX0                 ; prerusenie INT0  - ostava zakazane, signal STOP osetr
                                                                               ime priamo v hlavnej slucke
                     408    ;       ;setb    ES                  ; prerusenie seriovej linky teraz nevyuzivame
                     409            ;setb    ET0                 ; povolime prerusenia od casovaca T0
                     410            ;setb    TR0
                     411            ;setb    EA                  ; spust cely prerusovaci mechanizmus
                     412            ;-----------------------
                     413            ; Prerusenia
                     414            ;-----------------------
                     415            
                     416    
                     417            ; pociatocna inicializacia - vynuluj vstupne registre a rozsviet vsetky diody 
0061 752800          418            mov     INPORTA, #0
0064 75211E          419            mov     INPORTB, #01eh      ; vsetky clonky pasivne
0067 752200          420            mov     INPORTC, #0
006A 75231E          421            mov     OUTPORTA, #(bmPKO1 or bmPKO2 or bmPKO3 or bmPKO4)
006D 7524F0          422            mov     OUTPORTB, #(bmFLED1 or bmFLED2 or bmFLED3 or bmFLED4)
0070 7525FF          423            mov     OUTPORTC, #(bmPO1 or bmPO2D or bmPO2U or bmPO3D or bmPO3U or bmPO4 or bmLEDD
                                                                                or bmLEDU)
0073 D218            424            setb    KS
0075 C238            425            clr     STOPPED
0077 1208FE          426            call    WRITEPORTS          ; zapis novu informaciu
                     427    ;;;;;;;;
                     428    
007A 752300          429            mov     OUTPORTA, #0
007D 752400          430            mov     OUTPORTB, #0
0080 752500          431            mov     OUTPORTC, #0
0083 1208FE          432            call    WRITEPORTS          ; zapis novu informaciu
                     433    
0086 752800          434            mov     INPORTA, #0
0089 752100          435            mov     INPORTB, #0         
008C 752200          436            mov     INPORTC, #0
008F 1208A3          437            call    READPORTS           ; prvotne nacitanie udajov
                     438    
DEBUG                                                                                                         PAGE 9

0092                 439    CALIB:
                     440            ;kalibracia vytahu podla dolnej porovnavacej clonky
                     441            ;setb    TR0
0092 1208A3          442            lcall   READPORTS                   ; precitaj, co je na portoch
0095 300C11          443            jnb     SKRD, CALIBEND              ; ak sme na dolnej porovnavacej clonke, tak koni
                                                                               ec
0098 D221            444            setb    DOWN                        ; inak pod dole
009A D222            445            setb    FAST                        ; a rychlo
009C C223            446            clr     SLOW                        ;
009E 1208FE          447            lcall   WRITEPORTS                  ; zapis informaciu 
00A1                 448    CALIBLOOP:
00A1 1208A3          449            lcall   READPORTS                   ; 
00A4 300C02          450            jnb     SKRD, CALIBEND              ; ak sme dole, konci
00A7 80F8            451            jmp     CALIBLOOP
00A9                 452    CALIBEND:                              
00A9 C222            453            clr     FAST                        ; zastavime v tomto smere
00AB C221            454            clr     DOWN                        ;
00AD D223            455            setb    SLOW                        ; Este sa pohneme kusocek hore, aby sme si 
00AF D220            456            setb    UP                          ; boli isti, ze sme spravne synchronizovani na p
                                                                               oschodi
00B1 1208FE          457            lcall   WRITEPORTS 
00B4                 458    CALIBEND2:
00B4 1208A3          459            lcall   READPORTS                   ; 
00B7 2009FA          460            jb      MB1, CALIBEND2              ; 
00BA C223            461            clr     SLOW                        ; A teraz sme uz naozaj spravne
00BC C220            462            clr     UP                          ; 
00BE D224            463            setb    FLED1
00C0 1208FE          464            lcall   WRITEPORTS                  ; zapis informaciu
                     465            ;clr     TR0
                     466    ;        _BP_
00C3                 467    MAIN:
                     468    
                     469    ;            |  7    |  6    |  5    |  4    |  3    |  2    |  1    |  0    |
                     470    ; ****************************************************************************
                     471    ; INPORTA >  |       |       |DOORCLS| PKI4  | PKI3  | PKI2  | PKI1  |STOPNOT|
                     472    ; ----------------------------------------------------------------------------
                     473    ; INPORTB >  | DPK   | DPZK  | DP    | SKRD  | SKRH  | MB2   | MB1   |       |
                     474    ; ----------------------------------------------------------------------------
                     475    ; INPORTC >  |       |       | PI4   | PI3D  | PI3U  | PI2D  | PI2U  | PI1   |
                     476    ; ****************************************************************************
                     477    ; OUTPORTA > |       |       |       | PKO4  | PKO3  | PKO2  | PKO1  | KS    |
                     478    ; ----------------------------------------------------------------------------
                     479    ; OUTPORTB > | FLED4 | FLED3 | FLED2 | FLED1 | SLOW  | FAST  | DOWN  | UP    |
                     480    ; ----------------------------------------------------------------------------
                     481    ; OUTPORTC > | LEDU  | LEDD  | PO4   | PO3D  | PO3U  | PO2D  | PO2U  | PO1   |
                     482    ; ****************************************************************************
                     483    ; POSITION
                     484    ; ****************************************************************************
                     485    
                     486    
                     487    ;------------------------------------------------------------------------------- << 1. posch
                                                                               odie >>
                     488    
00C3                 489    FLOOR1:
                     490 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00C3 C22F            491 +1         clr     LEDU            
00C5 C22E            492 +1         clr     LEDD 
DEBUG                                                                                                         PAGE 10

00C7 C224            493 +1         clr     FLED1             
00C9 C225            494 +1         clr     FLED2                
00CB C226            495 +1         clr     FLED3           
00CD C227            496 +1         clr     FLED4           
00CF D224            497 +1         setb    FLED1
00D1 1208FE          498 +1         lcall   WRITEPORTS
00D4 12085F          500            lcall   WAITFORTIMER    ; simulacia TIMERu
00D7 1208A3          501    F1S:    lcall   READPORTS     ;-; nacitanie dat
00DA C219            502            clr     PKO1          ;-; vynulovanie volby poschodia na ktorom stojim
00DC C228            503            clr     PO1             ;
00DE 1208FE          504            lcall   WRITEPORTS      ;
00E1 200FF3          505            jb      DPK, F1S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
00E4 E528            506            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Kabina)
00E6 541C            507            anl     A, #00011100b ;-;
00E8 7008            508            jnz     F1OK          ;-; ak ano, podme na to
00EA E522            509            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco viac ako poschodie na kto
                                                                               rom stojim (Sachta)
00EC 543E            510            anl     A, #00111110b ;-;
00EE 7002            511            jnz     F1OK          ;-; ak ano, podme na to
00F0 80E5            512            jmp     F1S             ; Nemam sa kde hnut, opakujem
00F2 D220            513    F1OK:   setb    UP              ; rychly pohyb hore
00F4 D222            514            setb    FAST            ; 
00F6 C223            515            clr     SLOW            ;
00F8 1208FE          516            lcall   WRITEPORTS      ; 
00FB 0200FE          517            jmp     UP1           ;-; prejdi do stavu UP1
00FE                 518    UP1:
                     519 +1                 POLOHA_LED 1  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
00FE C22F            520 +1         clr     LEDU            
0100 C22E            521 +1         clr     LEDD 
0102 C224            522 +1         clr     FLED1             
0104 C225            523 +1         clr     FLED2                
0106 C226            524 +1         clr     FLED3           
0108 C227            525 +1         clr     FLED4           
010A D224            526 +1         setb    FLED1
010C 1208FE          527 +1         lcall   WRITEPORTS
                     529 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
010F 12082A          530 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0112 1208A3          531 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0115 3009FA          532 +1         jnb     MB1, $-3  ; 
0118 12082A          533 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
011B 1208A3          535    UP1A:   lcall   READPORTS       ; nacitanie dat
                     536 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
011E 200B03          537 +1         jb      SKRH, $+6
0121 0207E2          538 +1         ljmp    ERR_SKRH
0124 00              539 +1         nop
                     541 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0125 200903          542 +1         jb      MB1, $+6
0128 0207C7          543 +1         ljmp    ERR_2SPOM_C
012B 00              544 +1         nop
012C 200AEC          546            jb      MB2, UP1A     ;-; mame uz 1. spomalovaciu clonku?
                     547 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
012F 12082A          548 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0132 1208A3          549 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0135 300AFA          550 +1         jnb     MB2, $-3  ; 
DEBUG                                                                                                         PAGE 11

0138 12082A          551 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
013B D22E            553            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
013D 1208FE          554            lcall   WRITEPORTS      ;
0140 020143          555            jmp     UP1_MB2       ;-; a prejdi do stavu UP1_MB2
0143                 556    UP1_MB2:
0143 1208A3          557            lcall   READPORTS       ; nacitanie dat
                     558 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0146 200B03          559 +1         jb      SKRH, $+6
0149 0207E2          560 +1         ljmp    ERR_SKRH
014C 00              561 +1         nop
                     563 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
014D 200903          564 +1         jb      MB1, $+6
0150 0207B8          565 +1         ljmp    ERR_1SPOM_C
0153 00              566 +1         nop
0154 200AEC          568            jb      MB2, UP1_MB2  ;-; mame uz aj druhu spomalovaciu clonku?     
0157 D22F            569            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
0159 1208FE          570            lcall   WRITEPORTS      ;   
                     571 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
015C 12082A          572 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
015F 1208A3          573 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0162 300AFA          574 +1         jnb     MB2, $-3  ; 
0165 12082A          575 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     577    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     578    ;        anl     A, #00000100b ;-;
                     579    ;        jz      UP1_MB1       ;-;       Ak nie, chod do stavu UP1_MB1        
                     580 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     581 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0168 C3              582 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0169 7400            583 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
016B 7212            584 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
016D B00E            585 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
016F 7242            586 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0171 720F            587 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0173 7238            588 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0175 3400            589 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0177 702E            591            jnz     U1_MB2C       ;-; Ak ano, zastav
                     592 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
0179 E522            593 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
017B 33              594 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
017C 547E            595 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
017E 7805            596 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     597 +1  ; LL1: 
0180 6006            598 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
DEBUG                                                                                                         PAGE 12

                                                                               na LL2
0182 C3              599 +1         clr     C               ; Inak shiftnem o 2
0183 13              600 +1         rrc     A               ;
0184 C3              601 +1         clr     C               ;
0185 13              602 +1         rrc     A               ;
0186 D8F8            603 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     604 +1 ; LL2:
0188 7405            605 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
018A C3              606 +1         clr     C               ;
018B 98              607 +1         subb    A, R0           ;
                     609 +1         LCJNE   A, #2, UP1_MB1  ; |   ak nie, nezastavujeme 
018C B40203          610 +1         cjne    A, #2, $+6
018F 020195          611 +1         jmp     $+6
0192 0201B1          612 +1         ljmp    UP1_MB1
0195 00              613 +1         nop
                     615 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0196 E528            616 +1         mov     A, INPORTA
0198 541E            617 +1         anl     A, #00011110b
019A C3              618 +1         clr     C
019B 13              619 +1         rrc     A
                     620 +1 ;LL1    
019C 7802            621 +1         mov     R0, #2
019E C3              622 +1         clr     C
019F 13              623 +1         rrc     A
01A0 D8FC            624 +1         djnz    R0, $-2;LL1
01A2 6003            626            jz      U1_MB2C         ; |   ak neni zastavujem         
01A4 0201B1          627            jmp     UP1_MB1          ; |   inak nezastavim        
01A7 D223            628    U1_MB2C:setb    SLOW            ;       Ak ano, spomalme
01A9 C222            629            clr     FAST            ; 
01AB 1208FE          630            lcall   WRITEPORTS      ;         
01AE 0201B1          631            jmp     UP1_MB1       ;-; a prejdi do stavu UP1_MB1 
01B1                 632    UP1_MB1:
01B1 1208A3          633            lcall   READPORTS       ; nacitanie dat
                     634 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
01B4 200B03          635 +1         jb      SKRH, $+6
01B7 0207E2          636 +1         ljmp    ERR_SKRH
01BA 00              637 +1         nop
                     639 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
01BB 200A03          640 +1         jb      MB2, $+6
01BE 0207D6          641 +1         ljmp    ERR_ZAST_C
01C1 00              642 +1         nop
01C2 2009EC          644            jb      MB1, UP1_MB1  ;-; Sme na zastavovacej clonke?
                     645    
                     646 +1         ZASTAV  2, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                     647 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
01C5 C3              648 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
01C6 7400            649 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
01C8 7212            650 +1         orl     C, PI2U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
01CA B00E            651 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
01CC 7242            652 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
01CE 720F            653 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
DEBUG                                                                                                         PAGE 13

01D0 7238            654 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
01D2 3400            655 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
01D4 C238            657            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
01D6 702E            658            jnz     U1_MB1C       ;-; Ak ano, zastav
                     659 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi? (potom stojime
                                                                                urcite)
01D8 E522            660 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
01DA 33              661 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
01DB 547E            662 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
01DD 7805            663 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     664 +1  ; LL1: 
01DF 6006            665 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
01E1 C3              666 +1         clr     C               ; Inak shiftnem o 2
01E2 13              667 +1         rrc     A               ;
01E3 C3              668 +1         clr     C               ;
01E4 13              669 +1         rrc     A               ;
01E5 D8F8            670 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     671 +1 ; LL2:
01E7 7405            672 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
01E9 C3              673 +1         clr     C               ;
01EA 98              674 +1         subb    A, R0           ;
                     676 +1         LCJNE   A, #2, UP2      ; |   ak nie, nezastavujeme 
01EB B40203          677 +1         cjne    A, #2, $+6
01EE 0201F4          678 +1         jmp     $+6
01F1 020290          679 +1         ljmp    UP2
01F4 00              680 +1         nop
                     682 +1         VYSSIE_KABINA 2         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
01F5 E528            683 +1         mov     A, INPORTA
01F7 541E            684 +1         anl     A, #00011110b
01F9 C3              685 +1         clr     C
01FA 13              686 +1         rrc     A
                     687 +1 ;LL1    
01FB 7802            688 +1         mov     R0, #2
01FD C3              689 +1         clr     C
01FE 13              690 +1         rrc     A
01FF D8FC            691 +1         djnz    R0, $-2;LL1
0201 6003            693            jz      U1_MB1C         ; |   ak neni zastavujem         
0203 020290          694            ljmp    UP2             ; |   inak nezastavim        
0206 C220            695    U1_MB1C:clr     UP              ; zastav motor
0208 D23A            696            setb    UPOld           ;       (a zalohuj) 
020A C23B            697            clr     DOWNOld         ;       (a zalohuj)
020C C222            698            clr     FAST            ; 
020E 1208FE          699            lcall   WRITEPORTS      ; 
0211 020214          700            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2
                     701    
                     702    ;------------------------------------------------------------------------------- << 2. posch
                                                                               odie >>
                     703    
DEBUG                                                                                                         PAGE 14

0214                 704    FLOOR2:
                     705 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0214 C22F            706 +1         clr     LEDU            
0216 C22E            707 +1         clr     LEDD 
0218 C224            708 +1         clr     FLED1             
021A C225            709 +1         clr     FLED2                
021C C226            710 +1         clr     FLED3           
021E C227            711 +1         clr     FLED4           
0220 D225            712 +1         setb    FLED2
0222 1208FE          713 +1         lcall   WRITEPORTS
0225 12085F          715            lcall   WAITFORTIMER    ; simulacia TIMERu
0228 1208A3          716    F2S:    lcall   READPORTS     ;-; nacitanie dat
022B C21A            717            clr     PKO2          ;-; vynulovanie volby poschodia na ktorom stojim
022D C22A            718            clr     PO2U            ;
022F C229            719            clr     PO2D            ;
0231 1208FE          720            lcall   WRITEPORTS      ;
0234 200FF1          721            jb      DPK, F2S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0237 79F8            722            mov     R1, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0239 7AF8            723            mov     R2, #11111000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
023B 203A06          724            jb      UPOld, F2OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
023E E9              725            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
023F F4              726            cpl     A               ;       |
0240 F9              727            mov     R1, A           ;       |
0241 EA              728            mov     A, R2           ;       A znegujeme aj masku sachty
0242 F4              729            cpl     A               ;       |
0243 FA              730            mov     R2, A           ;       |
0244                 731    F2OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0244 E528            732            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0246 541A            733            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0248 59              734            anl     A, R1           ;  | 
0249 7027            735            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     736                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
024B E528            737            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
024D 541A            738            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
024F 7007            739            jnz     F2SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0251 E522            740            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
0253 5439            741            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0255 5A              742            anl     A, R2           ;  |   
0256 701A            743            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
                     744            ; Pohyb v opacnom smere (nevieme v ktorom)
0258 B23A            745    F2SW:   cpl     UPOld           ;  Znegujem stary posun
025A B23B            746            cpl     DOWNOld         ;  |
025C E9              747            mov     A, R1           ;  Znegujeme masky
025D F4              748            cpl     A               ;  |
025E F9              749            mov     R1, A           ;  |
025F EA              750            mov     A, R2           ;  |
0260 F4              751            cpl     A               ;  |
0261 FA              752            mov     R2, A           ;  |               
0262 E528            753            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0264 541A            754            anl     A, #00011010b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0266 59              755            anl     A, R1           ;  | 
DEBUG                                                                                                         PAGE 15

0267 7009            756            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0269 E522            757            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
026B 5439            758            anl     A, #00111001b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
026D 5A              759            anl     A, R2           ;  | 
026E 7002            760            jnz     F2              ; nasli sme poschodie v tomto smere, mozme ist
0270 80B6            761            jmp     F2S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0272 203A03          762    F2:     jb      UPOld, F2UP     ;   
0275 020284          763            jmp     F2DOWN          ;
0278 D220            764    F2UP:   setb    UP              ; rychly pohyb hore
027A D222            765            setb    FAST            ; 
027C C223            766            clr     SLOW            ;
027E 1208FE          767            lcall   WRITEPORTS      ; 
0281 020290          768            jmp     UP2           ;-; prejdi do stavu UP2    
0284 D221            769    F2DOWN: setb    DOWN            ; rychly pohyb hore
0286 D222            770            setb    FAST            ; 
0288 C223            771            clr     SLOW            ;
028A 1208FE          772            lcall   WRITEPORTS      ; 
028D 0203A6          773            jmp     DOWN2         ;-; prejdi do stavu DOWN2    
                     774            
                     775                
0290                 776    UP2:
                     777 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0290 C22F            778 +1         clr     LEDU            
0292 C22E            779 +1         clr     LEDD 
0294 C224            780 +1         clr     FLED1             
0296 C225            781 +1         clr     FLED2                
0298 C226            782 +1         clr     FLED3           
029A C227            783 +1         clr     FLED4           
029C D225            784 +1         setb    FLED2
029E 1208FE          785 +1         lcall   WRITEPORTS
                     787 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
02A1 12082A          788 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02A4 1208A3          789 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02A7 3009FA          790 +1         jnb     MB1, $-3  ; 
02AA 12082A          791 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02AD 1208A3          793    UP2A:   lcall   READPORTS       ; nacitanie dat
                     794 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02B0 200B03          795 +1         jb      SKRH, $+6
02B3 0207E2          796 +1         ljmp    ERR_SKRH
02B6 00              797 +1         nop
                     799 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
02B7 200903          800 +1         jb      MB1, $+6
02BA 0207C7          801 +1         ljmp    ERR_2SPOM_C
02BD 00              802 +1         nop
02BE 200AEC          804            jb      MB2, UP2A     ;-; mame uz 1. spomalovaciu clonku?
                     805 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02C1 12082A          806 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02C4 1208A3          807 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02C7 300AFA          808 +1         jnb     MB2, $-3  ; 
02CA 12082A          809 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
02CD D22E            811            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
02CF 1208FE          812            lcall   WRITEPORTS      ;
02D2 0202D5          813            jmp     UP2_MB2       ;-; a prejdi do stavu UP2_MB2
DEBUG                                                                                                         PAGE 16

02D5                 814    UP2_MB2:
02D5 1208A3          815            lcall   READPORTS       ; nacitanie dat
                     816 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
02D8 200B03          817 +1         jb      SKRH, $+6
02DB 0207E2          818 +1         ljmp    ERR_SKRH
02DE 00              819 +1         nop
                     821 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
02DF 200903          822 +1         jb      MB1, $+6
02E2 0207B8          823 +1         ljmp    ERR_1SPOM_C
02E5 00              824 +1         nop
02E6 200AEC          826            jb      MB2, UP2_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
02E9 D22F            827            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
02EB 1208FE          828            lcall   WRITEPORTS      ;
                     829 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
02EE 12082A          830 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
02F1 1208A3          831 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
02F4 300AFA          832 +1         jnb     MB2, $-3  ; 
02F7 12082A          833 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                     835    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                     836    ;        anl     A, #00001000b ;-;
                     837    ;        jz      UP2_MB1       ;-;       Ak nie, chod do stavu UP2_MB1
                     838 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     839 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
02FA C3              840 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
02FB 7400            841 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
02FD 7214            842 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
02FF B00E            843 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0301 7243            844 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0303 720F            845 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0305 7238            846 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0307 3400            847 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0309 702E            849            jnz     U2_MB2C       ;-; Ak ano, zastav
                     850 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
030B E522            851 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
030D 33              852 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
030E 547E            853 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0310 7805            854 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     855 +1  ; LL1: 
0312 6006            856 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0314 C3              857 +1         clr     C               ; Inak shiftnem o 2
0315 13              858 +1         rrc     A               ;
0316 C3              859 +1         clr     C               ;
0317 13              860 +1         rrc     A               ;
DEBUG                                                                                                         PAGE 17

0318 D8F8            861 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     862 +1 ; LL2:
031A 7405            863 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
031C C3              864 +1         clr     C               ;
031D 98              865 +1         subb    A, R0           ;
                     867 +1         LCJNE   A, #3, UP2_MB1  ; |   ak nie, nezastavujeme  
031E B40303          868 +1         cjne    A, #3, $+6
0321 020327          869 +1         jmp     $+6
0324 020343          870 +1         ljmp    UP2_MB1
0327 00              871 +1         nop
                     873 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0328 E528            874 +1         mov     A, INPORTA
032A 541E            875 +1         anl     A, #00011110b
032C C3              876 +1         clr     C
032D 13              877 +1         rrc     A
                     878 +1 ;LL1    
032E 7803            879 +1         mov     R0, #3
0330 C3              880 +1         clr     C
0331 13              881 +1         rrc     A
0332 D8FC            882 +1         djnz    R0, $-2;LL1
0334 6003            884            jz      U2_MB2C         ; |   ak neni zastavujem  
0336 020343          885            ljmp    UP2_MB1         ; |   inak nezastavim
0339 D223            886    U2_MB2C:setb    SLOW            ;       Ak ano, spomalme
033B C222            887            clr     FAST            ; 
033D 1208FE          888            lcall   WRITEPORTS      ;
0340 020343          889            jmp     UP2_MB1       ;-; a prejdi do stavu UP2_MB1 
0343                 890    UP2_MB1:
0343 1208A3          891            lcall   READPORTS       ; nacitanie dat
                     892 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
0346 200B03          893 +1         jb      SKRH, $+6
0349 0207E2          894 +1         ljmp    ERR_SKRH
034C 00              895 +1         nop
                     897 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
034D 200A03          898 +1         jb      MB2, $+6
0350 0207D6          899 +1         ljmp    ERR_ZAST_C
0353 00              900 +1         nop
0354 2009EC          902            jb      MB1, UP2_MB1  ;-; Sme na zastavovacej clonke?
                     903            
                     904 +1         ZASTAV  3, U            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                     905 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0357 C3              906 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0358 7400            907 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
035A 7214            908 +1         orl     C, PI3U      ; | Mam v tomto smere stlacene tlacidlo v sachte?
035C B00E            909 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
035E 7243            910 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0360 720F            911 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0362 7238            912 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0364 3400            913 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
DEBUG                                                                                                         PAGE 18

0366 C238            915            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0368 702E            916            jnz     U2_MB1C       ;-; Ak ano, zastav
                     917 +1         NAJVYSSIE               ; | ..a sme na najvyssom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
036A E522            918 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
036C 33              919 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
036D 547E            920 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
036F 7805            921 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                     922 +1  ; LL1: 
0371 6006            923 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0373 C3              924 +1         clr     C               ; Inak shiftnem o 2
0374 13              925 +1         rrc     A               ;
0375 C3              926 +1         clr     C               ;
0376 13              927 +1         rrc     A               ;
0377 D8F8            928 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                     929 +1 ; LL2:
0379 7405            930 +1         mov     A, #5           ; vysledne (najnizsie zvolene) poschodie je index v R0
037B C3              931 +1         clr     C               ;
037C 98              932 +1         subb    A, R0           ;
                     934 +1         LCJNE   A, #3, UP3      ; |   ak nie, nezastavujeme  
037D B40303          935 +1         cjne    A, #3, $+6
0380 020386          936 +1         jmp     $+6
0383 0204B0          937 +1         ljmp    UP3
0386 00              938 +1         nop
                     940 +1         VYSSIE_KABINA 3         ; | ..ok, sme na najvyssom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0387 E528            941 +1         mov     A, INPORTA
0389 541E            942 +1         anl     A, #00011110b
038B C3              943 +1         clr     C
038C 13              944 +1         rrc     A
                     945 +1 ;LL1    
038D 7803            946 +1         mov     R0, #3
038F C3              947 +1         clr     C
0390 13              948 +1         rrc     A
0391 D8FC            949 +1         djnz    R0, $-2;LL1
0393 6003            951            jz      U2_MB1C         ; |   ak neni zastavujem  
0395 0204B0          952            ljmp    UP3             ; |   inak nezastavim
0398 C220            953    U2_MB1C:clr     UP              ; zastav motor
039A D23A            954            setb    UPOld           ;       (a zalohuj)
039C C23B            955            clr     DOWNOld         ;       (a zalohuj)
039E C222            956            clr     FAST            ; 
03A0 1208FE          957            lcall   WRITEPORTS      ; 
03A3 020434          958            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3
03A6                 959    DOWN2:
                     960 +1                 POLOHA_LED 2  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
03A6 C22F            961 +1         clr     LEDU            
03A8 C22E            962 +1         clr     LEDD 
03AA C224            963 +1         clr     FLED1             
03AC C225            964 +1         clr     FLED2                
03AE C226            965 +1         clr     FLED3           
03B0 C227            966 +1         clr     FLED4           
DEBUG                                                                                                         PAGE 19

03B2 D225            967 +1         setb    FLED2
03B4 1208FE          968 +1         lcall   WRITEPORTS
                     970 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
03B7 12082A          971 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03BA 1208A3          972 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03BD 3009FA          973 +1         jnb     MB1, $-3  ; 
03C0 12082A          974 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03C3 1208A3          976            lcall   READPORTS       ; nacitanie dat
                     977 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03C6 200C03          978 +1         jb      SKRD, $+6
03C9 0207DF          979 +1         ljmp    ERR_SKRD
03CC 00              980 +1         nop
                     982 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
03CD 200903          983 +1         jb      MB1, $+6
03D0 0207C7          984 +1         ljmp    ERR_2SPOM_C
03D3 00              985 +1         nop
03D4 200ACF          987            jb      MB2, DOWN2    ;-; mame uz 1. spomalovaciu clonku?
                     988 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
03D7 12082A          989 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
03DA 1208A3          990 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
03DD 300AFA          991 +1         jnb     MB2, $-3  ; 
03E0 12082A          992 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
03E3 D22F            994            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
03E5 1208FE          995            lcall   WRITEPORTS      ;
03E8 0203EB          996            jmp     DOWN2_MB2     ;-; a prejdi do stavu DOWN2_MB2
03EB                 997    DOWN2_MB2:
03EB 1208A3          998            lcall   READPORTS       ; nacitanie dat
                     999 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
03EE 200C03         1000 +1         jb      SKRD, $+6
03F1 0207DF         1001 +1         ljmp    ERR_SKRD
03F4 00             1002 +1         nop
                    1004 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
03F5 200903         1005 +1         jb      MB1, $+6
03F8 0207B8         1006 +1         ljmp    ERR_1SPOM_C
03FB 00             1007 +1         nop
03FC 200AEC         1009            jb      MB2, DOWN2_MB2;-; mame uz aj druhu spomalovaciu clonku?          
03FF D22E           1010            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
0401 1208FE         1011            lcall   WRITEPORTS      ;
                    1012 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
0404 12082A         1013 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0407 1208A3         1014 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
040A 300AFA         1015 +1         jnb     MB2, $-3  ; 
040D 12082A         1016 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1018    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1019    ;        anl     A, #00000010b ;-;
                    1020    ;        jz      DOWN2_MB1     ;-;       Ak nie, chod do stavu DOWN2_MB1
0410 D223           1021            setb    SLOW            ;       Ak ano, spomalme
0412 C222           1022            clr     FAST            ; 
0414 1208FE         1023            lcall   WRITEPORTS      ;
0417 02041A         1024            jmp     DOWN2_MB1     ;-; a prejdi do stavu DOWN2_MB1
041A                1025    DOWN2_MB1:    
041A 1208A3         1026            lcall   READPORTS       ; nacitanie dat
041D 300C05         1027            jnb     SKRD, D2_MB1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
DEBUG                                                                                                         PAGE 20

                                                                               m pripade)
0420 300902         1028            jnb     MB1, D2_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
0423 80F5           1029            jmp     DOWN2_MB1       ; Ak sme nechytili ani jednu clonku, opakujeme
0425 C238           1030    D2_MB1C:clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0427 C221           1031            clr     DOWN            ; zastav motor
0429 D23B           1032            setb    DOWNOld         ;       (a zalohuj)
042B C23A           1033            clr     UPOld           ;       (a zalohuj)
042D C222           1034            clr     FAST            ; 
042F 1208FE         1035            lcall   WRITEPORTS      ; 
0432 01C3           1036            jmp     FLOOR1        ;-; a prejdi do stavu FLOOR2      
                    1037    
                    1038    
                    1039    ;------------------------------------------------------------------------------- << 3. posch
                                                                               odie >>
                    1040    
0434                1041    FLOOR3:
                    1042 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0434 C22F           1043 +1         clr     LEDU            
0436 C22E           1044 +1         clr     LEDD 
0438 C224           1045 +1         clr     FLED1             
043A C225           1046 +1         clr     FLED2                
043C C226           1047 +1         clr     FLED3           
043E C227           1048 +1         clr     FLED4           
0440 D226           1049 +1         setb    FLED3
0442 1208FE         1050 +1         lcall   WRITEPORTS
0445 12085F         1052            lcall   WAITFORTIMER    ; simulacia TIMERu
0448 1208A3         1053    F3S:    lcall   READPORTS     ;-; nacitanie dat
044B C21B           1054            clr     PKO3          ;-; vynulovanie volby poschodia na ktorom stojim
044D C22C           1055            clr     PO3U            ;
044F C22B           1056            clr     PO3D            ;
0451 1208FE         1057            lcall   WRITEPORTS      ;
0454 200FF1         1058            jb      DPK, F3S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
0457 79F0           1059            mov     R1, #11110000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) k
                                                                               abina
0459 7AE0           1060            mov     R2, #11100000b;-; Default predpokladam, ze mam namierene hore (na 3. a 4.) s
                                                                               achta
045B 203A06         1061            jb      UPOld, F3OK     ;   Je to pravda? Naozaj som doteraz isiel hore?
045E E9             1062            mov     A, R1           ;       Ak nie, znegujeme masku kabiny
045F F4             1063            cpl     A               ;       |
0460 F9             1064            mov     R1, A           ;       |
0461 EA             1065            mov     A, R2           ;       A znegujeme aj masku sachty
0462 F4             1066            cpl     A               ;       |
0463 FA             1067            mov     R2, A           ;       |        
0464                1068    F3OK:   ; Pohyb v jednom smere (nevieme v ktorom)
0464 E528           1069            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Kabina)
0466 5416           1070            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0468 59             1071            anl     A, R1           ;  | 
0469 7027           1072            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1073                                    ; zistenie, ci bolo stlacene nieco viac (menej) ako poschodi
                                                                               e na ktorom stojim (Sachta)
046B E528           1074            mov     A, INPORTA      ; Mam v kabine nieco stlacene?
046D 5416           1075            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi (kabina
                                                                               )
046F 7007           1076            jnz     F3SW            ;  | Ak ano, idem rovno zistovat opacny smer.
0471 E522           1077            mov     A, INPORTC      ; Mam stlacene nieco v sachte (mojim smerom)?    
DEBUG                                                                                                         PAGE 21

0473 5427           1078            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla privolavacov
0475 5A             1079            anl     A, R2           ;  |   
0476 701A           1080            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
                    1081            ; Pohyb v opacnom smere (nevieme v ktorom)
0478 B23A           1082    F3SW:   cpl     UPOld           ;  Znegujem stary posun
047A B23B           1083            cpl     DOWNOld         ;  |
047C E9             1084            mov     A, R1           ;  Znegujeme masky
047D F4             1085            cpl     A               ;  |
047E F9             1086            mov     R1, A           ;  |
047F EA             1087            mov     A, R2           ;  |
0480 F4             1088            cpl     A               ;  |
0481 FA             1089            mov     R2, A           ;  |               
0482 E528           1090            mov     A, INPORTA      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Kabina)
0484 5416           1091            anl     A, #00010110b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
0486 59             1092            anl     A, R1           ;  | 
0487 7009           1093            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0489 E522           1094            mov     A, INPORTC      ; zistenie, cibolo stlacene nieco viac ako poschodie na ktor
                                                                               om stojim (Sachta)
048B 5427           1095            anl     A, #00100111b   ;  | Beriem iba bity predstavujuce tlacidla poschodi
048D 5A             1096            anl     A, R2           ;  | 
048E 7002           1097            jnz     F3              ; nasli sme poschodie v tomto smere, mozme ist
0490 80B6           1098            jmp     F3S           ;-; nemame sa kde hybat, tak opakujeme zistovanie
0492 203A03         1099    F3:     jb      UPOld, F3UP     ;   
0495 0204A4         1100            jmp     F3DOWN          ;
0498 D220           1101    F3UP:   setb    UP              ; rychly pohyb hore
049A D222           1102            setb    FAST            ; 
049C C223           1103            clr     SLOW            ;
049E 1208FE         1104            lcall   WRITEPORTS      ; 
04A1 0204B0         1105            jmp     UP3           ;-; prejdi do stavu UP2    
04A4 D221           1106    F3DOWN: setb    DOWN            ; rychly pohyb hore
04A6 D222           1107            setb    FAST            ; 
04A8 C223           1108            clr     SLOW            ;
04AA 1208FE         1109            lcall   WRITEPORTS      ; 
04AD 02053F         1110            jmp     DOWN3         ;-; prejdi do stavu UP2    
                    1111         
                    1112         
04B0                1113    UP3:
                    1114 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
04B0 C22F           1115 +1         clr     LEDU            
04B2 C22E           1116 +1         clr     LEDD 
04B4 C224           1117 +1         clr     FLED1             
04B6 C225           1118 +1         clr     FLED2                
04B8 C226           1119 +1         clr     FLED3           
04BA C227           1120 +1         clr     FLED4           
04BC D226           1121 +1         setb    FLED3
04BE 1208FE         1122 +1         lcall   WRITEPORTS
                    1124 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
04C1 12082A         1125 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04C4 1208A3         1126 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04C7 3009FA         1127 +1         jnb     MB1, $-3  ; 
04CA 12082A         1128 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04CD 1208A3         1130    UP3A:   lcall   READPORTS       ; nacitanie dat
                    1131 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04D0 200B03         1132 +1         jb      SKRH, $+6
04D3 0207E2         1133 +1         ljmp    ERR_SKRH
DEBUG                                                                                                         PAGE 22

04D6 00             1134 +1         nop
                    1136 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
04D7 200903         1137 +1         jb      MB1, $+6
04DA 0207C7         1138 +1         ljmp    ERR_2SPOM_C
04DD 00             1139 +1         nop
04DE 200AEC         1141            jb      MB2, UP3A     ;-; mame uz 1. spomalovaciu clonku?
                    1142 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
04E1 12082A         1143 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
04E4 1208A3         1144 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
04E7 300AFA         1145 +1         jnb     MB2, $-3  ; 
04EA 12082A         1146 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
04ED D22E           1148            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
04EF 1208FE         1149            lcall   WRITEPORTS      ;
04F2 0204F5         1150            jmp     UP3_MB2       ;-; a prejdi do stavu UP3_MB2
04F5                1151    UP3_MB2:
04F5 1208A3         1152            lcall   READPORTS       ; nacitanie dat
                    1153 +1         ljnb    SKRH, ERR_SKRH  ; >>> CHYBA, Horna porovnavacia clonka <<<
04F8 200B03         1154 +1         jb      SKRH, $+6
04FB 0207E2         1155 +1         ljmp    ERR_SKRH
04FE 00             1156 +1         nop
                    1158 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
04FF 200903         1159 +1         jb      MB1, $+6
0502 0207B8         1160 +1         ljmp    ERR_1SPOM_C
0505 00             1161 +1         nop
0506 200AEC         1163            jb      MB2, UP3_MB2  ;-; mame uz aj druhu spomalovaciu clonku?          
0509 D22F           1164            setb    LEDU            ; Rozsviet LEDku, ze mame druhu MB2
050B 1208FE         1165            lcall   WRITEPORTS      ;
                    1166 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme 
050E 12082A         1167 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0511 1208A3         1168 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0514 300AFA         1169 +1         jnb     MB2, $-3  ; 
0517 12082A         1170 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1172    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1173    ;        anl     A, #00010000b ;-;
                    1174    ;        jz      UP3_MB1       ;-;       Ak nie, chod do stavu UP3_MB1
051A D223           1175            setb    SLOW            ;       Ak ano, spomalme
051C C222           1176            clr     FAST            ; 
051E 1208FE         1177            lcall   WRITEPORTS      ;
0521 020524         1178            jmp     UP3_MB1       ;-; a prejdi do stavu UP3_MB1 
0524                1179    UP3_MB1:
0524 1208A3         1180            lcall   READPORTS       ; nacitanie dat
0527 300B05         1181            jnb     SKRH, U3_MB1C  ;  Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
052A 300902         1182            jnb     MB1, U3_MB1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
052D 80F5           1183            jmp     UP3_MB1         ; Ak sme nechytili ani jednu clonku, opakujeme. 
052F C238           1184    U3_MB1C:clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
0531 C220           1185            clr     UP              ; zastav motor
0533 D23A           1186            setb    UPOld           ;       (a zalohuj)
0535 C23B           1187            clr     DOWNOld         ;       (a zalohuj)
0537 C222           1188            clr     FAST            ; 
0539 1208FE         1189            lcall   WRITEPORTS      ; 
053C 02065E         1190            jmp     FLOOR4        ;-; a prejdi do stavu FLOOR4   
053F                1191    DOWN3:
DEBUG                                                                                                         PAGE 23

                    1192 +1                 POLOHA_LED 3  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
053F C22F           1193 +1         clr     LEDU            
0541 C22E           1194 +1         clr     LEDD 
0543 C224           1195 +1         clr     FLED1             
0545 C225           1196 +1         clr     FLED2                
0547 C226           1197 +1         clr     FLED3           
0549 C227           1198 +1         clr     FLED4           
054B D226           1199 +1         setb    FLED3
054D 1208FE         1200 +1         lcall   WRITEPORTS
                    1202 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
0550 12082A         1203 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0553 1208A3         1204 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0556 3009FA         1205 +1         jnb     MB1, $-3  ; 
0559 12082A         1206 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
055C 1208A3         1208            lcall   READPORTS       ; nacitanie dat
                    1209 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
055F 200C03         1210 +1         jb      SKRD, $+6
0562 0207DF         1211 +1         ljmp    ERR_SKRD
0565 00             1212 +1         nop
                    1214 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
0566 200903         1215 +1         jb      MB1, $+6
0569 0207C7         1216 +1         ljmp    ERR_2SPOM_C
056C 00             1217 +1         nop
056D 200ACF         1219            jb      MB2, DOWN3    ;-; mame uz 1. spomalovaciu clonku?
                    1220 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme   
0570 12082A         1221 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
0573 1208A3         1222 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
0576 300AFA         1223 +1         jnb     MB2, $-3  ; 
0579 12082A         1224 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
057C D22F           1226            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
057E 1208FE         1227            lcall   WRITEPORTS      ;
0581 020584         1228            jmp     DOWN3_MB2     ;-; a prejdi do stavu DOWN3_MB2
0584                1229    DOWN3_MB2:
0584 1208A3         1230            lcall   READPORTS       ; nacitanie dat
                    1231 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0587 200C03         1232 +1         jb      SKRD, $+6
058A 0207DF         1233 +1         ljmp    ERR_SKRD
058D 00             1234 +1         nop
                    1236 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
                                                                               tavovaciu) <<<
058E 200903         1237 +1         jb      MB1, $+6
0591 0207B8         1238 +1         ljmp    ERR_1SPOM_C
0594 00             1239 +1         nop
0595 200AEC         1241            jb      MB2, DOWN3_MB2;-; mame uz aj druhu spomalovaciu clonku?          
0598 D22E           1242            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
059A 1208FE         1243            lcall   WRITEPORTS      ;
                    1244 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
059D 12082A         1245 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
05A0 1208A3         1246 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
05A3 300AFA         1247 +1         jnb     MB2, $-3  ; 
05A6 12082A         1248 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1250    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1251    ;        anl     A, #00000100b ;-;
DEBUG                                                                                                         PAGE 24

                    1252    ;        jz      DOWN3_MB1     ;-;       Ak nie, chod do stavu DOWN3_MB1
                    1253 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1254 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
05A9 C3             1255 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
05AA 7400           1256 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
05AC 7211           1257 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
05AE B00E           1258 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
05B0 7242           1259 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
05B2 720F           1260 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
05B4 7238           1261 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
05B6 3400           1262 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
05B8 7033           1264            jnz     D3_MB2C         ; Ak ano, zastav
                    1265 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
05BA E522           1266 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
05BC 33             1267 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
05BD 547E           1268 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
05BF 7805           1269 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1270 +1  ; LL1: 
05C1 6006           1271 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
05C3 C3             1272 +1         clr     C               ; Inak shiftnem o 2
05C4 33             1273 +1         rlc     A               ;
05C5 C3             1274 +1         clr     C               ;
05C6 33             1275 +1         rlc     A               ;
05C7 D8F8           1276 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1277 +1 ; LL2:
05C9 E8             1278 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1280 +1         LCJNE   A, #2, DOWN3_MB1; |   ak nie, nezastavujeme  
05CA B40203         1281 +1         cjne    A, #2, $+6
05CD 0205D3         1282 +1         jmp     $+6
05D0 0205F7         1283 +1         ljmp    DOWN3_MB1
05D3 00             1284 +1         nop
                    1286 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
05D4 7405           1287 +1         mov     A, #5
05D6 C3             1288 +1         clr     C
05D7 9402           1289 +1         subb    A, #2
05D9 F8             1290 +1         mov     R0, A
05DA E528           1291 +1         mov     A, INPORTA
05DC 541E           1292 +1         anl     A, #00011110b
05DE C3             1293 +1         clr     C
05DF 33             1294 +1         rlc     A
05E0 C3             1295 +1         clr     C
05E1 33             1296 +1         rlc     A
05E2 C3             1297 +1         clr     C
DEBUG                                                                                                         PAGE 25

05E3 33             1298 +1         rlc     A
                    1299 +1 ;LL1   
05E4 C3             1300 +1         clr     C
05E5 33             1301 +1         rlc     A
05E6 D8FC           1302 +1         djnz    R0, $-2;LL1
05E8 6003           1304            jz      D3_MB2C         ; |   ak neni zastavujem                  
05EA 0205F7         1305            ljmp    DOWN3_MB1       ;-; |        
05ED D223           1306    D3_MB2C:setb    SLOW            ;       Ak ano, spomalme
05EF C222           1307            clr     FAST            ; 
05F1 1208FE         1308            lcall   WRITEPORTS      ;
05F4 0205F7         1309            jmp     DOWN3_MB1     ;-; a prejdi do stavu DOWN3_MB1
05F7                1310    DOWN3_MB1:    
05F7 1208A3         1311            lcall   READPORTS       ; nacitanie dat
                    1312 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
05FA 200C03         1313 +1         jb      SKRD, $+6
05FD 0207DF         1314 +1         ljmp    ERR_SKRD
0600 00             1315 +1         nop
                    1317 +1         ljnb    MB2, ERR_ZAST_C ; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spo
                                                                               malovaciu) <<<
0601 200A03         1318 +1         jb      MB2, $+6
0604 0207D6         1319 +1         ljmp    ERR_ZAST_C
0607 00             1320 +1         nop
0608 2009EC         1322            jb      MB1, DOWN3_MB1;-; Sme na zastavovacej clonke?
                    1323 +1         ZASTAV  2, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1324 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
060B C3             1325 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
060C 7400           1326 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
060E 7211           1327 +1         orl     C, PI2D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0610 B00E           1328 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
0612 7242           1329 +1         orl     C, PKI2          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
0614 720F           1330 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0616 7238           1331 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0618 3400           1332 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
061A C238           1334            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril
061C 7033           1335            jnz     D3_MB1C         ; Ak ano, zastav
                    1336 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
061E E522           1337 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0620 33             1338 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0621 547E           1339 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0623 7805           1340 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1341 +1  ; LL1: 
0625 6006           1342 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0627 C3             1343 +1         clr     C               ; Inak shiftnem o 2
0628 33             1344 +1         rlc     A               ;
0629 C3             1345 +1         clr     C               ;
DEBUG                                                                                                         PAGE 26

062A 33             1346 +1         rlc     A               ;
062B D8F8           1347 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1348 +1 ; LL2:
062D E8             1349 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1351 +1         LCJNE   A, #2, DOWN2    ; |   ak nie, nezastavujeme  
062E B40203         1352 +1         cjne    A, #2, $+6
0631 020637         1353 +1         jmp     $+6
0634 0203A6         1354 +1         ljmp    DOWN2
0637 00             1355 +1         nop
                    1357 +1         NIZSIE_KABINA 2         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0638 7405           1358 +1         mov     A, #5
063A C3             1359 +1         clr     C
063B 9402           1360 +1         subb    A, #2
063D F8             1361 +1         mov     R0, A
063E E528           1362 +1         mov     A, INPORTA
0640 541E           1363 +1         anl     A, #00011110b
0642 C3             1364 +1         clr     C
0643 33             1365 +1         rlc     A
0644 C3             1366 +1         clr     C
0645 33             1367 +1         rlc     A
0646 C3             1368 +1         clr     C
0647 33             1369 +1         rlc     A
                    1370 +1 ;LL1   
0648 C3             1371 +1         clr     C
0649 33             1372 +1         rlc     A
064A D8FC           1373 +1         djnz    R0, $-2;LL1
064C 6003           1375            jz      D3_MB1C         ; |   ak neni zastavujem                  
064E 0203A6         1376            ljmp    DOWN2         ;-; |        
0651 C221           1377    D3_MB1C:clr     DOWN            ; zastav motor
0653 D23B           1378            setb    DOWNOld         ;       (a zalohuj)
0655 C23A           1379            clr     UPOld           ;       (a zalohuj)
0657 C222           1380            clr     FAST            ; 
0659 1208FE         1381            lcall   WRITEPORTS      ; 
065C 4114           1382            jmp     FLOOR2        ;-; a prejdi do stavu FLOOR2      
                    1383          
                    1384            
                    1385    ;------------------------------------------------------------------------------- << 4. posch
                                                                               odie >>
                    1386    
065E                1387    FLOOR4:
                    1388 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
065E C22F           1389 +1         clr     LEDU            
0660 C22E           1390 +1         clr     LEDD 
0662 C224           1391 +1         clr     FLED1             
0664 C225           1392 +1         clr     FLED2                
0666 C226           1393 +1         clr     FLED3           
0668 C227           1394 +1         clr     FLED4           
066A D227           1395 +1         setb    FLED4
066C 1208FE         1396 +1         lcall   WRITEPORTS
066F 12085F         1398            lcall   WAITFORTIMER    ; simulacia TIMERu
0672 1208A3         1399    F4S:    lcall   READPORTS     ;-; nacitanie dat
0675 C21C           1400            clr     PKO4          ;-; vynulovanie volby poschodia na ktorom stojim
0677 C22D           1401            clr     PO4            ;
0679 1208FE         1402            lcall   WRITEPORTS      ;
067C 200FF3         1403            jb      DPK, F4S        ; Mam pretazenu kabinu? (Ak ano, tak sa nepohnem)
DEBUG                                                                                                         PAGE 27

067F E528           1404            mov     A, INPORTA      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Kabina)
0681 540E           1405            anl     A, #00001110b ;-;
0683 7008           1406            jnz     F4OK          ;-; ak ano, ideme na to
0685 E522           1407            mov     A, INPORTC      ; zistenie, ci bolo stlacene nieco menej ako poschodie na kt
                                                                               orom stojim (Sachta)
0687 541F           1408            anl     A, #00011111b ;-;
0689 7002           1409            jnz     F4OK          ;-; ak ano, ideme na to
068B 80E5           1410            jmp     F4S             ; Nemam sa kde hnut, opakujem
068D D221           1411    F4OK:   setb    DOWN            ; rychly pohyb dole
068F D222           1412            setb    FAST            ;
0691 C223           1413            clr     SLOW            ; 
0693 1208FE         1414            lcall   WRITEPORTS      ; 
0696 020699         1415            jmp     DOWN4         ;-; prejdi do stavu DOWN4 
0699                1416    DOWN4:
                    1417 +1                 POLOHA_LED 4  ;-; Zhasni LEDKY,uz sme na poschodi (aj na paneli "Poloha kabi
                                                                               ny", nechaj len aktualne poschodie)
0699 C22F           1418 +1         clr     LEDU            
069B C22E           1419 +1         clr     LEDD 
069D C224           1420 +1         clr     FLED1             
069F C225           1421 +1         clr     FLED2                
06A1 C226           1422 +1         clr     FLED3           
06A3 C227           1423 +1         clr     FLED4           
06A5 D227           1424 +1         setb    FLED4
06A7 1208FE         1425 +1         lcall   WRITEPORTS
                    1427 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
06AA 12082A         1428 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06AD 1208A3         1429 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06B0 3009FA         1430 +1         jnb     MB1, $-3  ; 
06B3 12082A         1431 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06B6 1208A3         1433            lcall   READPORTS       ; nacitanie dat
                    1434 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06B9 200C03         1435 +1         jb      SKRD, $+6
06BC 0207DF         1436 +1         ljmp    ERR_SKRD
06BF 00             1437 +1         nop
                    1439 +1         ljnb    MB1, ERR_2SPOM_C; >>> CHYBA, Vypadli 2 spomalovacie clonky (narazil som na z
                                                                               astavovaciu) <<<
06C0 200903         1440 +1         jb      MB1, $+6
06C3 0207C7         1441 +1         ljmp    ERR_2SPOM_C
06C6 00             1442 +1         nop
06C7 200ACF         1444            jb      MB2, DOWN4    ;-; mame uz 1. spomalovaciu clonku?
                    1445 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme      
06CA 12082A         1446 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06CD 1208A3         1447 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06D0 300AFA         1448 +1         jnb     MB2, $-3  ; 
06D3 12082A         1449 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
06D6 D22F           1451            setb    LEDU            ; Ak ano, rozsviet LEDku, ze mame prvu MB2 mame za sebou
06D8 1208FE         1452            lcall   WRITEPORTS      ;
06DB 0206DE         1453            jmp     DOWN4_MB2     ;-; a prejdi do stavu DOWN4_MB2
06DE                1454    DOWN4_MB2:
06DE 1208A3         1455            lcall   READPORTS       ; nacitanie dat
                    1456 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
06E1 200C03         1457 +1         jb      SKRD, $+6
06E4 0207DF         1458 +1         ljmp    ERR_SKRD
06E7 00             1459 +1         nop
                    1461 +1         ljnb    MB1, ERR_1SPOM_C; >>> CHYBA, Vypadla spomalovacia clonka (narazil som na zas
DEBUG                                                                                                         PAGE 28

                                                                               tavovaciu) <<<
06E8 200903         1462 +1         jb      MB1, $+6
06EB 0207B8         1463 +1         ljmp    ERR_1SPOM_C
06EE 00             1464 +1         nop
06EF 200AEC         1466            jb      MB2, DOWN4_MB2;-; mame uz aj druhu spomalovaciu clonku?          
06F2 D22E           1467            setb    LEDD            ; Ak ano, rozsviet LEDku, ze mame druhu MB2
06F4 1208FE         1468            lcall   WRITEPORTS      ;
                    1469 +1         ZAKMITC MB2             ; Pockame, kym z nej odideme
06F7 12082A         1470 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
06FA 1208A3         1471 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
06FD 300AFA         1472 +1         jnb     MB2, $-3  ; 
0700 12082A         1473 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
                    1475    ;        mov     A, INPORTA      ; Chceme tu spomalit? - je najblizsie poschodie zvolene?
                    1476    ;        anl     A, #00001000b ;-;
                    1477    ;        jz      DOWN4_MB1     ;-;       Ak nie, chod do stavu DOWN4_MB1
                    1478 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0) 
                    1479 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0703 C3             1480 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0704 7400           1481 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0706 7213           1482 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
0708 B00E           1483 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
070A 7243           1484 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
070C 720F           1485 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
070E 7238           1486 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0710 3400           1487 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0712 7033           1489            jnz     D4_MB2C       ;-; Ak ano, zastav
                    1490 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
                                                                               m stojime urcite)
0714 E522           1491 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
0716 33             1492 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
0717 547E           1493 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
0719 7805           1494 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1495 +1  ; LL1: 
071B 6006           1496 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
071D C3             1497 +1         clr     C               ; Inak shiftnem o 2
071E 33             1498 +1         rlc     A               ;
071F C3             1499 +1         clr     C               ;
0720 33             1500 +1         rlc     A               ;
0721 D8F8           1501 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1502 +1 ; LL2:
0723 E8             1503 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1505 +1         LCJNE   A, #3, DOWN4_MB1; |   ak nie, nezastavujeme  
0724 B40303         1506 +1         cjne    A, #3, $+6
0727 02072D         1507 +1         jmp     $+6
072A 020751         1508 +1         ljmp    DOWN4_MB1
DEBUG                                                                                                         PAGE 29

072D 00             1509 +1         nop
                    1511 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
072E 7405           1512 +1         mov     A, #5
0730 C3             1513 +1         clr     C
0731 9403           1514 +1         subb    A, #3
0733 F8             1515 +1         mov     R0, A
0734 E528           1516 +1         mov     A, INPORTA
0736 541E           1517 +1         anl     A, #00011110b
0738 C3             1518 +1         clr     C
0739 33             1519 +1         rlc     A
073A C3             1520 +1         clr     C
073B 33             1521 +1         rlc     A
073C C3             1522 +1         clr     C
073D 33             1523 +1         rlc     A
                    1524 +1 ;LL1   
073E C3             1525 +1         clr     C
073F 33             1526 +1         rlc     A
0740 D8FC           1527 +1         djnz    R0, $-2;LL1
0742 6003           1529            jz      D4_MB2C         ; |   ak neni zastavujem          
0744 020751         1530            ljmp    DOWN4_MB1       ;-; |       
0747 D223           1531    D4_MB2C:setb    SLOW            ;       Ak ano, spomalme
0749 C222           1532            clr     FAST            ; 
074B 1208FE         1533            lcall   WRITEPORTS      ;
074E 020751         1534            jmp     DOWN4_MB1     ;-; a prejdi do stavu DOWN4_MB1
0751                1535    DOWN4_MB1:    
0751 1208A3         1536            lcall   READPORTS       ; nacitanie dat
                    1537 +1         ljnb    SKRD, ERR_SKRD  ; >>> CHYBA, Dolna porovnavacia clonka <<<
0754 200C03         1538 +1         jb      SKRD, $+6
0757 0207DF         1539 +1         ljmp    ERR_SKRD
075A 00             1540 +1         nop
                    1542 +1         ljnb    MB2, ERR_ZAST_C; >>> CHYBA, Vypadla zastavovacia clonka (narazil som na spom
                                                                               alovaciu) <<<
075B 200A03         1543 +1         jb      MB2, $+6
075E 0207D6         1544 +1         ljmp    ERR_ZAST_C
0761 00             1545 +1         nop
0762 2009EC         1547            jb      MB1, DOWN4_MB1 ;-; Sme na zastavovacej clonke?
                    1548 +1         ZASTAV  3, D            ; Ak ano, chceme tu zastavit? - je toto poschodie zvolene? (
                                                                               Vrati do A 1 ak ano, inak 0)
                    1549 +1                                         ; Chceme tu zastavit? - je toto poschodie zvolene? 
                                                                               
0765 C3             1550 +1         clr     C                       ; | Idem robit cachre-machre s Carry bitom
0766 7400           1551 +1         mov     A, #0h                  ; | Aj Acc potrebujem prazdny
0768 7213           1552 +1         orl     C, PI3D      ; | Mam v tomto smere stlacene tlacidlo v sachte?
076A B00E           1553 +1         anl     C, /DPZK                ; | a mam plne zatazenu kabinu? (lebo ak ano tak ani
                                                                                za boha nestojim)
076C 7243           1554 +1         orl     C, PKI3          ; | Mam v tomto smere stlacene tlacidlo v kabine? 
076E 720F           1555 +1         orl     C, DPK                  ; | a mam pretazenu kabinu? (Ak ano tak stojim urcit
                                                                               e)
0770 7238           1556 +1         orl     C, STOPPED              ; | a bolo stlacene tlacidlo STOP? (Ak ano tak stoji
                                                                               m urcite)
0772 3400           1557 +1         addc    A, #0h                  ; Ak mi v predchadzajucich krokoch vyslo, ze mam sta
                                                                               t, tak stojim nezavisle na tlacidlach kab
                                                                               iny
0774 C238           1559            clr     STOPPED         ; Priznak STOPPED vynulujem, uz som ho osetril 
0776 7033           1560            jnz     D4_MB1C       ;-; Ak ano, zastav
                    1561 +1         NAJNIZSIE               ; | ..a sme na najnizsom privolanom poschodi z kabiny? (poto
DEBUG                                                                                                         PAGE 30

                                                                               m stojime urcite)
0778 E522           1562 +1         mov     A, INPORTC      ; INPORTC - vektor "privolavace zo sachty"               
077A 33             1563 +1         rlc     A               ; SHIFT LEFT - shiftnem si tak, aby som mal kazde poschodie 
                                                                               dvojicu bitov | X  4 | 3U 3D | 2U 2D | 1 
                                                                                X | 
077B 547E           1564 +1         anl     A, #01111110b   ; Vynulujem nedefinovane bity
077D 7805           1565 +1         mov     R0, #05         ; Budem opakovat max. 4x (ale chcem mat index o jeden viac, 
                                                                               aby som mal na konci rovno cislo poschodi
                                                                               a)
                    1566 +1  ; LL1: 
077F 6006           1567 +1         jz      $+8;LL2         ; Ak mam 0 - ziadne dalsie poschodia ne su pritomne, skocim 
                                                                               na LL2
0781 C3             1568 +1         clr     C               ; Inak shiftnem o 2
0782 33             1569 +1         rlc     A               ;
0783 C3             1570 +1         clr     C               ;
0784 33             1571 +1         rlc     A               ;
0785 D8F8           1572 +1         djnz    R0, $-6         ; ...a pokracujem v zistovani
                    1573 +1 ; LL2:
0787 E8             1574 +1         mov     A, R0           ; vysledne (najnizsie zvolene) poschodie je index v R0
                    1576 +1         LCJNE   A, #3, DOWN3    ; |   ak nie, nezastavujeme  
0788 B40303         1577 +1         cjne    A, #3, $+6
078B 020791         1578 +1         jmp     $+6
078E 02053F         1579 +1         ljmp    DOWN3
0791 00             1580 +1         nop
                    1582 +1         NIZSIE_KABINA 3         ; | ..ok, sme na najnizsom privolanom poschodi z kabiny ale 
                                                                               neni nad nami uz nic v kabine stlacene? 
                                                                               
0792 7405           1583 +1         mov     A, #5
0794 C3             1584 +1         clr     C
0795 9403           1585 +1         subb    A, #3
0797 F8             1586 +1         mov     R0, A
0798 E528           1587 +1         mov     A, INPORTA
079A 541E           1588 +1         anl     A, #00011110b
079C C3             1589 +1         clr     C
079D 33             1590 +1         rlc     A
079E C3             1591 +1         clr     C
079F 33             1592 +1         rlc     A
07A0 C3             1593 +1         clr     C
07A1 33             1594 +1         rlc     A
                    1595 +1 ;LL1   
07A2 C3             1596 +1         clr     C
07A3 33             1597 +1         rlc     A
07A4 D8FC           1598 +1         djnz    R0, $-2;LL1
07A6 6003           1600            jz      D4_MB1C         ; |   ak neni zastavujem          
07A8 02053F         1601            ljmp    DOWN3         ;-; |       
07AB C221           1602    D4_MB1C:clr     DOWN            ; zastav motor
07AD D23B           1603            setb    DOWNOld         ;       (a zalohuj)
07AF C23A           1604            clr     UPOld           ;       (a zalohuj)
07B1 C222           1605            clr     FAST            ; 
07B3 1208FE         1606            lcall   WRITEPORTS      ; 
07B6 8134           1607            jmp     FLOOR3        ;-; a prejdi do stavu FLOOR3                 
                    1608                    
                    1609      
07B8                1610    ERR_1SPOM_C: 
                    1611            ;clr     UP              ; zastav motor
                    1612            ;clr     DOWN            ; 
                    1613            ;lcall   WRITEPORTS      ; 
                    1614            ;_BP_
DEBUG                                                                                                         PAGE 31

                    1615            ;nop
                    1616            ;nop 
                    1617 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07B8 12082A         1618 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07BB 1208A3         1619 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07BE 3009FA         1620 +1         jnb     MB1, $-3  ; 
07C1 12082A         1621 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07C4 0207E5         1623            ljmp    ERROR1         
                    1624            
07C7                1625    ERR_2SPOM_C: 
                    1626            ;clr     UP              ; zastav motor
                    1627            ;clr     DOWN            ; 
                    1628            ;lcall   WRITEPORTS      ; 
                    1629            ;_BP_
                    1630            ;nop
                    1631            ;nop
                    1632 +1         ZAKMITC MB1             ; Pockame, kym odideme z poschodia (Clonky MB1)
07C7 12082A         1633 +1         lcall   TIME10MS        ; pockame 10 ms kym sa hodnota ustali (ze som na clonke)
07CA 1208A3         1634 +1         lcall   READPORTS       ; Uz sme z tej clonky prec?
07CD 3009FA         1635 +1         jnb     MB1, $-3  ; 
07D0 12082A         1636 +1         lcall   TIME10MS        ; pockame 10 ms  kym sa hodnota ustali (ze sme z nej naozaj 
                                                                               zliezli)
07D3 0207E5         1638            ljmp    ERROR1 
                    1639            
07D6                1640    ERR_ZAST_C: 
                    1641            ;clr     UP              ; zastav motor
                    1642            ;clr     DOWN            ; 
                    1643            ;lcall   WRITEPORTS      ; 
                    1644            ;_BP_
                    1645            ;nop
                    1646            ;nop
                    1647            ;lcall   READPORTS
                    1648            ;clr     FAST
                    1649            ;clr     SLOW
                    1650 +1         _BP_
07D6 C2B3           1651 +1         clr     P3.3
07D8 D2AA           1652 +1         setb    EX1
07DA 00             1653 +1         nop
07DB 00             1654 +1         nop
07DC 0207E5         1656            ljmp    ERROR1  
                    1657            
07DF                1658    ERR_SKRD: 
                    1659            ;clr     UP              ; zastav motor
                    1660            ;clr     DOWN            ; 
                    1661            ;lcall   WRITEPORTS      ; 
                    1662            ;_BP_
                    1663            ;nop
                    1664            ;nop
07DF 0207E5         1665            ljmp    ERROR1    
                    1666            
07E2                1667    ERR_SKRH: 
                    1668            ;clr     UP              ; zastav motor
                    1669            ;clr     DOWN            ; 
                    1670            ;lcall   WRITEPORTS      ; 
                    1671            ;_BP_
                    1672            ;nop
                    1673            ;nop
DEBUG                                                                                                         PAGE 32

07E2 0207E5         1674            ljmp    ERROR1 
                    1675            
07E5                1676    ERROR1:         
07E5 D22F           1677            setb    LEDU
07E7 D22E           1678            setb    LEDD
07E9 C222           1679            clr     FAST
07EB D223           1680            setb    SLOW
07ED 1208FE         1681            lcall   WRITEPORTS          
07F0 1208A3         1682    ERROR1S:lcall   READPORTS       ; nacitanie dat
07F3 300B08         1683            jnb     SKRH, ERROR1C   ; Sme na hornej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
07F6 300C05         1684            jnb     SKRD, ERROR1C   ; Sme na dolnej porovnavacej clonke? (tu zastavujeme v kazdo
                                                                               m pripade)
07F9 300902         1685            jnb     MB1, ERROR1C  ;-; Sme na zastavovacej clonke? (tu zastavujeme v kazdom pripa
                                                                               de)
07FC 80F2           1686            jmp     ERROR1S         ; Ak sme nechytili ani jednu clonku, opakujeme
07FE C220           1687    ERROR1C:clr     UP              ; zastav motor
0800 C221           1688            clr     DOWN            ; 
0802 C222           1689            clr     FAST            ; 
0804 C223           1690            clr     SLOW            ; 
0806 1208FE         1691            lcall   WRITEPORTS      ; 
0809 12085F         1692            lcall   WAITFORTIMER    ; simulacia TIMERu
080C 02080F         1693            jmp     ERROR2        ;-; a prejdi do stavu ERROR2 
                    1694            
080F 1208A3         1695    ERROR2: lcall   READPORTS       ; nacitanie dat
0812 200DFA         1696            jb      DP, ERROR2      ; uz vystupili vsetci ludia z kabiny?
0815 200FF7         1697            jb      DPK, ERROR2     ; uz vystupili vsetci ludia z kabiny?
0818 200EF4         1698            jb      DPZK, ERROR2    ; uz vystupili vsetci ludia z kabiny?
081B 020033         1699            ljmp    START
                    1700                           
                    1701                    
081E                1702    ENDPROG:
081E D218           1703            setb    KS
0820 1208FE         1704            call    WRITEPORTS                ; zapis novu informaciu
                    1705 +1         _BP_
0823 C2B3           1706 +1         clr     P3.3
0825 D2AA           1707 +1         setb    EX1
0827 00             1708 +1         nop
0828 00             1709 +1         nop
0829 22             1711            ret
                    1712            
                    1713            
                    1714    ;INT_TIMER0:
                    1715    ;        push    ACC
                    1716    ;        mov     A, R7  
                    1717    ;        dec     R7               
                    1718    ;        jnz     INT_TIMER0_END     
                    1719    ;        mov     R7, #20h
                    1720    ;        jb      LEDU, INT_TIMER0_CLEAR       
                    1721    ;        setb    LEDU
                    1722    ;        setb    LEDD
                    1723    ;        jmp     INT_TIMER0_WRITE
                    1724    ;INT_TIMER0_CLEAR:        
                    1725    ;        ;clr     LEDU
                    1726    ;        ;clr     LEDD
                    1727    ;INT_TIMER0_WRITE: 
                    1728    ;        lcall   WRITEPORTS
                    1729    ;INT_TIMER0_END: 
DEBUG                                                                                                         PAGE 33

                    1730    ;        setb    LEDU
                    1731    ;        lcall   WRITEPORTS       
                    1732    ;        pop     ACC
                    1733    ;        reti
                    1734            
                    1735            
                    1736    ; rutina time delay 1 ms pre oscilator s frekvenciou 11.0592 MHz
                    1737    ; 1 instrukcia 2 takty? => 11.0592/2 = pocet instrukcii potrebnych na 1 sekundu
                    1738    ; 11.0592MHz/2000 = zdrzanie 1 ms
082A                1739    TIME10MS:
082A 7963           1740            mov     R1,#063h        ; 2
                    1741                                    ; *** 100x
082C 7AFF           1742    TIME0:  mov     R2,#0FFh        ; 2 
082E DAFE           1743    TIME1:  djnz    R2,TIME1        ; 256*2   
0830 7AFF           1744            mov     R2,#0FFh        ; 2       
0832 DAFE           1745    TIME2:  djnz    R2,TIME2        ; 256*2 
0834 7A24           1746            mov     R2,#024h        ; 2       
0836 DAFE           1747    TIME3:  djnz    R2,TIME3        ; 36*2
0838 00             1748            nop                     ; 1
0839 D9F1           1749            djnz    R1,TIME0        ; 2
                    1750                                    ; ***
083B 792A           1751            mov     R1,#02Ah        ; 2 
083D D9FE           1752    TIME4:  djnz    R1,TIME4        ; 43*2  
083F 22             1753            ret                     ; koniec
                    1754            
                    1755            
                    1756    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1757    ; STOP
                    1758    ; osetri stlacenie tlacidla STOP
                    1759    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0840                1760    STOP:
0840 D238           1761            setb    STOPPED
0842 C222           1762            clr     FAST
0844 C223           1763            clr     SLOW
0846 74E1           1764            mov     A, #11100001b
0848 5223           1765            anl     OUTPORTA, A 
084A 1208FE         1766            lcall   WRITEPORTS
                    1767            
084D 12085F         1768            lcall   WAITFORTIMER
0850 120867         1769    STOPC:  lcall   READPORTS1
0853 E528           1770            mov     A, INPORTA
0855 541E           1771            anl     A, #00011110b
0857 60F7           1772            jz      STOPC     
                    1773            
0859 D223           1774            setb    SLOW
085B 1208FE         1775            lcall   WRITEPORTS
085E 22             1776            ret        
                    1777            
                    1778            
                    1779    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1780    ; DELAY
                    1781    ; Pocka na stlacenie tlacidla na 1. poschodi  - signal PO1 (v buducnosti to 
                    1782    ; bude timer)
                    1783    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
085F                1784    WAITFORTIMER:
085F 7B10           1785            mov     R3, #10h
0861 12082A         1786    DEL1:   lcall   TIME10MS
0864 DBFB           1787            djnz    R3, DEL1
DEBUG                                                                                                         PAGE 34

0866 22             1788            ret
                    1789            
                    1790    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1791    ; READPORTS1
                    1792    ; precita nove hodnoty na portoch
                    1793    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
0867                1794    READPORTS1:
0867 75A080         1795            mov     p2, #i8255INA       ; citaj data z portu A
086A 75803F         1796            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
086D C2B7           1797            clr     RDNOT
086F 00             1798            nop
0870 00             1799            nop
0871 00             1800            nop
0872 00             1801            nop
0873 858028         1802            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
0876 D2B7           1803            setb    RDNOT
                    1804            
0878 75A081         1805            mov     p2, #i8255INB       ; citaj data z portu B
087B 7580FE         1806            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
087E C2B7           1807            clr     RDNOT
0880 00             1808            nop
0881 00             1809            nop
0882 00             1810            nop
0883 00             1811            nop
0884 858021         1812            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
0887 D2B7           1813            setb    RDNOT
                    1814    
0889 75A082         1815            mov     p2, #i8255INC       ; citaj data z portu C
088C 75803F         1816            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
088F C2B7           1817            clr     RDNOT
0891 00             1818            nop
0892 00             1819            nop
0893 00             1820            nop
0894 00             1821            nop
0895 858022         1822            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
0898 D2B7           1823            setb    RDNOT
089A 00             1824            nop
089B 00             1825            nop
089C 00             1826            nop
089D 00             1827            nop
089E 00             1828            nop
089F 00             1829            nop
08A0 00             1830            nop
08A1 00             1831            nop
08A2 22             1832            ret
                    1833    
                    1834    
                    1835    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1836    ; READPORTS
                    1837    ; precita nove hodnoty na portoch
                    1838    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08A3                1839    READPORTS:
08A3 75A080         1840            mov     p2, #i8255INA       ; citaj data z portu A
08A6 75803F         1841            mov     p0, #(bmSTOP or bmPKI1 or bmPKI2 or bmPKI3 or bmPKI4 or bmDOORCLSD)
08A9 C2B7           1842            clr     RDNOT
08AB 00             1843            nop
08AC 00             1844            nop
DEBUG                                                                                                         PAGE 35

08AD 00             1845            nop
08AE 00             1846            nop
08AF 858028         1847            mov     INPORTA, p0         ; uloz informaciu z datovej zbernice 
08B2 D2B7           1848            setb    RDNOT
                    1849            
08B4 75A081         1850            mov     p2, #i8255INB       ; citaj data z portu B
08B7 7580FE         1851            mov     p0, #(bmMB1I or bmMB2I or bmSKRHI or bmSKRHD or bmDPI or bmDPKI or bmDPZKI)
                                                                               
08BA C2B7           1852            clr     RDNOT
08BC 00             1853            nop
08BD 00             1854            nop
08BE 00             1855            nop
08BF 00             1856            nop
08C0 858021         1857            mov     INPORTB, p0         ; uloz informaciu z datovej zbernice 
08C3 D2B7           1858            setb    RDNOT
                    1859    
08C5 75A082         1860            mov     p2, #i8255INC       ; citaj data z portu C
08C8 75803F         1861            mov     p0, #(bmPI1 or bmPI2D or bmPI2U or bmPI3D or bmPI3U or bmPI4)
08CB C2B7           1862            clr     RDNOT
08CD 00             1863            nop
08CE 00             1864            nop
08CF 00             1865            nop
08D0 00             1866            nop
08D1 858022         1867            mov     INPORTC, p0         ; uloz informaciu z datovej zbernice 
08D4 D2B7           1868            setb    RDNOT
08D6 00             1869            nop
08D7 00             1870            nop
08D8 00             1871            nop
08D9 00             1872            nop
08DA 00             1873            nop
08DB 00             1874            nop
08DC 00             1875            nop
08DD 00             1876            nop
                    1877            
08DE 300F04         1878            jnb     DPK, READPORTS_C1
08E1 C222           1879            clr     FAST
08E3 D223           1880            setb    SLOW
08E5                1881    READPORTS_C1:         
08E5 204003         1882            jb      STOPNOT, READPORTS_C
08E8 120840         1883            lcall   STOP
08EB                1884    READPORTS_C:        
08EB E528           1885            mov     A, INPORTA
08ED 541E           1886            anl     A, #00011110b
08EF 4223           1887            orl     OUTPORTA, A
08F1 1208FE         1888            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
08F4 E522           1889            mov     A, INPORTC
08F6 543F           1890            anl     A, #00111111b
08F8 4225           1891            orl     OUTPORTC, A
08FA 1208FE         1892            call    WRITEPORTS              ; aktualizuj signalizaciu na ovladacom paneli
                    1893            
08FD 22             1894            ret
                    1895            
                    1896    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1897    ; WRITEPORTS
                    1898    ; spravi zalohu vystupnych registrov a posle data von
                    1899    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
08FE                1900    WRITEPORTS:
08FE 852380         1901            mov     p0, OUTPORTA        ; teraz postupne posli data najprv na port A,
DEBUG                                                                                                         PAGE 36

0901 75A0C0         1902            mov     p2, #i8255OUTA
0904 C2B6           1903            clr     WRNOT
0906 00             1904            nop
0907 00             1905            nop
0908 00             1906            nop
0909 00             1907            nop
090A D2B6           1908            setb    WRNOT
                    1909            
090C 852480         1910            mov     p0, OUTPORTB        ; potom port B
090F 75A0C1         1911            mov     p2, #i8255OUTB
0912 C2B6           1912            clr     WRNOT
0914 00             1913            nop
0915 00             1914            nop
0916 00             1915            nop
0917 00             1916            nop
0918 D2B6           1917            setb    WRNOT
                    1918    
091A 852580         1919            mov     p0, OUTPORTC        ; a nakoniec port C
091D 75A0C2         1920            mov     p2, #i8255OUTC
0920 C2B6           1921            clr     WRNOT
0922 00             1922            nop
0923 00             1923            nop
0924 00             1924            nop
0925 00             1925            nop
0926 D2B6           1926            setb    WRNOT
0928 00             1927            nop
0929 00             1928            nop
092A 00             1929            nop
092B 00             1930            nop
092C 00             1931            nop
092D 00             1932            nop
092E 00             1933            nop
092F 00             1934            nop
0930 22             1935            ret
                    1936    
                    1937    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                    1938    
0931 0D0A5269       1939    STR_INIT:   db  0dh, 0ah, 'Riadiaci system je inicializovany.', 0dh, 0ah, 00h
0935 61646961   
0939 63692073   
093D 79737465   
0941 6D206A65   
0945 20696E69   
0949 6369616C   
094D 697A6F76   
0951 616E792E   
0955 0D0A00     
0958 52696164       1940    STR_STOP:   db  'Riadiaci system je reinicializovany po stlaceni tlacidla STOP.', 0dh, 0ah, 
                                                                               00h
095C 69616369   
0960 20737973   
0964 74656D20   
0968 6A652072   
096C 65696E69   
0970 6369616C   
0974 697A6F76   
0978 616E7920   
097C 706F2073   
DEBUG                                                                                                         PAGE 37

0980 746C6163   
0984 656E6920   
0988 746C6163   
098C 69646C61   
0990 2053544F   
0994 502E0D0A   
0998 00         
0999 4B616C69       1941    STR_CALIB:  db  'Kalibracia vytahu je ukoncena.', 0dh, 0ah, 00h
099D 62726163   
09A1 69612076   
09A5 79746168   
09A9 75206A65   
09AD 20756B6F   
09B1 6E63656E   
09B5 612E0D0A   
09B9 00         
                    1942    
----                1943            DSEG
0040                1944            org     40h
0040                1945    STACK:  DS      10h
                    1946    
                    1947    end

VERSION 1.2h ASSEMBLY COMPLETE, 1 ERRORS FOUND

ERROR SUMMARY:
Line #343, ERROR #2: Undefined symbol
DEBUG                                                                                                         PAGE 38

BMDOORCLSD . . . . . . . . . . .    NUMB  0020H  
BMDOWN . . . . . . . . . . . . .    NUMB  0002H  NOT USED  
BMDPI. . . . . . . . . . . . . .    NUMB  0020H  
BMDPKI . . . . . . . . . . . . .    NUMB  0080H  
BMDPZKI. . . . . . . . . . . . .    NUMB  0040H  
BMFAST . . . . . . . . . . . . .    NUMB  0004H  NOT USED  
BMFLED1. . . . . . . . . . . . .    NUMB  0010H  
BMFLED2. . . . . . . . . . . . .    NUMB  0020H  
BMFLED3. . . . . . . . . . . . .    NUMB  0040H  
BMFLED4. . . . . . . . . . . . .    NUMB  0080H  
BMKS . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMLEDD . . . . . . . . . . . . .    NUMB  0040H  
BMLEDU . . . . . . . . . . . . .    NUMB  0080H  
BMMB1I . . . . . . . . . . . . .    NUMB  0002H  
BMMB2I . . . . . . . . . . . . .    NUMB  0004H  
BMPI1. . . . . . . . . . . . . .    NUMB  0001H  
BMPI2D . . . . . . . . . . . . .    NUMB  0002H  
BMPI2U . . . . . . . . . . . . .    NUMB  0004H  
BMPI3D . . . . . . . . . . . . .    NUMB  0008H  
BMPI3U . . . . . . . . . . . . .    NUMB  0010H  
BMPI4. . . . . . . . . . . . . .    NUMB  0020H  
BMPKI1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKI2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKI3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKI4 . . . . . . . . . . . . .    NUMB  0010H  
BMPKO1 . . . . . . . . . . . . .    NUMB  0002H  
BMPKO2 . . . . . . . . . . . . .    NUMB  0004H  
BMPKO3 . . . . . . . . . . . . .    NUMB  0008H  
BMPKO4 . . . . . . . . . . . . .    NUMB  0010H  
BMPO1. . . . . . . . . . . . . .    NUMB  0001H  
BMPO2D . . . . . . . . . . . . .    NUMB  0002H  
BMPO2U . . . . . . . . . . . . .    NUMB  0004H  
BMPO3D . . . . . . . . . . . . .    NUMB  0008H  
BMPO3U . . . . . . . . . . . . .    NUMB  0010H  
BMPO4. . . . . . . . . . . . . .    NUMB  0020H  
BMSKRHD. . . . . . . . . . . . .    NUMB  0010H  
BMSKRHI. . . . . . . . . . . . .    NUMB  0008H  
BMSLOW . . . . . . . . . . . . .    NUMB  0008H  NOT USED  
BMSMERPI1U . . . . . . . . . . .    NUMB  003EH  NOT USED  
BMSMERPI2D . . . . . . . . . . .    NUMB  0001H  NOT USED  
BMSMERPI2U . . . . . . . . . . .    NUMB  0038H  NOT USED  
BMSMERPI3D . . . . . . . . . . .    NUMB  0007H  NOT USED  
BMSMERPI3U . . . . . . . . . . .    NUMB  0020H  NOT USED  
BMSMERPI4D . . . . . . . . . . .    NUMB  001FH  NOT USED  
BMSMERPKI1U. . . . . . . . . . .    NUMB  001CH  NOT USED  
BMSMERPKI2D. . . . . . . . . . .    NUMB  0002H  NOT USED  
BMSMERPKI2U. . . . . . . . . . .    NUMB  0018H  NOT USED  
BMSMERPKI3D. . . . . . . . . . .    NUMB  0006H  NOT USED  
BMSMERPKI3U. . . . . . . . . . .    NUMB  0010H  NOT USED  
BMSMERPKI4D. . . . . . . . . . .    NUMB  000EH  NOT USED  
BMSTOP . . . . . . . . . . . . .    NUMB  0001H  
BMUP . . . . . . . . . . . . . .    NUMB  0001H  NOT USED  
CALIB. . . . . . . . . . . . . .  C ADDR  0092H  NOT USED  
CALIBEND . . . . . . . . . . . .  C ADDR  00A9H  
CALIBEND2. . . . . . . . . . . .  C ADDR  00B4H  
CALIBLOOP. . . . . . . . . . . .  C ADDR  00A1H  
CTRLREG. . . . . . . . . . . . .  D ADDR  0027H  
D2_MB1C. . . . . . . . . . . . .  C ADDR  0425H  
DEBUG                                                                                                         PAGE 39

D3_MB1C. . . . . . . . . . . . .  C ADDR  0651H  
D3_MB2C. . . . . . . . . . . . .  C ADDR  05EDH  
D4_MB1C. . . . . . . . . . . . .  C ADDR  07ABH  
D4_MB2C. . . . . . . . . . . . .  C ADDR  0747H  
DEL1 . . . . . . . . . . . . . .  C ADDR  0861H  
DOORCLSD . . . . . . . . . . . .  B ADDR  0045H  NOT USED  
DOORCLSDOLD. . . . . . . . . . .  B ADDR  0039H  NOT USED  
DOWN . . . . . . . . . . . . . .  B ADDR  0021H  
DOWN2. . . . . . . . . . . . . .  C ADDR  03A6H  
DOWN2_MB1. . . . . . . . . . . .  C ADDR  041AH  
DOWN2_MB2. . . . . . . . . . . .  C ADDR  03EBH  
DOWN3. . . . . . . . . . . . . .  C ADDR  053FH  
DOWN3_MB1. . . . . . . . . . . .  C ADDR  05F7H  
DOWN3_MB2. . . . . . . . . . . .  C ADDR  0584H  
DOWN4. . . . . . . . . . . . . .  C ADDR  0699H  
DOWN4_MB1. . . . . . . . . . . .  C ADDR  0751H  
DOWN4_MB2. . . . . . . . . . . .  C ADDR  06DEH  
DOWNOLD. . . . . . . . . . . . .  B ADDR  003BH  
DP . . . . . . . . . . . . . . .  B ADDR  000DH  
DPK. . . . . . . . . . . . . . .  B ADDR  000FH  
DPZK . . . . . . . . . . . . . .  B ADDR  000EH  
ENDPROG. . . . . . . . . . . . .  C ADDR  081EH  NOT USED  
ERROR1 . . . . . . . . . . . . .  C ADDR  07E5H  
ERROR1C. . . . . . . . . . . . .  C ADDR  07FEH  
ERROR1S. . . . . . . . . . . . .  C ADDR  07F0H  
ERROR2 . . . . . . . . . . . . .  C ADDR  080FH  
ERR_1SPOM_C. . . . . . . . . . .  C ADDR  07B8H  
ERR_2SPOM_C. . . . . . . . . . .  C ADDR  07C7H  
ERR_SKRD . . . . . . . . . . . .  C ADDR  07DFH  
ERR_SKRH . . . . . . . . . . . .  C ADDR  07E2H  
ERR_ZAST_C . . . . . . . . . . .  C ADDR  07D6H  
EX1. . . . . . . . . . . . . . .  B ADDR  00AAH  PREDEFINED  
F1OK . . . . . . . . . . . . . .  C ADDR  00F2H  
F1S. . . . . . . . . . . . . . .  C ADDR  00D7H  
F2 . . . . . . . . . . . . . . .  C ADDR  0272H  
F2DOWN . . . . . . . . . . . . .  C ADDR  0284H  
F2OK . . . . . . . . . . . . . .  C ADDR  0244H  
F2S. . . . . . . . . . . . . . .  C ADDR  0228H  
F2SW . . . . . . . . . . . . . .  C ADDR  0258H  
F2UP . . . . . . . . . . . . . .  C ADDR  0278H  
F3 . . . . . . . . . . . . . . .  C ADDR  0492H  
F3DOWN . . . . . . . . . . . . .  C ADDR  04A4H  
F3OK . . . . . . . . . . . . . .  C ADDR  0464H  
F3S. . . . . . . . . . . . . . .  C ADDR  0448H  
F3SW . . . . . . . . . . . . . .  C ADDR  0478H  
F3UP . . . . . . . . . . . . . .  C ADDR  0498H  
F4OK . . . . . . . . . . . . . .  C ADDR  068DH  
F4S. . . . . . . . . . . . . . .  C ADDR  0672H  
FAST . . . . . . . . . . . . . .  B ADDR  0022H  
FASTOLD. . . . . . . . . . . . .  B ADDR  003CH  NOT USED  
FLED1. . . . . . . . . . . . . .  B ADDR  0024H  
FLED2. . . . . . . . . . . . . .  B ADDR  0025H  
FLED3. . . . . . . . . . . . . .  B ADDR  0026H  
FLED4. . . . . . . . . . . . . .  B ADDR  0027H  
FLOOR1 . . . . . . . . . . . . .  C ADDR  00C3H  
FLOOR2 . . . . . . . . . . . . .  C ADDR  0214H  
FLOOR3 . . . . . . . . . . . . .  C ADDR  0434H  
FLOOR4 . . . . . . . . . . . . .  C ADDR  065EH  
DEBUG                                                                                                         PAGE 40

FLOORREQ . . . . . . . . . . . .  D ADDR  0036H  NOT USED  
HIGHEST. . . . . . . . . . . . .  D ADDR  0032H  NOT USED  
I8255INA . . . . . . . . . . . .    NUMB  0080H  
I8255INB . . . . . . . . . . . .    NUMB  0081H  
I8255INC . . . . . . . . . . . .    NUMB  0082H  
I8255INCW. . . . . . . . . . . .    NUMB  0083H  
I8255OUTA. . . . . . . . . . . .    NUMB  00C0H  
I8255OUTB. . . . . . . . . . . .    NUMB  00C1H  
I8255OUTC. . . . . . . . . . . .    NUMB  00C2H  
I8255OUTCW . . . . . . . . . . .    NUMB  00C3H  
INPORTA. . . . . . . . . . . . .  D ADDR  0028H  
INPORTB. . . . . . . . . . . . .  D ADDR  0021H  
INPORTBOLD . . . . . . . . . . .  D ADDR  0026H  
INPORTC. . . . . . . . . . . . .  D ADDR  0022H  
INT_TIMER0 . . . . . . . . . . .                 UNDEFINED  
KS . . . . . . . . . . . . . . .  B ADDR  0018H  
LEDD . . . . . . . . . . . . . .  B ADDR  002EH  
LEDU . . . . . . . . . . . . . .  B ADDR  002FH  
LOWEST . . . . . . . . . . . . .  D ADDR  0031H  NOT USED  
MAIN . . . . . . . . . . . . . .  C ADDR  00C3H  NOT USED  
MB1. . . . . . . . . . . . . . .  B ADDR  0009H  
MB1OLD . . . . . . . . . . . . .  B ADDR  0031H  NOT USED  
MB2. . . . . . . . . . . . . . .  B ADDR  000AH  
MB2OLD . . . . . . . . . . . . .  B ADDR  0032H  NOT USED  
OUTPORTA . . . . . . . . . . . .  D ADDR  0023H  
OUTPORTB . . . . . . . . . . . .  D ADDR  0024H  
OUTPORTBOLD. . . . . . . . . . .  D ADDR  0034H  NOT USED  
OUTPORTC . . . . . . . . . . . .  D ADDR  0025H  
P0 . . . . . . . . . . . . . . .  D ADDR  0080H  PREDEFINED  
P2 . . . . . . . . . . . . . . .  D ADDR  00A0H  PREDEFINED  
P3 . . . . . . . . . . . . . . .  D ADDR  00B0H  PREDEFINED  
PI1. . . . . . . . . . . . . . .  B ADDR  0010H  NOT USED  
PI2D . . . . . . . . . . . . . .  B ADDR  0011H  
PI2U . . . . . . . . . . . . . .  B ADDR  0012H  
PI3D . . . . . . . . . . . . . .  B ADDR  0013H  
PI3U . . . . . . . . . . . . . .  B ADDR  0014H  
PI4. . . . . . . . . . . . . . .  B ADDR  0015H  NOT USED  
PKI1 . . . . . . . . . . . . . .  B ADDR  0041H  NOT USED  
PKI2 . . . . . . . . . . . . . .  B ADDR  0042H  
PKI3 . . . . . . . . . . . . . .  B ADDR  0043H  
PKI4 . . . . . . . . . . . . . .  B ADDR  0044H  NOT USED  
PKO1 . . . . . . . . . . . . . .  B ADDR  0019H  
PKO2 . . . . . . . . . . . . . .  B ADDR  001AH  
PKO3 . . . . . . . . . . . . . .  B ADDR  001BH  
PKO4 . . . . . . . . . . . . . .  B ADDR  001CH  
PO1. . . . . . . . . . . . . . .  B ADDR  0028H  
PO2D . . . . . . . . . . . . . .  B ADDR  0029H  
PO2U . . . . . . . . . . . . . .  B ADDR  002AH  
PO3D . . . . . . . . . . . . . .  B ADDR  002BH  
PO3U . . . . . . . . . . . . . .  B ADDR  002CH  
PO4. . . . . . . . . . . . . . .  B ADDR  002DH  
POSITION . . . . . . . . . . . .  D ADDR  0030H  NOT USED  
RDNOT. . . . . . . . . . . . . .  B ADDR  00B7H  
READPORTS. . . . . . . . . . . .  C ADDR  08A3H  
READPORTS1 . . . . . . . . . . .  C ADDR  0867H  
READPORTS_C. . . . . . . . . . .  C ADDR  08EBH  
READPORTS_C1 . . . . . . . . . .  C ADDR  08E5H  
RESET. . . . . . . . . . . . . .  C ADDR  0033H  NOT USED  
DEBUG                                                                                                         PAGE 41

SKRD . . . . . . . . . . . . . .  B ADDR  000CH  
SKRDOLD. . . . . . . . . . . . .  B ADDR  0034H  NOT USED  
SKRH . . . . . . . . . . . . . .  B ADDR  000BH  
SKRHOLD. . . . . . . . . . . . .  B ADDR  0033H  NOT USED  
SLOW . . . . . . . . . . . . . .  B ADDR  0023H  
SLOWOLD. . . . . . . . . . . . .  B ADDR  003DH  NOT USED  
SP . . . . . . . . . . . . . . .  D ADDR  0081H  PREDEFINED  
STACK. . . . . . . . . . . . . .  D ADDR  0040H  
START. . . . . . . . . . . . . .  C ADDR  0033H  
STOP . . . . . . . . . . . . . .  C ADDR  0840H  
STOPC. . . . . . . . . . . . . .  C ADDR  0850H  
STOPNOT. . . . . . . . . . . . .  B ADDR  0040H  
STOPPED. . . . . . . . . . . . .  B ADDR  0038H  
STOPTIMER. . . . . . . . . . . .  D ADDR  0033H  
STR_CALIB. . . . . . . . . . . .  C ADDR  0999H  NOT USED  
STR_INIT . . . . . . . . . . . .  C ADDR  0931H  NOT USED  
STR_STOP . . . . . . . . . . . .  C ADDR  0958H  NOT USED  
TIME0. . . . . . . . . . . . . .  C ADDR  082CH  
TIME1. . . . . . . . . . . . . .  C ADDR  082EH  
TIME10MS . . . . . . . . . . . .  C ADDR  082AH  
TIME2. . . . . . . . . . . . . .  C ADDR  0832H  
TIME3. . . . . . . . . . . . . .  C ADDR  0836H  
TIME4. . . . . . . . . . . . . .  C ADDR  083DH  
TIMERCONST . . . . . . . . . . .    NUMB  00FAH  NOT USED  
U1_MB1C. . . . . . . . . . . . .  C ADDR  0206H  
U1_MB2C. . . . . . . . . . . . .  C ADDR  01A7H  
U2_MB1C. . . . . . . . . . . . .  C ADDR  0398H  
U2_MB2C. . . . . . . . . . . . .  C ADDR  0339H  
U3_MB1C. . . . . . . . . . . . .  C ADDR  052FH  
UP . . . . . . . . . . . . . . .  B ADDR  0020H  
UP1. . . . . . . . . . . . . . .  C ADDR  00FEH  
UP1A . . . . . . . . . . . . . .  C ADDR  011BH  
UP1_MB1. . . . . . . . . . . . .  C ADDR  01B1H  
UP1_MB2. . . . . . . . . . . . .  C ADDR  0143H  
UP2. . . . . . . . . . . . . . .  C ADDR  0290H  
UP2A . . . . . . . . . . . . . .  C ADDR  02ADH  
UP2_MB1. . . . . . . . . . . . .  C ADDR  0343H  
UP2_MB2. . . . . . . . . . . . .  C ADDR  02D5H  
UP3. . . . . . . . . . . . . . .  C ADDR  04B0H  
UP3A . . . . . . . . . . . . . .  C ADDR  04CDH  
UP3_MB1. . . . . . . . . . . . .  C ADDR  0524H  
UP3_MB2. . . . . . . . . . . . .  C ADDR  04F5H  
UPOLD. . . . . . . . . . . . . .  B ADDR  003AH  
WAITFORTIMER . . . . . . . . . .  C ADDR  085FH  
WRITEPORTS . . . . . . . . . . .  C ADDR  08FEH  
WRNOT. . . . . . . . . . . . . .  B ADDR  00B6H  
